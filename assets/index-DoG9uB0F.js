import{c as ee,u as w,a as H,b as O,r as l,j as e,D as se,d as te,e as ae,f as re,g as oe,L as $,I as L,T as ne,h as ie,B as f,i as b,k as v,l as U,m as B,F as z,S as le,n as ce,C as de,o as k,M as A,p as me,q as M,s as _,t as ue,v as q}from"./index-mU7h8hRK.js";import{E as xe,A as pe,C as he,a as ge,b as je,c as fe}from"./empty-state-BcsK6Lbn.js";import{A as be,L as Ne}from"./app-header-uGGFvY-e.js";import{u as ve,O as ye,C as we}from"./onboarding-tour-Del2Lgds.js";import{P as I}from"./plus-BEmJsT-E.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=ee("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);function ke({open:s,onOpenChange:a}){const{t}=w(),m=H(),{createProject:i}=O(),[o,n]=l.useState({name:"",description:"",version:""}),[d,x]=l.useState({}),[p,y]=l.useState(!1),h=(c,N)=>{n(C=>({...C,[c]:N})),d[c]&&x(C=>({...C,[c]:null}))},g=()=>{const c={};return o.name.trim()?/\s/.test(o.name)&&(c.name="Name cannot contain whitespace"):c.name=t("validation.required"),x(c),Object.keys(c).length===0},j=async c=>{if(c.preventDefault(),!!g()){y(!0);try{const N=await i({name:o.name.trim(),description:o.description.trim(),version:o.version.trim()||"1.0.0"});n({name:"",description:"",version:""}),x({}),a(!1),m({to:"/projects/$projectId",params:{projectId:N.id}})}catch(N){console.error("Error creating project:",N),x({submit:t("common.error")})}finally{y(!1)}}},r=()=>{n({name:"",description:"",version:""}),x({}),a(!1)};return e.jsx(se,{open:s,onOpenChange:a,children:e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:t("projects.createNew")}),e.jsx(oe,{children:t("projects.createFirst")})]}),e.jsxs("form",{onSubmit:j,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{htmlFor:"name",children:[t("projects.projectName")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(L,{id:"name",placeholder:"My Awesome Game",value:o.name,onChange:c=>h("name",c.target.value),className:d.name?"border-destructive":"",autoFocus:!0}),d.name&&e.jsx("p",{className:"text-xs text-destructive",children:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"description",children:t("projects.projectDescription")}),e.jsx(ne,{id:"description",placeholder:"A brief description of your project...",value:o.description,onChange:c=>h("description",c.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"version",children:"Version"}),e.jsx(L,{id:"version",placeholder:"1.0.0",value:o.version,onChange:c=>h("version",c.target.value)})]}),d.submit&&e.jsx("p",{className:"text-sm text-destructive",children:d.submit})]})}),e.jsxs(ie,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:r,disabled:p,children:t("common.cancel")}),e.jsx(f,{type:"submit",disabled:p,children:t(p?"common.loading":"common.create")})]})]})]})})}const Q=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:b("w-full caption-bottom text-sm",s),...a})}));Q.displayName="Table";const V=l.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:b("[&_tr]:border-b",s),...a}));V.displayName="TableHeader";const G=l.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:b("[&_tr:last-child]:border-0",s),...a}));G.displayName="TableBody";const De=l.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:b("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));De.displayName="TableFooter";const F=l.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:b("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));F.displayName="TableRow";const T=l.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:b("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));T.displayName="TableHead";const E=l.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:b("p-2 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));E.displayName="TableCell";const Se=l.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:b("mt-4 text-sm text-muted-foreground",s),...a}));Se.displayName="TableCaption";async function Te(){try{return"storage"in navigator&&"estimate"in navigator.storage?(await navigator.storage.estimate()).usage||0:await Ee()}catch(s){return console.error("Error calculating disk usage:",s),0}}async function Ee(){try{const[s,a,t,m,i,o,n]=await Promise.all([v.projects.count(),v.dialogues.count(),v.nodes.count(),v.edges.count(),v.participants.count(),v.categories.count(),v.decorators.count()]);return s*500+a*300+t*200+m*100+(i+o+n)*150}catch(s){return console.error("Error estimating data size:",s),0}}function Ie({onNewProject:s,onSearch:a,searchQuery:t,onShowTour:m}){const{t:i}=w(),{status:o,setLoginDialogOpen:n}=B(),d=i(o==="connected"?"sync.status.connected":o==="syncing"?"sync.status.syncing":"sync.status.disconnected"),x=o==="connected"?"text-emerald-500":o==="syncing"?"text-amber-500":o==="error"?"text-red-500":"text-muted-foreground";return e.jsx(be,{containerClassName:"max-w-7xl mx-auto",leftClassName:"hidden md:flex items-center gap-3 justify-between md:justify-start min-w-0",rightClassName:`${k()?"w-full justify-between":""}`,left:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center",children:e.jsx(A,{className:"h-6 w-6 text-primary-foreground"})}),e.jsxs("div",{className:"hidden sm:block min-w-0",children:[e.jsx("h1",{className:"text-base lg:text-lg font-bold tracking-tight truncate",children:i("app.title")}),e.jsx("p",{className:"hidden xl:block text-xs text-muted-foreground",children:i("app.subtitle")})]})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex-1 md:w-44 lg:w-64 md:flex-none hidden md:block","data-tour":"search","data-header-mobile-hidden":!0,children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(L,{type:"text",placeholder:i("common.search"),value:t,onChange:p=>a(p.target.value),className:"pl-9 h-9"})]}),e.jsx(Ne,{}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>n(!0),className:"rounded-full","aria-label":`${i("sync.title")} - ${d}`,title:`${i("sync.title")} - ${d}`,children:e.jsx(de,{className:`h-4 w-4 ${x}`})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:m,className:"rounded-full shrink-0 hidden lg:inline-flex","data-header-mobile-hidden":!0,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsxs(f,{onClick:s,size:"sm",className:`gap-1 md:inline-flex whitespace-nowrap ${k()?"hidden":""}`,"data-tour":`${k()?"":"create-project"}`,"aria-label":i("projects.createNew"),"data-header-mobile-hidden":!0,children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:i("projects.createNew")})]})]})})}function Pe({projectCount:s,dialogueCount:a,diskUsage:t}){const{t:m}=w(),[i,o]=l.useState(!k()),[n,d]=l.useState(),[x,p]=l.useState(0),y=l.useRef(pe({delay:2500,stopOnInteraction:!1}));l.useEffect(()=>{const r=()=>o(!k());return r(),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),window.addEventListener("device-override",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r),window.removeEventListener("device-override",r)}},[]);const h=!i;l.useEffect(()=>{h||p(0)},[h]),l.useEffect(()=>{if(!n||!h)return;const r=()=>{p(n.selectedScrollSnap())};return r(),n.on("select",r),n.on("reInit",r),()=>{n.off("select",r),n.off("reInit",r)}},[n,h]);const g=[{id:"projects",label:m("projects.title"),value:s,iconContainerClass:"bg-blue-50 dark:bg-blue-900/20",icon:e.jsx(z,{className:"h-6 w-6 text-primary"})},{id:"dialogues",label:m("dialogues.title"),value:a,iconContainerClass:"bg-purple-50 dark:bg-purple-900/20",icon:e.jsx(A,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})},{id:"disk",label:m("dashboard.diskUsage"),value:t,iconContainerClass:"bg-orange-50 dark:bg-orange-900/20",icon:e.jsx(Ce,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"})}],j=(r,c=!1)=>e.jsx(M,{children:e.jsx(q,{className:c?"p-5":"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r.label}),e.jsx("h3",{className:`${c?"text-2xl":"text-3xl"} font-bold mt-2`,children:r.value})]}),e.jsx("div",{className:`w-12 h-12 rounded-full ${r.iconContainerClass} flex items-center justify-center`,children:r.icon})]})})},r.id);return h?e.jsxs("div",{className:"relative",children:[e.jsx(he,{opts:{loop:!0},plugins:[y.current],setApi:d,className:"w-full",children:e.jsx(ge,{className:"-ml-1",children:g.map(r=>e.jsx(je,{className:"basis-full pl-1",children:j(r,!0)},r.id))})}),e.jsx("div",{className:"mt-3 flex items-center justify-center gap-2",children:g.map((r,c)=>e.jsx("button",{type:"button",onClick:()=>n==null?void 0:n.scrollTo(c),className:`h-2 rounded-full transition-all ${x===c?"w-5 bg-primary":"w-2 bg-muted-foreground/40"}`,"aria-label":r.label},r.id))})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:g.map(r=>j(r))})}function $e({project:s}){const{t:a}=w(),{dialogues:t}=U(),m=t.filter(x=>x.projectId===s.id),i=["from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20","from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20","from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20","from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20"],o=["text-blue-500 dark:text-blue-400","text-purple-500 dark:text-purple-400","text-orange-500 dark:text-orange-400","text-green-500 dark:text-green-400"],n=["#3b82f6","#9333ea","#f97316","#22c55e"],d=parseInt(s.id.substring(0,8),16)%i.length;return e.jsx(ue,{to:"/projects/$projectId",params:{projectId:s.id},children:e.jsxs(M,{className:"group cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all h-full min-h-[280px] flex flex-col overflow-hidden rounded-lg",children:[e.jsxs("div",{className:`h-32 bg-gradient-to-br ${i[d]} flex items-center justify-center relative overflow-hidden rounded-t-lg`,children:[e.jsx("div",{className:"absolute inset-0 opacity-30 dark:opacity-20 bg-[radial-gradient(circle,currentColor_1px,transparent_1px)] [background-size:16px_16px]",style:{color:n[d]}}),e.jsx(z,{className:`h-12 w-12 ${o[d]} opacity-80 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 relative z-10`}),e.jsxs("div",{className:"absolute top-3 right-3 text-xs text-muted-foreground flex items-center gap-1 bg-background/90 backdrop-blur-sm px-2 py-1 rounded-full",children:[e.jsx(fe,{className:"h-3 w-3"}),_(s.createdAt)]})]}),e.jsxs(q,{className:"p-4 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-base group-hover:text-primary transition-colors line-clamp-1",children:s.name}),s.version&&e.jsxs("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded",children:["v",s.version]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2 leading-relaxed",children:s.description}),e.jsx("div",{className:"mt-auto pt-3 border-t flex items-center justify-center text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(A,{className:`h-3.5 w-3.5 group-hover:${o[d].replace("text-","text-")} transition-colors`}),e.jsxs("span",{className:"font-medium",children:[m.length," ",m.length===1?a("dialogues.title").slice(0,-1):a("dialogues.title")]})]})})]})]})})}function Le({projects:s,dialogueCountByProject:a,onOpenProject:t,onCreateProject:m}){const{t:i}=w();return e.jsxs("div",{className:"md:hidden space-y-3","data-tour":"projects-grid",children:[e.jsxs(f,{onClick:m,className:"w-full gap-2",size:"sm",children:[e.jsx(I,{className:"h-4 w-4"}),i("projects.createNew")]}),e.jsx(M,{className:"overflow-hidden",children:e.jsxs(Q,{children:[e.jsx(V,{children:e.jsxs(F,{children:[e.jsx(T,{className:"min-w-[8rem]",children:i("projects.projectName")}),e.jsx(T,{className:"min-w-[6.5rem]",children:i("projects.created")}),e.jsx(T,{className:"w-[4.5rem] text-center",children:i("dialogues.title")})]})}),e.jsx(G,{children:s.map(o=>e.jsxs(F,{tabIndex:0,onClick:()=>t(o.id),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),t(o.id))},className:"cursor-pointer select-none active:bg-accent/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/60",children:[e.jsx(E,{className:"py-4 font-semibold",children:e.jsx("span",{className:"block max-w-[8rem] truncate",children:o.name})}),e.jsx(E,{className:"py-4 text-muted-foreground whitespace-nowrap",children:_(o.createdAt)}),e.jsx(E,{className:"py-4 text-center font-medium",children:a[o.id]||0})]},o.id))})]})})]})}function He(){const{t:s}=w(),a=H(),{projects:t,loadProjects:m,isLoading:i,createOnboardingExampleProject:o}=O(),{dialogues:n,loadDialogues:d}=U(),{lastSyncedAt:x}=B(),[p,y]=l.useState(""),[h,g]=l.useState(!1),[j,r]=l.useState(!1),[c,N]=l.useState(0),{runTour:C,finishTour:R,resetTour:K}=ve("dashboard");l.useEffect(()=>{m()},[m]),l.useEffect(()=>{x&&(m(),d())},[x,m,d]),l.useEffect(()=>{(async()=>{const S=await Te();N(S)})()},[t,n]);const D=()=>{g(!0)},J=u=>{a({to:"/projects/$projectId",params:{projectId:u}})},W=async()=>{if(!j){r(!0);try{const u=await o();R(),await m(),await d(),a({to:"/projects/$projectId",params:{projectId:u.projectId}})}catch(u){console.error("Error creating example project:",u)}finally{r(!1)}}},P=t.filter(u=>u.name.toLowerCase().includes(p.toLowerCase())),X=l.useMemo(()=>n.reduce((u,S)=>(u[S.projectId]=(u[S.projectId]||0)+1,u),{}),[n]),Y=n.length,Z=me(c);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background to-muted/20 overflow-x-clip",children:[e.jsx(ye,{run:C,onFinish:R,tourType:"dashboard"}),e.jsx(ke,{open:h,onOpenChange:g}),e.jsx(Ie,{onNewProject:D,onSearch:y,searchQuery:p,onShowTour:K}),e.jsxs("main",{className:"flex-1 p-6 md:p-12 max-w-7xl mx-auto w-full",children:[e.jsx(Pe,{projectCount:t.length,dialogueCount:Y,diskUsage:Z}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-xl font-bold tracking-tight",children:s("projects.recentProjects")})}),i?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:s("common.loading")})}):P.length===0?e.jsx(xe,{icon:z,title:s("projects.noProjects"),description:s("projects.createFirst"),action:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs(f,{onClick:D,children:[e.jsx(I,{className:"h-4 w-4"}),s("projects.createNew")]}),t.length===0&&e.jsxs(f,{variant:"outline",onClick:W,disabled:j,children:[e.jsx(le,{className:"h-4 w-4"}),s(j?"common.loading":"tour.dashboard.exampleAction")]})]}),tips:["Projects help organize your dialogues by game or story","Each project can contain multiple dialogues","Use the search bar to quickly find projects"]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{projects:P,dialogueCountByProject:X,onOpenProject:J,onCreateProject:D}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6","data-tour":"projects-grid",children:[P.map(u=>e.jsx($e,{project:u},u.id)),e.jsxs("button",{onClick:D,className:"border-2 border-dashed rounded-2xl flex flex-col items-center justify-center min-h-[280px] hover:border-primary hover:bg-primary/5 transition-all group",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(I,{className:"h-8 w-8 text-primary"})}),e.jsx("span",{className:"font-bold text-lg",children:s("projects.createNew")}),e.jsx("span",{className:"text-sm text-muted-foreground mt-2",children:s("projects.createNewDescription")})]})]})]})]})]})]})}export{He as component};
