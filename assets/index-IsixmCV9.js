import{c as ee,j as e,t as _,u as L,l as Ze,v as ze,M as oe,B as k,X as Ae,C as st,w as at,m as ce,q as Ne,U as W,x as G,y as Z,n as $,o as B,F as rt,z as Be,s as nt,A as Ve,a as Ke,k as Me,r as j,D as te,d as se,e as ae,f as re,g as ne,L as M,I as V,T as it,h as ie,E as be,G as ye,H as we,J as Ce,K as ke,N as De,O as Ie,P as Se,Q as Pe,R as Ye,V as lt,W as He,b as ot,Y as ct,Z as dt}from"./index-Dhli5vHJ.js";import{C as mt,c as ut,a as xt,u as he,b as Xe,T as Ge,d as pe,M as ht}from"./confetti-DNPUiJMj.js";import{useCategoryStore as Q}from"./categoryStore-CW7iwFwv.js";import{D as ge,a as fe,E as je,b as ve,c as H,d as pt,N as de,C as Qe,A as gt,L as ft}from"./app-header-CAB32Odr.js";import{C as jt,E as vt}from"./empty-state-DitJ4HIr.js";import{P as q}from"./plus-SHmiLhX7.js";import{S as Nt,M as bt,A as yt}from"./sun-DeSA4H9d.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=ee("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ee("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=ee("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=ee("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ee("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ee("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Dt={variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600"}};function Le({className:a,variant:d="default",...s}){return e.jsx("div",{className:_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",Dt.variant[d],a),...s})}function It({activeSection:a,onSectionChange:d,project:s,dialogueCount:o=0,participantCount:r=0,isMobileOpen:C=!1,onMobileClose:y}){const{t:h}=L(),{status:m,setLoginDialogOpen:u}=Ze(),p=ze(x=>x.openWithContext),c={connected:"text-green-500",connecting:"text-blue-500",syncing:"text-blue-500",error:"text-red-500",disconnected:"text-muted-foreground"}[m]||"text-muted-foreground",w=[{id:"overview",label:h("navigation.dashboard"),icon:Ct,color:"text-blue-500"},{id:"dialogues",label:h("dialogues.title"),icon:oe,color:"text-blue-500",count:o},{id:"participants",label:h("participants.title"),icon:et,color:"text-purple-500",count:r},{id:"categories",label:h("categories.title"),icon:Je,color:"text-orange-500"},{id:"decorators",label:h("decorators.title"),icon:kt,color:"text-green-500"}];return e.jsxs("aside",{className:_("flex-shrink-0 bg-card border-border flex flex-col transition-transform duration-300 ease-in-out","fixed inset-y-0 left-0 z-50 h-full w-64","lg:static lg:z-0 lg:translate-x-0","lg:w-80","lg:rounded-none",C?"translate-x-0 rounded-none":"-translate-x-full lg:translate-x-0 md:rounded-xl"),children:[e.jsx("div",{className:"lg:hidden flex justify-end p-4",children:e.jsx(k,{variant:"ghost",size:"icon",onClick:y,className:"rounded-full",children:e.jsx(Ae,{className:"h-5 w-5"})})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:_("p-4 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 border border-blue-100 dark:border-blue-900/30 flex flex-col items-center text-center",C?"flex-row justify-between":""),children:[e.jsx("div",{className:_("w-12 h-12 rounded-lg bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white shadow-md mb-2",C?"hidden":""),children:e.jsx(Je,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-sm line-clamp-1",children:s==null?void 0:s.name}),(s==null?void 0:s.version)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["v",s.version]})]})}),e.jsx("nav",{className:"flex-1 px-3 py-2 space-y-1 overflow-y-auto",children:w.map(x=>{const F=x.icon,z=a===x.id;return e.jsxs("button",{onClick:()=>d(x.id),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",z?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(F,{className:_("h-5 w-5",z&&x.color)}),e.jsx("span",{className:"flex-1 text-left",children:x.label}),x.count!==void 0&&e.jsx("span",{className:"text-[10px] bg-muted px-1.5 py-0.5 rounded-md",children:x.count})]},x.id)})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>u(!0),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors","text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(st,{className:_("h-5 w-5",c)}),e.jsx("span",{children:h("sync.title")})]})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>p({context:{type:"project",projectId:s==null?void 0:s.id},onOpenSettings:d?()=>d("settings"):null,mode:"detail"}),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",a==="settings"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{children:h("navigation.settings")})]})})]})}function St({project:a,dialogues:d=[],participants:s=[],categories:o=[],decorators:r=[],onExport:C,onImport:y,onDelete:h,onSectionChange:m,fileInputRef:u,isImporting:p=!1}){const{t:c}=L(),w=ce(),x=ze(g=>g.openWithContext),F=d.reduce((g,l)=>g+(l.nodeCount||0),0),z=[...d].sort((g,l)=>new Date(l.modifiedAt)-new Date(g.modifiedAt)).slice(0,5);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 text-xs font-medium text-muted-foreground mb-4 ${w?"hidden":""}`,children:[e.jsx(Ne,{to:"/",className:"hover:text-primary cursor-pointer",children:c("projects.title")}),e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{className:"text-foreground",children:a.name})]}),e.jsxs("div",{className:"flex items-start justify-between mb-10",children:[e.jsxs("div",{className:"group flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-1",children:c("projects.projectName")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl md:text-4xl font-bold tracking-tight",children:a.name}),a.version&&e.jsxs(Le,{variant:"success",children:["v",a.version]}),e.jsx("button",{onClick:()=>x({context:{type:"project",projectId:a==null?void 0:a.id},onOpenSettings:m?()=>m("settings"):null,mode:"detail"}),className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-full hover:bg-accent text-muted-foreground hover:text-primary transition-all",title:"Project Settings",children:e.jsx(xe,{className:"h-5 w-5"})})]}),a.description&&e.jsx("p",{className:"mt-3 text-lg text-muted-foreground leading-relaxed max-w-2xl",children:a.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs(ge,{className:!0,children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var g;return(g=u==null?void 0:u.current)==null?void 0:g.click()},disabled:p,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),c("common.import")]}),e.jsxs(H,{onClick:C,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),c("common.export")]}),e.jsx(pt,{}),e.jsxs(H,{onClick:h,className:"text-destructive focus:text-destructive",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),c("common.delete")]})]})]})}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var g;return(g=u==null?void 0:u.current)==null?void 0:g.click()},disabled:p,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),c("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:C,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),c("common.export")]}),e.jsx(k,{variant:"outline",size:"sm",onClick:h,className:"gap-2 text-destructive hover:text-destructive hover:border-destructive/50",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 mb-6",children:[e.jsx($,{children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-primary shrink-0",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:"File Size"}),e.jsx("h3",{className:"text-lg font-bold",children:"--"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[F," ",c("dialogues.nodes")]})]})]})})}),e.jsx($,{children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400 shrink-0",children:e.jsx(mt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:c("projects.modified")}),e.jsx("h3",{className:"text-lg font-bold truncate",children:Be(a.modifiedAt)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Current User"})]})]})})}),e.jsx($,{children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center text-orange-600 dark:text-orange-400 shrink-0",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:c("projects.created")}),e.jsx("h3",{className:"text-lg font-bold",children:nt(a.createdAt)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.version?`v${a.version}`:"v1.0.0"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:c("dialogues.title")}),e.jsxs("button",{onClick:()=>m==null?void 0:m("dialogues"),className:"text-sm text-primary hover:text-blue-600 font-medium flex items-center gap-1 transition-colors",children:["View All ",e.jsx(We,{className:"h-4 w-4"})]})]}),e.jsx($,{children:e.jsx(B,{className:"p-0",children:z.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c("dialogues.noDialogues")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-border",children:z.map(g=>e.jsxs(Ne,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:a.id,dialogueId:g.id},className:"p-4 flex items-center justify-between group hover:bg-accent transition-colors cursor-pointer hover:rounded-lg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center text-blue-500",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:g.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Be(g.modifiedAt)," â€¢ ",g.nodeCount||0," ",c("dialogues.nodes")]})]})]}),e.jsx("button",{className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-card shadow-sm border border-border text-primary hover:bg-primary hover:text-primary-foreground transition-all",children:e.jsx(xe,{className:"h-4 w-4"})})]},g.id))}),e.jsx("div",{className:"bg-muted/50 px-4 py-3 border-t border-border text-center",children:e.jsxs("button",{type:"button",onClick:()=>m==null?void 0:m("dialogues"),className:"text-xs font-medium text-muted-foreground hover:text-primary transition-colors",children:["+ ",c("dialogues.createNew")]})})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{children:e.jsxs(B,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Project Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Project ID"}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-lg border border-border",children:[e.jsxs("code",{className:"text-xs font-mono",children:[a.id.substring(0,12),"..."]}),e.jsxs("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(a.id).then(()=>{Ve({variant:"success",title:"Copied",description:"Project ID copied to clipboard."})}).catch(()=>{Ve({variant:"error",title:"Copy failed",description:"Unable to copy Project ID."})})},className:"text-muted-foreground hover:text-primary p-1 rounded-md hover:bg-accent transition-colors","aria-label":"Copy Project ID",children:[e.jsx("span",{className:"sr-only",children:"Copy"}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("dialogues.title")}),e.jsx("span",{className:"font-medium",children:d.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("participants.title")}),e.jsx("span",{className:"font-medium",children:s.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("categories.title")}),e.jsx("span",{className:"font-medium",children:o.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:c("decorators.title")}),e.jsx("span",{className:"font-medium",children:r.length})]})]})]})]})}),s.length>0&&e.jsx($,{children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider",children:c("participants.top")}),e.jsx("button",{onClick:()=>m==null?void 0:m("participants"),className:"text-xs text-primary hover:underline",children:c("common.manage")})]}),e.jsxs("div",{className:"flex -space-x-2 overflow-hidden mb-3",children:[s.slice(0,4).map(g=>e.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-card bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:g.name.charAt(0).toUpperCase()},g.id)),s.length>4&&e.jsxs("div",{className:"h-8 w-8 rounded-full ring-2 ring-card bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:["+",s.length-4]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c("participants.inProject",{count:s.length})})]})})]})]})]})}function Pt({dialogue:a,projectId:d}){const{t:s}=L(),o=Ke(),r=ze(y=>y.openWithContext),C=a.nodeCount||0;return e.jsx(Ne,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:d,dialogueId:a.id},children:e.jsxs($,{className:"group cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all h-full flex flex-col overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 flex items-center justify-center relative overflow-hidden rounded-t-lg",children:[e.jsx("div",{className:"absolute inset-0 opacity-30 dark:opacity-20 bg-[radial-gradient(#9333ea_1px,transparent_1px)] [background-size:16px_16px]"}),e.jsx(oe,{className:"h-12 w-12 text-purple-500 dark:text-purple-400 opacity-80 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 relative z-10"}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full bg-background/90 backdrop-blur-sm",onClick:y=>{y.preventDefault(),y.stopPropagation(),r({context:{type:"dialogue",name:a.name,projectId:d,dialogueId:a.id},onOpenSettings:()=>o({to:"/projects/$projectId/dialogue/$dialogueId/settings",params:{projectId:d,dialogueId:a.id}}),mode:"detail"})},children:e.jsx(wt,{className:"h-3.5 w-3.5"})})})]}),e.jsxs(B,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsx("h3",{className:"font-bold text-base group-hover:text-primary transition-colors line-clamp-1",children:a.name})}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2 leading-relaxed",children:a.description}),e.jsx("div",{className:"mt-auto pt-3 border-t flex items-center justify-center text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{className:"h-3.5 w-3.5 group-hover:text-purple-500 transition-colors"}),e.jsx("span",{className:"font-medium",children:s("dialogues.nodeCount",{count:C})})]})})]})]})})}function Et({open:a,onOpenChange:d,projectId:s}){const{t:o}=L(),r=Ke(),{createDialogue:C,dialogues:y}=Me(),[h,m]=j.useState({name:"",description:""}),[u,p]=j.useState({}),[c,w]=j.useState(!1),x=(l,n)=>{m(t=>({...t,[l]:n})),u[l]&&p(t=>({...t,[l]:null}))},F=()=>{const l={};return h.name.trim()?/\s/.test(h.name)&&(l.name="Name cannot contain whitespace"):l.name=o("validation.required"),p(l),Object.keys(l).length===0},z=async l=>{if(l.preventDefault(),!!F()){w(!0);try{const t=y.filter(v=>v.projectId===s).length===0,i=await C({projectId:s,name:h.name.trim(),description:h.description.trim()});t?ut():xt(),m({name:"",description:""}),p({}),d(!1),setTimeout(()=>{r({to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:s,dialogueId:i.id}})},1e3)}catch(n){console.error("Error creating dialogue:",n),p({submit:o("common.error")})}finally{w(!1)}}},g=()=>{m({name:"",description:""}),p({}),d(!1)};return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:o("dialogues.createNew")}),e.jsx(ne,{children:o("dialogues.createFirst")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"dialogue-name",children:[o("dialogues.dialogueName")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"dialogue-name",placeholder:"Welcome Conversation",value:h.name,onChange:l=>x("name",l.target.value),className:u.name?"border-destructive":"",autoFocus:!0}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"dialogue-description",children:o("projects.projectDescription")}),e.jsx(it,{id:"dialogue-description",placeholder:"A brief description of this dialogue...",value:h.description,onChange:l=>x("description",l.target.value),rows:3})]}),u.submit&&e.jsx("p",{className:"text-sm text-destructive",children:u.submit})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:g,disabled:c,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:c,children:o(c?"common.loading":"common.create")})]})]})]})})}function Ft({projectId:a,dialogues:d=[]}){const{t:s}=L(),{importDialogue:o}=Me(),[r,C]=j.useState(!1),[y,h]=j.useState(!1),m=j.useRef(null),u=ce(),p=async c=>{var x;const w=(x=c.target.files)==null?void 0:x[0];if(w){h(!0);try{await o(a,w)}catch(F){console.error("Failed to import dialogue:",F)}finally{h(!1),m.current&&(m.current.value="")}}};return e.jsxs("div",{children:[e.jsx(Et,{open:r,onOpenChange:C,projectId:a}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("dialogues.title")," (",d.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:m,type:"file",accept:".mnteadlg",onChange:p,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(ve,{align:"end",children:e.jsxs(H,{onClick:()=>{var c;return(c=m.current)==null?void 0:c.click()},disabled:y,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]})})]}),e.jsxs(k,{size:"icon",onClick:()=>C(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(q,{className:"h-4 w-4"}),!u&&s("dialogues.createNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var c;return(c=m.current)==null?void 0:c.click()},disabled:y,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{size:"sm",onClick:()=>C(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("dialogues.createNew")]})]})]})]}),d.length===0?e.jsx(vt,{icon:oe,title:s("dialogues.noDialogues"),description:s("dialogues.createFirst"),action:e.jsxs(k,{type:"button",onClick:()=>C(!0),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),s("dialogues.createNew")]}),tips:["Dialogues are the backbone of your interactive narratives","Use nodes to create branching conversations","Connect nodes to create dialogue flow"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(c=>e.jsx(Pt,{dialogue:c,projectId:a},c.id))})]})}function zt({open:a,onOpenChange:d,projectId:s}){const{t:o}=L(),{createParticipant:r,participants:C}=he(),{categories:y,loadCategories:h}=Q(),[m,u]=j.useState(!1),[p,c]=j.useState({name:"",category:""}),[w,x]=j.useState({});j.useEffect(()=>{a&&s&&h(s)},[a,s,h]);const F=n=>{const t=[];let i=y.find(v=>v.id===n);for(;i;)t.unshift(i.name),i=y.find(v=>v.id===i.parentCategoryId);return t.join(" > ")},z=(()=>{const n=new Map;return y.forEach(t=>{const i=F(t.id);if(!i)return;const[v]=i.split(" > ");n.has(v)||n.set(v,[]),n.get(v).push({id:t.id,name:t.name,label:i})}),Array.from(n.entries()).map(([t,i])=>({label:t,options:i.sort((v,S)=>v.label.localeCompare(S.label))})).sort((t,i)=>t.label.localeCompare(i.label))})(),g=()=>{const n={};if(p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(n.name="Name must be 16 characters or fewer"):n.name="Name must contain only letters and numbers":n.name=o("validation.required"),p.category||(n.category=o("validation.required")),!n.name&&p.category){const t=p.name.trim(),i=y.filter(D=>D.name===p.category),v=D=>{let f=D;const I=new Set;for(;f;){if(I.has(f))return null;I.add(f);const b=y.find(P=>P.id===f);if(!b)return null;if(!b.parentCategoryId)return b.id;f=b.parentCategoryId}return null},S=i.map(D=>v(D.id)).filter(Boolean),N=C.filter(D=>D.projectId===s).some(D=>{if(D.name!==t)return!1;const f=y.find(b=>b.name===D.category);if(!f)return!1;const I=v(f.id);return I&&S.includes(I)});S.length>0&&N&&(n.name="Participant name must be unique within its category tree")}return x(n),Object.keys(n).length===0},l=async n=>{if(n.preventDefault(),!!g()){u(!0);try{await r({...p,projectId:s}),c({name:"",category:""}),x({}),d(!1)}catch(t){console.error("Failed to create participant:",t)}finally{u(!1)}}};return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:o("participants.addNew")}),e.jsx(ne,{children:o("participants.createDescription")})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:p.name,onChange:n=>{c({...p,name:n.target.value}),w.name&&x({...w,name:null})},placeholder:o("participants.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[o("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(de,{id:"category",value:p.category,onChange:n=>{c({...p,category:n.target.value}),w.category&&x({...w,category:null})},className:w.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:o("participants.categoryPlaceholder")}),z.length===0?e.jsx("option",{value:"",disabled:!0,children:o("categories.noCategories")}):z.map(n=>e.jsx("optgroup",{label:n.label,children:n.options.map(t=>e.jsx("option",{value:t.name,children:t.label},t.id))},n.label))]}),w.category&&e.jsx("p",{className:"text-xs text-destructive",children:w.category})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:m,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:m||!p.name.trim()||!p.category,children:o(m?"common.creating":"common.create")})]})]})]})})}function At({open:a,onOpenChange:d,participant:s,projectId:o}){const{t:r}=L(),{updateParticipant:C,participants:y}=he(),{categories:h,loadCategories:m}=Q(),[u,p]=j.useState(!1),[c,w]=j.useState({name:"",category:""}),[x,F]=j.useState({});j.useEffect(()=>{a&&o&&m(o),a&&s&&w({name:s.name||"",category:s.category||""})},[a,o,s,m]);const z=t=>{const i=[];let v=h.find(S=>S.id===t);for(;v;)i.unshift(v.name),v=h.find(S=>S.id===v.parentCategoryId);return i.join(" > ")},g=(()=>{const t=new Map;return h.forEach(i=>{const v=z(i.id);if(!v)return;const[S]=v.split(" > ");t.has(S)||t.set(S,[]),t.get(S).push({id:i.id,name:i.name,label:v})}),Array.from(t.entries()).map(([i,v])=>({label:i,options:v.sort((S,E)=>S.label.localeCompare(E.label))})).sort((i,v)=>i.label.localeCompare(v.label))})();j.useEffect(()=>{a||F({})},[a]);const l=()=>{const t={};if(c.name.trim()?/^[A-Za-z0-9]+$/.test(c.name)?c.name.length>16&&(t.name="Name must be 16 characters or fewer"):t.name="Name must contain only letters and numbers":t.name=r("validation.required"),c.category||(t.category=r("validation.required")),!t.name&&c.category&&s){const i=c.name.trim(),v=h.filter(f=>f.name===c.category),S=f=>{let I=f;const b=new Set;for(;I;){if(b.has(I))return null;b.add(I);const P=h.find(O=>O.id===I);if(!P)return null;if(!P.parentCategoryId)return P.id;I=P.parentCategoryId}return null},E=v.map(f=>S(f.id)).filter(Boolean),D=y.filter(f=>f.projectId===o).some(f=>{if(f.id===s.id||f.name!==i)return!1;const I=h.find(P=>P.name===f.category);if(!I)return!1;const b=S(I.id);return b&&E.includes(b)});E.length>0&&D&&(t.name="Participant name must be unique within its category tree")}return F(t),Object.keys(t).length===0},n=async t=>{if(t.preventDefault(),!!l()){p(!0);try{await C(s.id,c),d(!1)}catch(i){console.error("Failed to update participant:",i)}finally{p(!1)}}};return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[r("common.edit")," ",r("participants.title").slice(0,-1)]}),e.jsx(ne,{children:r("participants.updateDescription")})]}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:c.name,onChange:t=>{w({...c,name:t.target.value}),x.name&&F({...x,name:null})},placeholder:r("participants.namePlaceholder"),className:x.name?"border-destructive":"",required:!0}),x.name&&e.jsx("p",{className:"text-xs text-destructive",children:x.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[r("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(de,{id:"category",value:c.category,onChange:t=>{w({...c,category:t.target.value}),x.category&&F({...x,category:null})},className:x.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:r("participants.categoryPlaceholder")}),g.length===0?e.jsx("option",{value:"",disabled:!0,children:r("categories.noCategories")}):g.map(t=>e.jsx("optgroup",{label:t.label,children:t.options.map(i=>e.jsx("option",{value:i.name,children:i.label},i.id))},t.label))]}),x.category&&e.jsx("p",{className:"text-xs text-destructive",children:x.category})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:u,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:u||!c.name.trim()||!c.category,children:r(u?"common.saving":"common.save")})]})]})]})})}function _e({participant:a}){const{t:d}=L(),{deleteParticipant:s}=he(),[o,r]=j.useState(!1),[C,y]=j.useState(!1),[h,m]=j.useState(!1),u=async()=>{m(!0);try{await s(a.id),r(!1)}catch(p){console.error("Failed to delete participant:",p)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.category&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.category})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>r(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(At,{open:C,onOpenChange:y,participant:a,projectId:a.projectId}),e.jsx(be,{open:o,onOpenChange:r,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:d("participants.deleteTitle")}),e.jsx(De,{children:d("participants.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:h,children:d("common.cancel")}),e.jsx(Pe,{variant:"destructive",onClick:u,disabled:h,children:d(h?"common.deleting":"common.delete")})]})]})})]})}function Mt({projectId:a,participants:d=[]}){const{t:s}=L(),{importParticipants:o,exportParticipants:r}=he(),{categories:C,loadCategories:y}=Q(),[h,m]=j.useState(!1),[u,p]=j.useState(!1),c=j.useRef(null),w=ce(),[x,F]=j.useState(new Set);j.useEffect(()=>{a&&y(a)},[a,y]);const{rootCategories:z,childrenByParent:g,participantsByCategory:l,unmatchedParticipants:n}=j.useMemo(()=>{const N=new Map;C.forEach(b=>{const P=b.parentCategoryId||null;N.has(P)||N.set(P,[]),N.get(P).push(b)}),N.forEach(b=>{b.sort((P,O)=>P.name.localeCompare(O.name))});const D=new Map;C.forEach(b=>{D.has(b.name)||D.set(b.name,b)});const f=new Map,I=[];return d.forEach(b=>{const P=D.get(b.category);if(!P){I.push(b);return}f.has(P.id)||f.set(P.id,[]),f.get(P.id).push(b)}),f.forEach(b=>{b.sort((P,O)=>P.name.localeCompare(O.name))}),{rootCategories:(N.get(null)||[]).slice().sort((b,P)=>b.name.localeCompare(P.name)),childrenByParent:N,participantsByCategory:f,unmatchedParticipants:I.sort((b,P)=>b.name.localeCompare(P.name))}},[C,d]),t=N=>{F(D=>{const f=new Set(D);return f.has(N)?f.delete(N):f.add(N),f})},i=N=>l.has(N)?!0:(g.get(N)||[]).some(f=>i(f.id)),v=N=>{const D=(g.get(N.id)||[]).filter(b=>i(b.id)),f=l.get(N.id)||[];if(D.length===0&&f.length===0)return null;const I=x.has(N.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>t(N.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[I?e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:N.name})]})}),!I&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[f.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(b=>e.jsx(_e,{participant:b},b.id))}),D.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:D.map(b=>v(b))})]})]},N.id)},S=async()=>{try{const N=await r(a),D=new Blob([JSON.stringify(N,null,2)],{type:"application/json"}),f=URL.createObjectURL(D),I=document.createElement("a");I.href=f,I.download=`participants-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(f)}catch(N){console.error("Failed to export participants:",N)}},E=async N=>{var f;const D=(f=N.target.files)==null?void 0:f[0];if(D){p(!0);try{const I=await D.text(),b=JSON.parse(I);await o(a,Array.isArray(b)?b:[b])}catch(I){console.error("Failed to import participants:",I)}finally{p(!1),c.current&&(c.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("participants.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("participants.description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:c,type:"file",accept:".json",onChange:E,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var N;return(N=c.current)==null?void 0:N.click()},disabled:u,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:S,disabled:d.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>m(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(q,{className:"h-4 w-4"}),!w&&s("participants.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var N;return(N=c.current)==null?void 0:N.click()},disabled:u,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:S,disabled:d.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>m(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("participants.addNew")]})]})]})]}),d.length===0?e.jsx($,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(et,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("participants.noParticipants")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("participants.noParticipantsDescription")}),e.jsxs(k,{onClick:()=>m(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("participants.addNew")]})]})})}):e.jsxs("div",{className:"space-y-6",children:[z.map(N=>v(N)),n.length>0&&e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3",children:e.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"Uncategorized"})}),e.jsx("div",{className:"p-4 pt-4 border-t border-border",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(N=>e.jsx(_e,{participant:N},N.id))})})]})]}),e.jsx(zt,{open:h,onOpenChange:m,projectId:a})]})}function Lt({open:a,onOpenChange:d,projectId:s}){const{t:o}=L(),{categories:r,createCategory:C,loadCategories:y}=Q(),[h,m]=j.useState(!1),[u,p]=j.useState({name:"",parentCategoryId:null}),[c,w]=j.useState({});j.useEffect(()=>{a&&s&&y(s)},[a,s,y]),j.useEffect(()=>{a||(p({name:"",parentCategoryId:null}),w({}))},[a]);const x=()=>{const l={};if(u.name.trim()?/^[A-Za-z0-9]+$/.test(u.name)?u.name.length>16&&(l.name="Name must be 16 characters or fewer"):l.name="Name must contain only letters and numbers":l.name=o("validation.required"),u.parentCategoryId){let t=0,i=u.parentCategoryId;const v=new Set;for(;i;){if(v.has(i)){t=Number.POSITIVE_INFINITY;break}v.add(i);const S=r.find(E=>E.id===i);if(!S)break;t+=1,i=S.parentCategoryId||null}(!Number.isFinite(t)||t+1>5)&&(l.parentCategoryId="Category depth cannot exceed 5 levels")}if(u.name.trim()){const n=u.name.trim(),t=E=>{let N=E;const D=new Set;for(;N;){if(D.has(N))return null;D.add(N);const f=r.find(I=>I.id===N);if(!f)return null;if(!f.parentCategoryId)return f.id;N=f.parentCategoryId}return null},i=u.parentCategoryId?t(u.parentCategoryId):null;(i?!(E=>{const N=[E],D=new Set;for(;N.length>0;){const f=N.pop();if(!f||D.has(f))continue;D.add(f);const I=r.find(b=>b.id===f);if(I){if(I.name===n)return!0;r.filter(b=>b.parentCategoryId===I.id).forEach(b=>N.push(b.id))}}return!1})(i):!r.some(E=>!E.parentCategoryId&&E.name===n))||(l.name="Category name must be unique within its tree")}return w(l),Object.keys(l).length===0},F=async l=>{if(l.preventDefault(),!!x()){m(!0);try{await C({name:u.name,parentCategoryId:u.parentCategoryId||null,projectId:s}),p({name:"",parentCategoryId:null}),w({}),d(!1)}catch(n){console.error("Failed to create category:",n)}finally{m(!1)}}},z=l=>{const n=[];let t=r.find(i=>i.id===l);for(;t;)n.unshift(t.name),t=r.find(i=>i.id===t.parentCategoryId);return n.join(" > ")},g=(()=>{const l=new Map;return r.forEach(n=>{const t=z(n.id);if(!t)return;const[i]=t.split(" > ");l.has(i)||l.set(i,[]),l.get(i).push({id:n.id,label:t})}),Array.from(l.entries()).map(([n,t])=>({label:n,options:t.sort((i,v)=>i.label.localeCompare(v.label))})).sort((n,t)=>n.label.localeCompare(t.label))})();return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:o("categories.addNew")}),e.jsx(ne,{children:o("categories.createDescription")})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:u.name,onChange:l=>{p({...u,name:l.target.value}),c.name&&w({...c,name:null})},placeholder:o("categories.namePlaceholder"),className:c.name?"border-destructive":"",required:!0}),c.name&&e.jsx("p",{className:"text-xs text-destructive",children:c.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:o("categories.parentCategory")}),e.jsxs(de,{id:"parentCategory",value:u.parentCategoryId||"none",onChange:l=>{const n=l.target.value;p({...u,parentCategoryId:n==="none"?null:n}),c.parentCategoryId?w({...c,parentCategoryId:null}):c.name&&w({...c,name:null})},children:[e.jsx("option",{value:"none",children:o("categories.noParent")}),g.map(l=>e.jsx("optgroup",{label:l.label,children:l.options.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))},l.label))]}),c.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:c.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("categories.parentCategoryHelp")})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:h,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:h||!u.name.trim(),children:o(h?"common.creating":"common.create")})]})]})]})})}function Ot({open:a,onOpenChange:d,category:s,projectId:o}){const{t:r}=L(),{categories:C,updateCategory:y,loadCategories:h}=Q(),[m,u]=j.useState(!1),[p,c]=j.useState({name:"",parentCategoryId:null}),[w,x]=j.useState({});j.useEffect(()=>{a&&o&&h(o),a&&s&&c({name:s.name||"",parentCategoryId:s.parentCategoryId||null})},[a,o,s,h]),j.useEffect(()=>{a||x({})},[a]);const F=()=>{const n={};p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(n.name="Name must be 16 characters or fewer"):n.name="Name must contain only letters and numbers":n.name=r("validation.required");const t=5,i=new Map;C.forEach(E=>{const N=E.parentCategoryId||null;i.has(N)||i.set(N,[]),i.get(N).push(E.id)});const v=E=>{const N=new Set,D=f=>{if(N.has(f))return 0;N.add(f);const I=i.get(f)||[];if(I.length===0)return 1;let b=0;return I.forEach(P=>{b=Math.max(b,D(P))}),1+b};return D(s==null?void 0:s.id)},S=E=>{let N=0,D=E;const f=new Set;for(;D;){if(f.has(D))return Number.POSITIVE_INFINITY;f.add(D);const I=C.find(b=>b.id===D);if(!I)break;N+=1,D=I.parentCategoryId||null}return N};if(s){const E=p.parentCategoryId?S(p.parentCategoryId):0,N=v(s.id),D=E+N;(!Number.isFinite(E)||D>t)&&(n.parentCategoryId=`Category depth cannot exceed ${t} levels`)}if(s&&p.name.trim()){const E=p.name.trim(),N=b=>{let P=b;const O=new Set;for(;P;){if(O.has(P))return null;O.add(P);const T=C.find(K=>K.id===P);if(!T)return null;if(!T.parentCategoryId)return T.id;P=T.parentCategoryId}return null},D=p.parentCategoryId?N(p.parentCategoryId):s.id;(D?!(b=>{const P=[b],O=new Set;for(;P.length>0;){const T=P.pop();if(!T||O.has(T))continue;O.add(T);const K=C.find(J=>J.id===T);if(K){if(K.id!==s.id&&K.name===E)return!0;C.filter(J=>J.parentCategoryId===K.id).forEach(J=>P.push(J.id))}}return!1})(D):!C.some(b=>!b.parentCategoryId&&b.id!==s.id&&b.name===E))||(n.name="Category name must be unique within its tree")}return x(n),Object.keys(n).length===0},z=async n=>{if(n.preventDefault(),!!F()){u(!0);try{await y(s.id,{name:p.name,parentCategoryId:p.parentCategoryId||null}),d(!1)}catch(t){console.error("Failed to update category:",t)}finally{u(!1)}}},g=n=>{const t=[];let i=C.find(v=>v.id===n);for(;i;)t.unshift(i.name),i=C.find(v=>v.id===i.parentCategoryId);return t.join(" > ")},l=(()=>{const n=new Map;return C.filter(t=>t.id!==(s==null?void 0:s.id)).forEach(t=>{const i=g(t.id);if(!i)return;const[v]=i.split(" > ");n.has(v)||n.set(v,[]),n.get(v).push({id:t.id,label:i})}),Array.from(n.entries()).map(([t,i])=>({label:t,options:i.sort((v,S)=>v.label.localeCompare(S.label))})).sort((t,i)=>t.label.localeCompare(i.label))})();return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[r("common.edit")," ",r("categories.title").slice(0,-1)]}),e.jsx(ne,{children:r("categories.updateDescription")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:p.name,onChange:n=>{c({...p,name:n.target.value}),w.name&&x({...w,name:null})},placeholder:r("categories.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:r("categories.parentCategory")}),e.jsxs(de,{id:"parentCategory",value:p.parentCategoryId||"none",onChange:n=>{const t=n.target.value;c({...p,parentCategoryId:t==="none"?null:t}),w.parentCategoryId?x({...w,parentCategoryId:null}):w.name&&x({...w,name:null})},children:[e.jsx("option",{value:"none",children:r("categories.noParent")}),l.map(n=>e.jsx("optgroup",{label:n.label,children:n.options.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))},n.label))]}),w.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:w.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("categories.parentCategoryHelp")})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:m,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:m||!p.name.trim(),children:r(m?"common.saving":"common.save")})]})]})]})})}function Tt({category:a}){const{t:d}=L(),{categories:s,deleteCategory:o}=Q(),[r,C]=j.useState(!1),[y,h]=j.useState(!1),[m,u]=j.useState(!1),p=async()=>{u(!0);try{await o(a.id),C(!1)}catch(x){console.error("Failed to delete category:",x)}finally{u(!1)}},w=(()=>{if(!a.parentCategoryId)return null;const x=s.find(F=>F.id===a.parentCategoryId);return x?x.name:null})();return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center text-white",children:e.jsx(Ge,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),w&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:w})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>h(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>C(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Ot,{open:y,onOpenChange:h,category:a,projectId:a.projectId}),e.jsx(be,{open:r,onOpenChange:C,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:d("categories.deleteTitle")}),e.jsx(De,{children:d("categories.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:m,children:d("common.cancel")}),e.jsx(Pe,{variant:"destructive",onClick:p,disabled:m,children:d(m?"common.deleting":"common.delete")})]})]})})]})}function Ut({projectId:a,categories:d=[]}){const{t:s}=L(),{importCategories:o,exportCategories:r}=Q(),[C,y]=j.useState(!1),[h,m]=j.useState(!1),u=j.useRef(null),p=ce(),[c,w]=j.useState(new Set),x=new Map;d.forEach(t=>{const i=t.parentCategoryId||null;x.has(i)||x.set(i,[]),x.get(i).push(t)});const F=(x.get(null)||[]).slice().sort((t,i)=>t.name.localeCompare(i.name)),z=t=>{w(i=>{const v=new Set(i);return v.has(t)?v.delete(t):v.add(t),v})},g=t=>{const i=(x.get(t.id)||[]).slice().sort((S,E)=>S.name.localeCompare(E.name)),v=c.has(t.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>z(t.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[v?e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:t.name})]})}),!v&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(Tt,{category:t})}),i.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:i.map(S=>g(S))})]})]},t.id)},l=async()=>{try{const t=await r(a),i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),v=URL.createObjectURL(i),S=document.createElement("a");S.href=v,S.download=`categories-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(v)}catch(t){console.error("Failed to export categories:",t)}},n=async t=>{var v;const i=(v=t.target.files)==null?void 0:v[0];if(i){m(!0);try{const S=await i.text(),E=JSON.parse(S);await o(a,Array.isArray(E)?E:[E])}catch(S){console.error("Failed to import categories:",S)}finally{m(!1),u.current&&(u.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("categories.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("categories.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".json",onChange:n,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},disabled:h,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:l,disabled:d.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(q,{className:"h-4 w-4"}),!p&&s("categories.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},disabled:h,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:l,disabled:d.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("categories.addNew")]})]})]})]}),d.length===0?e.jsx($,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ge,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("categories.noCategories")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("categories.noCategoriesDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("categories.addNew")]})]})})}):e.jsx("div",{className:"space-y-6",children:F.map(t=>g(t))}),e.jsx(Lt,{open:C,onOpenChange:y,projectId:a})]})}function qt({open:a,onOpenChange:d,projectId:s}){const{t:o}=L(),{createDecorator:r}=pe(),[C,y]=j.useState(!1),[h,m]=j.useState({name:"",type:"",properties:[]}),[u,p]=j.useState({}),c=()=>{m({...h,properties:[...h.properties,{name:"",type:"string",defaultValue:""}]})},w=(g,l,n)=>{const t=[...h.properties];t[g]={...t[g],[l]:n},m({...h,properties:t})},x=g=>{m({...h,properties:h.properties.filter((l,n)=>n!==g)})},F=()=>{const g={};return h.name.trim()?/\s/.test(h.name)&&(g.name=o("decorators.validation.noWhitespace")):g.name=o("validation.required"),p(g),Object.keys(g).length===0},z=async g=>{if(g.preventDefault(),!!F()){y(!0);try{await r({...h,projectId:s}),m({name:"",type:"",properties:[]}),p({}),d(!1)}catch(l){console.error("Failed to create decorator:",l)}finally{y(!1)}}};return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[600px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:o("decorators.addNew")}),e.jsx(ne,{children:o("decorators.createDescription")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:h.name,onChange:g=>{m({...h,name:g.target.value}),u.name&&p({...u,name:null})},placeholder:o("decorators.namePlaceholder"),className:u.name?"border-destructive":"",required:!0}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:o("decorators.type")}),e.jsx(V,{id:"type",value:h.type,onChange:g=>m({...h,type:g.target.value}),placeholder:o("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:o("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:c,className:"gap-2",children:[e.jsx(q,{className:"h-3 w-3"}),o("decorators.properties.add")]})]}),h.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:o("decorators.properties.empty")}),h.properties.map((g,l)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.name")}),e.jsx(V,{value:g.name,onChange:n=>w(l,"name",n.target.value),placeholder:o("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.type")}),e.jsx(de,{value:g.type,onChange:n=>w(l,"type",n.target.value),children:[{value:"string",label:o("decorators.types.string")},{value:"int",label:o("decorators.types.integer")},{value:"float",label:o("decorators.types.float")},{value:"bool",label:o("decorators.types.boolean")}].map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.defaultValue")}),e.jsx(V,{value:g.defaultValue,onChange:n=>w(l,"defaultValue",n.target.value),placeholder:g.type==="bool"?o("decorators.properties.placeholders.bool"):g.type==="int"?o("decorators.properties.placeholders.int"):g.type==="float"?o("decorators.properties.placeholders.float"):o("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(l),className:"h-9 w-9",children:e.jsx(Ae,{className:"h-4 w-4"})})]},l))]})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:C,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:C||!h.name.trim(),children:o(C?"common.creating":"common.create")})]})]})]})})}function Rt({open:a,onOpenChange:d,decorator:s,projectId:o}){const{t:r}=L(),{updateDecorator:C}=pe(),[y,h]=j.useState(!1),[m,u]=j.useState({name:"",type:"",properties:[]}),[p,c]=j.useState({});j.useEffect(()=>{a&&s&&u({name:s.name||"",type:s.type||"",properties:Array.isArray(s.properties)?s.properties:[]})},[a,s]),j.useEffect(()=>{a||c({})},[a]);const w=()=>{u(l=>({...l,properties:[...l.properties,{name:"",type:"string",defaultValue:""}]}))},x=(l,n,t)=>{const i=[...m.properties];i[l]={...i[l],[n]:t},u({...m,properties:i})},F=l=>{u(n=>({...n,properties:n.properties.filter((t,i)=>i!==l)}))},z=()=>{const l={};return m.name.trim()?/\s/.test(m.name)&&(l.name=r("decorators.validation.noWhitespace")):l.name=r("validation.required"),c(l),Object.keys(l).length===0},g=async l=>{if(l.preventDefault(),!!z()){h(!0);try{await C(s.id,{name:m.name,type:m.type,properties:m.properties,projectId:o}),d(!1)}catch(n){console.error("Failed to update decorator:",n)}finally{h(!1)}}};return e.jsx(te,{open:a,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[600px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[r("common.edit")," ",r("decorators.title").slice(0,-1)]}),e.jsx(ne,{children:r("decorators.updateDescription")})]}),e.jsxs("form",{onSubmit:g,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"name",value:m.name,onChange:l=>{u({...m,name:l.target.value}),p.name&&c({...p,name:null})},placeholder:r("decorators.namePlaceholder"),className:p.name?"border-destructive":"",required:!0}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:r("decorators.type")}),e.jsx(V,{id:"type",value:m.type,onChange:l=>u({...m,type:l.target.value}),placeholder:r("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:r("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:w,className:"gap-2",children:[e.jsx(q,{className:"h-3 w-3"}),r("decorators.properties.add")]})]}),m.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:r("decorators.properties.empty")}),m.properties.map((l,n)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.name")}),e.jsx(V,{value:l.name,onChange:t=>x(n,"name",t.target.value),placeholder:r("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.type")}),e.jsx(de,{value:l.type,onChange:t=>x(n,"type",t.target.value),children:[{value:"string",label:r("decorators.types.string")},{value:"int",label:r("decorators.types.integer")},{value:"float",label:r("decorators.types.float")},{value:"bool",label:r("decorators.types.boolean")}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.defaultValue")}),e.jsx(V,{value:l.defaultValue,onChange:t=>x(n,"defaultValue",t.target.value),placeholder:r("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>F(n),children:e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})})]},n))]})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:y,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:y||!m.name.trim(),children:r(y?"common.saving":"common.save")})]})]})]})})}function $t({decorator:a}){const{t:d}=L(),{deleteDecorator:s}=pe(),[o,r]=j.useState(!1),[C,y]=j.useState(!1),[h,m]=j.useState(!1),u=async()=>{m(!0);try{await s(a.id),r(!1)}catch(p){console.error("Failed to delete decorator:",p)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white",children:e.jsx(Ye,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.type&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.type})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>r(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Rt,{open:C,onOpenChange:y,decorator:a,projectId:a.projectId}),e.jsx(be,{open:o,onOpenChange:r,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:d("decorators.deleteTitle")}),e.jsx(De,{children:d("decorators.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:h,children:d("common.cancel")}),e.jsx(Pe,{variant:"destructive",onClick:u,disabled:h,children:d(h?"common.deleting":"common.delete")})]})]})})]})}function Bt({projectId:a,decorators:d=[]}){const{t:s}=L(),{importDecorators:o,exportDecorators:r}=pe(),[C,y]=j.useState(!1),[h,m]=j.useState(!1),u=j.useRef(null),p=ce(),c=async()=>{try{const x=await r(a),F=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),z=URL.createObjectURL(F),g=document.createElement("a");g.href=z,g.download=`decorators-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(z)}catch(x){console.error("Failed to export decorators:",x)}},w=async x=>{var z;const F=(z=x.target.files)==null?void 0:z[0];if(F){m(!0);try{const g=await F.text(),l=JSON.parse(g);await o(a,Array.isArray(l)?l:[l])}catch(g){console.error("Failed to import decorators:",g)}finally{m(!1),u.current&&(u.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("decorators.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("decorators.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".json",onChange:w,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var x;return(x=u.current)==null?void 0:x.click()},disabled:h,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:c,disabled:d.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(q,{className:"h-4 w-4"}),!p&&s("decorators.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var x;return(x=u.current)==null?void 0:x.click()},disabled:h,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:c,disabled:d.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("decorators.addNew")]})]})]})]}),d.length===0?e.jsx($,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ye,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("decorators.noDecorators")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("decorators.noDecoratorsDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),s("decorators.addNew")]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(x=>e.jsx($t,{decorator:x},x.id))}),e.jsx(qt,{open:C,onOpenChange:y,projectId:a})]})}function Yt(){const{t:a}=L(),{theme:d,resolvedTheme:s,setTheme:o}=lt(),{projectId:r}=He.useParams(),C=He.useSearch(),y=ce(),{projects:h,loadProjects:m,deleteProject:u,exportProject:p,importProject:c}=ot(),{dialogues:w,loadDialogues:x}=Me(),{participants:F,loadParticipants:z}=he(),{categories:g,loadCategories:l}=Q(),{decorators:n,loadDecorators:t}=pe(),{status:i,checkRemoteDiff:v,startPull:S,lastSyncedAt:E}=Ze(),[N,D]=j.useState(!0),[f,I]=j.useState((C==null?void 0:C.section)||"overview"),[b,P]=j.useState(!1),[O,T]=j.useState(!1),[K,J]=j.useState(!1),Oe=j.useRef(new Set),Y=j.useRef(null),me=j.useCallback(async()=>{D(!0),await Promise.all([m(),x(),z(r),l(r),t(r)]),D(!1)},[m,x,z,l,t,r]);j.useEffect(()=>{me()},[me]),j.useEffect(()=>{E&&me()},[E,me]),j.useEffect(()=>{(async()=>{if(!r||i!=="connected"||Oe.current.has(r))return;Oe.current.add(r),await v(r)&&await S(r,{simulate:!0})})()},[r,i,v,S]);const ue=h.find(A=>A.id===r),Ee=w.filter(A=>A.projectId===r),Fe=F.filter(A=>A.projectId===r),Te=g.filter(A=>A.projectId===r),Ue=n.filter(A=>A.projectId===r),le=async()=>{try{await p(r)}catch(A){console.error("Failed to export project:",A)}};j.useEffect(()=>{const A=U=>{const X=U==null?void 0:U.detail;!X||X.projectId!==r||le()},R=U=>{const X=U==null?void 0:U.detail;!X||X.projectId!==r||Y.current&&Y.current.click()};return window.addEventListener("command:project-export",A),window.addEventListener("command:project-import",R),()=>{window.removeEventListener("command:project-export",A),window.removeEventListener("command:project-import",R)}},[r,le]),j.useEffect(()=>{if(y)return;const A=R=>{const U=R.target;if(!(U.tagName==="INPUT"||U.tagName==="TEXTAREA"||U.isContentEditable)&&(R.ctrlKey||R.metaKey)){const $e=R.key.toLowerCase();if($e==="e"){R.preventDefault(),le();return}$e==="i"&&(R.preventDefault(),Y.current&&Y.current.click())}};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[le,y]);const qe=async A=>{var U;const R=(U=A.target.files)==null?void 0:U[0];if(R){P(!0);try{await c(R),await me()}catch(X){console.error("Failed to import project:",X)}finally{P(!1),Y.current&&(Y.current.value="")}}},tt=async()=>{await u(r),window.location.href="#/"},Re=()=>{J(!0)};return N?e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsx("p",{className:"text-muted-foreground",children:a("common.loading")})}):ue?e.jsxs("div",{className:`${y?"min-h-screen":"h-screen"} flex flex-col`,children:[e.jsx(gt,{className:O?"z-40":void 0,left:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>T(!0),className:"lg:hidden rounded-full shrink-0",children:e.jsx(ht,{className:"h-5 w-5"})}),e.jsx(Ne,{to:"/",children:e.jsx(ct,{content:a("common.back"),side:"bottom",children:e.jsx(k,{variant:"ghost",size:"icon",className:"rounded-full shrink-0",children:e.jsx(yt,{className:"h-5 w-5"})})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-sm md:text-2xl font-bold tracking-tight truncate",children:ue.name}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:a("projects.projectDetails")})]})]}),right:e.jsxs("div",{className:"hidden md:flex items-center text-xs font-medium text-muted-foreground bg-muted px-3 py-1.5 rounded-full","data-header-mobile-hidden":!0,children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),a("dialogues.autoSaved")]}),menuItems:e.jsxs(e.Fragment,{children:[e.jsx(ft,{}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>o(s==="dark"?"light":"dark"),className:"justify-start",children:s==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),a("settings.lightMode")]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),a("settings.darkMode")]})})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>T(!1)}),e.jsx("input",{ref:Y,type:"file",accept:".mnteadlgproj",onChange:qe,className:"hidden"}),e.jsxs("div",{className:`flex-1 flex min-h-0 ${y?"":"overflow-hidden"}`,children:[e.jsx(It,{activeSection:f,onSectionChange:A=>{I(A),T(!1)},project:ue,dialogueCount:Ee.length,participantCount:Fe.length,isMobileOpen:O,onMobileClose:()=>T(!1)}),e.jsx("main",{className:`flex-1 bg-grid ${y?"":"overflow-y-auto"}`,children:e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8 lg:p-12",children:[f==="overview"&&e.jsx(St,{project:ue,dialogues:Ee,participants:Fe,categories:Te,decorators:Ue,onExport:le,onImport:qe,onDelete:Re,onSectionChange:I,fileInputRef:Y,isImporting:b}),f==="dialogues"&&e.jsx(Ft,{projectId:r,dialogues:Ee}),f==="participants"&&e.jsx(Mt,{projectId:r,participants:Fe}),f==="categories"&&e.jsx(Ut,{projectId:r,categories:Te}),f==="decorators"&&e.jsx(Bt,{projectId:r,decorators:Ue}),f==="settings"&&e.jsx(dt,{project:ue,onExport:le,onDelete:Re})]})})]}),e.jsx(be,{open:K,onOpenChange:J,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:a("projects.deleteProject")}),e.jsx(De,{children:a("projects.deleteConfirm")})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",children:a("common.cancel")}),e.jsx(Pe,{variant:"destructive",onClick:()=>{J(!1),tt()},children:a("common.delete")})]})]})})]}):e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a("projects.notFound")}),e.jsx("p",{className:"text-muted-foreground",children:a("projects.notFoundDescription")})]})})}export{Yt as component};
