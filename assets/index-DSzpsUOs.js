import{c as ue,j as e,i as Y,u as M,m as Qe,w as Te,M as de,B as N,X,C as ot,x as ct,r as f,o as ie,F as dt,y as Je,s as mt,t as ze,U as H,z as K,A as _,q,v as $,E as Ze,a as et,l as Ue,D as G,d as Q,e as ee,f as te,g as se,L as A,I as O,T as ut,h as ae,G as ve,H as be,J as Ne,K as ye,N as we,O as Ce,P as ke,Q as De,R as Se,V as Fe,S as tt,W as xt,Y as Ke,b as ht,Z as pt,_ as gt}from"./index-CtdWMEAS.js";import{S as Re,C as ft,c as jt,a as vt,u as Ie,b as st,T as at,d as Pe,e as Ee,M as bt}from"./confetti-CgzFYpIx.js";import{useCategoryStore as le}from"./categoryStore-BdSH2jAY.js";import{D as xe,a as he,E as pe,b as ge,c as W,d as Nt,N as oe,C as rt,A as yt,L as wt,e as Ct}from"./app-header-B3PCuEQ-.js";import{A as kt,c as Dt,d as Ye,C as St,a as It,b as Pt,E as Et}from"./empty-state-DMInOUyL.js";import{P as T}from"./plus-B26CuSYj.js";import{S as zt,M as Ft}from"./sun-CqVREw0S.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=ue("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ue("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=ue("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=ue("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ue("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=ue("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Ot={variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600"}};function Ae({className:n,variant:x="default",...r}){return e.jsx("div",{className:Y("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",Ot.variant[x],n),...r})}function Tt({activeSection:n,onSectionChange:x,project:r,dialogueCount:o=0,participantCount:a=0,isMobileOpen:C=!1,onMobileClose:b}){const{t:m}=M(),{status:h,setLoginDialogOpen:d}=Qe(),p=Te(u=>u.openWithContext),v={connected:"text-green-500",connecting:"text-blue-500",syncing:"text-blue-500",error:"text-red-500",disconnected:"text-muted-foreground"}[h]||"text-muted-foreground",g=[{id:"overview",label:m("navigation.dashboard"),icon:Lt,color:"text-blue-500"},{id:"dialogues",label:m("dialogues.title"),icon:de,color:"text-blue-500",count:o},{id:"participants",label:m("participants.title"),icon:nt,color:"text-purple-500",count:a},{id:"categories",label:m("categories.title"),icon:Xe,color:"text-orange-500"},{id:"decorators",label:m("decorators.title"),icon:Mt,color:"text-green-500"},{id:"conditions",label:m("conditions.title"),icon:Re,color:"text-cyan-500"}];return e.jsxs("aside",{className:Y("flex-shrink-0 bg-card border-border flex flex-col transition-transform duration-300 ease-in-out","fixed inset-y-0 left-0 z-50 h-full w-64","lg:static lg:z-0 lg:translate-x-0","lg:w-80","lg:rounded-none",C?"translate-x-0 rounded-none":"-translate-x-full lg:translate-x-0 md:rounded-xl"),children:[e.jsx("div",{className:"lg:hidden flex justify-end p-4",children:e.jsx(N,{variant:"ghost",size:"icon",onClick:b,className:"rounded-full",children:e.jsx(X,{className:"h-5 w-5"})})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:Y("p-4 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 border border-blue-100 dark:border-blue-900/30 flex flex-col items-center text-center",C?"flex-row justify-between":""),children:[e.jsx("div",{className:Y("w-12 h-12 rounded-lg bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white shadow-md mb-2",C?"hidden":""),children:e.jsx(Xe,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-sm line-clamp-1",children:r==null?void 0:r.name}),(r==null?void 0:r.version)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["v",r.version]})]})}),e.jsx("nav",{className:"flex-1 px-3 py-2 space-y-1 overflow-y-auto",children:g.map(u=>{const I=u.icon,D=n===u.id;return e.jsxs("button",{onClick:()=>x(u.id),className:Y("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",D?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(I,{className:Y("h-5 w-5",D&&u.color)}),e.jsx("span",{className:"flex-1 text-left",children:u.label}),u.count!==void 0&&e.jsx("span",{className:"text-[10px] bg-muted px-1.5 py-0.5 rounded-md",children:u.count})]},u.id)})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>d(!0),className:Y("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors","text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(ot,{className:Y("h-5 w-5",v)}),e.jsx("span",{children:m("sync.title")})]})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>p({context:{type:"project",projectId:r==null?void 0:r.id},onOpenSettings:x?()=>x("settings"):null,mode:"detail"}),className:Y("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",n==="settings"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(ct,{className:"h-5 w-5"}),e.jsx("span",{children:m("navigation.settings")})]})})]})}function Ut({project:n,dialogues:x=[],participants:r=[],categories:o=[],decorators:a=[],conditions:C=[],onExport:b,onImport:m,onDelete:h,onSectionChange:d,fileInputRef:p,isImporting:v=!1}){const{t:g}=M(),[u,I]=f.useState(!ie()),[D,P]=f.useState(),[l,s]=f.useState(0),t=Te(c=>c.openWithContext),i=f.useRef(kt({delay:2500,stopOnInteraction:!1}));f.useEffect(()=>{const c=()=>I(!ie());return c(),window.addEventListener("resize",c),window.addEventListener("orientationchange",c),window.addEventListener("device-override",c),()=>{window.removeEventListener("resize",c),window.removeEventListener("orientationchange",c),window.removeEventListener("device-override",c)}},[]);const j=!u,E=x.reduce((c,S)=>c+(S.nodeCount||0),0),z=[...x].sort((c,S)=>new Date(S.modifiedAt)-new Date(c.modifiedAt)).slice(0,5);f.useEffect(()=>{j||s(0)},[j]),f.useEffect(()=>{if(!D||!j)return;const c=()=>{s(D.selectedScrollSnap())};return c(),D.on("select",c),D.on("reInit",c),()=>{D.off("select",c),D.off("reInit",c)}},[D,j]);const y=[{id:"file-size",label:"File Size",value:"--",meta:`${E} ${g("dialogues.nodes")}`,icon:e.jsx(dt,{className:"h-4 w-4"}),iconContainerClass:"bg-blue-50 dark:bg-blue-900/20 text-primary"},{id:"modified",label:g("projects.modified"),value:Je(n.modifiedAt),meta:"Current User",icon:e.jsx(ft,{className:"h-4 w-4"}),iconContainerClass:"bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400"},{id:"created",label:g("projects.created"),value:mt(n.createdAt),meta:n.version?`v${n.version}`:"v1.0.0",icon:e.jsx(Dt,{className:"h-4 w-4"}),iconContainerClass:"bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400"}],k=c=>e.jsx(q,{children:e.jsx($,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${c.iconContainerClass}`,children:c.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:c.label}),e.jsx("h3",{className:"text-lg font-bold truncate",children:c.value}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:c.meta})]})]})})},c.id);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 text-xs font-medium text-muted-foreground mb-4 ${j?"hidden":""}`,children:[e.jsx(ze,{to:"/",className:"hover:text-primary cursor-pointer",children:g("projects.title")}),e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{className:"text-foreground",children:n.name})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-10 min-w-0",children:[e.jsxs("div",{className:"group flex-1 min-w-0",children:[e.jsx("label",{className:"hidden md:block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-1",children:g("projects.projectName")}),e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-4xl font-bold tracking-tight truncate",children:n.name}),n.version&&e.jsxs(Ae,{variant:"success",children:["v",n.version]}),e.jsx("button",{onClick:()=>t({context:{type:"project",projectId:n==null?void 0:n.id},onOpenSettings:d?()=>d("settings"):null,mode:"detail"}),className:"hidden md:flex opacity-0 group-hover:opacity-100 p-1.5 rounded-full hover:bg-accent text-muted-foreground hover:text-primary transition-all",title:"Project Settings",children:e.jsx(me,{className:"h-5 w-5"})})]}),n.description&&e.jsx("p",{className:"mt-3 leading-relaxed max-w-2xl text-muted-foreground text-sm md:text-lg",children:n.description})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs(xe,{className:!0,children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(W,{onClick:()=>{var c;return(c=p==null?void 0:p.current)==null?void 0:c.click()},disabled:v,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),g("common.import")]}),e.jsxs(W,{onClick:b,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),g("common.export")]}),e.jsx(Nt,{}),e.jsxs(W,{onClick:h,className:"text-destructive focus:text-destructive",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),g("common.delete")]})]})]})}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var c;return(c=p==null?void 0:p.current)==null?void 0:c.click()},disabled:v,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),g("common.import")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:b,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),g("common.export")]}),e.jsx(N,{variant:"outline",size:"sm",onClick:h,className:"gap-2 text-destructive hover:text-destructive hover:border-destructive/50",children:e.jsx(_,{className:"h-4 w-4"})})]})]})]}),j?e.jsxs("div",{className:"relative mb-6",children:[e.jsx(St,{opts:{loop:!0,align:"start"},plugins:[i.current],setApi:P,className:"w-full",children:e.jsx(It,{children:y.map(c=>e.jsx(Pt,{children:k(c)},c.id))})}),e.jsx("div",{className:"mt-3 flex items-center justify-center gap-2",children:y.map((c,S)=>e.jsx("button",{type:"button",onClick:()=>D==null?void 0:D.scrollTo(S),className:`h-2 rounded-full transition-all ${l===S?"w-5 bg-primary":"w-2 bg-muted-foreground/40"}`,"aria-label":c.label},c.id))})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 mb-6",children:y.map(c=>k(c))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:g("dialogues.title")}),e.jsxs("button",{onClick:()=>d==null?void 0:d("dialogues"),className:"text-sm text-primary hover:text-blue-600 font-medium flex items-center gap-1 transition-colors",children:["View All ",e.jsx(Ye,{className:"h-4 w-4"})]})]}),e.jsx(q,{children:e.jsx($,{className:"p-0",children:z.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(de,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g("dialogues.noDialogues")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-border",children:z.map(c=>e.jsxs(ze,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:n.id,dialogueId:c.id},className:"p-4 flex items-center justify-between group hover:bg-accent transition-colors cursor-pointer hover:rounded-lg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center text-blue-500",children:e.jsx(de,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:c.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Je(c.modifiedAt)," â€¢ ",c.nodeCount||0," ",g("dialogues.nodes")]})]})]}),e.jsx("button",{className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-card shadow-sm border border-border text-primary hover:bg-primary hover:text-primary-foreground transition-all",children:e.jsx(me,{className:"h-4 w-4"})})]},c.id))}),e.jsx("div",{className:"bg-muted/50 px-4 py-3 border-t border-border text-center",children:e.jsxs("button",{type:"button",onClick:()=>d==null?void 0:d("dialogues"),className:"text-xs font-medium text-muted-foreground hover:text-primary transition-colors",children:["+ ",g("dialogues.createNew")]})})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{children:e.jsxs($,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Project Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Project ID"}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-lg border border-border",children:[e.jsxs("code",{className:"text-xs font-mono",children:[n.id.substring(0,12),"..."]}),e.jsxs("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(n.id).then(()=>{Ze({variant:"success",title:"Copied",description:"Project ID copied to clipboard."})}).catch(()=>{Ze({variant:"error",title:"Copy failed",description:"Unable to copy Project ID."})})},className:"text-muted-foreground hover:text-primary p-1 rounded-md hover:bg-accent transition-colors","aria-label":"Copy Project ID",children:[e.jsx("span",{className:"sr-only",children:"Copy"}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:g("dialogues.title")}),e.jsx("span",{className:"font-medium",children:x.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:g("participants.title")}),e.jsx("span",{className:"font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:g("categories.title")}),e.jsx("span",{className:"font-medium",children:o.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:g("decorators.title")}),e.jsx("span",{className:"font-medium",children:a.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:g("conditions.title")}),e.jsx("span",{className:"font-medium",children:C.length})]})]})]})]})}),r.length>0&&e.jsx(q,{children:e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider",children:g("participants.top")}),e.jsx("button",{onClick:()=>d==null?void 0:d("participants"),className:"text-xs text-primary hover:underline",children:g("common.manage")})]}),e.jsxs("div",{className:"flex -space-x-2 overflow-hidden mb-3",children:[r.slice(0,4).map(c=>e.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-card bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:c.name.charAt(0).toUpperCase()},c.id)),r.length>4&&e.jsxs("div",{className:"h-8 w-8 rounded-full ring-2 ring-card bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:["+",r.length-4]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g("participants.inProject",{count:r.length})})]})})]})]})]})}function Rt({dialogue:n,projectId:x}){const{t:r}=M(),o=et(),a=Te(b=>b.openWithContext),C=n.nodeCount||0;return e.jsx(ze,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:x,dialogueId:n.id},children:e.jsxs(q,{className:"group cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all h-full flex flex-col overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 flex items-center justify-center relative overflow-hidden rounded-t-lg",children:[e.jsx("div",{className:"absolute inset-0 opacity-30 dark:opacity-20 bg-[radial-gradient(#9333ea_1px,transparent_1px)] [background-size:16px_16px]"}),e.jsx(de,{className:"h-12 w-12 text-purple-500 dark:text-purple-400 opacity-80 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 relative z-10"}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full bg-background/90 backdrop-blur-sm",onClick:b=>{b.preventDefault(),b.stopPropagation(),a({context:{type:"dialogue",name:n.name,projectId:x,dialogueId:n.id},onOpenSettings:()=>o({to:"/projects/$projectId/dialogue/$dialogueId/settings",params:{projectId:x,dialogueId:n.id}}),mode:"detail"})},children:e.jsx(At,{className:"h-3.5 w-3.5"})})})]}),e.jsxs($,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsx("h3",{className:"font-bold text-base group-hover:text-primary transition-colors line-clamp-1",children:n.name})}),n.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2 leading-relaxed",children:n.description}),e.jsx("div",{className:"mt-auto pt-3 border-t flex items-center justify-center text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(de,{className:"h-3.5 w-3.5 group-hover:text-purple-500 transition-colors"}),e.jsx("span",{className:"font-medium",children:r("dialogues.nodeCount",{count:C})})]})})]})]})})}function Vt({open:n,onOpenChange:x,projectId:r}){const{t:o}=M(),a=et(),{createDialogue:C,dialogues:b}=Ue(),[m,h]=f.useState({name:"",description:""}),[d,p]=f.useState({}),[v,g]=f.useState(!1),u=(l,s)=>{h(t=>({...t,[l]:s})),d[l]&&p(t=>({...t,[l]:null}))},I=()=>{const l={};return m.name.trim()?/\s/.test(m.name)&&(l.name="Name cannot contain whitespace"):l.name=o("validation.required"),p(l),Object.keys(l).length===0},D=async l=>{if(l.preventDefault(),!!I()){g(!0);try{const t=b.filter(j=>j.projectId===r).length===0,i=await C({projectId:r,name:m.name.trim(),description:m.description.trim()});t?jt():vt(),h({name:"",description:""}),p({}),x(!1),setTimeout(()=>{a({to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:r,dialogueId:i.id}})},1e3)}catch(s){console.error("Error creating dialogue:",s),p({submit:o("common.error")})}finally{g(!1)}}},P=()=>{h({name:"",description:""}),p({}),x(!1)};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:o("dialogues.createNew")}),e.jsx(se,{children:o("dialogues.createFirst")})]}),e.jsxs("form",{onSubmit:D,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"dialogue-name",children:[o("dialogues.dialogueName")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"dialogue-name",placeholder:"Welcome Conversation",value:m.name,onChange:l=>u("name",l.target.value),className:d.name?"border-destructive":"",autoFocus:!0}),d.name&&e.jsx("p",{className:"text-xs text-destructive",children:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"dialogue-description",children:o("projects.projectDescription")}),e.jsx(ut,{id:"dialogue-description",placeholder:"A brief description of this dialogue...",value:m.description,onChange:l=>u("description",l.target.value),rows:3})]}),d.submit&&e.jsx("p",{className:"text-sm text-destructive",children:d.submit})]})}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:P,disabled:v,children:o("common.cancel")}),e.jsx(N,{type:"submit",disabled:v,children:o(v?"common.loading":"common.create")})]})]})]})})}function qt({projectId:n,dialogues:x=[]}){const{t:r}=M(),{importDialogue:o}=Ue(),[a,C]=f.useState(!1),[b,m]=f.useState(!1),h=f.useRef(null),d=ie(),p=async v=>{var u;const g=(u=v.target.files)==null?void 0:u[0];if(g){m(!0);try{await o(n,g)}catch(I){console.error("Failed to import dialogue:",I)}finally{m(!1),h.current&&(h.current.value="")}}};return e.jsxs("div",{children:[e.jsx(Vt,{open:a,onOpenChange:C,projectId:n}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[r("dialogues.title")," (",x.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:h,type:"file",accept:".mnteadlg",onChange:p,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsx(ge,{align:"end",children:e.jsxs(W,{onClick:()=>{var v;return(v=h.current)==null?void 0:v.click()},disabled:b,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("common.import")]})})]}),e.jsxs(N,{size:"icon",onClick:()=>C(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(T,{className:"h-4 w-4"}),!d&&r("dialogues.createNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var v;return(v=h.current)==null?void 0:v.click()},disabled:b,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),r("common.import")]}),e.jsxs(N,{size:"sm",onClick:()=>C(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("dialogues.createNew")]})]})]})]}),x.length===0?e.jsx(Et,{icon:de,title:r("dialogues.noDialogues"),description:r("dialogues.createFirst"),action:e.jsxs(N,{type:"button",onClick:()=>C(!0),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),r("dialogues.createNew")]}),tips:["Dialogues are the backbone of your interactive narratives","Use nodes to create branching conversations","Connect nodes to create dialogue flow"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(v=>e.jsx(Rt,{dialogue:v,projectId:n},v.id))})]})}function $t({open:n,onOpenChange:x,projectId:r}){const{t:o}=M(),{createParticipant:a,participants:C}=Ie(),{categories:b,loadCategories:m}=le(),[h,d]=f.useState(!1),[p,v]=f.useState({name:"",category:""}),[g,u]=f.useState({});f.useEffect(()=>{n&&r&&m(r)},[n,r,m]);const I=s=>{const t=[];let i=b.find(j=>j.id===s);for(;i;)t.unshift(i.name),i=b.find(j=>j.id===i.parentCategoryId);return t.join(" > ")},D=(()=>{const s=new Map;return b.forEach(t=>{const i=I(t.id);if(!i)return;const[j]=i.split(" > ");s.has(j)||s.set(j,[]),s.get(j).push({id:t.id,name:t.name,label:i})}),Array.from(s.entries()).map(([t,i])=>({label:t,options:i.sort((j,E)=>j.label.localeCompare(E.label))})).sort((t,i)=>t.label.localeCompare(i.label))})(),P=()=>{const s={};if(p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(s.name="Name must be 16 characters or fewer"):s.name="Name must contain only letters and numbers":s.name=o("validation.required"),p.category||(s.category=o("validation.required")),!s.name&&p.category){const t=p.name.trim(),i=b.filter(k=>k.name===p.category),j=k=>{let c=k;const S=new Set;for(;c;){if(S.has(c))return null;S.add(c);const w=b.find(F=>F.id===c);if(!w)return null;if(!w.parentCategoryId)return w.id;c=w.parentCategoryId}return null},E=i.map(k=>j(k.id)).filter(Boolean),y=C.filter(k=>k.projectId===r).some(k=>{if(k.name!==t)return!1;const c=b.find(w=>w.name===k.category);if(!c)return!1;const S=j(c.id);return S&&E.includes(S)});E.length>0&&y&&(s.name="Participant name must be unique within its category tree")}return u(s),Object.keys(s).length===0},l=async s=>{if(s.preventDefault(),!!P()){d(!0);try{await a({...p,projectId:r}),v({name:"",category:""}),u({}),x(!1)}catch(t){console.error("Failed to create participant:",t)}finally{d(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:o("participants.addNew")}),e.jsx(se,{children:o("participants.createDescription")})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[o("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:p.name,onChange:s=>{v({...p,name:s.target.value}),g.name&&u({...g,name:null})},placeholder:o("participants.namePlaceholder"),className:g.name?"border-destructive":"",required:!0}),g.name&&e.jsx("p",{className:"text-xs text-destructive",children:g.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"category",children:[o("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(oe,{id:"category",value:p.category,onChange:s=>{v({...p,category:s.target.value}),g.category&&u({...g,category:null})},className:g.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:o("participants.categoryPlaceholder")}),D.length===0?e.jsx("option",{value:"",disabled:!0,children:o("categories.noCategories")}):D.map(s=>e.jsx("optgroup",{label:s.label,children:s.options.map(t=>e.jsx("option",{value:t.name,children:t.label},t.id))},s.label))]}),g.category&&e.jsx("p",{className:"text-xs text-destructive",children:g.category})]})]}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:h,children:o("common.cancel")}),e.jsx(N,{type:"submit",disabled:h||!p.name.trim()||!p.category,children:o(h?"common.creating":"common.create")})]})]})]})})}function Bt({open:n,onOpenChange:x,participant:r,projectId:o}){const{t:a}=M(),{updateParticipant:C,participants:b}=Ie(),{categories:m,loadCategories:h}=le(),[d,p]=f.useState(!1),[v,g]=f.useState({name:"",category:""}),[u,I]=f.useState({});f.useEffect(()=>{n&&o&&h(o),n&&r&&g({name:r.name||"",category:r.category||""})},[n,o,r,h]);const D=t=>{const i=[];let j=m.find(E=>E.id===t);for(;j;)i.unshift(j.name),j=m.find(E=>E.id===j.parentCategoryId);return i.join(" > ")},P=(()=>{const t=new Map;return m.forEach(i=>{const j=D(i.id);if(!j)return;const[E]=j.split(" > ");t.has(E)||t.set(E,[]),t.get(E).push({id:i.id,name:i.name,label:j})}),Array.from(t.entries()).map(([i,j])=>({label:i,options:j.sort((E,z)=>E.label.localeCompare(z.label))})).sort((i,j)=>i.label.localeCompare(j.label))})();f.useEffect(()=>{n||I({})},[n]);const l=()=>{const t={};if(v.name.trim()?/^[A-Za-z0-9]+$/.test(v.name)?v.name.length>16&&(t.name="Name must be 16 characters or fewer"):t.name="Name must contain only letters and numbers":t.name=a("validation.required"),v.category||(t.category=a("validation.required")),!t.name&&v.category&&r){const i=v.name.trim(),j=m.filter(c=>c.name===v.category),E=c=>{let S=c;const w=new Set;for(;S;){if(w.has(S))return null;w.add(S);const F=m.find(R=>R.id===S);if(!F)return null;if(!F.parentCategoryId)return F.id;S=F.parentCategoryId}return null},z=j.map(c=>E(c.id)).filter(Boolean),k=b.filter(c=>c.projectId===o).some(c=>{if(c.id===r.id||c.name!==i)return!1;const S=m.find(F=>F.name===c.category);if(!S)return!1;const w=E(S.id);return w&&z.includes(w)});z.length>0&&k&&(t.name="Participant name must be unique within its category tree")}return I(t),Object.keys(t).length===0},s=async t=>{if(t.preventDefault(),!!l()){p(!0);try{await C(r.id,v),x(!1)}catch(i){console.error("Failed to update participant:",i)}finally{p(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsxs(te,{children:[a("common.edit")," ",a("participants.title").slice(0,-1)]}),e.jsx(se,{children:a("participants.updateDescription")})]}),e.jsxs("form",{onSubmit:s,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[a("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:v.name,onChange:t=>{g({...v,name:t.target.value}),u.name&&I({...u,name:null})},placeholder:a("participants.namePlaceholder"),className:u.name?"border-destructive":"",required:!0}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"category",children:[a("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(oe,{id:"category",value:v.category,onChange:t=>{g({...v,category:t.target.value}),u.category&&I({...u,category:null})},className:u.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:a("participants.categoryPlaceholder")}),P.length===0?e.jsx("option",{value:"",disabled:!0,children:a("categories.noCategories")}):P.map(t=>e.jsx("optgroup",{label:t.label,children:t.options.map(i=>e.jsx("option",{value:i.name,children:i.label},i.id))},t.label))]}),u.category&&e.jsx("p",{className:"text-xs text-destructive",children:u.category})]})]}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:d,children:a("common.cancel")}),e.jsx(N,{type:"submit",disabled:d||!v.name.trim()||!v.category,children:a(d?"common.saving":"common.save")})]})]})]})})}function Ge({participant:n}){const{t:x}=M(),{deleteParticipant:r}=Ie(),[o,a]=f.useState(!1),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=async()=>{h(!0);try{await r(n.id),a(!1)}catch(p){console.error("Failed to delete participant:",p)}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg",children:n.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:n.name}),n.category&&e.jsx(Ae,{variant:"outline",className:"mt-1 text-xs",children:n.category})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>b(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>a(!0),children:e.jsx(_,{className:"h-4 w-4"})})]})]})})}),e.jsx(Bt,{open:C,onOpenChange:b,participant:n,projectId:n.projectId}),e.jsx(ve,{open:o,onOpenChange:a,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsx(we,{children:x("participants.deleteTitle")}),e.jsx(Ce,{children:x("participants.deleteDescription",{name:n.name})})]}),e.jsxs(ke,{children:[e.jsx(De,{variant:"outline",disabled:m,children:x("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:d,disabled:m,children:x(m?"common.deleting":"common.delete")})]})]})})]})}function Wt({projectId:n,participants:x=[]}){const{t:r}=M(),{importParticipants:o,exportParticipants:a}=Ie(),{categories:C,loadCategories:b}=le(),[m,h]=f.useState(!1),[d,p]=f.useState(!1),v=f.useRef(null),g=ie(),[u,I]=f.useState(new Set);f.useEffect(()=>{n&&b(n)},[n,b]);const{rootCategories:D,childrenByParent:P,participantsByCategory:l,unmatchedParticipants:s}=f.useMemo(()=>{const y=new Map;C.forEach(w=>{const F=w.parentCategoryId||null;y.has(F)||y.set(F,[]),y.get(F).push(w)}),y.forEach(w=>{w.sort((F,R)=>F.name.localeCompare(R.name))});const k=new Map;C.forEach(w=>{k.has(w.name)||k.set(w.name,w)});const c=new Map,S=[];return x.forEach(w=>{const F=k.get(w.category);if(!F){S.push(w);return}c.has(F.id)||c.set(F.id,[]),c.get(F.id).push(w)}),c.forEach(w=>{w.sort((F,R)=>F.name.localeCompare(R.name))}),{rootCategories:(y.get(null)||[]).slice().sort((w,F)=>w.name.localeCompare(F.name)),childrenByParent:y,participantsByCategory:c,unmatchedParticipants:S.sort((w,F)=>w.name.localeCompare(F.name))}},[C,x]),t=y=>{I(k=>{const c=new Set(k);return c.has(y)?c.delete(y):c.add(y),c})},i=y=>l.has(y)?!0:(P.get(y)||[]).some(c=>i(c.id)),j=y=>{const k=(P.get(y.id)||[]).filter(w=>i(w.id)),c=l.get(y.id)||[];if(k.length===0&&c.length===0)return null;const S=u.has(y.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>t(y.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[S?e.jsx(st,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(rt,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:y.name})]})}),!S&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[c.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(w=>e.jsx(Ge,{participant:w},w.id))}),k.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:k.map(w=>j(w))})]})]},y.id)},E=async()=>{try{const y=await a(n),k=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),c=URL.createObjectURL(k),S=document.createElement("a");S.href=c,S.download=`participants-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(c)}catch(y){console.error("Failed to export participants:",y)}},z=async y=>{var c;const k=(c=y.target.files)==null?void 0:c[0];if(k){p(!0);try{const S=await k.text(),w=JSON.parse(S);await o(n,Array.isArray(w)?w:[w])}catch(S){console.error("Failed to import participants:",S)}finally{p(!1),v.current&&(v.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[r("participants.title")," (",x.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("participants.description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:v,type:"file",accept:".json",onChange:z,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(W,{onClick:()=>{var y;return(y=v.current)==null?void 0:y.click()},disabled:d,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("common.import")]}),e.jsxs(W,{onClick:E,disabled:x.length===0,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),r("common.export")]})]})]}),e.jsxs(N,{size:"icon",onClick:()=>h(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(T,{className:"h-4 w-4"}),!g&&r("participants.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var y;return(y=v.current)==null?void 0:y.click()},disabled:d,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),r("common.import")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:E,disabled:x.length===0,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),r("common.export")]}),e.jsxs(N,{size:"sm",onClick:()=>h(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("participants.addNew")]})]})]})]}),x.length===0?e.jsx(q,{children:e.jsx($,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(nt,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("participants.noParticipants")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:r("participants.noParticipantsDescription")}),e.jsxs(N,{onClick:()=>h(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("participants.addNew")]})]})})}):e.jsxs("div",{className:"space-y-6",children:[D.map(y=>j(y)),s.length>0&&e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3",children:e.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"Uncategorized"})}),e.jsx("div",{className:"p-4 pt-4 border-t border-border",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(y=>e.jsx(Ge,{participant:y},y.id))})})]})]}),e.jsx($t,{open:m,onOpenChange:h,projectId:n})]})}function Ht({open:n,onOpenChange:x,projectId:r}){const{t:o}=M(),{categories:a,createCategory:C,loadCategories:b}=le(),[m,h]=f.useState(!1),[d,p]=f.useState({name:"",parentCategoryId:null}),[v,g]=f.useState({});f.useEffect(()=>{n&&r&&b(r)},[n,r,b]),f.useEffect(()=>{n||(p({name:"",parentCategoryId:null}),g({}))},[n]);const u=()=>{const l={};if(d.name.trim()?/^[A-Za-z0-9]+$/.test(d.name)?d.name.length>16&&(l.name="Name must be 16 characters or fewer"):l.name="Name must contain only letters and numbers":l.name=o("validation.required"),d.parentCategoryId){let t=0,i=d.parentCategoryId;const j=new Set;for(;i;){if(j.has(i)){t=Number.POSITIVE_INFINITY;break}j.add(i);const E=a.find(z=>z.id===i);if(!E)break;t+=1,i=E.parentCategoryId||null}(!Number.isFinite(t)||t+1>5)&&(l.parentCategoryId="Category depth cannot exceed 5 levels")}if(d.name.trim()){const s=d.name.trim(),t=z=>{let y=z;const k=new Set;for(;y;){if(k.has(y))return null;k.add(y);const c=a.find(S=>S.id===y);if(!c)return null;if(!c.parentCategoryId)return c.id;y=c.parentCategoryId}return null},i=d.parentCategoryId?t(d.parentCategoryId):null;(i?!(z=>{const y=[z],k=new Set;for(;y.length>0;){const c=y.pop();if(!c||k.has(c))continue;k.add(c);const S=a.find(w=>w.id===c);if(S){if(S.name===s)return!0;a.filter(w=>w.parentCategoryId===S.id).forEach(w=>y.push(w.id))}}return!1})(i):!a.some(z=>!z.parentCategoryId&&z.name===s))||(l.name="Category name must be unique within its tree")}return g(l),Object.keys(l).length===0},I=async l=>{if(l.preventDefault(),!!u()){h(!0);try{await C({name:d.name,parentCategoryId:d.parentCategoryId||null,projectId:r}),p({name:"",parentCategoryId:null}),g({}),x(!1)}catch(s){console.error("Failed to create category:",s)}finally{h(!1)}}},D=l=>{const s=[];let t=a.find(i=>i.id===l);for(;t;)s.unshift(t.name),t=a.find(i=>i.id===t.parentCategoryId);return s.join(" > ")},P=(()=>{const l=new Map;return a.forEach(s=>{const t=D(s.id);if(!t)return;const[i]=t.split(" > ");l.has(i)||l.set(i,[]),l.get(i).push({id:s.id,label:t})}),Array.from(l.entries()).map(([s,t])=>({label:s,options:t.sort((i,j)=>i.label.localeCompare(j.label))})).sort((s,t)=>s.label.localeCompare(t.label))})();return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:o("categories.addNew")}),e.jsx(se,{children:o("categories.createDescription")})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[o("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:d.name,onChange:l=>{p({...d,name:l.target.value}),v.name&&g({...v,name:null})},placeholder:o("categories.namePlaceholder"),className:v.name?"border-destructive":"",required:!0}),v.name&&e.jsx("p",{className:"text-xs text-destructive",children:v.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"parentCategory",children:o("categories.parentCategory")}),e.jsxs(oe,{id:"parentCategory",value:d.parentCategoryId||"none",onChange:l=>{const s=l.target.value;p({...d,parentCategoryId:s==="none"?null:s}),v.parentCategoryId?g({...v,parentCategoryId:null}):v.name&&g({...v,name:null})},children:[e.jsx("option",{value:"none",children:o("categories.noParent")}),P.map(l=>e.jsx("optgroup",{label:l.label,children:l.options.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))},l.label))]}),v.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:v.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("categories.parentCategoryHelp")})]})]}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:m,children:o("common.cancel")}),e.jsx(N,{type:"submit",disabled:m||!d.name.trim(),children:o(m?"common.creating":"common.create")})]})]})]})})}function _t({open:n,onOpenChange:x,category:r,projectId:o}){const{t:a}=M(),{categories:C,updateCategory:b,loadCategories:m}=le(),[h,d]=f.useState(!1),[p,v]=f.useState({name:"",parentCategoryId:null}),[g,u]=f.useState({});f.useEffect(()=>{n&&o&&m(o),n&&r&&v({name:r.name||"",parentCategoryId:r.parentCategoryId||null})},[n,o,r,m]),f.useEffect(()=>{n||u({})},[n]);const I=()=>{const s={};p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(s.name="Name must be 16 characters or fewer"):s.name="Name must contain only letters and numbers":s.name=a("validation.required");const t=5,i=new Map;C.forEach(z=>{const y=z.parentCategoryId||null;i.has(y)||i.set(y,[]),i.get(y).push(z.id)});const j=z=>{const y=new Set,k=c=>{if(y.has(c))return 0;y.add(c);const S=i.get(c)||[];if(S.length===0)return 1;let w=0;return S.forEach(F=>{w=Math.max(w,k(F))}),1+w};return k(r==null?void 0:r.id)},E=z=>{let y=0,k=z;const c=new Set;for(;k;){if(c.has(k))return Number.POSITIVE_INFINITY;c.add(k);const S=C.find(w=>w.id===k);if(!S)break;y+=1,k=S.parentCategoryId||null}return y};if(r){const z=p.parentCategoryId?E(p.parentCategoryId):0,y=j(r.id),k=z+y;(!Number.isFinite(z)||k>t)&&(s.parentCategoryId=`Category depth cannot exceed ${t} levels`)}if(r&&p.name.trim()){const z=p.name.trim(),y=w=>{let F=w;const R=new Set;for(;F;){if(R.has(F))return null;R.add(F);const B=C.find(J=>J.id===F);if(!B)return null;if(!B.parentCategoryId)return B.id;F=B.parentCategoryId}return null},k=p.parentCategoryId?y(p.parentCategoryId):r.id;(k?!(w=>{const F=[w],R=new Set;for(;F.length>0;){const B=F.pop();if(!B||R.has(B))continue;R.add(B);const J=C.find(Z=>Z.id===B);if(J){if(J.id!==r.id&&J.name===z)return!0;C.filter(Z=>Z.parentCategoryId===J.id).forEach(Z=>F.push(Z.id))}}return!1})(k):!C.some(w=>!w.parentCategoryId&&w.id!==r.id&&w.name===z))||(s.name="Category name must be unique within its tree")}return u(s),Object.keys(s).length===0},D=async s=>{if(s.preventDefault(),!!I()){d(!0);try{await b(r.id,{name:p.name,parentCategoryId:p.parentCategoryId||null}),x(!1)}catch(t){console.error("Failed to update category:",t)}finally{d(!1)}}},P=s=>{const t=[];let i=C.find(j=>j.id===s);for(;i;)t.unshift(i.name),i=C.find(j=>j.id===i.parentCategoryId);return t.join(" > ")},l=(()=>{const s=new Map;return C.filter(t=>t.id!==(r==null?void 0:r.id)).forEach(t=>{const i=P(t.id);if(!i)return;const[j]=i.split(" > ");s.has(j)||s.set(j,[]),s.get(j).push({id:t.id,label:i})}),Array.from(s.entries()).map(([t,i])=>({label:t,options:i.sort((j,E)=>j.label.localeCompare(E.label))})).sort((t,i)=>t.label.localeCompare(i.label))})();return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsxs(te,{children:[a("common.edit")," ",a("categories.title").slice(0,-1)]}),e.jsx(se,{children:a("categories.updateDescription")})]}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[a("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:p.name,onChange:s=>{v({...p,name:s.target.value}),g.name&&u({...g,name:null})},placeholder:a("categories.namePlaceholder"),className:g.name?"border-destructive":"",required:!0}),g.name&&e.jsx("p",{className:"text-xs text-destructive",children:g.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"parentCategory",children:a("categories.parentCategory")}),e.jsxs(oe,{id:"parentCategory",value:p.parentCategoryId||"none",onChange:s=>{const t=s.target.value;v({...p,parentCategoryId:t==="none"?null:t}),g.parentCategoryId?u({...g,parentCategoryId:null}):g.name&&u({...g,name:null})},children:[e.jsx("option",{value:"none",children:a("categories.noParent")}),l.map(s=>e.jsx("optgroup",{label:s.label,children:s.options.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))},s.label))]}),g.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:g.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("categories.parentCategoryHelp")})]})]}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:h,children:a("common.cancel")}),e.jsx(N,{type:"submit",disabled:h||!p.name.trim(),children:a(h?"common.saving":"common.save")})]})]})]})})}function Jt({category:n}){const{t:x}=M(),{categories:r,deleteCategory:o}=le(),[a,C]=f.useState(!1),[b,m]=f.useState(!1),[h,d]=f.useState(!1),p=async()=>{d(!0);try{await o(n.id),C(!1)}catch(u){console.error("Failed to delete category:",u)}finally{d(!1)}},g=(()=>{if(!n.parentCategoryId)return null;const u=r.find(I=>I.id===n.parentCategoryId);return u?u.name:null})();return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center text-white",children:e.jsx(at,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:n.name}),g&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:g})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>m(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>C(!0),children:e.jsx(_,{className:"h-4 w-4"})})]})]})})}),e.jsx(_t,{open:b,onOpenChange:m,category:n,projectId:n.projectId}),e.jsx(ve,{open:a,onOpenChange:C,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsx(we,{children:x("categories.deleteTitle")}),e.jsx(Ce,{children:x("categories.deleteDescription",{name:n.name})})]}),e.jsxs(ke,{children:[e.jsx(De,{variant:"outline",disabled:h,children:x("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:p,disabled:h,children:x(h?"common.deleting":"common.delete")})]})]})})]})}function Zt({projectId:n,categories:x=[]}){const{t:r}=M(),{importCategories:o,exportCategories:a}=le(),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=f.useRef(null),p=ie(),[v,g]=f.useState(new Set),u=new Map;x.forEach(t=>{const i=t.parentCategoryId||null;u.has(i)||u.set(i,[]),u.get(i).push(t)});const I=(u.get(null)||[]).slice().sort((t,i)=>t.name.localeCompare(i.name)),D=t=>{g(i=>{const j=new Set(i);return j.has(t)?j.delete(t):j.add(t),j})},P=t=>{const i=(u.get(t.id)||[]).slice().sort((E,z)=>E.name.localeCompare(z.name)),j=v.has(t.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>D(t.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[j?e.jsx(st,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(rt,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:t.name})]})}),!j&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(Jt,{category:t})}),i.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:i.map(E=>P(E))})]})]},t.id)},l=async()=>{try{const t=await a(n),i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),j=URL.createObjectURL(i),E=document.createElement("a");E.href=j,E.download=`categories-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(j)}catch(t){console.error("Failed to export categories:",t)}},s=async t=>{var j;const i=(j=t.target.files)==null?void 0:j[0];if(i){h(!0);try{const E=await i.text(),z=JSON.parse(E);await o(n,Array.isArray(z)?z:[z])}catch(E){console.error("Failed to import categories:",E)}finally{h(!1),d.current&&(d.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[r("categories.title")," (",x.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("categories.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:d,type:"file",accept:".json",onChange:s,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(W,{onClick:()=>{var t;return(t=d.current)==null?void 0:t.click()},disabled:m,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("common.import")]}),e.jsxs(W,{onClick:l,disabled:x.length===0,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),r("common.export")]})]})]}),e.jsxs(N,{size:"icon",onClick:()=>b(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(T,{className:"h-4 w-4"}),!p&&r("categories.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var t;return(t=d.current)==null?void 0:t.click()},disabled:m,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),r("common.import")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:l,disabled:x.length===0,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),r("common.export")]}),e.jsxs(N,{size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("categories.addNew")]})]})]})]}),x.length===0?e.jsx(q,{children:e.jsx($,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(at,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("categories.noCategories")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:r("categories.noCategoriesDescription")}),e.jsxs(N,{onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("categories.addNew")]})]})})}):e.jsx("div",{className:"space-y-6",children:I.map(t=>P(t))}),e.jsx(Ht,{open:C,onOpenChange:b,projectId:n})]})}function Kt({open:n,onOpenChange:x,projectId:r}){const{t:o}=M(),{createDecorator:a}=Pe(),[C,b]=f.useState(!1),[m,h]=f.useState({name:"",type:"",properties:[]}),[d,p]=f.useState({}),v=()=>{h({...m,properties:[...m.properties,{name:"",type:"string",defaultValue:""}]})},g=(l,s,t)=>{const i=[...m.properties];i[l]={...i[l],[s]:t},h({...m,properties:i})},u=l=>{h({...m,properties:m.properties.filter((s,t)=>t!==l)})},I=l=>typeof l=="boolean"?l:typeof l=="string"?l.toLowerCase()==="true":!!l,D=()=>{const l={};return m.name.trim()?/\s/.test(m.name)&&(l.name=o("decorators.validation.noWhitespace")):l.name=o("validation.required"),p(l),Object.keys(l).length===0},P=async l=>{if(l.preventDefault(),!!D()){b(!0);try{await a({...m,projectId:r}),h({name:"",type:"",properties:[]}),p({}),x(!1)}catch(s){console.error("Failed to create decorator:",s)}finally{b(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:o("decorators.addNew")}),e.jsx(se,{children:o("decorators.createDescription")})]}),e.jsxs("form",{onSubmit:P,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[o("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:m.name,onChange:l=>{h({...m,name:l.target.value}),d.name&&p({...d,name:null})},placeholder:o("decorators.namePlaceholder"),className:d.name?"border-destructive":"",required:!0}),d.name&&e.jsx("p",{className:"text-xs text-destructive",children:d.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"type",children:o("decorators.type")}),e.jsx(O,{id:"type",value:m.type,onChange:l=>h({...m,type:l.target.value}),placeholder:o("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:o("decorators.properties.title")}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:v,className:"gap-2",children:[e.jsx(T,{className:"h-3 w-3"}),o("decorators.properties.add")]})]}),m.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:o("decorators.properties.empty")}),m.properties.map((l,s)=>e.jsxs("div",{className:"flex flex-col gap-2 bg-muted p-3 rounded-md md:grid md:grid-cols-[1fr,120px,1fr,auto] md:items-end",children:[e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"flex md:hidden h-8 w-8",onClick:()=>u(s),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("decorators.properties.name")}),e.jsx(O,{value:l.name,onChange:t=>g(s,"name",t.target.value),placeholder:o("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("decorators.properties.type")}),e.jsx(oe,{value:l.type,onChange:t=>g(s,"type",t.target.value),children:[{value:"string",label:o("decorators.types.string")},{value:"int",label:o("decorators.types.integer")},{value:"float",label:o("decorators.types.float")},{value:"bool",label:o("decorators.types.boolean")}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("decorators.properties.defaultValue")}),l.type==="bool"?e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[e.jsx(A,{className:"text-xs font-medium",children:I(l.defaultValue)?o("common.true"):o("common.false")}),e.jsx(Fe,{checked:I(l.defaultValue),onCheckedChange:t=>g(s,"defaultValue",t)})]}):e.jsx(O,{value:l.defaultValue,onChange:t=>g(s,"defaultValue",t.target.value),placeholder:l.type==="int"?o("decorators.properties.placeholders.int"):l.type==="float"?o("decorators.properties.placeholders.float"):o("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"hidden md:flex h-8 w-8",onClick:()=>u(s),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})})]},s))]})]})}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:C,children:o("common.cancel")}),e.jsx(N,{type:"submit",disabled:C||!m.name.trim(),children:o(C?"common.creating":"common.create")})]})]})]})})}function Yt({open:n,onOpenChange:x,decorator:r,projectId:o}){const{t:a}=M(),{updateDecorator:C}=Pe(),[b,m]=f.useState(!1),[h,d]=f.useState({name:"",type:"",properties:[]}),[p,v]=f.useState({});f.useEffect(()=>{n&&r&&d({name:r.name||"",type:r.type||"",properties:Array.isArray(r.properties)?r.properties:[]})},[n,r]),f.useEffect(()=>{n||v({})},[n]);const g=()=>{d(s=>({...s,properties:[...s.properties,{name:"",type:"string",defaultValue:""}]}))},u=(s,t,i)=>{const j=[...h.properties];j[s]={...j[s],[t]:i},d({...h,properties:j})},I=s=>{d(t=>({...t,properties:t.properties.filter((i,j)=>j!==s)}))},D=s=>typeof s=="boolean"?s:typeof s=="string"?s.toLowerCase()==="true":!!s,P=()=>{const s={};return h.name.trim()?/\s/.test(h.name)&&(s.name=a("decorators.validation.noWhitespace")):s.name=a("validation.required"),v(s),Object.keys(s).length===0},l=async s=>{if(s.preventDefault(),!!P()){m(!0);try{await C(r.id,{name:h.name,type:h.type,properties:h.properties,projectId:o}),x(!1)}catch(t){console.error("Failed to update decorator:",t)}finally{m(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(ee,{children:[e.jsxs(te,{children:[a("common.edit")," ",a("decorators.title").slice(0,-1)]}),e.jsx(se,{children:a("decorators.updateDescription")})]}),e.jsxs("form",{onSubmit:l,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[a("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:h.name,onChange:s=>{d({...h,name:s.target.value}),p.name&&v({...p,name:null})},placeholder:a("decorators.namePlaceholder"),className:p.name?"border-destructive":"",required:!0}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"type",children:a("decorators.type")}),e.jsx(O,{id:"type",value:h.type,onChange:s=>d({...h,type:s.target.value}),placeholder:a("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:a("decorators.properties.title")}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:g,className:"gap-2",children:[e.jsx(T,{className:"h-3 w-3"}),a("decorators.properties.add")]})]}),h.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("decorators.properties.empty")}),h.properties.map((s,t)=>e.jsxs("div",{className:"flex flex-col gap-2 bg-muted p-3 rounded-md md:grid md:grid-cols-[1fr,120px,1fr,auto] md:items-end",children:[e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"flex md:hidden h-8 w-8",onClick:()=>I(t),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("decorators.properties.name")}),e.jsx(O,{value:s.name,onChange:i=>u(t,"name",i.target.value),placeholder:a("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("decorators.properties.type")}),e.jsx(oe,{value:s.type,onChange:i=>u(t,"type",i.target.value),children:[{value:"string",label:a("decorators.types.string")},{value:"int",label:a("decorators.types.integer")},{value:"float",label:a("decorators.types.float")},{value:"bool",label:a("decorators.types.boolean")}].map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("decorators.properties.defaultValue")}),s.type==="bool"?e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[e.jsx(A,{className:"text-xs font-medium",children:D(s.defaultValue)?a("common.true"):a("common.false")}),e.jsx(Fe,{checked:D(s.defaultValue),onCheckedChange:i=>u(t,"defaultValue",i)})]}):e.jsx(O,{value:s.defaultValue,onChange:i=>u(t,"defaultValue",i.target.value),placeholder:a("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"hidden md:flex h-8 w-8",onClick:()=>I(t),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})})]},t))]})]})}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:b,children:a("common.cancel")}),e.jsx(N,{type:"submit",disabled:b||!h.name.trim(),children:a(b?"common.saving":"common.save")})]})]})]})})}function Xt({decorator:n}){const{t:x}=M(),{deleteDecorator:r}=Pe(),[o,a]=f.useState(!1),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=async()=>{h(!0);try{await r(n.id),a(!1)}catch(p){console.error("Failed to delete decorator:",p)}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white",children:e.jsx(tt,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:n.name}),n.type&&e.jsx(Ae,{variant:"outline",className:"mt-1 text-xs",children:n.type})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>b(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>a(!0),children:e.jsx(_,{className:"h-4 w-4"})})]})]})})}),e.jsx(Yt,{open:C,onOpenChange:b,decorator:n,projectId:n.projectId}),e.jsx(ve,{open:o,onOpenChange:a,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsx(we,{children:x("decorators.deleteTitle")}),e.jsx(Ce,{children:x("decorators.deleteDescription",{name:n.name})})]}),e.jsxs(ke,{children:[e.jsx(De,{variant:"outline",disabled:m,children:x("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:d,disabled:m,children:x(m?"common.deleting":"common.delete")})]})]})})]})}function Gt({projectId:n,decorators:x=[]}){const{t:r}=M(),{importDecorators:o,exportDecorators:a}=Pe(),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=f.useRef(null),p=ie(),v=async()=>{try{const u=await a(n),I=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),D=URL.createObjectURL(I),P=document.createElement("a");P.href=D,P.download=`decorators-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(D)}catch(u){console.error("Failed to export decorators:",u)}},g=async u=>{var D;const I=(D=u.target.files)==null?void 0:D[0];if(I){h(!0);try{const P=await I.text(),l=JSON.parse(P);await o(n,Array.isArray(l)?l:[l])}catch(P){console.error("Failed to import decorators:",P)}finally{h(!1),d.current&&(d.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[r("decorators.title")," (",x.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("decorators.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:d,type:"file",accept:".json",onChange:g,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(W,{onClick:()=>{var u;return(u=d.current)==null?void 0:u.click()},disabled:m,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("common.import")]}),e.jsxs(W,{onClick:v,disabled:x.length===0,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),r("common.export")]})]})]}),e.jsxs(N,{size:"icon",onClick:()=>b(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(T,{className:"h-4 w-4"}),!p&&r("decorators.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var u;return(u=d.current)==null?void 0:u.click()},disabled:m,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),r("common.import")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:v,disabled:x.length===0,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),r("common.export")]}),e.jsxs(N,{size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("decorators.addNew")]})]})]})]}),x.length===0?e.jsx(q,{children:e.jsx($,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(tt,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("decorators.noDecorators")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:r("decorators.noDecoratorsDescription")}),e.jsxs(N,{onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("decorators.addNew")]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(u=>e.jsx(Xt,{decorator:u},u.id))}),e.jsx(Kt,{open:C,onOpenChange:b,projectId:n})]})}function Qt({open:n,onOpenChange:x,projectId:r}){const{t:o}=M(),{createCondition:a}=Ee(),[C,b]=f.useState(!1),[m,h]=f.useState({name:"",type:"",properties:[]}),[d,p]=f.useState({}),v=()=>{h({...m,properties:[...m.properties,{name:"",type:"string",defaultValue:""}]})},g=(l,s,t)=>{const i=[...m.properties];i[l]={...i[l],[s]:t},h({...m,properties:i})},u=l=>{h({...m,properties:m.properties.filter((s,t)=>t!==l)})},I=l=>typeof l=="boolean"?l:typeof l=="string"?l.toLowerCase()==="true":!!l,D=()=>{const l={};return m.name.trim()?/\s/.test(m.name)&&(l.name=o("conditions.validation.noWhitespace")):l.name=o("validation.required"),p(l),Object.keys(l).length===0},P=async l=>{if(l.preventDefault(),!!D()){b(!0);try{await a({...m,projectId:r}),h({name:"",type:"",properties:[]}),p({}),x(!1)}catch(s){console.error("Failed to create condition:",s)}finally{b(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:o("conditions.addNew")}),e.jsx(se,{children:o("conditions.createDescription")})]}),e.jsxs("form",{onSubmit:P,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[o("conditions.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:m.name,onChange:l=>{h({...m,name:l.target.value}),d.name&&p({...d,name:null})},placeholder:o("conditions.namePlaceholder"),className:d.name?"border-destructive":"",required:!0}),d.name&&e.jsx("p",{className:"text-xs text-destructive",children:d.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"type",children:o("conditions.type")}),e.jsx(O,{id:"type",value:m.type,onChange:l=>h({...m,type:l.target.value}),placeholder:o("conditions.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:o("conditions.properties.title")}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:v,className:"gap-2",children:[e.jsx(T,{className:"h-3 w-3"}),o("conditions.properties.add")]})]}),m.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:o("conditions.properties.empty")}),m.properties.map((l,s)=>e.jsxs("div",{className:"flex flex-col gap-2 bg-muted p-3 rounded-md md:grid md:grid-cols-[1fr,120px,1fr,auto] md:items-end",children:[e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"flex md:hidden h-8 w-8",onClick:()=>u(s),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("conditions.properties.name")}),e.jsx(O,{value:l.name,onChange:t=>g(s,"name",t.target.value),placeholder:o("conditions.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("conditions.properties.type")}),e.jsx(oe,{value:l.type,onChange:t=>g(s,"type",t.target.value),children:[{value:"string",label:o("decorators.types.string")},{value:"int",label:o("decorators.types.integer")},{value:"float",label:o("decorators.types.float")},{value:"bool",label:o("decorators.types.boolean")}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:o("conditions.properties.defaultValue")}),l.type==="bool"?e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[e.jsx(A,{className:"text-xs font-medium",children:I(l.defaultValue)?o("common.true"):o("common.false")}),e.jsx(Fe,{checked:I(l.defaultValue),onCheckedChange:t=>g(s,"defaultValue",t)})]}):e.jsx(O,{value:l.defaultValue,onChange:t=>g(s,"defaultValue",t.target.value),placeholder:o("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"hidden md:flex h-8 w-8",onClick:()=>u(s),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})})]},s))]})]})}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:C,children:o("common.cancel")}),e.jsx(N,{type:"submit",disabled:C||!m.name.trim(),children:o(C?"common.creating":"common.create")})]})]})]})})}function es({open:n,onOpenChange:x,condition:r,projectId:o}){const{t:a}=M(),{updateCondition:C}=Ee(),[b,m]=f.useState(!1),[h,d]=f.useState({name:"",type:"",properties:[]}),[p,v]=f.useState({});f.useEffect(()=>{n&&r&&d({name:r.name||"",type:r.type||"",properties:Array.isArray(r.properties)?r.properties:[]})},[n,r]),f.useEffect(()=>{n||v({})},[n]);const g=()=>{d(s=>({...s,properties:[...s.properties,{name:"",type:"string",defaultValue:""}]}))},u=(s,t,i)=>{const j=[...h.properties];j[s]={...j[s],[t]:i},d({...h,properties:j})},I=s=>{d(t=>({...t,properties:t.properties.filter((i,j)=>j!==s)}))},D=s=>typeof s=="boolean"?s:typeof s=="string"?s.toLowerCase()==="true":!!s,P=()=>{const s={};return h.name.trim()?/\s/.test(h.name)&&(s.name=a("conditions.validation.noWhitespace")):s.name=a("validation.required"),v(s),Object.keys(s).length===0},l=async s=>{if(s.preventDefault(),!!P()){m(!0);try{await C(r.id,{name:h.name,type:h.type,properties:h.properties,projectId:o}),x(!1)}catch(t){console.error("Failed to update condition:",t)}finally{m(!1)}}};return e.jsx(G,{open:n,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(ee,{children:[e.jsxs(te,{children:[a("common.edit")," ",a("conditions.title").slice(0,-1)]}),e.jsx(se,{children:a("conditions.updateDescription")})]}),e.jsxs("form",{onSubmit:l,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(A,{htmlFor:"name",children:[a("conditions.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"name",value:h.name,onChange:s=>{d({...h,name:s.target.value}),p.name&&v({...p,name:null})},placeholder:a("conditions.namePlaceholder"),className:p.name?"border-destructive":"",required:!0}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(A,{htmlFor:"type",children:a("conditions.type")}),e.jsx(O,{id:"type",value:h.type,onChange:s=>d({...h,type:s.target.value}),placeholder:a("conditions.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:a("conditions.properties.title")}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:g,className:"gap-2",children:[e.jsx(T,{className:"h-3 w-3"}),a("conditions.properties.add")]})]}),h.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("conditions.properties.empty")}),h.properties.map((s,t)=>e.jsxs("div",{className:"flex flex-col gap-2 bg-muted p-3 rounded-md md:grid md:grid-cols-[1fr,120px,1fr,auto] md:items-end",children:[e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"flex md:hidden h-8 w-8",onClick:()=>I(t),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("conditions.properties.name")}),e.jsx(O,{value:s.name,onChange:i=>u(t,"name",i.target.value),placeholder:a("conditions.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("conditions.properties.type")}),e.jsx(oe,{value:s.type,onChange:i=>u(t,"type",i.target.value),children:[{value:"string",label:a("decorators.types.string")},{value:"int",label:a("decorators.types.integer")},{value:"float",label:a("decorators.types.float")},{value:"bool",label:a("decorators.types.boolean")}].map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(A,{className:"text-xs",children:a("conditions.properties.defaultValue")}),s.type==="bool"?e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[e.jsx(A,{className:"text-xs font-medium",children:D(s.defaultValue)?a("common.true"):a("common.false")}),e.jsx(Fe,{checked:D(s.defaultValue),onCheckedChange:i=>u(t,"defaultValue",i)})]}):e.jsx(O,{value:s.defaultValue,onChange:i=>u(t,"defaultValue",i.target.value),placeholder:a("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"hidden md:flex h-8 w-8",onClick:()=>I(t),children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})})]},t))]})]})}),e.jsxs(ae,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:b,children:a("common.cancel")}),e.jsx(N,{type:"submit",disabled:b||!h.name.trim(),children:a(b?"common.saving":"common.save")})]})]})]})})}function ts({condition:n}){const{t:x}=M(),{deleteCondition:r}=Ee(),[o,a]=f.useState(!1),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=async()=>{h(!0);try{await r(n.id),a(!1)}catch(p){console.error("Failed to delete condition:",p)}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white",children:e.jsx(Re,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:n.name}),n.type&&e.jsx(Ae,{variant:"outline",className:"mt-1 text-xs",children:n.type})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>b(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>a(!0),children:e.jsx(_,{className:"h-4 w-4"})})]})]})})}),e.jsx(es,{open:C,onOpenChange:b,condition:n,projectId:n.projectId}),e.jsx(ve,{open:o,onOpenChange:a,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsx(we,{children:x("conditions.deleteTitle")}),e.jsx(Ce,{children:x("conditions.deleteDescription",{name:n.name})})]}),e.jsxs(ke,{children:[e.jsx(De,{variant:"outline",disabled:m,children:x("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:d,disabled:m,children:x(m?"common.deleting":"common.delete")})]})]})})]})}function ss({projectId:n,conditions:x=[]}){const{t:r}=M(),{importConditions:o,exportConditions:a}=Ee(),[C,b]=f.useState(!1),[m,h]=f.useState(!1),d=f.useRef(null),p=ie(),v=async()=>{try{const u=await a(n),I=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),D=URL.createObjectURL(I),P=document.createElement("a");P.href=D,P.download=`conditions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(D)}catch(u){console.error("Failed to export conditions:",u)}},g=async u=>{var D;const I=(D=u.target.files)==null?void 0:D[0];if(I){h(!0);try{const P=await I.text(),l=JSON.parse(P);await o(n,Array.isArray(l)?l:[l])}catch(P){console.error("Failed to import conditions:",P)}finally{h(!1),d.current&&(d.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[r("conditions.title")," (",x.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("conditions.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:d,type:"file",accept:".json",onChange:g,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(W,{onClick:()=>{var u;return(u=d.current)==null?void 0:u.click()},disabled:m,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r("common.import")]}),e.jsxs(W,{onClick:v,disabled:x.length===0,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),r("common.export")]})]})]}),e.jsxs(N,{size:"icon",onClick:()=>b(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(T,{className:"h-4 w-4"}),!p&&r("conditions.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{var u;return(u=d.current)==null?void 0:u.click()},disabled:m,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),r("common.import")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:v,disabled:x.length===0,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),r("common.export")]}),e.jsxs(N,{size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("conditions.addNew")]})]})]})]}),x.length===0?e.jsx(q,{children:e.jsx($,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Re,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("conditions.noConditions")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:r("conditions.noConditionsDescription")}),e.jsxs(N,{onClick:()=>b(!0),className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),r("conditions.addNew")]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(u=>e.jsx(ts,{condition:u},u.id))}),e.jsx(Qt,{open:C,onOpenChange:b,projectId:n})]})}function ds(){const{t:n}=M(),{theme:x,resolvedTheme:r,setTheme:o}=xt(),{projectId:a}=Ke.useParams(),C=Ke.useSearch(),b=ie(),{projects:m,loadProjects:h,deleteProject:d,exportProject:p,importProject:v}=ht(),{dialogues:g,loadDialogues:u}=Ue(),{participants:I,loadParticipants:D}=Ie(),{categories:P,loadCategories:l}=le(),{decorators:s,loadDecorators:t}=Pe(),{conditions:i,loadConditions:j}=Ee(),{status:E,checkRemoteDiff:z,startPull:y,lastSyncedAt:k}=Qe(),[c,S]=f.useState(!0),[w,F]=f.useState((C==null?void 0:C.section)||"overview"),[R,B]=f.useState(!1),[J,Z]=f.useState(!1),[it,Le]=f.useState(!1),Ve=f.useRef(new Set),re=f.useRef(null),fe=f.useCallback(async()=>{S(!0),await Promise.all([h(),u(),D(a),l(a),t(a),j(a)]),S(!1)},[h,u,D,l,t,j,a]);f.useEffect(()=>{fe()},[fe]),f.useEffect(()=>{k&&fe()},[k,fe]),f.useEffect(()=>{(async()=>{if(!a||E!=="connected"||Ve.current.has(a))return;Ve.current.add(a),await z(a)&&await y(a,{simulate:!0})})()},[a,E,z,y]);const je=m.find(L=>L.id===a),Me=g.filter(L=>L.projectId===a),Oe=I.filter(L=>L.projectId===a),qe=P.filter(L=>L.projectId===a),$e=s.filter(L=>L.projectId===a),Be=i.filter(L=>L.projectId===a),ce=async()=>{try{await p(a)}catch(L){console.error("Failed to export project:",L)}};f.useEffect(()=>{const L=U=>{const ne=U==null?void 0:U.detail;!ne||ne.projectId!==a||ce()},V=U=>{const ne=U==null?void 0:U.detail;!ne||ne.projectId!==a||re.current&&re.current.click()};return window.addEventListener("command:project-export",L),window.addEventListener("command:project-import",V),()=>{window.removeEventListener("command:project-export",L),window.removeEventListener("command:project-import",V)}},[a,ce]),f.useEffect(()=>{if(b)return;const L=V=>{const U=V.target;if(!(U.tagName==="INPUT"||U.tagName==="TEXTAREA"||U.isContentEditable)&&(V.ctrlKey||V.metaKey)){const _e=V.key.toLowerCase();if(_e==="e"){V.preventDefault(),ce();return}_e==="i"&&(V.preventDefault(),re.current&&re.current.click())}};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[ce,b]);const We=async L=>{var U;const V=(U=L.target.files)==null?void 0:U[0];if(V){B(!0);try{await v(V),await fe()}catch(ne){console.error("Failed to import project:",ne)}finally{B(!1),re.current&&(re.current.value="")}}},lt=async()=>{await d(a),window.location.href="#/"},He=()=>{Le(!0)};return c?e.jsx("div",{className:`${b?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsx("p",{className:"text-muted-foreground",children:n("common.loading")})}):je?e.jsxs("div",{className:`${b?"h-[100dvh]":"h-screen"} flex flex-col overflow-hidden`,children:[e.jsx(yt,{className:J?"z-40":void 0,left:e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>Z(!0),className:"lg:hidden rounded-full shrink-0",children:e.jsx(bt,{className:"h-5 w-5"})}),e.jsx(ze,{to:"/",children:e.jsx(pt,{content:n("common.back"),side:"bottom",children:e.jsx(N,{variant:"ghost",size:"icon",className:"rounded-full shrink-0",children:e.jsx(Ct,{className:"h-5 w-5"})})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-sm md:text-2xl font-bold tracking-tight truncate",children:je.name}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:n("projects.projectDetails")})]})]}),right:e.jsxs("div",{className:"hidden md:flex items-center text-xs font-medium text-muted-foreground bg-muted px-3 py-1.5 rounded-full","data-header-mobile-hidden":!0,children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),n("dialogues.autoSaved")]}),menuItems:e.jsxs(e.Fragment,{children:[e.jsx(wt,{}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o(r==="dark"?"light":"dark"),className:"justify-start",children:r==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),n("settings.lightMode")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"h-4 w-4 mr-2"}),n("settings.darkMode")]})})]})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>Z(!1)}),e.jsx("input",{ref:re,type:"file",accept:".mnteadlgproj",onChange:We,className:"hidden"}),e.jsxs("div",{className:"flex-1 flex min-h-0 overflow-hidden",children:[e.jsx(Tt,{activeSection:w,onSectionChange:L=>{F(L),Z(!1)},project:je,dialogueCount:Me.length,participantCount:Oe.length,isMobileOpen:J,onMobileClose:()=>Z(!1)}),e.jsx("main",{className:"flex-1 bg-grid overflow-x-hidden overflow-y-auto overscroll-contain",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8 lg:p-12",children:[w==="overview"&&e.jsx(Ut,{project:je,dialogues:Me,participants:Oe,categories:qe,decorators:$e,conditions:Be,onExport:ce,onImport:We,onDelete:He,onSectionChange:F,fileInputRef:re,isImporting:R}),w==="dialogues"&&e.jsx(qt,{projectId:a,dialogues:Me}),w==="participants"&&e.jsx(Wt,{projectId:a,participants:Oe}),w==="categories"&&e.jsx(Zt,{projectId:a,categories:qe}),w==="decorators"&&e.jsx(Gt,{projectId:a,decorators:$e}),w==="conditions"&&e.jsx(ss,{projectId:a,conditions:Be}),w==="settings"&&e.jsx(gt,{project:je,onExport:ce,onDelete:He})]})})]}),e.jsx(ve,{open:it,onOpenChange:Le,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsx(we,{children:n("projects.deleteProject")}),e.jsx(Ce,{children:n("projects.deleteConfirm")})]}),e.jsxs(ke,{children:[e.jsx(De,{variant:"outline",children:n("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:()=>{Le(!1),lt()},children:n("common.delete")})]})]})})]}):e.jsx("div",{className:`${b?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:n("projects.notFound")}),e.jsx("p",{className:"text-muted-foreground",children:n("projects.notFoundDescription")})]})})}export{ds as component};
