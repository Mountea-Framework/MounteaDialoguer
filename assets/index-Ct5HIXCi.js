import{$ as Fb,r as C,c as ze,a0 as $b,a1 as zb,j as h,a2 as Hl,a3 as Mn,a4 as Bb,i as Yt,u as Qe,M as ud,l as M0,a5 as fi,L as $e,B as ye,A as Wr,V as Qn,I as Dt,a6 as P0,a7 as hr,T as Hb,X as Un,a8 as Vb,a9 as Gb,D as Ub,d as Kb,e as Yb,f as Wb,g as Xb,S as Zb,W as Qb,aa as Jb,b as ew,w as tw,ab as rw,ac as us,E as cs,ad as nw,z as iw,ae as sw,af as aw,x as ow,t as uw,Z as pt,G as cw,H as lw,J as dw,K as fw,N as hw,O as pw,P as gw,Q as mw,R as vw,ag as yw,ah as xw,ai as Jd,aj as ef,ak as Pn}from"./index-CtdWMEAS.js";import{c as cd}from"./_commonjs-dynamic-modules-TDtrdbi3.js";import{P as xr}from"./plus-B26CuSYj.js";import{T as hi,C as ld,S as bw,b as dd,u as ww,d as _w,e as Nw,f as Ew,M as Cw}from"./confetti-CgzFYpIx.js";import{useCategoryStore as Sw}from"./categoryStore-BdSH2jAY.js";import{N as mr,C as fd,A as jw,L as kw,e as Rw}from"./app-header-B3PCuEQ-.js";import{u as Iw,O as Aw,C as Tw}from"./onboarding-tour-BwrZzWFl.js";import{S as qw,M as Mw}from"./sun-CqVREw0S.js";function Pw(e,t){if(e===void 0)return{shouldBlockFn:()=>!0,withResolver:!1};if("shouldBlockFn"in e)return e;if(typeof e=="function")return{shouldBlockFn:async()=>await e(),enableBeforeUnload:!0,withResolver:!1};const r=!!(e.condition??!0),n=e.blockerFn;return{shouldBlockFn:async()=>r&&n!==void 0?await n():r,enableBeforeUnload:r,withResolver:n===void 0}}function Ow(e,t){const{shouldBlockFn:r,enableBeforeUnload:n=!0,disabled:i=!1,withResolver:s=!1}=Pw(e),a=Fb(),{history:o}=a,[u,c]=C.useState({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0});return C.useEffect(()=>{const l=async d=>{function f(w){const g=a.parseLocation(w),b=a.getMatchedRoutes(g.pathname);return b.foundRoute===void 0?{routeId:"__notFound__",fullPath:g.pathname,pathname:g.pathname,params:b.routeParams,search:a.options.parseSearch(w.search)}:{routeId:b.foundRoute.id,fullPath:b.foundRoute.fullPath,pathname:g.pathname,params:b.routeParams,search:a.options.parseSearch(w.search)}}const p=f(d.currentLocation),m=f(d.nextLocation);if(p.routeId==="__notFound__"&&m.routeId!=="__notFound__")return!1;const x=await r({action:d.action,current:p,next:m});if(!s)return x;if(!x)return!1;const v=await new Promise(w=>{c({status:"blocked",current:p,next:m,action:d.action,proceed:()=>w(!1),reset:()=>w(!0)})});return c({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0}),v};return i?void 0:o.block({blockerFn:l,enableBeforeUnload:n})},[r,n,i,s,o,a]),u}/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dw=ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tf=ze("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lw=ze("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=ze("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rf=ze("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=ze("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=ze("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fw=ze("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=ze("LocateFixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $w=ze("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zw=ze("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bw=ze("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hw=ze("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=ze("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vw=ze("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=ze("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);function Oe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,n;r<e.length;r++)(n=Oe(e[r]))!==""&&(t+=(t&&" ")+n);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var Gw={value:()=>{}};function mi(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Kn(r)}function Kn(e){this._=e}function Uw(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}Kn.prototype=mi.prototype={constructor:Kn,on:function(e,t){var r=this._,n=Uw(e+"",r),i,s=-1,a=n.length;if(arguments.length<2){for(;++s<a;)if((i=(e=n[s]).type)&&(i=Kw(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<a;)if(i=(e=n[s]).type)r[i]=sf(r[i],e.name,t);else if(t==null)for(i in r)r[i]=sf(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Kn(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,s;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],n=0,i=s.length;n<i;++n)s[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,s=n.length;i<s;++i)n[i].value.apply(t,r)}};function Kw(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function sf(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=Gw,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var Vl="http://www.w3.org/1999/xhtml";const af={svg:"http://www.w3.org/2000/svg",xhtml:Vl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vi(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),af.hasOwnProperty(t)?{space:af[t],local:e}:e}function Yw(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===Vl&&t.documentElement.namespaceURI===Vl?t.createElement(e):t.createElementNS(r,e)}}function Ww(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function D0(e){var t=vi(e);return(t.local?Ww:Yw)(t)}function Xw(){}function hd(e){return e==null?Xw:function(){return this.querySelector(e)}}function Zw(e){typeof e!="function"&&(e=hd(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],a=s.length,o=n[i]=new Array(a),u,c,l=0;l<a;++l)(u=s[l])&&(c=e.call(u,u.__data__,l,s))&&("__data__"in u&&(c.__data__=u.__data__),o[l]=c);return new Ze(n,this._parents)}function Qw(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Jw(){return[]}function L0(e){return e==null?Jw:function(){return this.querySelectorAll(e)}}function e_(e){return function(){return Qw(e.apply(this,arguments))}}function t_(e){typeof e=="function"?e=e_(e):e=L0(e);for(var t=this._groups,r=t.length,n=[],i=[],s=0;s<r;++s)for(var a=t[s],o=a.length,u,c=0;c<o;++c)(u=a[c])&&(n.push(e.call(u,u.__data__,c,a)),i.push(u));return new Ze(n,i)}function F0(e){return function(){return this.matches(e)}}function $0(e){return function(t){return t.matches(e)}}var r_=Array.prototype.find;function n_(e){return function(){return r_.call(this.children,e)}}function i_(){return this.firstElementChild}function s_(e){return this.select(e==null?i_:n_(typeof e=="function"?e:$0(e)))}var a_=Array.prototype.filter;function o_(){return Array.from(this.children)}function u_(e){return function(){return a_.call(this.children,e)}}function c_(e){return this.selectAll(e==null?o_:u_(typeof e=="function"?e:$0(e)))}function l_(e){typeof e!="function"&&(e=F0(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],a=s.length,o=n[i]=[],u,c=0;c<a;++c)(u=s[c])&&e.call(u,u.__data__,c,s)&&o.push(u);return new Ze(n,this._parents)}function z0(e){return new Array(e.length)}function d_(){return new Ze(this._enter||this._groups.map(z0),this._parents)}function ei(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ei.prototype={constructor:ei,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function f_(e){return function(){return e}}function h_(e,t,r,n,i,s){for(var a=0,o,u=t.length,c=s.length;a<c;++a)(o=t[a])?(o.__data__=s[a],n[a]=o):r[a]=new ei(e,s[a]);for(;a<u;++a)(o=t[a])&&(i[a]=o)}function p_(e,t,r,n,i,s,a){var o,u,c=new Map,l=t.length,d=s.length,f=new Array(l),p;for(o=0;o<l;++o)(u=t[o])&&(f[o]=p=a.call(u,u.__data__,o,t)+"",c.has(p)?i[o]=u:c.set(p,u));for(o=0;o<d;++o)p=a.call(e,s[o],o,s)+"",(u=c.get(p))?(n[o]=u,u.__data__=s[o],c.delete(p)):r[o]=new ei(e,s[o]);for(o=0;o<l;++o)(u=t[o])&&c.get(f[o])===u&&(i[o]=u)}function g_(e){return e.__data__}function m_(e,t){if(!arguments.length)return Array.from(this,g_);var r=t?p_:h_,n=this._parents,i=this._groups;typeof e!="function"&&(e=f_(e));for(var s=i.length,a=new Array(s),o=new Array(s),u=new Array(s),c=0;c<s;++c){var l=n[c],d=i[c],f=d.length,p=v_(e.call(l,l&&l.__data__,c,n)),m=p.length,x=o[c]=new Array(m),y=a[c]=new Array(m),v=u[c]=new Array(f);r(l,d,x,y,v,p,t);for(var w=0,g=0,b,_;w<m;++w)if(b=x[w]){for(w>=g&&(g=w+1);!(_=y[g])&&++g<m;);b._next=_||null}}return a=new Ze(a,n),a._enter=o,a._exit=u,a}function v_(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function y_(){return new Ze(this._exit||this._groups.map(z0),this._parents)}function x_(e,t,r){var n=this.enter(),i=this,s=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?s.remove():r(s),n&&i?n.merge(i).order():i}function b_(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,s=n.length,a=Math.min(i,s),o=new Array(i),u=0;u<a;++u)for(var c=r[u],l=n[u],d=c.length,f=o[u]=new Array(d),p,m=0;m<d;++m)(p=c[m]||l[m])&&(f[m]=p);for(;u<i;++u)o[u]=r[u];return new Ze(o,this._parents)}function w_(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,s=n[i],a;--i>=0;)(a=n[i])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function __(e){e||(e=N_);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var r=this._groups,n=r.length,i=new Array(n),s=0;s<n;++s){for(var a=r[s],o=a.length,u=i[s]=new Array(o),c,l=0;l<o;++l)(c=a[l])&&(u[l]=c);u.sort(t)}return new Ze(i,this._parents).order()}function N_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function E_(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function C_(){return Array.from(this)}function S_(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,s=n.length;i<s;++i){var a=n[i];if(a)return a}return null}function j_(){let e=0;for(const t of this)++e;return e}function k_(){return!this.node()}function R_(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],s=0,a=i.length,o;s<a;++s)(o=i[s])&&e.call(o,o.__data__,s,i);return this}function I_(e){return function(){this.removeAttribute(e)}}function A_(e){return function(){this.removeAttributeNS(e.space,e.local)}}function T_(e,t){return function(){this.setAttribute(e,t)}}function q_(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function M_(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function P_(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function O_(e,t){var r=vi(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?A_:I_:typeof t=="function"?r.local?P_:M_:r.local?q_:T_)(r,t))}function B0(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function D_(e){return function(){this.style.removeProperty(e)}}function L_(e,t,r){return function(){this.style.setProperty(e,t,r)}}function F_(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function $_(e,t,r){return arguments.length>1?this.each((t==null?D_:typeof t=="function"?F_:L_)(e,t,r??"")):wr(this.node(),e)}function wr(e,t){return e.style.getPropertyValue(t)||B0(e).getComputedStyle(e,null).getPropertyValue(t)}function z_(e){return function(){delete this[e]}}function B_(e,t){return function(){this[e]=t}}function H_(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function V_(e,t){return arguments.length>1?this.each((t==null?z_:typeof t=="function"?H_:B_)(e,t)):this.node()[e]}function H0(e){return e.trim().split(/^|\s+/)}function pd(e){return e.classList||new V0(e)}function V0(e){this._node=e,this._names=H0(e.getAttribute("class")||"")}V0.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function G0(e,t){for(var r=pd(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function U0(e,t){for(var r=pd(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function G_(e){return function(){G0(this,e)}}function U_(e){return function(){U0(this,e)}}function K_(e,t){return function(){(t.apply(this,arguments)?G0:U0)(this,e)}}function Y_(e,t){var r=H0(e+"");if(arguments.length<2){for(var n=pd(this.node()),i=-1,s=r.length;++i<s;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?K_:t?G_:U_)(r,t))}function W_(){this.textContent=""}function X_(e){return function(){this.textContent=e}}function Z_(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Q_(e){return arguments.length?this.each(e==null?W_:(typeof e=="function"?Z_:X_)(e)):this.node().textContent}function J_(){this.innerHTML=""}function e1(e){return function(){this.innerHTML=e}}function t1(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function r1(e){return arguments.length?this.each(e==null?J_:(typeof e=="function"?t1:e1)(e)):this.node().innerHTML}function n1(){this.nextSibling&&this.parentNode.appendChild(this)}function i1(){return this.each(n1)}function s1(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function a1(){return this.each(s1)}function o1(e){var t=typeof e=="function"?e:D0(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function u1(){return null}function c1(e,t){var r=typeof e=="function"?e:D0(e),n=t==null?u1:typeof t=="function"?t:hd(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function l1(){var e=this.parentNode;e&&e.removeChild(this)}function d1(){return this.each(l1)}function f1(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function h1(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function p1(e){return this.select(e?h1:f1)}function g1(e){return arguments.length?this.property("__data__",e):this.node().__data__}function m1(e){return function(t){e.call(this,t,this.__data__)}}function v1(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function y1(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,s;r<i;++r)s=t[r],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++n]=s;++n?t.length=n:delete this.__on}}}function x1(e,t,r){return function(){var n=this.__on,i,s=m1(t);if(n){for(var a=0,o=n.length;a<o;++a)if((i=n[a]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=r),i.value=t;return}}this.addEventListener(e.type,s,r),i={type:e.type,name:e.name,value:t,listener:s,options:r},n?n.push(i):this.__on=[i]}}function b1(e,t,r){var n=v1(e+""),i,s=n.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var u=0,c=o.length,l;u<c;++u)for(i=0,l=o[u];i<s;++i)if((a=n[i]).type===l.type&&a.name===l.name)return l.value}return}for(o=t?x1:y1,i=0;i<s;++i)this.each(o(n[i],t,r));return this}function K0(e,t,r){var n=B0(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function w1(e,t){return function(){return K0(this,e,t)}}function _1(e,t){return function(){return K0(this,e,t.apply(this,arguments))}}function N1(e,t){return this.each((typeof t=="function"?_1:w1)(e,t))}function*E1(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,s=n.length,a;i<s;++i)(a=n[i])&&(yield a)}var Y0=[null];function Ze(e,t){this._groups=e,this._parents=t}function on(){return new Ze([[document.documentElement]],Y0)}function C1(){return this}Ze.prototype=on.prototype={constructor:Ze,select:Zw,selectAll:t_,selectChild:s_,selectChildren:c_,filter:l_,data:m_,enter:d_,exit:y_,join:x_,merge:b_,selection:C1,order:w_,sort:__,call:E_,nodes:C_,node:S_,size:j_,empty:k_,each:R_,attr:O_,style:$_,property:V_,classed:Y_,text:Q_,html:r1,raise:i1,lower:a1,append:o1,insert:c1,remove:d1,clone:p1,datum:g1,on:b1,dispatch:N1,[Symbol.iterator]:E1};function Xe(e){return typeof e=="string"?new Ze([[document.querySelector(e)]],[document.documentElement]):new Ze([[e]],Y0)}function S1(e){let t;for(;t=e.sourceEvent;)e=t;return e}function it(e,t){if(e=S1(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const j1={passive:!1},Xr={capture:!0,passive:!1};function ls(e){e.stopImmediatePropagation()}function vr(e){e.preventDefault(),e.stopImmediatePropagation()}function W0(e){var t=e.document.documentElement,r=Xe(e).on("dragstart.drag",vr,Xr);"onselectstart"in t?r.on("selectstart.drag",vr,Xr):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function X0(e,t){var r=e.document.documentElement,n=Xe(e).on("dragstart.drag",null);t&&(n.on("click.drag",vr,Xr),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const On=e=>()=>e;function Gl(e,{sourceEvent:t,subject:r,target:n,identifier:i,active:s,x:a,y:o,dx:u,dy:c,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:l}})}Gl.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function k1(e){return!e.ctrlKey&&!e.button}function R1(){return this.parentNode}function I1(e,t){return t??{x:e.x,y:e.y}}function A1(){return navigator.maxTouchPoints||"ontouchstart"in this}function Z0(){var e=k1,t=R1,r=I1,n=A1,i={},s=mi("start","drag","end"),a=0,o,u,c,l,d=0;function f(b){b.on("mousedown.drag",p).filter(n).on("touchstart.drag",y).on("touchmove.drag",v,j1).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(b,_){if(!(l||!e.call(this,b,_))){var N=g(this,t.call(this,b,_),b,_,"mouse");N&&(Xe(b.view).on("mousemove.drag",m,Xr).on("mouseup.drag",x,Xr),W0(b.view),ls(b),c=!1,o=b.clientX,u=b.clientY,N("start",b))}}function m(b){if(vr(b),!c){var _=b.clientX-o,N=b.clientY-u;c=_*_+N*N>d}i.mouse("drag",b)}function x(b){Xe(b.view).on("mousemove.drag mouseup.drag",null),X0(b.view,c),vr(b),i.mouse("end",b)}function y(b,_){if(e.call(this,b,_)){var N=b.changedTouches,E=t.call(this,b,_),I=N.length,A,L;for(A=0;A<I;++A)(L=g(this,E,b,_,N[A].identifier,N[A]))&&(ls(b),L("start",b,N[A]))}}function v(b){var _=b.changedTouches,N=_.length,E,I;for(E=0;E<N;++E)(I=i[_[E].identifier])&&(vr(b),I("drag",b,_[E]))}function w(b){var _=b.changedTouches,N=_.length,E,I;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),E=0;E<N;++E)(I=i[_[E].identifier])&&(ls(b),I("end",b,_[E]))}function g(b,_,N,E,I,A){var L=s.copy(),T=it(A||N,_),j,F,S;if((S=r.call(b,new Gl("beforestart",{sourceEvent:N,target:f,identifier:I,active:a,x:T[0],y:T[1],dx:0,dy:0,dispatch:L}),E))!=null)return j=S.x-T[0]||0,F=S.y-T[1]||0,function D(O,M,R){var q=T,V;switch(O){case"start":i[I]=D,V=a++;break;case"end":delete i[I],--a;case"drag":T=it(R||M,_),V=a;break}L.call(O,b,new Gl(O,{sourceEvent:M,subject:S,target:f,identifier:I,active:V,x:T[0]+j,y:T[1]+F,dx:T[0]-q[0],dy:T[1]-q[1],dispatch:L}),E)}}return f.filter=function(b){return arguments.length?(e=typeof b=="function"?b:On(!!b),f):e},f.container=function(b){return arguments.length?(t=typeof b=="function"?b:On(b),f):t},f.subject=function(b){return arguments.length?(r=typeof b=="function"?b:On(b),f):r},f.touchable=function(b){return arguments.length?(n=typeof b=="function"?b:On(!!b),f):n},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(d=(b=+b)*b,f):Math.sqrt(d)},f}function gd(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Q0(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function un(){}var Zr=.7,ti=1/Zr,yr="\\s*([+-]?\\d+)\\s*",Qr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",T1=/^#([0-9a-f]{3,8})$/,q1=new RegExp(`^rgb\\(${yr},${yr},${yr}\\)$`),M1=new RegExp(`^rgb\\(${vt},${vt},${vt}\\)$`),P1=new RegExp(`^rgba\\(${yr},${yr},${yr},${Qr}\\)$`),O1=new RegExp(`^rgba\\(${vt},${vt},${vt},${Qr}\\)$`),D1=new RegExp(`^hsl\\(${Qr},${vt},${vt}\\)$`),L1=new RegExp(`^hsla\\(${Qr},${vt},${vt},${Qr}\\)$`),of={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gd(un,Wt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:uf,formatHex:uf,formatHex8:F1,formatHsl:$1,formatRgb:cf,toString:cf});function uf(){return this.rgb().formatHex()}function F1(){return this.rgb().formatHex8()}function $1(){return J0(this).formatHsl()}function cf(){return this.rgb().formatRgb()}function Wt(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=T1.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?lf(t):r===3?new Ue(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Dn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Dn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=q1.exec(e))?new Ue(t[1],t[2],t[3],1):(t=M1.exec(e))?new Ue(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=P1.exec(e))?Dn(t[1],t[2],t[3],t[4]):(t=O1.exec(e))?Dn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=D1.exec(e))?hf(t[1],t[2]/100,t[3]/100,1):(t=L1.exec(e))?hf(t[1],t[2]/100,t[3]/100,t[4]):of.hasOwnProperty(e)?lf(of[e]):e==="transparent"?new Ue(NaN,NaN,NaN,0):null}function lf(e){return new Ue(e>>16&255,e>>8&255,e&255,1)}function Dn(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ue(e,t,r,n)}function z1(e){return e instanceof un||(e=Wt(e)),e?(e=e.rgb(),new Ue(e.r,e.g,e.b,e.opacity)):new Ue}function Ul(e,t,r,n){return arguments.length===1?z1(e):new Ue(e,t,r,n??1)}function Ue(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}gd(Ue,Ul,Q0(un,{brighter(e){return e=e==null?ti:Math.pow(ti,e),new Ue(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Zr:Math.pow(Zr,e),new Ue(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ue(Ut(this.r),Ut(this.g),Ut(this.b),ri(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:df,formatHex:df,formatHex8:B1,formatRgb:ff,toString:ff}));function df(){return`#${Gt(this.r)}${Gt(this.g)}${Gt(this.b)}`}function B1(){return`#${Gt(this.r)}${Gt(this.g)}${Gt(this.b)}${Gt((isNaN(this.opacity)?1:this.opacity)*255)}`}function ff(){const e=ri(this.opacity);return`${e===1?"rgb(":"rgba("}${Ut(this.r)}, ${Ut(this.g)}, ${Ut(this.b)}${e===1?")":`, ${e})`}`}function ri(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ut(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Gt(e){return e=Ut(e),(e<16?"0":"")+e.toString(16)}function hf(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new st(e,t,r,n)}function J0(e){if(e instanceof st)return new st(e.h,e.s,e.l,e.opacity);if(e instanceof un||(e=Wt(e)),!e)return new st;if(e instanceof st)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),s=Math.max(t,r,n),a=NaN,o=s-i,u=(s+i)/2;return o?(t===s?a=(r-n)/o+(r<n)*6:r===s?a=(n-t)/o+2:a=(t-r)/o+4,o/=u<.5?s+i:2-s-i,a*=60):o=u>0&&u<1?0:a,new st(a,o,u,e.opacity)}function H1(e,t,r,n){return arguments.length===1?J0(e):new st(e,t,r,n??1)}function st(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}gd(st,H1,Q0(un,{brighter(e){return e=e==null?ti:Math.pow(ti,e),new st(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Zr:Math.pow(Zr,e),new st(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Ue(ds(e>=240?e-240:e+120,i,n),ds(e,i,n),ds(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new st(pf(this.h),Ln(this.s),Ln(this.l),ri(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ri(this.opacity);return`${e===1?"hsl(":"hsla("}${pf(this.h)}, ${Ln(this.s)*100}%, ${Ln(this.l)*100}%${e===1?")":`, ${e})`}`}}));function pf(e){return e=(e||0)%360,e<0?e+360:e}function Ln(e){return Math.max(0,Math.min(1,e||0))}function ds(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const md=e=>()=>e;function V1(e,t){return function(r){return e+r*t}}function G1(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function U1(e){return(e=+e)==1?ey:function(t,r){return r-t?G1(t,r,e):md(isNaN(t)?r:t)}}function ey(e,t){var r=t-e;return r?V1(e,r):md(isNaN(e)?t:e)}const ni=(function e(t){var r=U1(t);function n(i,s){var a=r((i=Ul(i)).r,(s=Ul(s)).r),o=r(i.g,s.g),u=r(i.b,s.b),c=ey(i.opacity,s.opacity);return function(l){return i.r=a(l),i.g=o(l),i.b=u(l),i.opacity=c(l),i+""}}return n.gamma=e,n})(1);function K1(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(s){for(i=0;i<r;++i)n[i]=e[i]*(1-s)+t[i]*s;return n}}function Y1(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function W1(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),s=new Array(r),a;for(a=0;a<n;++a)i[a]=Ur(e[a],t[a]);for(;a<r;++a)s[a]=t[a];return function(o){for(a=0;a<n;++a)s[a]=i[a](o);return s}}function X1(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function mt(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Z1(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=Ur(e[i],t[i]):n[i]=t[i];return function(s){for(i in r)n[i]=r[i](s);return n}}var Kl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fs=new RegExp(Kl.source,"g");function Q1(e){return function(){return e}}function J1(e){return function(t){return e(t)+""}}function ty(e,t){var r=Kl.lastIndex=fs.lastIndex=0,n,i,s,a=-1,o=[],u=[];for(e=e+"",t=t+"";(n=Kl.exec(e))&&(i=fs.exec(t));)(s=i.index)>r&&(s=t.slice(r,s),o[a]?o[a]+=s:o[++a]=s),(n=n[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,u.push({i:a,x:mt(n,i)})),r=fs.lastIndex;return r<t.length&&(s=t.slice(r),o[a]?o[a]+=s:o[++a]=s),o.length<2?u[0]?J1(u[0].x):Q1(t):(t=u.length,function(c){for(var l=0,d;l<t;++l)o[(d=u[l]).i]=d.x(c);return o.join("")})}function Ur(e,t){var r=typeof t,n;return t==null||r==="boolean"?md(t):(r==="number"?mt:r==="string"?(n=Wt(t))?(t=n,ni):ty:t instanceof Wt?ni:t instanceof Date?X1:Y1(t)?K1:Array.isArray(t)?W1:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Z1:mt)(e,t)}var gf=180/Math.PI,Yl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ry(e,t,r,n,i,s){var a,o,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,u/=o),e*n<t*r&&(e=-e,t=-t,u=-u,a=-a),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*gf,skewX:Math.atan(u)*gf,scaleX:a,scaleY:o}}var Fn;function eN(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Yl:ry(t.a,t.b,t.c,t.d,t.e,t.f)}function tN(e){return e==null||(Fn||(Fn=document.createElementNS("http://www.w3.org/2000/svg","g")),Fn.setAttribute("transform",e),!(e=Fn.transform.baseVal.consolidate()))?Yl:(e=e.matrix,ry(e.a,e.b,e.c,e.d,e.e,e.f))}function ny(e,t,r,n){function i(c){return c.length?c.pop()+" ":""}function s(c,l,d,f,p,m){if(c!==d||l!==f){var x=p.push("translate(",null,t,null,r);m.push({i:x-4,x:mt(c,d)},{i:x-2,x:mt(l,f)})}else(d||f)&&p.push("translate("+d+t+f+r)}function a(c,l,d,f){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),f.push({i:d.push(i(d)+"rotate(",null,n)-2,x:mt(c,l)})):l&&d.push(i(d)+"rotate("+l+n)}function o(c,l,d,f){c!==l?f.push({i:d.push(i(d)+"skewX(",null,n)-2,x:mt(c,l)}):l&&d.push(i(d)+"skewX("+l+n)}function u(c,l,d,f,p,m){if(c!==d||l!==f){var x=p.push(i(p)+"scale(",null,",",null,")");m.push({i:x-4,x:mt(c,d)},{i:x-2,x:mt(l,f)})}else(d!==1||f!==1)&&p.push(i(p)+"scale("+d+","+f+")")}return function(c,l){var d=[],f=[];return c=e(c),l=e(l),s(c.translateX,c.translateY,l.translateX,l.translateY,d,f),a(c.rotate,l.rotate,d,f),o(c.skewX,l.skewX,d,f),u(c.scaleX,c.scaleY,l.scaleX,l.scaleY,d,f),c=l=null,function(p){for(var m=-1,x=f.length,y;++m<x;)d[(y=f[m]).i]=y.x(p);return d.join("")}}}var rN=ny(eN,"px, ","px)","deg)"),nN=ny(tN,", ",")",")"),iN=1e-12;function mf(e){return((e=Math.exp(e))+1/e)/2}function sN(e){return((e=Math.exp(e))-1/e)/2}function aN(e){return((e=Math.exp(2*e))-1)/(e+1)}const Yn=(function e(t,r,n){function i(s,a){var o=s[0],u=s[1],c=s[2],l=a[0],d=a[1],f=a[2],p=l-o,m=d-u,x=p*p+m*m,y,v;if(x<iN)v=Math.log(f/c)/t,y=function(E){return[o+E*p,u+E*m,c*Math.exp(t*E*v)]};else{var w=Math.sqrt(x),g=(f*f-c*c+n*x)/(2*c*r*w),b=(f*f-c*c-n*x)/(2*f*r*w),_=Math.log(Math.sqrt(g*g+1)-g),N=Math.log(Math.sqrt(b*b+1)-b);v=(N-_)/t,y=function(E){var I=E*v,A=mf(_),L=c/(r*w)*(A*aN(t*I+_)-sN(_));return[o+L*p,u+L*m,c*A/mf(t*I+_)]}}return y.duration=v*1e3*t/Math.SQRT2,y}return i.rho=function(s){var a=Math.max(.001,+s),o=a*a,u=o*o;return e(a,o,u)},i})(Math.SQRT2,2,4);var _r=0,zr=0,Fr=0,iy=1e3,ii,Br,si=0,Xt=0,yi=0,Jr=typeof performance=="object"&&performance.now?performance:Date,sy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function vd(){return Xt||(sy(oN),Xt=Jr.now()+yi)}function oN(){Xt=0}function ai(){this._call=this._time=this._next=null}ai.prototype=ay.prototype={constructor:ai,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?vd():+r)+(t==null?0:+t),!this._next&&Br!==this&&(Br?Br._next=this:ii=this,Br=this),this._call=e,this._time=r,Wl()},stop:function(){this._call&&(this._call=null,this._time=1/0,Wl())}};function ay(e,t,r){var n=new ai;return n.restart(e,t,r),n}function uN(){vd(),++_r;for(var e=ii,t;e;)(t=Xt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--_r}function vf(){Xt=(si=Jr.now())+yi,_r=zr=0;try{uN()}finally{_r=0,lN(),Xt=0}}function cN(){var e=Jr.now(),t=e-si;t>iy&&(yi-=t,si=e)}function lN(){for(var e,t=ii,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:ii=r);Br=e,Wl(n)}function Wl(e){if(!_r){zr&&(zr=clearTimeout(zr));var t=e-Xt;t>24?(e<1/0&&(zr=setTimeout(vf,e-Jr.now()-yi)),Fr&&(Fr=clearInterval(Fr))):(Fr||(si=Jr.now(),Fr=setInterval(cN,iy)),_r=1,sy(vf))}}function yf(e,t,r){var n=new ai;return t=t==null?0:+t,n.restart(i=>{n.stop(),e(i+t)},t,r),n}var dN=mi("start","end","cancel","interrupt"),fN=[],oy=0,xf=1,Xl=2,Wn=3,bf=4,Zl=5,Xn=6;function xi(e,t,r,n,i,s){var a=e.__transition;if(!a)e.__transition={};else if(r in a)return;hN(e,r,{name:t,index:n,group:i,on:dN,tween:fN,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:oy})}function yd(e,t){var r=ct(e,t);if(r.state>oy)throw new Error("too late; already scheduled");return r}function xt(e,t){var r=ct(e,t);if(r.state>Wn)throw new Error("too late; already running");return r}function ct(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function hN(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=ay(s,0,r.time);function s(c){r.state=xf,r.timer.restart(a,r.delay,r.time),r.delay<=c&&a(c-r.delay)}function a(c){var l,d,f,p;if(r.state!==xf)return u();for(l in n)if(p=n[l],p.name===r.name){if(p.state===Wn)return yf(a);p.state===bf?(p.state=Xn,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete n[l]):+l<t&&(p.state=Xn,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete n[l])}if(yf(function(){r.state===Wn&&(r.state=bf,r.timer.restart(o,r.delay,r.time),o(c))}),r.state=Xl,r.on.call("start",e,e.__data__,r.index,r.group),r.state===Xl){for(r.state=Wn,i=new Array(f=r.tween.length),l=0,d=-1;l<f;++l)(p=r.tween[l].value.call(e,e.__data__,r.index,r.group))&&(i[++d]=p);i.length=d+1}}function o(c){for(var l=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(u),r.state=Zl,1),d=-1,f=i.length;++d<f;)i[d].call(e,l);r.state===Zl&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=Xn,r.timer.stop(),delete n[t];for(var c in n)return;delete e.__transition}}function Zn(e,t){var r=e.__transition,n,i,s=!0,a;if(r){t=t==null?null:t+"";for(a in r){if((n=r[a]).name!==t){s=!1;continue}i=n.state>Xl&&n.state<Zl,n.state=Xn,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[a]}s&&delete e.__transition}}function pN(e){return this.each(function(){Zn(this,e)})}function gN(e,t){var r,n;return function(){var i=xt(this,e),s=i.tween;if(s!==r){n=r=s;for(var a=0,o=n.length;a<o;++a)if(n[a].name===t){n=n.slice(),n.splice(a,1);break}}i.tween=n}}function mN(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var s=xt(this,e),a=s.tween;if(a!==n){i=(n=a).slice();for(var o={name:t,value:r},u=0,c=i.length;u<c;++u)if(i[u].name===t){i[u]=o;break}u===c&&i.push(o)}s.tween=i}}function vN(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=ct(this.node(),r).tween,i=0,s=n.length,a;i<s;++i)if((a=n[i]).name===e)return a.value;return null}return this.each((t==null?gN:mN)(r,e,t))}function xd(e,t,r){var n=e._id;return e.each(function(){var i=xt(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return ct(i,n).value[t]}}function uy(e,t){var r;return(typeof t=="number"?mt:t instanceof Wt?ni:(r=Wt(t))?(t=r,ni):ty)(e,t)}function yN(e){return function(){this.removeAttribute(e)}}function xN(e){return function(){this.removeAttributeNS(e.space,e.local)}}function bN(e,t,r){var n,i=r+"",s;return function(){var a=this.getAttribute(e);return a===i?null:a===n?s:s=t(n=a,r)}}function wN(e,t,r){var n,i=r+"",s;return function(){var a=this.getAttributeNS(e.space,e.local);return a===i?null:a===n?s:s=t(n=a,r)}}function _N(e,t,r){var n,i,s;return function(){var a,o=r(this),u;return o==null?void this.removeAttribute(e):(a=this.getAttribute(e),u=o+"",a===u?null:a===n&&u===i?s:(i=u,s=t(n=a,o)))}}function NN(e,t,r){var n,i,s;return function(){var a,o=r(this),u;return o==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),u=o+"",a===u?null:a===n&&u===i?s:(i=u,s=t(n=a,o)))}}function EN(e,t){var r=vi(e),n=r==="transform"?nN:uy;return this.attrTween(e,typeof t=="function"?(r.local?NN:_N)(r,n,xd(this,"attr."+e,t)):t==null?(r.local?xN:yN)(r):(r.local?wN:bN)(r,n,t))}function CN(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function SN(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function jN(e,t){var r,n;function i(){var s=t.apply(this,arguments);return s!==n&&(r=(n=s)&&SN(e,s)),r}return i._value=t,i}function kN(e,t){var r,n;function i(){var s=t.apply(this,arguments);return s!==n&&(r=(n=s)&&CN(e,s)),r}return i._value=t,i}function RN(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=vi(e);return this.tween(r,(n.local?jN:kN)(n,t))}function IN(e,t){return function(){yd(this,e).delay=+t.apply(this,arguments)}}function AN(e,t){return t=+t,function(){yd(this,e).delay=t}}function TN(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?IN:AN)(t,e)):ct(this.node(),t).delay}function qN(e,t){return function(){xt(this,e).duration=+t.apply(this,arguments)}}function MN(e,t){return t=+t,function(){xt(this,e).duration=t}}function PN(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?qN:MN)(t,e)):ct(this.node(),t).duration}function ON(e,t){if(typeof t!="function")throw new Error;return function(){xt(this,e).ease=t}}function DN(e){var t=this._id;return arguments.length?this.each(ON(t,e)):ct(this.node(),t).ease}function LN(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;xt(this,e).ease=r}}function FN(e){if(typeof e!="function")throw new Error;return this.each(LN(this._id,e))}function $N(e){typeof e!="function"&&(e=F0(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],a=s.length,o=n[i]=[],u,c=0;c<a;++c)(u=s[c])&&e.call(u,u.__data__,c,s)&&o.push(u);return new St(n,this._parents,this._name,this._id)}function zN(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,s=Math.min(n,i),a=new Array(n),o=0;o<s;++o)for(var u=t[o],c=r[o],l=u.length,d=a[o]=new Array(l),f,p=0;p<l;++p)(f=u[p]||c[p])&&(d[p]=f);for(;o<n;++o)a[o]=t[o];return new St(a,this._parents,this._name,this._id)}function BN(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function HN(e,t,r){var n,i,s=BN(t)?yd:xt;return function(){var a=s(this,e),o=a.on;o!==n&&(i=(n=o).copy()).on(t,r),a.on=i}}function VN(e,t){var r=this._id;return arguments.length<2?ct(this.node(),r).on.on(e):this.each(HN(r,e,t))}function GN(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function UN(){return this.on("end.remove",GN(this._id))}function KN(e){var t=this._name,r=this._id;typeof e!="function"&&(e=hd(e));for(var n=this._groups,i=n.length,s=new Array(i),a=0;a<i;++a)for(var o=n[a],u=o.length,c=s[a]=new Array(u),l,d,f=0;f<u;++f)(l=o[f])&&(d=e.call(l,l.__data__,f,o))&&("__data__"in l&&(d.__data__=l.__data__),c[f]=d,xi(c[f],t,r,f,c,ct(l,r)));return new St(s,this._parents,t,r)}function YN(e){var t=this._name,r=this._id;typeof e!="function"&&(e=L0(e));for(var n=this._groups,i=n.length,s=[],a=[],o=0;o<i;++o)for(var u=n[o],c=u.length,l,d=0;d<c;++d)if(l=u[d]){for(var f=e.call(l,l.__data__,d,u),p,m=ct(l,r),x=0,y=f.length;x<y;++x)(p=f[x])&&xi(p,t,r,x,f,m);s.push(f),a.push(l)}return new St(s,a,t,r)}var WN=on.prototype.constructor;function XN(){return new WN(this._groups,this._parents)}function ZN(e,t){var r,n,i;return function(){var s=wr(this,e),a=(this.style.removeProperty(e),wr(this,e));return s===a?null:s===r&&a===n?i:i=t(r=s,n=a)}}function cy(e){return function(){this.style.removeProperty(e)}}function QN(e,t,r){var n,i=r+"",s;return function(){var a=wr(this,e);return a===i?null:a===n?s:s=t(n=a,r)}}function JN(e,t,r){var n,i,s;return function(){var a=wr(this,e),o=r(this),u=o+"";return o==null&&(u=o=(this.style.removeProperty(e),wr(this,e))),a===u?null:a===n&&u===i?s:(i=u,s=t(n=a,o))}}function eE(e,t){var r,n,i,s="style."+t,a="end."+s,o;return function(){var u=xt(this,e),c=u.on,l=u.value[s]==null?o||(o=cy(t)):void 0;(c!==r||i!==l)&&(n=(r=c).copy()).on(a,i=l),u.on=n}}function tE(e,t,r){var n=(e+="")=="transform"?rN:uy;return t==null?this.styleTween(e,ZN(e,n)).on("end.style."+e,cy(e)):typeof t=="function"?this.styleTween(e,JN(e,n,xd(this,"style."+e,t))).each(eE(this._id,e)):this.styleTween(e,QN(e,n,t),r).on("end.style."+e,null)}function rE(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function nE(e,t,r){var n,i;function s(){var a=t.apply(this,arguments);return a!==i&&(n=(i=a)&&rE(e,a,r)),n}return s._value=t,s}function iE(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,nE(e,t,r??""))}function sE(e){return function(){this.textContent=e}}function aE(e){return function(){var t=e(this);this.textContent=t??""}}function oE(e){return this.tween("text",typeof e=="function"?aE(xd(this,"text",e)):sE(e==null?"":e+""))}function uE(e){return function(t){this.textContent=e.call(this,t)}}function cE(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&uE(i)),t}return n._value=e,n}function lE(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,cE(e))}function dE(){for(var e=this._name,t=this._id,r=ly(),n=this._groups,i=n.length,s=0;s<i;++s)for(var a=n[s],o=a.length,u,c=0;c<o;++c)if(u=a[c]){var l=ct(u,t);xi(u,e,r,c,a,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new St(n,this._parents,e,r)}function fE(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(s,a){var o={value:a},u={value:function(){--i===0&&s()}};r.each(function(){var c=xt(this,n),l=c.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(u)),c.on=t}),i===0&&s()})}var hE=0;function St(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function ly(){return++hE}var Et=on.prototype;St.prototype={constructor:St,select:KN,selectAll:YN,selectChild:Et.selectChild,selectChildren:Et.selectChildren,filter:$N,merge:zN,selection:XN,transition:dE,call:Et.call,nodes:Et.nodes,node:Et.node,size:Et.size,empty:Et.empty,each:Et.each,on:VN,attr:EN,attrTween:RN,style:tE,styleTween:iE,text:oE,textTween:lE,remove:UN,tween:vN,delay:TN,duration:PN,ease:DN,easeVarying:FN,end:fE,[Symbol.iterator]:Et[Symbol.iterator]};function pE(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var gE={time:null,delay:0,duration:250,ease:pE};function mE(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function vE(e){var t,r;e instanceof St?(t=e._id,e=e._name):(t=ly(),(r=gE).time=vd(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,s=0;s<i;++s)for(var a=n[s],o=a.length,u,c=0;c<o;++c)(u=a[c])&&xi(u,e,t,c,a,r||mE(u,t));return new St(n,this._parents,e,t)}on.prototype.interrupt=pN;on.prototype.transition=vE;const $n=e=>()=>e;function yE(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function Ct(e,t,r){this.k=e,this.x=t,this.y=r}Ct.prototype={constructor:Ct,scale:function(e){return e===1?this:new Ct(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ct(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var bi=new Ct(1,0,0);dy.prototype=Ct.prototype;function dy(e){for(;!e.__zoom;)if(!(e=e.parentNode))return bi;return e.__zoom}function hs(e){e.stopImmediatePropagation()}function $r(e){e.preventDefault(),e.stopImmediatePropagation()}function xE(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function bE(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function wf(){return this.__zoom||bi}function wE(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _E(){return navigator.maxTouchPoints||"ontouchstart"in this}function NE(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],s=e.invertY(t[0][1])-r[0][1],a=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a))}function fy(){var e=xE,t=bE,r=NE,n=wE,i=_E,s=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],o=250,u=Yn,c=mi("start","zoom","end"),l,d,f,p=500,m=150,x=0,y=10;function v(S){S.property("__zoom",wf).on("wheel.zoom",I,{passive:!1}).on("mousedown.zoom",A).on("dblclick.zoom",L).filter(i).on("touchstart.zoom",T).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(S,D,O,M){var R=S.selection?S.selection():S;R.property("__zoom",wf),S!==R?_(S,D,O,M):R.interrupt().each(function(){N(this,arguments).event(M).start().zoom(null,typeof D=="function"?D.apply(this,arguments):D).end()})},v.scaleBy=function(S,D,O,M){v.scaleTo(S,function(){var R=this.__zoom.k,q=typeof D=="function"?D.apply(this,arguments):D;return R*q},O,M)},v.scaleTo=function(S,D,O,M){v.transform(S,function(){var R=t.apply(this,arguments),q=this.__zoom,V=O==null?b(R):typeof O=="function"?O.apply(this,arguments):O,G=q.invert(V),Y=typeof D=="function"?D.apply(this,arguments):D;return r(g(w(q,Y),V,G),R,a)},O,M)},v.translateBy=function(S,D,O,M){v.transform(S,function(){return r(this.__zoom.translate(typeof D=="function"?D.apply(this,arguments):D,typeof O=="function"?O.apply(this,arguments):O),t.apply(this,arguments),a)},null,M)},v.translateTo=function(S,D,O,M,R){v.transform(S,function(){var q=t.apply(this,arguments),V=this.__zoom,G=M==null?b(q):typeof M=="function"?M.apply(this,arguments):M;return r(bi.translate(G[0],G[1]).scale(V.k).translate(typeof D=="function"?-D.apply(this,arguments):-D,typeof O=="function"?-O.apply(this,arguments):-O),q,a)},M,R)};function w(S,D){return D=Math.max(s[0],Math.min(s[1],D)),D===S.k?S:new Ct(D,S.x,S.y)}function g(S,D,O){var M=D[0]-O[0]*S.k,R=D[1]-O[1]*S.k;return M===S.x&&R===S.y?S:new Ct(S.k,M,R)}function b(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function _(S,D,O,M){S.on("start.zoom",function(){N(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){N(this,arguments).event(M).end()}).tween("zoom",function(){var R=this,q=arguments,V=N(R,q).event(M),G=t.apply(R,q),Y=O==null?b(G):typeof O=="function"?O.apply(R,q):O,J=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),P=R.__zoom,B=typeof D=="function"?D.apply(R,q):D,z=u(P.invert(Y).concat(J/P.k),B.invert(Y).concat(J/B.k));return function($){if($===1)$=B;else{var K=z($),re=J/K[2];$=new Ct(re,Y[0]-K[0]*re,Y[1]-K[1]*re)}V.zoom(null,$)}})}function N(S,D,O){return!O&&S.__zooming||new E(S,D)}function E(S,D){this.that=S,this.args=D,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,D),this.taps=0}E.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,D){return this.mouse&&S!=="mouse"&&(this.mouse[1]=D.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=D.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=D.invert(this.touch1[0])),this.that.__zoom=D,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var D=Xe(this.that).datum();c.call(S,this.that,new yE(S,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:c}),D)}};function I(S,...D){if(!e.apply(this,arguments))return;var O=N(this,D).event(S),M=this.__zoom,R=Math.max(s[0],Math.min(s[1],M.k*Math.pow(2,n.apply(this,arguments)))),q=it(S);if(O.wheel)(O.mouse[0][0]!==q[0]||O.mouse[0][1]!==q[1])&&(O.mouse[1]=M.invert(O.mouse[0]=q)),clearTimeout(O.wheel);else{if(M.k===R)return;O.mouse=[q,M.invert(q)],Zn(this),O.start()}$r(S),O.wheel=setTimeout(V,m),O.zoom("mouse",r(g(w(M,R),O.mouse[0],O.mouse[1]),O.extent,a));function V(){O.wheel=null,O.end()}}function A(S,...D){if(f||!e.apply(this,arguments))return;var O=S.currentTarget,M=N(this,D,!0).event(S),R=Xe(S.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",J,!0),q=it(S,O),V=S.clientX,G=S.clientY;W0(S.view),hs(S),M.mouse=[q,this.__zoom.invert(q)],Zn(this),M.start();function Y(P){if($r(P),!M.moved){var B=P.clientX-V,z=P.clientY-G;M.moved=B*B+z*z>x}M.event(P).zoom("mouse",r(g(M.that.__zoom,M.mouse[0]=it(P,O),M.mouse[1]),M.extent,a))}function J(P){R.on("mousemove.zoom mouseup.zoom",null),X0(P.view,M.moved),$r(P),M.event(P).end()}}function L(S,...D){if(e.apply(this,arguments)){var O=this.__zoom,M=it(S.changedTouches?S.changedTouches[0]:S,this),R=O.invert(M),q=O.k*(S.shiftKey?.5:2),V=r(g(w(O,q),M,R),t.apply(this,D),a);$r(S),o>0?Xe(this).transition().duration(o).call(_,V,M,S):Xe(this).call(v.transform,V,M,S)}}function T(S,...D){if(e.apply(this,arguments)){var O=S.touches,M=O.length,R=N(this,D,S.changedTouches.length===M).event(S),q,V,G,Y;for(hs(S),V=0;V<M;++V)G=O[V],Y=it(G,this),Y=[Y,this.__zoom.invert(Y),G.identifier],R.touch0?!R.touch1&&R.touch0[2]!==Y[2]&&(R.touch1=Y,R.taps=0):(R.touch0=Y,q=!0,R.taps=1+!!l);l&&(l=clearTimeout(l)),q&&(R.taps<2&&(d=Y[0],l=setTimeout(function(){l=null},p)),Zn(this),R.start())}}function j(S,...D){if(this.__zooming){var O=N(this,D).event(S),M=S.changedTouches,R=M.length,q,V,G,Y;for($r(S),q=0;q<R;++q)V=M[q],G=it(V,this),O.touch0&&O.touch0[2]===V.identifier?O.touch0[0]=G:O.touch1&&O.touch1[2]===V.identifier&&(O.touch1[0]=G);if(V=O.that.__zoom,O.touch1){var J=O.touch0[0],P=O.touch0[1],B=O.touch1[0],z=O.touch1[1],$=($=B[0]-J[0])*$+($=B[1]-J[1])*$,K=(K=z[0]-P[0])*K+(K=z[1]-P[1])*K;V=w(V,Math.sqrt($/K)),G=[(J[0]+B[0])/2,(J[1]+B[1])/2],Y=[(P[0]+z[0])/2,(P[1]+z[1])/2]}else if(O.touch0)G=O.touch0[0],Y=O.touch0[1];else return;O.zoom("touch",r(g(V,G,Y),O.extent,a))}}function F(S,...D){if(this.__zooming){var O=N(this,D).event(S),M=S.changedTouches,R=M.length,q,V;for(hs(S),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),q=0;q<R;++q)V=M[q],O.touch0&&O.touch0[2]===V.identifier?delete O.touch0:O.touch1&&O.touch1[2]===V.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(V=it(V,this),Math.hypot(d[0]-V[0],d[1]-V[1])<y)){var G=Xe(this).on("dblclick.zoom");G&&G.apply(this,arguments)}}}return v.wheelDelta=function(S){return arguments.length?(n=typeof S=="function"?S:$n(+S),v):n},v.filter=function(S){return arguments.length?(e=typeof S=="function"?S:$n(!!S),v):e},v.touchable=function(S){return arguments.length?(i=typeof S=="function"?S:$n(!!S),v):i},v.extent=function(S){return arguments.length?(t=typeof S=="function"?S:$n([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),v):t},v.scaleExtent=function(S){return arguments.length?(s[0]=+S[0],s[1]=+S[1],v):[s[0],s[1]]},v.translateExtent=function(S){return arguments.length?(a[0][0]=+S[0][0],a[1][0]=+S[1][0],a[0][1]=+S[0][1],a[1][1]=+S[1][1],v):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},v.constrain=function(S){return arguments.length?(r=S,v):r},v.duration=function(S){return arguments.length?(o=+S,v):o},v.interpolate=function(S){return arguments.length?(u=S,v):u},v.on=function(){var S=c.on.apply(c,arguments);return S===c?v:S},v.clickDistance=function(S){return arguments.length?(x=(S=+S)*S,v):Math.sqrt(x)},v.tapDistance=function(S){return arguments.length?(y=+S,v):y},v}const yt={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:r,targetHandle:n})=>`Couldn't create edge for ${e} handle id: "${e==="source"?r:n}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},en=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],hy=["Enter"," ","Escape"],py={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:r})=>`Moved selected node ${e}. New position, x: ${t}, y: ${r}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Nr;(function(e){e.Strict="strict",e.Loose="loose"})(Nr||(Nr={}));var Kt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Kt||(Kt={}));var tn;(function(e){e.Partial="partial",e.Full="full"})(tn||(tn={}));const gy={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Pt;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Pt||(Pt={}));var Er;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Er||(Er={}));var ue;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(ue||(ue={}));const _f={[ue.Left]:ue.Right,[ue.Right]:ue.Left,[ue.Top]:ue.Bottom,[ue.Bottom]:ue.Top};function my(e){return e===null?null:e?"valid":"invalid"}const vy=e=>"id"in e&&"source"in e&&"target"in e,EE=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),bd=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),cn=(e,t=[0,0])=>{const{width:r,height:n}=jt(e),i=e.origin??t,s=r*i[0],a=n*i[1];return{x:e.position.x-s,y:e.position.y-a}},CE=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((n,i)=>{const s=typeof i=="string";let a=!t.nodeLookup&&!s?i:void 0;t.nodeLookup&&(a=s?t.nodeLookup.get(i):bd(i)?i:t.nodeLookup.get(i.id));const o=a?oi(a,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return wi(n,o)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return _i(r)},ln=(e,t={})=>{let r={x:1/0,y:1/0,x2:-1/0,y2:-1/0},n=!1;return e.forEach(i=>{(t.filter===void 0||t.filter(i))&&(r=wi(r,oi(i)),n=!0)}),n?_i(r):{x:0,y:0,width:0,height:0}},wd=(e,t,[r,n,i]=[0,0,1],s=!1,a=!1)=>{const o={...fn(t,[r,n,i]),width:t.width/i,height:t.height/i},u=[];for(const c of e.values()){const{measured:l,selectable:d=!0,hidden:f=!1}=c;if(a&&!d||f)continue;const p=l.width??c.width??c.initialWidth??null,m=l.height??c.height??c.initialHeight??null,x=rn(o,Sr(c)),y=(p??0)*(m??0),v=s&&x>0;(!c.internals.handleBounds||v||x>=y||c.dragging)&&u.push(c)}return u},SE=(e,t)=>{const r=new Set;return e.forEach(n=>{r.add(n.id)}),t.filter(n=>r.has(n.source)||r.has(n.target))};function jE(e,t){const r=new Map,n=t!=null&&t.nodes?new Set(t.nodes.map(i=>i.id)):null;return e.forEach(i=>{i.measured.width&&i.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!i.hidden)&&(!n||n.has(i.id))&&r.set(i.id,i)}),r}async function kE({nodes:e,width:t,height:r,panZoom:n,minZoom:i,maxZoom:s},a){if(e.size===0)return Promise.resolve(!0);const o=jE(e,a),u=ln(o),c=_d(u,t,r,(a==null?void 0:a.minZoom)??i,(a==null?void 0:a.maxZoom)??s,(a==null?void 0:a.padding)??.1);return await n.setViewport(c,{duration:a==null?void 0:a.duration,ease:a==null?void 0:a.ease,interpolate:a==null?void 0:a.interpolate}),Promise.resolve(!0)}function yy({nodeId:e,nextPosition:t,nodeLookup:r,nodeOrigin:n=[0,0],nodeExtent:i,onError:s}){const a=r.get(e),o=a.parentId?r.get(a.parentId):void 0,{x:u,y:c}=o?o.internals.positionAbsolute:{x:0,y:0},l=a.origin??n;let d=a.extent||i;if(a.extent==="parent"&&!a.expandParent)if(!o)s==null||s("005",yt.error005());else{const p=o.measured.width,m=o.measured.height;p&&m&&(d=[[u,c],[u+p,c+m]])}else o&&jr(a.extent)&&(d=[[a.extent[0][0]+u,a.extent[0][1]+c],[a.extent[1][0]+u,a.extent[1][1]+c]]);const f=jr(d)?Zt(t,d,a.measured):t;return(a.measured.width===void 0||a.measured.height===void 0)&&(s==null||s("015",yt.error015())),{position:{x:f.x-u+(a.measured.width??0)*l[0],y:f.y-c+(a.measured.height??0)*l[1]},positionAbsolute:f}}async function RE({nodesToRemove:e=[],edgesToRemove:t=[],nodes:r,edges:n,onBeforeDelete:i}){const s=new Set(e.map(f=>f.id)),a=[];for(const f of r){if(f.deletable===!1)continue;const p=s.has(f.id),m=!p&&f.parentId&&a.find(x=>x.id===f.parentId);(p||m)&&a.push(f)}const o=new Set(t.map(f=>f.id)),u=n.filter(f=>f.deletable!==!1),l=SE(a,u);for(const f of u)o.has(f.id)&&!l.find(m=>m.id===f.id)&&l.push(f);if(!i)return{edges:l,nodes:a};const d=await i({nodes:a,edges:l});return typeof d=="boolean"?d?{edges:l,nodes:a}:{edges:[],nodes:[]}:d}const Cr=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),Zt=(e={x:0,y:0},t,r)=>({x:Cr(e.x,t[0][0],t[1][0]-((r==null?void 0:r.width)??0)),y:Cr(e.y,t[0][1],t[1][1]-((r==null?void 0:r.height)??0))});function xy(e,t,r){const{width:n,height:i}=jt(r),{x:s,y:a}=r.internals.positionAbsolute;return Zt(e,[[s,a],[s+n,a+i]],t)}const Nf=(e,t,r)=>e<t?Cr(Math.abs(e-t),1,t)/t:e>r?-Cr(Math.abs(e-r),1,t)/t:0,by=(e,t,r=15,n=40)=>{const i=Nf(e.x,n,t.width-n)*r,s=Nf(e.y,n,t.height-n)*r;return[i,s]},wi=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Ql=({x:e,y:t,width:r,height:n})=>({x:e,y:t,x2:e+r,y2:t+n}),_i=({x:e,y:t,x2:r,y2:n})=>({x:e,y:t,width:r-e,height:n-t}),Sr=(e,t=[0,0])=>{var i,s;const{x:r,y:n}=bd(e)?e.internals.positionAbsolute:cn(e,t);return{x:r,y:n,width:((i=e.measured)==null?void 0:i.width)??e.width??e.initialWidth??0,height:((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0}},oi=(e,t=[0,0])=>{var i,s;const{x:r,y:n}=bd(e)?e.internals.positionAbsolute:cn(e,t);return{x:r,y:n,x2:r+(((i=e.measured)==null?void 0:i.width)??e.width??e.initialWidth??0),y2:n+(((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0)}},wy=(e,t)=>_i(wi(Ql(e),Ql(t))),rn=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),n=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*n)},Ef=e=>at(e.width)&&at(e.height)&&at(e.x)&&at(e.y),at=e=>!isNaN(e)&&isFinite(e),IE=(e,t)=>{},dn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),fn=({x:e,y:t},[r,n,i],s=!1,a=[1,1])=>{const o={x:(e-r)/i,y:(t-n)/i};return s?dn(o,a):o},ui=({x:e,y:t},[r,n,i])=>({x:e*i+r,y:t*i+n});function lr(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const r=parseFloat(e);if(!Number.isNaN(r))return Math.floor(r)}if(typeof e=="string"&&e.endsWith("%")){const r=parseFloat(e);if(!Number.isNaN(r))return Math.floor(t*r*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function AE(e,t,r){if(typeof e=="string"||typeof e=="number"){const n=lr(e,r),i=lr(e,t);return{top:n,right:i,bottom:n,left:i,x:i*2,y:n*2}}if(typeof e=="object"){const n=lr(e.top??e.y??0,r),i=lr(e.bottom??e.y??0,r),s=lr(e.left??e.x??0,t),a=lr(e.right??e.x??0,t);return{top:n,right:a,bottom:i,left:s,x:s+a,y:n+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function TE(e,t,r,n,i,s){const{x:a,y:o}=ui(e,[t,r,n]),{x:u,y:c}=ui({x:e.x+e.width,y:e.y+e.height},[t,r,n]),l=i-u,d=s-c;return{left:Math.floor(a),top:Math.floor(o),right:Math.floor(l),bottom:Math.floor(d)}}const _d=(e,t,r,n,i,s)=>{const a=AE(s,t,r),o=(t-a.x)/e.width,u=(r-a.y)/e.height,c=Math.min(o,u),l=Cr(c,n,i),d=e.x+e.width/2,f=e.y+e.height/2,p=t/2-d*l,m=r/2-f*l,x=TE(e,p,m,l,t,r),y={left:Math.min(x.left-a.left,0),top:Math.min(x.top-a.top,0),right:Math.min(x.right-a.right,0),bottom:Math.min(x.bottom-a.bottom,0)};return{x:p-y.left+y.right,y:m-y.top+y.bottom,zoom:l}},nn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function jr(e){return e!=null&&e!=="parent"}function jt(e){var t,r;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0}}function _y(e){var t,r;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight)!==void 0}function Ny(e,t={width:0,height:0},r,n,i){const s={...e},a=n.get(r);if(a){const o=a.origin||i;s.x+=a.internals.positionAbsolute.x-(t.width??0)*o[0],s.y+=a.internals.positionAbsolute.y-(t.height??0)*o[1]}return s}function Cf(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function qE(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}function ME(e){return{...py,...e||{}}}function Kr(e,{snapGrid:t=[0,0],snapToGrid:r=!1,transform:n,containerBounds:i}){const{x:s,y:a}=ot(e),o=fn({x:s-((i==null?void 0:i.left)??0),y:a-((i==null?void 0:i.top)??0)},n),{x:u,y:c}=r?dn(o,t):o;return{xSnapped:u,ySnapped:c,...o}}const Nd=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ey=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},PE=["INPUT","SELECT","TEXTAREA"];function Cy(e){var n,i;const t=((i=(n=e.composedPath)==null?void 0:n.call(e))==null?void 0:i[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:PE.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const Sy=e=>"clientX"in e,ot=(e,t)=>{var s,a;const r=Sy(e),n=r?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,i=r?e.clientY:(a=e.touches)==null?void 0:a[0].clientY;return{x:n-((t==null?void 0:t.left)??0),y:i-((t==null?void 0:t.top)??0)}},Sf=(e,t,r,n,i)=>{const s=t.querySelectorAll(`.${e}`);return!s||!s.length?null:Array.from(s).map(a=>{const o=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),type:e,nodeId:i,position:a.getAttribute("data-handlepos"),x:(o.left-r.left)/n,y:(o.top-r.top)/n,...Nd(a)}})};function jy({sourceX:e,sourceY:t,targetX:r,targetY:n,sourceControlX:i,sourceControlY:s,targetControlX:a,targetControlY:o}){const u=e*.125+i*.375+a*.375+r*.125,c=t*.125+s*.375+o*.375+n*.125,l=Math.abs(u-e),d=Math.abs(c-t);return[u,c,l,d]}function zn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function jf({pos:e,x1:t,y1:r,x2:n,y2:i,c:s}){switch(e){case ue.Left:return[t-zn(t-n,s),r];case ue.Right:return[t+zn(n-t,s),r];case ue.Top:return[t,r-zn(r-i,s)];case ue.Bottom:return[t,r+zn(i-r,s)]}}function Ed({sourceX:e,sourceY:t,sourcePosition:r=ue.Bottom,targetX:n,targetY:i,targetPosition:s=ue.Top,curvature:a=.25}){const[o,u]=jf({pos:r,x1:e,y1:t,x2:n,y2:i,c:a}),[c,l]=jf({pos:s,x1:n,y1:i,x2:e,y2:t,c:a}),[d,f,p,m]=jy({sourceX:e,sourceY:t,targetX:n,targetY:i,sourceControlX:o,sourceControlY:u,targetControlX:c,targetControlY:l});return[`M${e},${t} C${o},${u} ${c},${l} ${n},${i}`,d,f,p,m]}function ky({sourceX:e,sourceY:t,targetX:r,targetY:n}){const i=Math.abs(r-e)/2,s=r<e?r+i:r-i,a=Math.abs(n-t)/2,o=n<t?n+a:n-a;return[s,o,i,a]}function OE({sourceNode:e,targetNode:t,selected:r=!1,zIndex:n=0,elevateOnSelect:i=!1,zIndexMode:s="basic"}){if(s==="manual")return n;const a=i&&r?n+1e3:n,o=Math.max(e.parentId||i&&e.selected?e.internals.z:0,t.parentId||i&&t.selected?t.internals.z:0);return a+o}function DE({sourceNode:e,targetNode:t,width:r,height:n,transform:i}){const s=wi(oi(e),oi(t));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const a={x:-i[0]/i[2],y:-i[1]/i[2],width:r/i[2],height:n/i[2]};return rn(a,_i(s))>0}const LE=({source:e,sourceHandle:t,target:r,targetHandle:n})=>`xy-edge__${e}${t||""}-${r}${n||""}`,FE=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),Jl=(e,t,r={})=>{if(!e.source||!e.target)return t;const n=r.getEdgeId||LE;let i;return vy(e)?i={...e}:i={...e,id:n(e)},FE(i,t)?t:(i.sourceHandle===null&&delete i.sourceHandle,i.targetHandle===null&&delete i.targetHandle,t.concat(i))};function Ry({sourceX:e,sourceY:t,targetX:r,targetY:n}){const[i,s,a,o]=ky({sourceX:e,sourceY:t,targetX:r,targetY:n});return[`M ${e},${t}L ${r},${n}`,i,s,a,o]}const kf={[ue.Left]:{x:-1,y:0},[ue.Right]:{x:1,y:0},[ue.Top]:{x:0,y:-1},[ue.Bottom]:{x:0,y:1}},$E=({source:e,sourcePosition:t=ue.Bottom,target:r})=>t===ue.Left||t===ue.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},Rf=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function zE({source:e,sourcePosition:t=ue.Bottom,target:r,targetPosition:n=ue.Top,center:i,offset:s,stepPosition:a}){const o=kf[t],u=kf[n],c={x:e.x+o.x*s,y:e.y+o.y*s},l={x:r.x+u.x*s,y:r.y+u.y*s},d=$E({source:c,sourcePosition:t,target:l}),f=d.x!==0?"x":"y",p=d[f];let m=[],x,y;const v={x:0,y:0},w={x:0,y:0},[,,g,b]=ky({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(o[f]*u[f]===-1){f==="x"?(x=i.x??c.x+(l.x-c.x)*a,y=i.y??(c.y+l.y)/2):(x=i.x??(c.x+l.x)/2,y=i.y??c.y+(l.y-c.y)*a);const N=[{x,y:c.y},{x,y:l.y}],E=[{x:c.x,y},{x:l.x,y}];o[f]===p?m=f==="x"?N:E:m=f==="x"?E:N}else{const N=[{x:c.x,y:l.y}],E=[{x:l.x,y:c.y}];if(f==="x"?m=o.x===p?E:N:m=o.y===p?N:E,t===n){const j=Math.abs(e[f]-r[f]);if(j<=s){const F=Math.min(s-1,s-j);o[f]===p?v[f]=(c[f]>e[f]?-1:1)*F:w[f]=(l[f]>r[f]?-1:1)*F}}if(t!==n){const j=f==="x"?"y":"x",F=o[f]===u[j],S=c[j]>l[j],D=c[j]<l[j];(o[f]===1&&(!F&&S||F&&D)||o[f]!==1&&(!F&&D||F&&S))&&(m=f==="x"?N:E)}const I={x:c.x+v.x,y:c.y+v.y},A={x:l.x+w.x,y:l.y+w.y},L=Math.max(Math.abs(I.x-m[0].x),Math.abs(A.x-m[0].x)),T=Math.max(Math.abs(I.y-m[0].y),Math.abs(A.y-m[0].y));L>=T?(x=(I.x+A.x)/2,y=m[0].y):(x=m[0].x,y=(I.y+A.y)/2)}return[[e,{x:c.x+v.x,y:c.y+v.y},...m,{x:l.x+w.x,y:l.y+w.y},r],x,y,g,b]}function BE(e,t,r,n){const i=Math.min(Rf(e,t)/2,Rf(t,r)/2,n),{x:s,y:a}=t;if(e.x===s&&s===r.x||e.y===a&&a===r.y)return`L${s} ${a}`;if(e.y===a){const c=e.x<r.x?-1:1,l=e.y<r.y?1:-1;return`L ${s+i*c},${a}Q ${s},${a} ${s},${a+i*l}`}const o=e.x<r.x?1:-1,u=e.y<r.y?-1:1;return`L ${s},${a+i*u}Q ${s},${a} ${s+i*o},${a}`}function ed({sourceX:e,sourceY:t,sourcePosition:r=ue.Bottom,targetX:n,targetY:i,targetPosition:s=ue.Top,borderRadius:a=5,centerX:o,centerY:u,offset:c=20,stepPosition:l=.5}){const[d,f,p,m,x]=zE({source:{x:e,y:t},sourcePosition:r,target:{x:n,y:i},targetPosition:s,center:{x:o,y:u},offset:c,stepPosition:l});return[d.reduce((v,w,g)=>{let b="";return g>0&&g<d.length-1?b=BE(d[g-1],w,d[g+1],a):b=`${g===0?"M":"L"}${w.x} ${w.y}`,v+=b,v},""),f,p,m,x]}function If(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function HE(e){var d;const{sourceNode:t,targetNode:r}=e;if(!If(t)||!If(r))return null;const n=t.internals.handleBounds||Af(t.handles),i=r.internals.handleBounds||Af(r.handles),s=Tf((n==null?void 0:n.source)??[],e.sourceHandle),a=Tf(e.connectionMode===Nr.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),e.targetHandle);if(!s||!a)return(d=e.onError)==null||d.call(e,"008",yt.error008(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const o=(s==null?void 0:s.position)||ue.Bottom,u=(a==null?void 0:a.position)||ue.Top,c=Qt(t,s,o),l=Qt(r,a,u);return{sourceX:c.x,sourceY:c.y,targetX:l.x,targetY:l.y,sourcePosition:o,targetPosition:u}}function Af(e){if(!e)return null;const t=[],r=[];for(const n of e)n.width=n.width??1,n.height=n.height??1,n.type==="source"?t.push(n):n.type==="target"&&r.push(n);return{source:t,target:r}}function Qt(e,t,r=ue.Left,n=!1){const i=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,s=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:a,height:o}=t??jt(e);if(n)return{x:i+a/2,y:s+o/2};switch((t==null?void 0:t.position)??r){case ue.Top:return{x:i+a/2,y:s};case ue.Right:return{x:i+a,y:s+o/2};case ue.Bottom:return{x:i+a/2,y:s+o};case ue.Left:return{x:i,y:s+o/2}}}function Tf(e,t){return e&&(t?e.find(r=>r.id===t):e[0])||null}function td(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`:""}function VE(e,{id:t,defaultColor:r,defaultMarkerStart:n,defaultMarkerEnd:i}){const s=new Set;return e.reduce((a,o)=>([o.markerStart||n,o.markerEnd||i].forEach(u=>{if(u&&typeof u=="object"){const c=td(u,t);s.has(c)||(a.push({id:c,color:u.color||r,...u}),s.add(c))}}),a),[]).sort((a,o)=>a.id.localeCompare(o.id))}const Iy=1e3,GE=10,Cd={nodeOrigin:[0,0],nodeExtent:en,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},UE={...Cd,checkEquality:!0};function Sd(e,t){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}function KE(e,t,r){const n=Sd(Cd,r);for(const i of e.values())if(i.parentId)kd(i,e,t,n);else{const s=cn(i,n.nodeOrigin),a=jr(i.extent)?i.extent:n.nodeExtent,o=Zt(s,a,jt(i));i.internals.positionAbsolute=o}}function YE(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const r=[],n=[];for(const i of e.handles){const s={id:i.id,width:i.width??1,height:i.height??1,nodeId:e.id,x:i.x,y:i.y,position:i.position,type:i.type};i.type==="source"?r.push(s):i.type==="target"&&n.push(s)}return{source:r,target:n}}function jd(e){return e==="manual"}function rd(e,t,r,n={}){var c,l;const i=Sd(UE,n),s={i:0},a=new Map(t),o=i!=null&&i.elevateNodesOnSelect&&!jd(i.zIndexMode)?Iy:0;let u=e.length>0;t.clear(),r.clear();for(const d of e){let f=a.get(d.id);if(i.checkEquality&&d===(f==null?void 0:f.internals.userNode))t.set(d.id,f);else{const p=cn(d,i.nodeOrigin),m=jr(d.extent)?d.extent:i.nodeExtent,x=Zt(p,m,jt(d));f={...i.defaults,...d,measured:{width:(c=d.measured)==null?void 0:c.width,height:(l=d.measured)==null?void 0:l.height},internals:{positionAbsolute:x,handleBounds:YE(d,f),z:Ay(d,o,i.zIndexMode),userNode:d}},t.set(d.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(u=!1),d.parentId&&kd(f,t,r,n,s)}return u}function WE(e,t){if(!e.parentId)return;const r=t.get(e.parentId);r?r.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function kd(e,t,r,n,i){const{elevateNodesOnSelect:s,nodeOrigin:a,nodeExtent:o,zIndexMode:u}=Sd(Cd,n),c=e.parentId,l=t.get(c);if(!l){console.warn(`Parent node ${c} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}WE(e,r),i&&!l.parentId&&l.internals.rootParentIndex===void 0&&u==="auto"&&(l.internals.rootParentIndex=++i.i,l.internals.z=l.internals.z+i.i*GE),i&&l.internals.rootParentIndex!==void 0&&(i.i=l.internals.rootParentIndex);const d=s&&!jd(u)?Iy:0,{x:f,y:p,z:m}=XE(e,l,a,o,d,u),{positionAbsolute:x}=e.internals,y=f!==x.x||p!==x.y;(y||m!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:f,y:p}:x,z:m}})}function Ay(e,t,r){const n=at(e.zIndex)?e.zIndex:0;return jd(r)?n:n+(e.selected?t:0)}function XE(e,t,r,n,i,s){const{x:a,y:o}=t.internals.positionAbsolute,u=jt(e),c=cn(e,r),l=jr(e.extent)?Zt(c,e.extent,u):c;let d=Zt({x:a+l.x,y:o+l.y},n,u);e.extent==="parent"&&(d=xy(d,u,t));const f=Ay(e,i,s),p=t.internals.z??0;return{x:d.x,y:d.y,z:p>=f?p+1:f}}function Rd(e,t,r,n=[0,0]){var a;const i=[],s=new Map;for(const o of e){const u=t.get(o.parentId);if(!u)continue;const c=((a=s.get(o.parentId))==null?void 0:a.expandedRect)??Sr(u),l=wy(c,o.rect);s.set(o.parentId,{expandedRect:l,parent:u})}return s.size>0&&s.forEach(({expandedRect:o,parent:u},c)=>{var g;const l=u.internals.positionAbsolute,d=jt(u),f=u.origin??n,p=o.x<l.x?Math.round(Math.abs(l.x-o.x)):0,m=o.y<l.y?Math.round(Math.abs(l.y-o.y)):0,x=Math.max(d.width,Math.round(o.width)),y=Math.max(d.height,Math.round(o.height)),v=(x-d.width)*f[0],w=(y-d.height)*f[1];(p>0||m>0||v||w)&&(i.push({id:c,type:"position",position:{x:u.position.x-p+v,y:u.position.y-m+w}}),(g=r.get(c))==null||g.forEach(b=>{e.some(_=>_.id===b.id)||i.push({id:b.id,type:"position",position:{x:b.position.x+p,y:b.position.y+m}})})),(d.width<o.width||d.height<o.height||p||m)&&i.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:x+(p?f[0]*p-v:0),height:y+(m?f[1]*m-w:0)}})}),i}function ZE(e,t,r,n,i,s,a){const o=n==null?void 0:n.querySelector(".xyflow__viewport");let u=!1;if(!o)return{changes:[],updatedInternals:u};const c=[],l=window.getComputedStyle(o),{m22:d}=new window.DOMMatrixReadOnly(l.transform),f=[];for(const p of e.values()){const m=t.get(p.id);if(!m)continue;if(m.hidden){t.set(m.id,{...m,internals:{...m.internals,handleBounds:void 0}}),u=!0;continue}const x=Nd(p.nodeElement),y=m.measured.width!==x.width||m.measured.height!==x.height;if(!!(x.width&&x.height&&(y||!m.internals.handleBounds||p.force))){const w=p.nodeElement.getBoundingClientRect(),g=jr(m.extent)?m.extent:s;let{positionAbsolute:b}=m.internals;m.parentId&&m.extent==="parent"?b=xy(b,x,t.get(m.parentId)):g&&(b=Zt(b,g,x));const _={...m,measured:x,internals:{...m.internals,positionAbsolute:b,handleBounds:{source:Sf("source",p.nodeElement,w,d,m.id),target:Sf("target",p.nodeElement,w,d,m.id)}}};t.set(m.id,_),m.parentId&&kd(_,t,r,{nodeOrigin:i,zIndexMode:a}),u=!0,y&&(c.push({id:m.id,type:"dimensions",dimensions:x}),m.expandParent&&m.parentId&&f.push({id:m.id,parentId:m.parentId,rect:Sr(_,i)}))}}if(f.length>0){const p=Rd(f,t,r,i);c.push(...p)}return{changes:c,updatedInternals:u}}async function QE({delta:e,panZoom:t,transform:r,translateExtent:n,width:i,height:s}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const a=await t.setViewportConstrained({x:r[0]+e.x,y:r[1]+e.y,zoom:r[2]},[[0,0],[i,s]],n),o=!!a&&(a.x!==r[0]||a.y!==r[1]||a.k!==r[2]);return Promise.resolve(o)}function qf(e,t,r,n,i,s){let a=i;const o=n.get(a)||new Map;n.set(a,o.set(r,t)),a=`${i}-${e}`;const u=n.get(a)||new Map;if(n.set(a,u.set(r,t)),s){a=`${i}-${e}-${s}`;const c=n.get(a)||new Map;n.set(a,c.set(r,t))}}function Ty(e,t,r){e.clear(),t.clear();for(const n of r){const{source:i,target:s,sourceHandle:a=null,targetHandle:o=null}=n,u={edgeId:n.id,source:i,target:s,sourceHandle:a,targetHandle:o},c=`${i}-${a}--${s}-${o}`,l=`${s}-${o}--${i}-${a}`;qf("source",u,l,e,i,a),qf("target",u,c,e,s,o),t.set(n.id,n)}}function qy(e,t){if(!e.parentId)return!1;const r=t.get(e.parentId);return r?r.selected?!0:qy(r,t):!1}function Mf(e,t,r){var i;let n=e;do{if((i=n==null?void 0:n.matches)!=null&&i.call(n,t))return!0;if(n===r)return!1;n=n==null?void 0:n.parentElement}while(n);return!1}function JE(e,t,r,n){const i=new Map;for(const[s,a]of e)if((a.selected||a.id===n)&&(!a.parentId||!qy(a,e))&&(a.draggable||t&&typeof a.draggable>"u")){const o=e.get(s);o&&i.set(s,{id:s,position:o.position||{x:0,y:0},distance:{x:r.x-o.internals.positionAbsolute.x,y:r.y-o.internals.positionAbsolute.y},extent:o.extent,parentId:o.parentId,origin:o.origin,expandParent:o.expandParent,internals:{positionAbsolute:o.internals.positionAbsolute||{x:0,y:0}},measured:{width:o.measured.width??0,height:o.measured.height??0}})}return i}function ps({nodeId:e,dragItems:t,nodeLookup:r,dragging:n=!0}){var a,o,u;const i=[];for(const[c,l]of t){const d=(a=r.get(c))==null?void 0:a.internals.userNode;d&&i.push({...d,position:l.position,dragging:n})}if(!e)return[i[0],i];const s=(o=r.get(e))==null?void 0:o.internals.userNode;return[s?{...s,position:((u=t.get(e))==null?void 0:u.position)||s.position,dragging:n}:i[0],i]}function eC({dragItems:e,snapGrid:t,x:r,y:n}){const i=e.values().next().value;if(!i)return null;const s={x:r-i.distance.x,y:n-i.distance.y},a=dn(s,t);return{x:a.x-s.x,y:a.y-s.y}}function tC({onNodeMouseDown:e,getStoreItems:t,onDragStart:r,onDrag:n,onDragStop:i}){let s={x:null,y:null},a=0,o=new Map,u=!1,c={x:0,y:0},l=null,d=!1,f=null,p=!1,m=!1,x=null;function y({noDragClassName:w,handleSelector:g,domNode:b,isSelectable:_,nodeId:N,nodeClickDistance:E=0}){f=Xe(b);function I({x:j,y:F}){const{nodeLookup:S,nodeExtent:D,snapGrid:O,snapToGrid:M,nodeOrigin:R,onNodeDrag:q,onSelectionDrag:V,onError:G,updateNodePositions:Y}=t();s={x:j,y:F};let J=!1;const P=o.size>1,B=P&&D?Ql(ln(o)):null,z=P&&M?eC({dragItems:o,snapGrid:O,x:j,y:F}):null;for(const[$,K]of o){if(!S.has($))continue;let re={x:j-K.distance.x,y:F-K.distance.y};M&&(re=z?{x:Math.round(re.x+z.x),y:Math.round(re.y+z.y)}:dn(re,O));let ee=null;if(P&&D&&!K.extent&&B){const{positionAbsolute:ie}=K.internals,le=ie.x-B.x+D[0][0],oe=ie.x+K.measured.width-B.x2+D[1][0],Z=ie.y-B.y+D[0][1],de=ie.y+K.measured.height-B.y2+D[1][1];ee=[[le,Z],[oe,de]]}const{position:ne,positionAbsolute:ce}=yy({nodeId:$,nextPosition:re,nodeLookup:S,nodeExtent:ee||D,nodeOrigin:R,onError:G});J=J||K.position.x!==ne.x||K.position.y!==ne.y,K.position=ne,K.internals.positionAbsolute=ce}if(m=m||J,!!J&&(Y(o,!0),x&&(n||q||!N&&V))){const[$,K]=ps({nodeId:N,dragItems:o,nodeLookup:S});n==null||n(x,o,$,K),q==null||q(x,$,K),N||V==null||V(x,K)}}async function A(){if(!l)return;const{transform:j,panBy:F,autoPanSpeed:S,autoPanOnNodeDrag:D}=t();if(!D){u=!1,cancelAnimationFrame(a);return}const[O,M]=by(c,l,S);(O!==0||M!==0)&&(s.x=(s.x??0)-O/j[2],s.y=(s.y??0)-M/j[2],await F({x:O,y:M})&&I(s)),a=requestAnimationFrame(A)}function L(j){var P;const{nodeLookup:F,multiSelectionActive:S,nodesDraggable:D,transform:O,snapGrid:M,snapToGrid:R,selectNodesOnDrag:q,onNodeDragStart:V,onSelectionDragStart:G,unselectNodesAndEdges:Y}=t();d=!0,(!q||!_)&&!S&&N&&((P=F.get(N))!=null&&P.selected||Y()),_&&q&&N&&(e==null||e(N));const J=Kr(j.sourceEvent,{transform:O,snapGrid:M,snapToGrid:R,containerBounds:l});if(s=J,o=JE(F,D,J,N),o.size>0&&(r||V||!N&&G)){const[B,z]=ps({nodeId:N,dragItems:o,nodeLookup:F});r==null||r(j.sourceEvent,o,B,z),V==null||V(j.sourceEvent,B,z),N||G==null||G(j.sourceEvent,z)}}const T=Z0().clickDistance(E).on("start",j=>{const{domNode:F,nodeDragThreshold:S,transform:D,snapGrid:O,snapToGrid:M}=t();l=(F==null?void 0:F.getBoundingClientRect())||null,p=!1,m=!1,x=j.sourceEvent,S===0&&L(j),s=Kr(j.sourceEvent,{transform:D,snapGrid:O,snapToGrid:M,containerBounds:l}),c=ot(j.sourceEvent,l)}).on("drag",j=>{const{autoPanOnNodeDrag:F,transform:S,snapGrid:D,snapToGrid:O,nodeDragThreshold:M,nodeLookup:R}=t(),q=Kr(j.sourceEvent,{transform:S,snapGrid:D,snapToGrid:O,containerBounds:l});if(x=j.sourceEvent,(j.sourceEvent.type==="touchmove"&&j.sourceEvent.touches.length>1||N&&!R.has(N))&&(p=!0),!p){if(!u&&F&&d&&(u=!0,A()),!d){const V=ot(j.sourceEvent,l),G=V.x-c.x,Y=V.y-c.y;Math.sqrt(G*G+Y*Y)>M&&L(j)}(s.x!==q.xSnapped||s.y!==q.ySnapped)&&o&&d&&(c=ot(j.sourceEvent,l),I(q))}}).on("end",j=>{if(!(!d||p)&&(u=!1,d=!1,cancelAnimationFrame(a),o.size>0)){const{nodeLookup:F,updateNodePositions:S,onNodeDragStop:D,onSelectionDragStop:O}=t();if(m&&(S(o,!1),m=!1),i||D||!N&&O){const[M,R]=ps({nodeId:N,dragItems:o,nodeLookup:F,dragging:!1});i==null||i(j.sourceEvent,o,M,R),D==null||D(j.sourceEvent,M,R),N||O==null||O(j.sourceEvent,R)}}}).filter(j=>{const F=j.target;return!j.button&&(!w||!Mf(F,`.${w}`,b))&&(!g||Mf(F,g,b))});f.call(T)}function v(){f==null||f.on(".drag",null)}return{update:y,destroy:v}}function rC(e,t,r){const n=[],i={x:e.x-r,y:e.y-r,width:r*2,height:r*2};for(const s of t.values())rn(i,Sr(s))>0&&n.push(s);return n}const nC=250;function iC(e,t,r,n){var o,u;let i=[],s=1/0;const a=rC(e,r,t+nC);for(const c of a){const l=[...((o=c.internals.handleBounds)==null?void 0:o.source)??[],...((u=c.internals.handleBounds)==null?void 0:u.target)??[]];for(const d of l){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:f,y:p}=Qt(c,d,d.position,!0),m=Math.sqrt(Math.pow(f-e.x,2)+Math.pow(p-e.y,2));m>t||(m<s?(i=[{...d,x:f,y:p}],s=m):m===s&&i.push({...d,x:f,y:p}))}}if(!i.length)return null;if(i.length>1){const c=n.type==="source"?"target":"source";return i.find(l=>l.type===c)??i[0]}return i[0]}function My(e,t,r,n,i,s=!1){var c,l,d;const a=n.get(e);if(!a)return null;const o=i==="strict"?(c=a.internals.handleBounds)==null?void 0:c[t]:[...((l=a.internals.handleBounds)==null?void 0:l.source)??[],...((d=a.internals.handleBounds)==null?void 0:d.target)??[]],u=(r?o==null?void 0:o.find(f=>f.id===r):o==null?void 0:o[0])??null;return u&&s?{...u,...Qt(a,u,u.position,!0)}:u}function Py(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function sC(e,t){let r=null;return t?r=!0:e&&!t&&(r=!1),r}const Oy=()=>!0;function aC(e,{connectionMode:t,connectionRadius:r,handleId:n,nodeId:i,edgeUpdaterType:s,isTarget:a,domNode:o,nodeLookup:u,lib:c,autoPanOnConnect:l,flowId:d,panBy:f,cancelConnection:p,onConnectStart:m,onConnect:x,onConnectEnd:y,isValidConnection:v=Oy,onReconnectEnd:w,updateConnection:g,getTransform:b,getFromHandle:_,autoPanSpeed:N,dragThreshold:E=1,handleDomNode:I}){const A=Ey(e.target);let L=0,T;const{x:j,y:F}=ot(e),S=Py(s,I),D=o==null?void 0:o.getBoundingClientRect();let O=!1;if(!D||!S)return;const M=My(i,S,n,u,t);if(!M)return;let R=ot(e,D),q=!1,V=null,G=!1,Y=null;function J(){if(!l||!D)return;const[ne,ce]=by(R,D,N);f({x:ne,y:ce}),L=requestAnimationFrame(J)}const P={...M,nodeId:i,type:S,position:M.position},B=u.get(i);let $={inProgress:!0,isValid:null,from:Qt(B,P,ue.Left,!0),fromHandle:P,fromPosition:P.position,fromNode:B,to:R,toHandle:null,toPosition:_f[P.position],toNode:null,pointer:R};function K(){O=!0,g($),m==null||m(e,{nodeId:i,handleId:n,handleType:S})}E===0&&K();function re(ne){if(!O){const{x:de,y:Le}=ot(ne),Ne=de-j,Ae=Le-F;if(!(Ne*Ne+Ae*Ae>E*E))return;K()}if(!_()||!P){ee(ne);return}const ce=b();R=ot(ne,D),T=iC(fn(R,ce,!1,[1,1]),r,u,P),q||(J(),q=!0);const ie=Dy(ne,{handle:T,connectionMode:t,fromNodeId:i,fromHandleId:n,fromType:a?"target":"source",isValidConnection:v,doc:A,lib:c,flowId:d,nodeLookup:u});Y=ie.handleDomNode,V=ie.connection,G=sC(!!T,ie.isValid);const le=u.get(i),oe=le?Qt(le,P,ue.Left,!0):$.from,Z={...$,from:oe,isValid:G,to:ie.toHandle&&G?ui({x:ie.toHandle.x,y:ie.toHandle.y},ce):R,toHandle:ie.toHandle,toPosition:G&&ie.toHandle?ie.toHandle.position:_f[P.position],toNode:ie.toHandle?u.get(ie.toHandle.nodeId):null,pointer:R};g(Z),$=Z}function ee(ne){if(!("touches"in ne&&ne.touches.length>0)){if(O){(T||Y)&&V&&G&&(x==null||x(V));const{inProgress:ce,...ie}=$,le={...ie,toPosition:$.toHandle?$.toPosition:null};y==null||y(ne,le),s&&(w==null||w(ne,le))}p(),cancelAnimationFrame(L),q=!1,G=!1,V=null,Y=null,A.removeEventListener("mousemove",re),A.removeEventListener("mouseup",ee),A.removeEventListener("touchmove",re),A.removeEventListener("touchend",ee)}}A.addEventListener("mousemove",re),A.addEventListener("mouseup",ee),A.addEventListener("touchmove",re),A.addEventListener("touchend",ee)}function Dy(e,{handle:t,connectionMode:r,fromNodeId:n,fromHandleId:i,fromType:s,doc:a,lib:o,flowId:u,isValidConnection:c=Oy,nodeLookup:l}){const d=s==="target",f=t?a.querySelector(`.${o}-flow__handle[data-id="${u}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:p,y:m}=ot(e),x=a.elementFromPoint(p,m),y=x!=null&&x.classList.contains(`${o}-flow__handle`)?x:f,v={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const w=Py(void 0,y),g=y.getAttribute("data-nodeid"),b=y.getAttribute("data-handleid"),_=y.classList.contains("connectable"),N=y.classList.contains("connectableend");if(!g||!w)return v;const E={source:d?g:n,sourceHandle:d?b:i,target:d?n:g,targetHandle:d?i:b};v.connection=E;const A=_&&N&&(r===Nr.Strict?d&&w==="source"||!d&&w==="target":g!==n||b!==i);v.isValid=A&&c(E),v.toHandle=My(g,w,b,l,r,!0)}return v}const nd={onPointerDown:aC,isValid:Dy};function oC({domNode:e,panZoom:t,getTransform:r,getViewScale:n}){const i=Xe(e);function s({translateExtent:o,width:u,height:c,zoomStep:l=1,pannable:d=!0,zoomable:f=!0,inversePan:p=!1}){const m=g=>{if(g.sourceEvent.type!=="wheel"||!t)return;const b=r(),_=g.sourceEvent.ctrlKey&&nn()?10:1,N=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*l,E=b[2]*Math.pow(2,N*_);t.scaleTo(E)};let x=[0,0];const y=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(x=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},v=g=>{const b=r();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const _=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],N=[_[0]-x[0],_[1]-x[1]];x=_;const E=n()*Math.max(b[2],Math.log(b[2]))*(p?-1:1),I={x:b[0]-N[0]*E,y:b[1]-N[1]*E},A=[[0,0],[u,c]];t.setViewportConstrained({x:I.x,y:I.y,zoom:b[2]},A,o)},w=fy().on("start",y).on("zoom",d?v:null).on("zoom.wheel",f?m:null);i.call(w,{})}function a(){i.on("zoom",null)}return{update:s,destroy:a,pointer:it}}const Ni=e=>({x:e.x,y:e.y,zoom:e.k}),gs=({x:e,y:t,zoom:r})=>bi.translate(e,t).scale(r),pr=(e,t)=>e.target.closest(`.${t}`),Ly=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),uC=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,ms=(e,t=0,r=uC,n=()=>{})=>{const i=typeof t=="number"&&t>0;return i||n(),i?e.transition().duration(t).ease(r).on("end",n):e},Fy=e=>{const t=e.ctrlKey&&nn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function cC({zoomPanValues:e,noWheelClassName:t,d3Selection:r,d3Zoom:n,panOnScrollMode:i,panOnScrollSpeed:s,zoomOnPinch:a,onPanZoomStart:o,onPanZoom:u,onPanZoomEnd:c}){return l=>{if(pr(l,t))return l.ctrlKey&&l.preventDefault(),!1;l.preventDefault(),l.stopImmediatePropagation();const d=r.property("__zoom").k||1;if(l.ctrlKey&&a){const y=it(l),v=Fy(l),w=d*Math.pow(2,v);n.scaleTo(r,w,y,l);return}const f=l.deltaMode===1?20:1;let p=i===Kt.Vertical?0:l.deltaX*f,m=i===Kt.Horizontal?0:l.deltaY*f;!nn()&&l.shiftKey&&i!==Kt.Vertical&&(p=l.deltaY*f,m=0),n.translateBy(r,-(p/d)*s,-(m/d)*s,{internal:!0});const x=Ni(r.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(u==null||u(l,x),e.panScrollTimeout=setTimeout(()=>{c==null||c(l,x),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,o==null||o(l,x))}}function lC({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:r}){return function(n,i){const s=n.type==="wheel",a=!t&&s&&!n.ctrlKey,o=pr(n,e);if(n.ctrlKey&&s&&o&&n.preventDefault(),a||o)return null;n.preventDefault(),r.call(this,n,i)}}function dC({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:r}){return n=>{var s,a,o;if((s=n.sourceEvent)!=null&&s.internal)return;const i=Ni(n.transform);e.mouseButton=((a=n.sourceEvent)==null?void 0:a.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=i,((o=n.sourceEvent)==null?void 0:o.type)==="mousedown"&&t(!0),r&&(r==null||r(n.sourceEvent,i))}}function fC({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:r,onTransformChange:n,onPanZoom:i}){return s=>{var a,o;e.usedRightMouseButton=!!(r&&Ly(t,e.mouseButton??0)),(a=s.sourceEvent)!=null&&a.sync||n([s.transform.x,s.transform.y,s.transform.k]),i&&!((o=s.sourceEvent)!=null&&o.internal)&&(i==null||i(s.sourceEvent,Ni(s.transform)))}}function hC({zoomPanValues:e,panOnDrag:t,panOnScroll:r,onDraggingChange:n,onPanZoomEnd:i,onPaneContextMenu:s}){return a=>{var o;if(!((o=a.sourceEvent)!=null&&o.internal)&&(e.isZoomingOrPanning=!1,s&&Ly(t,e.mouseButton??0)&&!e.usedRightMouseButton&&a.sourceEvent&&s(a.sourceEvent),e.usedRightMouseButton=!1,n(!1),i)){const u=Ni(a.transform);e.prevViewport=u,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{i==null||i(a.sourceEvent,u)},r?150:0)}}}function pC({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:r,panOnDrag:n,panOnScroll:i,zoomOnDoubleClick:s,userSelectionActive:a,noWheelClassName:o,noPanClassName:u,lib:c,connectionInProgress:l}){return d=>{var y;const f=e||t,p=r&&d.ctrlKey,m=d.type==="wheel";if(d.button===1&&d.type==="mousedown"&&(pr(d,`${c}-flow__node`)||pr(d,`${c}-flow__edge`)))return!0;if(!n&&!f&&!i&&!s&&!r||a||l&&!m||pr(d,o)&&m||pr(d,u)&&(!m||i&&m&&!e)||!r&&d.ctrlKey&&m)return!1;if(!r&&d.type==="touchstart"&&((y=d.touches)==null?void 0:y.length)>1)return d.preventDefault(),!1;if(!f&&!i&&!p&&m||!n&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(n)&&!n.includes(d.button)&&d.type==="mousedown")return!1;const x=Array.isArray(n)&&n.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||m)&&x}}function gC({domNode:e,minZoom:t,maxZoom:r,translateExtent:n,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:o,onDraggingChange:u}){const c={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},l=e.getBoundingClientRect(),d=fy().scaleExtent([t,r]).translateExtent(n),f=Xe(e).call(d);w({x:i.x,y:i.y,zoom:Cr(i.zoom,t,r)},[[0,0],[l.width,l.height]],n);const p=f.on("wheel.zoom"),m=f.on("dblclick.zoom");d.wheelDelta(Fy);function x(T,j){return f?new Promise(F=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?Ur:Yn).transform(ms(f,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>F(!0)),T)}):Promise.resolve(!1)}function y({noWheelClassName:T,noPanClassName:j,onPaneContextMenu:F,userSelectionActive:S,panOnScroll:D,panOnDrag:O,panOnScrollMode:M,panOnScrollSpeed:R,preventScrolling:q,zoomOnPinch:V,zoomOnScroll:G,zoomOnDoubleClick:Y,zoomActivationKeyPressed:J,lib:P,onTransformChange:B,connectionInProgress:z,paneClickDistance:$,selectionOnDrag:K}){S&&!c.isZoomingOrPanning&&v();const re=D&&!J&&!S;d.clickDistance(K?1/0:!at($)||$<0?0:$);const ee=re?cC({zoomPanValues:c,noWheelClassName:T,d3Selection:f,d3Zoom:d,panOnScrollMode:M,panOnScrollSpeed:R,zoomOnPinch:V,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:o}):lC({noWheelClassName:T,preventScrolling:q,d3ZoomHandler:p});if(f.on("wheel.zoom",ee,{passive:!1}),!S){const ce=dC({zoomPanValues:c,onDraggingChange:u,onPanZoomStart:a});d.on("start",ce);const ie=fC({zoomPanValues:c,panOnDrag:O,onPaneContextMenu:!!F,onPanZoom:s,onTransformChange:B});d.on("zoom",ie);const le=hC({zoomPanValues:c,panOnDrag:O,panOnScroll:D,onPaneContextMenu:F,onPanZoomEnd:o,onDraggingChange:u});d.on("end",le)}const ne=pC({zoomActivationKeyPressed:J,panOnDrag:O,zoomOnScroll:G,panOnScroll:D,zoomOnDoubleClick:Y,zoomOnPinch:V,userSelectionActive:S,noPanClassName:j,noWheelClassName:T,lib:P,connectionInProgress:z});d.filter(ne),Y?f.on("dblclick.zoom",m):f.on("dblclick.zoom",null)}function v(){d.on("zoom",null)}async function w(T,j,F){const S=gs(T),D=d==null?void 0:d.constrain()(S,j,F);return D&&await x(D),new Promise(O=>O(D))}async function g(T,j){const F=gs(T);return await x(F,j),new Promise(S=>S(F))}function b(T){if(f){const j=gs(T),F=f.property("__zoom");(F.k!==T.zoom||F.x!==T.x||F.y!==T.y)&&(d==null||d.transform(f,j,null,{sync:!0}))}}function _(){const T=f?dy(f.node()):{x:0,y:0,k:1};return{x:T.x,y:T.y,zoom:T.k}}function N(T,j){return f?new Promise(F=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?Ur:Yn).scaleTo(ms(f,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>F(!0)),T)}):Promise.resolve(!1)}function E(T,j){return f?new Promise(F=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?Ur:Yn).scaleBy(ms(f,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>F(!0)),T)}):Promise.resolve(!1)}function I(T){d==null||d.scaleExtent(T)}function A(T){d==null||d.translateExtent(T)}function L(T){const j=!at(T)||T<0?0:T;d==null||d.clickDistance(j)}return{update:y,destroy:v,setViewport:g,setViewportConstrained:w,getViewport:_,scaleTo:N,scaleBy:E,setScaleExtent:I,setTranslateExtent:A,syncViewport:b,setClickDistance:L}}var kr;(function(e){e.Line="line",e.Handle="handle"})(kr||(kr={}));function mC({width:e,prevWidth:t,height:r,prevHeight:n,affectsX:i,affectsY:s}){const a=e-t,o=r-n,u=[a>0?1:a<0?-1:0,o>0?1:o<0?-1:0];return a&&i&&(u[0]=u[0]*-1),o&&s&&(u[1]=u[1]*-1),u}function Pf(e){const t=e.includes("right")||e.includes("left"),r=e.includes("bottom")||e.includes("top"),n=e.includes("left"),i=e.includes("top");return{isHorizontal:t,isVertical:r,affectsX:n,affectsY:i}}function qt(e,t){return Math.max(0,t-e)}function Mt(e,t){return Math.max(0,e-t)}function Bn(e,t,r){return Math.max(0,t-e,e-r)}function Of(e,t){return e?!t:t}function vC(e,t,r,n,i,s,a,o){let{affectsX:u,affectsY:c}=t;const{isHorizontal:l,isVertical:d}=t,f=l&&d,{xSnapped:p,ySnapped:m}=r,{minWidth:x,maxWidth:y,minHeight:v,maxHeight:w}=n,{x:g,y:b,width:_,height:N,aspectRatio:E}=e;let I=Math.floor(l?p-e.pointerX:0),A=Math.floor(d?m-e.pointerY:0);const L=_+(u?-I:I),T=N+(c?-A:A),j=-s[0]*_,F=-s[1]*N;let S=Bn(L,x,y),D=Bn(T,v,w);if(a){let R=0,q=0;u&&I<0?R=qt(g+I+j,a[0][0]):!u&&I>0&&(R=Mt(g+L+j,a[1][0])),c&&A<0?q=qt(b+A+F,a[0][1]):!c&&A>0&&(q=Mt(b+T+F,a[1][1])),S=Math.max(S,R),D=Math.max(D,q)}if(o){let R=0,q=0;u&&I>0?R=Mt(g+I,o[0][0]):!u&&I<0&&(R=qt(g+L,o[1][0])),c&&A>0?q=Mt(b+A,o[0][1]):!c&&A<0&&(q=qt(b+T,o[1][1])),S=Math.max(S,R),D=Math.max(D,q)}if(i){if(l){const R=Bn(L/E,v,w)*E;if(S=Math.max(S,R),a){let q=0;!u&&!c||u&&!c&&f?q=Mt(b+F+L/E,a[1][1])*E:q=qt(b+F+(u?I:-I)/E,a[0][1])*E,S=Math.max(S,q)}if(o){let q=0;!u&&!c||u&&!c&&f?q=qt(b+L/E,o[1][1])*E:q=Mt(b+(u?I:-I)/E,o[0][1])*E,S=Math.max(S,q)}}if(d){const R=Bn(T*E,x,y)/E;if(D=Math.max(D,R),a){let q=0;!u&&!c||c&&!u&&f?q=Mt(g+T*E+j,a[1][0])/E:q=qt(g+(c?A:-A)*E+j,a[0][0])/E,D=Math.max(D,q)}if(o){let q=0;!u&&!c||c&&!u&&f?q=qt(g+T*E,o[1][0])/E:q=Mt(g+(c?A:-A)*E,o[0][0])/E,D=Math.max(D,q)}}}A=A+(A<0?D:-D),I=I+(I<0?S:-S),i&&(f?L>T*E?A=(Of(u,c)?-I:I)/E:I=(Of(u,c)?-A:A)*E:l?(A=I/E,c=u):(I=A*E,u=c));const O=u?g+I:g,M=c?b+A:b;return{width:_+(u?-I:I),height:N+(c?-A:A),x:s[0]*I*(u?-1:1)+O,y:s[1]*A*(c?-1:1)+M}}const $y={width:0,height:0,x:0,y:0},yC={...$y,pointerX:0,pointerY:0,aspectRatio:1};function xC(e){return[[0,0],[e.measured.width,e.measured.height]]}function bC(e,t,r){const n=t.position.x+e.position.x,i=t.position.y+e.position.y,s=e.measured.width??0,a=e.measured.height??0,o=r[0]*s,u=r[1]*a;return[[n-o,i-u],[n+s-o,i+a-u]]}function wC({domNode:e,nodeId:t,getStoreItems:r,onChange:n,onEnd:i}){const s=Xe(e);let a={controlDirection:Pf("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function o({controlPosition:c,boundaries:l,keepAspectRatio:d,resizeDirection:f,onResizeStart:p,onResize:m,onResizeEnd:x,shouldResize:y}){let v={...$y},w={...yC};a={boundaries:l,resizeDirection:f,keepAspectRatio:d,controlDirection:Pf(c)};let g,b=null,_=[],N,E,I,A=!1;const L=Z0().on("start",T=>{const{nodeLookup:j,transform:F,snapGrid:S,snapToGrid:D,nodeOrigin:O,paneDomNode:M}=r();if(g=j.get(t),!g)return;b=(M==null?void 0:M.getBoundingClientRect())??null;const{xSnapped:R,ySnapped:q}=Kr(T.sourceEvent,{transform:F,snapGrid:S,snapToGrid:D,containerBounds:b});v={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},w={...v,pointerX:R,pointerY:q,aspectRatio:v.width/v.height},N=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(N=j.get(g.parentId),E=N&&g.extent==="parent"?xC(N):void 0),_=[],I=void 0;for(const[V,G]of j)if(G.parentId===t&&(_.push({id:V,position:{...G.position},extent:G.extent}),G.extent==="parent"||G.expandParent)){const Y=bC(G,g,G.origin??O);I?I=[[Math.min(Y[0][0],I[0][0]),Math.min(Y[0][1],I[0][1])],[Math.max(Y[1][0],I[1][0]),Math.max(Y[1][1],I[1][1])]]:I=Y}p==null||p(T,{...v})}).on("drag",T=>{const{transform:j,snapGrid:F,snapToGrid:S,nodeOrigin:D}=r(),O=Kr(T.sourceEvent,{transform:j,snapGrid:F,snapToGrid:S,containerBounds:b}),M=[];if(!g)return;const{x:R,y:q,width:V,height:G}=v,Y={},J=g.origin??D,{width:P,height:B,x:z,y:$}=vC(w,a.controlDirection,O,a.boundaries,a.keepAspectRatio,J,E,I),K=P!==V,re=B!==G,ee=z!==R&&K,ne=$!==q&&re;if(!ee&&!ne&&!K&&!re)return;if((ee||ne||J[0]===1||J[1]===1)&&(Y.x=ee?z:v.x,Y.y=ne?$:v.y,v.x=Y.x,v.y=Y.y,_.length>0)){const oe=z-R,Z=$-q;for(const de of _)de.position={x:de.position.x-oe+J[0]*(P-V),y:de.position.y-Z+J[1]*(B-G)},M.push(de)}if((K||re)&&(Y.width=K&&(!a.resizeDirection||a.resizeDirection==="horizontal")?P:v.width,Y.height=re&&(!a.resizeDirection||a.resizeDirection==="vertical")?B:v.height,v.width=Y.width,v.height=Y.height),N&&g.expandParent){const oe=J[0]*(Y.width??0);Y.x&&Y.x<oe&&(v.x=oe,w.x=w.x-(Y.x-oe));const Z=J[1]*(Y.height??0);Y.y&&Y.y<Z&&(v.y=Z,w.y=w.y-(Y.y-Z))}const ce=mC({width:v.width,prevWidth:V,height:v.height,prevHeight:G,affectsX:a.controlDirection.affectsX,affectsY:a.controlDirection.affectsY}),ie={...v,direction:ce};(y==null?void 0:y(T,ie))!==!1&&(A=!0,m==null||m(T,ie),n(Y,M))}).on("end",T=>{A&&(x==null||x(T,{...v}),i==null||i({...v}),A=!1)});s.call(L)}function u(){s.on(".drag",null)}return{update:o,destroy:u}}const _C={},Df=e=>{let t;const r=new Set,n=(l,d)=>{const f=typeof l=="function"?l(t):l;if(!Object.is(f,t)){const p=t;t=d??(typeof f!="object"||f===null)?f:Object.assign({},t,f),r.forEach(m=>m(t,p))}},i=()=>t,u={setState:n,getState:i,getInitialState:()=>c,subscribe:l=>(r.add(l),()=>r.delete(l)),destroy:()=>{(_C?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},c=t=e(n,i,u);return u},NC=e=>e?Df(e):Df,{useDebugValue:EC}=zb,{useSyncExternalStoreWithSelector:CC}=$b,SC=e=>e;function zy(e,t=SC,r){const n=CC(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return EC(n),n}const Lf=(e,t)=>{const r=NC(e),n=(i,s=t)=>zy(r,i,s);return Object.assign(n,r),n},jC=(e,t)=>e?Lf(e,t):Lf;function Ce(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,i]of e)if(!Object.is(i,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0}const Ei=C.createContext(null),kC=Ei.Provider,By=yt.error001();function me(e,t){const r=C.useContext(Ei);if(r===null)throw new Error(By);return zy(r,e,t)}function Se(){const e=C.useContext(Ei);if(e===null)throw new Error(By);return C.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Ff={display:"none"},RC={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Hy="react-flow__node-desc",Vy="react-flow__edge-desc",IC="react-flow__aria-live",AC=e=>e.ariaLiveMessage,TC=e=>e.ariaLabelConfig;function qC({rfId:e}){const t=me(AC);return h.jsx("div",{id:`${IC}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:RC,children:t})}function MC({rfId:e,disableKeyboardA11y:t}){const r=me(TC);return h.jsxs(h.Fragment,{children:[h.jsx("div",{id:`${Hy}-${e}`,style:Ff,children:t?r["node.a11yDescription.default"]:r["node.a11yDescription.keyboardDisabled"]}),h.jsx("div",{id:`${Vy}-${e}`,style:Ff,children:r["edge.a11yDescription.default"]}),!t&&h.jsx(qC,{rfId:e})]})}const hn=C.forwardRef(({position:e="top-left",children:t,className:r,style:n,...i},s)=>{const a=`${e}`.split("-");return h.jsx("div",{className:Oe(["react-flow__panel",r,...a]),style:n,ref:s,...i,children:t})});hn.displayName="Panel";function PC({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:h.jsx(hn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:h.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const OC=e=>{const t=[],r=[];for(const[,n]of e.nodeLookup)n.selected&&t.push(n.internals.userNode);for(const[,n]of e.edgeLookup)n.selected&&r.push(n);return{selectedNodes:t,selectedEdges:r}},Hn=e=>e.id;function DC(e,t){return Ce(e.selectedNodes.map(Hn),t.selectedNodes.map(Hn))&&Ce(e.selectedEdges.map(Hn),t.selectedEdges.map(Hn))}function LC({onSelectionChange:e}){const t=Se(),{selectedNodes:r,selectedEdges:n}=me(OC,DC);return C.useEffect(()=>{const i={nodes:r,edges:n};e==null||e(i),t.getState().onSelectionChangeHandlers.forEach(s=>s(i))},[r,n,e]),null}const FC=e=>!!e.onSelectionChangeHandlers;function $C({onSelectionChange:e}){const t=me(FC);return e||t?h.jsx(LC,{onSelectionChange:e}):null}const Gy=[0,0],zC={x:0,y:0,zoom:1},BC=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],$f=[...BC,"rfId"],HC=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),zf={translateExtent:en,nodeOrigin:Gy,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function VC(e){const{setNodes:t,setEdges:r,setMinZoom:n,setMaxZoom:i,setTranslateExtent:s,setNodeExtent:a,reset:o,setDefaultNodesAndEdges:u}=me(HC,Ce),c=Se();C.useEffect(()=>(u(e.defaultNodes,e.defaultEdges),()=>{l.current=zf,o()}),[]);const l=C.useRef(zf);return C.useEffect(()=>{for(const d of $f){const f=e[d],p=l.current[d];f!==p&&(typeof e[d]>"u"||(d==="nodes"?t(f):d==="edges"?r(f):d==="minZoom"?n(f):d==="maxZoom"?i(f):d==="translateExtent"?s(f):d==="nodeExtent"?a(f):d==="ariaLabelConfig"?c.setState({ariaLabelConfig:ME(f)}):d==="fitView"?c.setState({fitViewQueued:f}):d==="fitViewOptions"?c.setState({fitViewOptions:f}):c.setState({[d]:f})))}l.current=e},$f.map(d=>e[d])),null}function Bf(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function GC(e){var n;const[t,r]=C.useState(e==="system"?null:e);return C.useEffect(()=>{if(e!=="system"){r(e);return}const i=Bf(),s=()=>r(i!=null&&i.matches?"dark":"light");return s(),i==null||i.addEventListener("change",s),()=>{i==null||i.removeEventListener("change",s)}},[e]),t!==null?t:(n=Bf())!=null&&n.matches?"dark":"light"}const Hf=typeof document<"u"?document:null;function sn(e=null,t={target:Hf,actInsideInputWithModifier:!0}){const[r,n]=C.useState(!1),i=C.useRef(!1),s=C.useRef(new Set([])),[a,o]=C.useMemo(()=>{if(e!==null){const c=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=c.reduce((d,f)=>d.concat(...f),[]);return[c,l]}return[[],[]]},[e]);return C.useEffect(()=>{const u=(t==null?void 0:t.target)??Hf,c=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=p=>{var y,v;if(i.current=p.ctrlKey||p.metaKey||p.shiftKey||p.altKey,(!i.current||i.current&&!c)&&Cy(p))return!1;const x=Gf(p.code,o);if(s.current.add(p[x]),Vf(a,s.current,!1)){const w=((v=(y=p.composedPath)==null?void 0:y.call(p))==null?void 0:v[0])||p.target,g=(w==null?void 0:w.nodeName)==="BUTTON"||(w==null?void 0:w.nodeName)==="A";t.preventDefault!==!1&&(i.current||!g)&&p.preventDefault(),n(!0)}},d=p=>{const m=Gf(p.code,o);Vf(a,s.current,!0)?(n(!1),s.current.clear()):s.current.delete(p[m]),p.key==="Meta"&&s.current.clear(),i.current=!1},f=()=>{s.current.clear(),n(!1)};return u==null||u.addEventListener("keydown",l),u==null||u.addEventListener("keyup",d),window.addEventListener("blur",f),window.addEventListener("contextmenu",f),()=>{u==null||u.removeEventListener("keydown",l),u==null||u.removeEventListener("keyup",d),window.removeEventListener("blur",f),window.removeEventListener("contextmenu",f)}}},[e,n]),r}function Vf(e,t,r){return e.filter(n=>r||n.length===t.size).some(n=>n.every(i=>t.has(i)))}function Gf(e,t){return t.includes(e)?"code":"key"}const UC=()=>{const e=Se();return C.useMemo(()=>({zoomIn:t=>{const{panZoom:r}=e.getState();return r?r.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:r}=e.getState();return r?r.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,r)=>{const{panZoom:n}=e.getState();return n?n.scaleTo(t,{duration:r==null?void 0:r.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,r)=>{const{transform:[n,i,s],panZoom:a}=e.getState();return a?(await a.setViewport({x:t.x??n,y:t.y??i,zoom:t.zoom??s},r),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,r,n]=e.getState().transform;return{x:t,y:r,zoom:n}},setCenter:async(t,r,n)=>e.getState().setCenter(t,r,n),fitBounds:async(t,r)=>{const{width:n,height:i,minZoom:s,maxZoom:a,panZoom:o}=e.getState(),u=_d(t,n,i,s,a,(r==null?void 0:r.padding)??.1);return o?(await o.setViewport(u,{duration:r==null?void 0:r.duration,ease:r==null?void 0:r.ease,interpolate:r==null?void 0:r.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,r={})=>{const{transform:n,snapGrid:i,snapToGrid:s,domNode:a}=e.getState();if(!a)return t;const{x:o,y:u}=a.getBoundingClientRect(),c={x:t.x-o,y:t.y-u},l=r.snapGrid??i,d=r.snapToGrid??s;return fn(c,n,d,l)},flowToScreenPosition:t=>{const{transform:r,domNode:n}=e.getState();if(!n)return t;const{x:i,y:s}=n.getBoundingClientRect(),a=ui(t,r);return{x:a.x+i,y:a.y+s}}}),[])};function Uy(e,t){const r=[],n=new Map,i=[];for(const s of e)if(s.type==="add"){i.push(s);continue}else if(s.type==="remove"||s.type==="replace")n.set(s.id,[s]);else{const a=n.get(s.id);a?a.push(s):n.set(s.id,[s])}for(const s of t){const a=n.get(s.id);if(!a){r.push(s);continue}if(a[0].type==="remove")continue;if(a[0].type==="replace"){r.push({...a[0].item});continue}const o={...s};for(const u of a)KC(u,o);r.push(o)}return i.length&&i.forEach(s=>{s.index!==void 0?r.splice(s.index,0,{...s.item}):r.push({...s.item})}),r}function KC(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Ky(e,t){return Uy(e,t)}function Yy(e,t){return Uy(e,t)}function Vt(e,t){return{id:e,type:"select",selected:t}}function gr(e,t=new Set,r=!1){const n=[];for(const[i,s]of e){const a=t.has(i);!(s.selected===void 0&&!a)&&s.selected!==a&&(r&&(s.selected=a),n.push(Vt(s.id,a)))}return n}function Uf({items:e=[],lookup:t}){var i;const r=[],n=new Map(e.map(s=>[s.id,s]));for(const[s,a]of e.entries()){const o=t.get(a.id),u=((i=o==null?void 0:o.internals)==null?void 0:i.userNode)??o;u!==void 0&&u!==a&&r.push({id:a.id,item:a,type:"replace"}),u===void 0&&r.push({item:a,type:"add",index:s})}for(const[s]of t)n.get(s)===void 0&&r.push({id:s,type:"remove"});return r}function Kf(e){return{id:e.id,type:"remove"}}const Yf=e=>EE(e),YC=e=>vy(e);function Wy(e){return C.forwardRef(e)}const WC=typeof window<"u"?C.useLayoutEffect:C.useEffect;function Wf(e){const[t,r]=C.useState(BigInt(0)),[n]=C.useState(()=>XC(()=>r(i=>i+BigInt(1))));return WC(()=>{const i=n.get();i.length&&(e(i),n.reset())},[t]),n}function XC(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:r=>{t.push(r),e()}}}const Xy=C.createContext(null);function ZC({children:e}){const t=Se(),r=C.useCallback(o=>{const{nodes:u=[],setNodes:c,hasDefaultNodes:l,onNodesChange:d,nodeLookup:f,fitViewQueued:p,onNodesChangeMiddlewareMap:m}=t.getState();let x=u;for(const v of o)x=typeof v=="function"?v(x):v;let y=Uf({items:x,lookup:f});for(const v of m.values())y=v(y);l&&c(x),y.length>0?d==null||d(y):p&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:w,setNodes:g}=t.getState();v&&g(w)})},[]),n=Wf(r),i=C.useCallback(o=>{const{edges:u=[],setEdges:c,hasDefaultEdges:l,onEdgesChange:d,edgeLookup:f}=t.getState();let p=u;for(const m of o)p=typeof m=="function"?m(p):m;l?c(p):d&&d(Uf({items:p,lookup:f}))},[]),s=Wf(i),a=C.useMemo(()=>({nodeQueue:n,edgeQueue:s}),[]);return h.jsx(Xy.Provider,{value:a,children:e})}function QC(){const e=C.useContext(Xy);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const JC=e=>!!e.panZoom;function pn(){const e=UC(),t=Se(),r=QC(),n=me(JC),i=C.useMemo(()=>{const s=d=>t.getState().nodeLookup.get(d),a=d=>{r.nodeQueue.push(d)},o=d=>{r.edgeQueue.push(d)},u=d=>{var v,w;const{nodeLookup:f,nodeOrigin:p}=t.getState(),m=Yf(d)?d:f.get(d.id),x=m.parentId?Ny(m.position,m.measured,m.parentId,f,p):m.position,y={...m,position:x,width:((v=m.measured)==null?void 0:v.width)??m.width,height:((w=m.measured)==null?void 0:w.height)??m.height};return Sr(y)},c=(d,f,p={replace:!1})=>{a(m=>m.map(x=>{if(x.id===d){const y=typeof f=="function"?f(x):f;return p.replace&&Yf(y)?y:{...x,...y}}return x}))},l=(d,f,p={replace:!1})=>{o(m=>m.map(x=>{if(x.id===d){const y=typeof f=="function"?f(x):f;return p.replace&&YC(y)?y:{...x,...y}}return x}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var f;return(f=s(d))==null?void 0:f.internals.userNode},getInternalNode:s,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(f=>({...f}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:a,setEdges:o,addNodes:d=>{const f=Array.isArray(d)?d:[d];r.nodeQueue.push(p=>[...p,...f])},addEdges:d=>{const f=Array.isArray(d)?d:[d];r.edgeQueue.push(p=>[...p,...f])},toObject:()=>{const{nodes:d=[],edges:f=[],transform:p}=t.getState(),[m,x,y]=p;return{nodes:d.map(v=>({...v})),edges:f.map(v=>({...v})),viewport:{x:m,y:x,zoom:y}}},deleteElements:async({nodes:d=[],edges:f=[]})=>{const{nodes:p,edges:m,onNodesDelete:x,onEdgesDelete:y,triggerNodeChanges:v,triggerEdgeChanges:w,onDelete:g,onBeforeDelete:b}=t.getState(),{nodes:_,edges:N}=await RE({nodesToRemove:d,edgesToRemove:f,nodes:p,edges:m,onBeforeDelete:b}),E=N.length>0,I=_.length>0;if(E){const A=N.map(Kf);y==null||y(N),w(A)}if(I){const A=_.map(Kf);x==null||x(_),v(A)}return(I||E)&&(g==null||g({nodes:_,edges:N})),{deletedNodes:_,deletedEdges:N}},getIntersectingNodes:(d,f=!0,p)=>{const m=Ef(d),x=m?d:u(d),y=p!==void 0;return x?(p||t.getState().nodes).filter(v=>{const w=t.getState().nodeLookup.get(v.id);if(w&&!m&&(v.id===d.id||!w.internals.positionAbsolute))return!1;const g=Sr(y?v:w),b=rn(g,x);return f&&b>0||b>=g.width*g.height||b>=x.width*x.height}):[]},isNodeIntersecting:(d,f,p=!0)=>{const x=Ef(d)?d:u(d);if(!x)return!1;const y=rn(x,f);return p&&y>0||y>=f.width*f.height||y>=x.width*x.height},updateNode:c,updateNodeData:(d,f,p={replace:!1})=>{c(d,m=>{const x=typeof f=="function"?f(m):f;return p.replace?{...m,data:x}:{...m,data:{...m.data,...x}}},p)},updateEdge:l,updateEdgeData:(d,f,p={replace:!1})=>{l(d,m=>{const x=typeof f=="function"?f(m):f;return p.replace?{...m,data:x}:{...m,data:{...m.data,...x}}},p)},getNodesBounds:d=>{const{nodeLookup:f,nodeOrigin:p}=t.getState();return CE(d,{nodeLookup:f,nodeOrigin:p})},getHandleConnections:({type:d,id:f,nodeId:p})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${p}-${d}${f?`-${f}`:""}`))==null?void 0:m.values())??[])},getNodeConnections:({type:d,handleId:f,nodeId:p})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${p}${d?f?`-${d}-${f}`:`-${d}`:""}`))==null?void 0:m.values())??[])},fitView:async d=>{const f=t.getState().fitViewResolver??qE();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:f}),r.nodeQueue.push(p=>[...p]),f.promise}}},[]);return C.useMemo(()=>({...i,...e,viewportInitialized:n}),[n])}const Xf=e=>e.selected,eS=typeof window<"u"?window:void 0;function tS({deleteKeyCode:e,multiSelectionKeyCode:t}){const r=Se(),{deleteElements:n}=pn(),i=sn(e,{actInsideInputWithModifier:!1}),s=sn(t,{target:eS});C.useEffect(()=>{if(i){const{edges:a,nodes:o}=r.getState();n({nodes:o.filter(Xf),edges:a.filter(Xf)}),r.setState({nodesSelectionActive:!1})}},[i]),C.useEffect(()=>{r.setState({multiSelectionActive:s})},[s])}function rS(e){const t=Se();C.useEffect(()=>{const r=()=>{var i,s,a,o;if(!e.current||!(((s=(i=e.current).checkVisibility)==null?void 0:s.call(i))??!0))return!1;const n=Nd(e.current);(n.height===0||n.width===0)&&((o=(a=t.getState()).onError)==null||o.call(a,"004",yt.error004())),t.setState({width:n.width||500,height:n.height||500})};if(e.current){r(),window.addEventListener("resize",r);const n=new ResizeObserver(()=>r());return n.observe(e.current),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}}},[])}const Ci={position:"absolute",width:"100%",height:"100%",top:0,left:0},nS=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function iS({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:r=!0,panOnScroll:n=!1,panOnScrollSpeed:i=.5,panOnScrollMode:s=Kt.Free,zoomOnDoubleClick:a=!0,panOnDrag:o=!0,defaultViewport:u,translateExtent:c,minZoom:l,maxZoom:d,zoomActivationKeyCode:f,preventScrolling:p=!0,children:m,noWheelClassName:x,noPanClassName:y,onViewportChange:v,isControlledViewport:w,paneClickDistance:g,selectionOnDrag:b}){const _=Se(),N=C.useRef(null),{userSelectionActive:E,lib:I,connectionInProgress:A}=me(nS,Ce),L=sn(f),T=C.useRef();rS(N);const j=C.useCallback(F=>{v==null||v({x:F[0],y:F[1],zoom:F[2]}),w||_.setState({transform:F})},[v,w]);return C.useEffect(()=>{if(N.current){T.current=gC({domNode:N.current,minZoom:l,maxZoom:d,translateExtent:c,viewport:u,onDraggingChange:O=>_.setState({paneDragging:O}),onPanZoomStart:(O,M)=>{const{onViewportChangeStart:R,onMoveStart:q}=_.getState();q==null||q(O,M),R==null||R(M)},onPanZoom:(O,M)=>{const{onViewportChange:R,onMove:q}=_.getState();q==null||q(O,M),R==null||R(M)},onPanZoomEnd:(O,M)=>{const{onViewportChangeEnd:R,onMoveEnd:q}=_.getState();q==null||q(O,M),R==null||R(M)}});const{x:F,y:S,zoom:D}=T.current.getViewport();return _.setState({panZoom:T.current,transform:[F,S,D],domNode:N.current.closest(".react-flow")}),()=>{var O;(O=T.current)==null||O.destroy()}}},[]),C.useEffect(()=>{var F;(F=T.current)==null||F.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:r,panOnScroll:n,panOnScrollSpeed:i,panOnScrollMode:s,zoomOnDoubleClick:a,panOnDrag:o,zoomActivationKeyPressed:L,preventScrolling:p,noPanClassName:y,userSelectionActive:E,noWheelClassName:x,lib:I,onTransformChange:j,connectionInProgress:A,selectionOnDrag:b,paneClickDistance:g})},[e,t,r,n,i,s,a,o,L,p,y,E,x,I,j,A,b,g]),h.jsx("div",{className:"react-flow__renderer",ref:N,style:Ci,children:m})}const sS=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function aS(){const{userSelectionActive:e,userSelectionRect:t}=me(sS,Ce);return e&&t?h.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const vs=(e,t)=>r=>{r.target===t.current&&(e==null||e(r))},oS=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function uS({isSelecting:e,selectionKeyPressed:t,selectionMode:r=tn.Full,panOnDrag:n,paneClickDistance:i,selectionOnDrag:s,onSelectionStart:a,onSelectionEnd:o,onPaneClick:u,onPaneContextMenu:c,onPaneScroll:l,onPaneMouseEnter:d,onPaneMouseMove:f,onPaneMouseLeave:p,children:m}){const x=Se(),{userSelectionActive:y,elementsSelectable:v,dragging:w,connectionInProgress:g}=me(oS,Ce),b=v&&(e||y),_=C.useRef(null),N=C.useRef(),E=C.useRef(new Set),I=C.useRef(new Set),A=C.useRef(!1),L=R=>{if(A.current||g){A.current=!1;return}u==null||u(R),x.getState().resetSelectedElements(),x.setState({nodesSelectionActive:!1})},T=R=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){R.preventDefault();return}c==null||c(R)},j=l?R=>l(R):void 0,F=R=>{A.current&&(R.stopPropagation(),A.current=!1)},S=R=>{var B,z;const{domNode:q}=x.getState();if(N.current=q==null?void 0:q.getBoundingClientRect(),!N.current)return;const V=R.target===_.current;if(!V&&!!R.target.closest(".nokey")||!e||!(s&&V||t)||R.button!==0||!R.isPrimary)return;(z=(B=R.target)==null?void 0:B.setPointerCapture)==null||z.call(B,R.pointerId),A.current=!1;const{x:J,y:P}=ot(R.nativeEvent,N.current);x.setState({userSelectionRect:{width:0,height:0,startX:J,startY:P,x:J,y:P}}),V||(R.stopPropagation(),R.preventDefault())},D=R=>{const{userSelectionRect:q,transform:V,nodeLookup:G,edgeLookup:Y,connectionLookup:J,triggerNodeChanges:P,triggerEdgeChanges:B,defaultEdgeOptions:z,resetSelectedElements:$}=x.getState();if(!N.current||!q)return;const{x:K,y:re}=ot(R.nativeEvent,N.current),{startX:ee,startY:ne}=q;if(!A.current){const Z=t?0:i;if(Math.hypot(K-ee,re-ne)<=Z)return;$(),a==null||a(R)}A.current=!0;const ce={startX:ee,startY:ne,x:K<ee?K:ee,y:re<ne?re:ne,width:Math.abs(K-ee),height:Math.abs(re-ne)},ie=E.current,le=I.current;E.current=new Set(wd(G,ce,V,r===tn.Partial,!0).map(Z=>Z.id)),I.current=new Set;const oe=(z==null?void 0:z.selectable)??!0;for(const Z of E.current){const de=J.get(Z);if(de)for(const{edgeId:Le}of de.values()){const Ne=Y.get(Le);Ne&&(Ne.selectable??oe)&&I.current.add(Le)}}if(!Cf(ie,E.current)){const Z=gr(G,E.current,!0);P(Z)}if(!Cf(le,I.current)){const Z=gr(Y,I.current);B(Z)}x.setState({userSelectionRect:ce,userSelectionActive:!0,nodesSelectionActive:!1})},O=R=>{var q,V;R.button===0&&((V=(q=R.target)==null?void 0:q.releasePointerCapture)==null||V.call(q,R.pointerId),!y&&R.target===_.current&&x.getState().userSelectionRect&&(L==null||L(R)),x.setState({userSelectionActive:!1,userSelectionRect:null}),A.current&&(o==null||o(R),x.setState({nodesSelectionActive:E.current.size>0})))},M=n===!0||Array.isArray(n)&&n.includes(0);return h.jsxs("div",{className:Oe(["react-flow__pane",{draggable:M,dragging:w,selection:e}]),onClick:b?void 0:vs(L,_),onContextMenu:vs(T,_),onWheel:vs(j,_),onPointerEnter:b?void 0:d,onPointerMove:b?D:f,onPointerUp:b?O:void 0,onPointerDownCapture:b?S:void 0,onClickCapture:b?F:void 0,onPointerLeave:p,ref:_,style:Ci,children:[m,h.jsx(aS,{})]})}function id({id:e,store:t,unselect:r=!1,nodeRef:n}){const{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:a,nodeLookup:o,onError:u}=t.getState(),c=o.get(e);if(!c){u==null||u("012",yt.error012(e));return}t.setState({nodesSelectionActive:!1}),c.selected?(r||c.selected&&a)&&(s({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var l;return(l=n==null?void 0:n.current)==null?void 0:l.blur()})):i([e])}function Zy({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:n,nodeId:i,isSelectable:s,nodeClickDistance:a}){const o=Se(),[u,c]=C.useState(!1),l=C.useRef();return C.useEffect(()=>{l.current=tC({getStoreItems:()=>o.getState(),onNodeMouseDown:d=>{id({id:d,store:o,nodeRef:e})},onDragStart:()=>{c(!0)},onDragStop:()=>{c(!1)}})},[]),C.useEffect(()=>{var d,f;if(t)(d=l.current)==null||d.destroy();else if(e.current)return(f=l.current)==null||f.update({noDragClassName:r,handleSelector:n,domNode:e.current,isSelectable:s,nodeId:i,nodeClickDistance:a}),()=>{var p;(p=l.current)==null||p.destroy()}},[r,n,t,s,e,i]),u}const cS=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Qy(){const e=Se();return C.useCallback(r=>{const{nodeExtent:n,snapToGrid:i,snapGrid:s,nodesDraggable:a,onError:o,updateNodePositions:u,nodeLookup:c,nodeOrigin:l}=e.getState(),d=new Map,f=cS(a),p=i?s[0]:5,m=i?s[1]:5,x=r.direction.x*p*r.factor,y=r.direction.y*m*r.factor;for(const[,v]of c){if(!f(v))continue;let w={x:v.internals.positionAbsolute.x+x,y:v.internals.positionAbsolute.y+y};i&&(w=dn(w,s));const{position:g,positionAbsolute:b}=yy({nodeId:v.id,nextPosition:w,nodeLookup:c,nodeExtent:n,nodeOrigin:l,onError:o});v.position=g,v.internals.positionAbsolute=b,d.set(v.id,v)}u(d)},[])}const Id=C.createContext(null),lS=Id.Provider;Id.Consumer;const Jy=()=>C.useContext(Id),dS=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),fS=(e,t,r)=>n=>{const{connectionClickStartHandle:i,connectionMode:s,connection:a}=n,{fromHandle:o,toHandle:u,isValid:c}=a,l=(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===r;return{connectingFrom:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===r,connectingTo:l,clickConnecting:(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.id)===t&&(i==null?void 0:i.type)===r,isPossibleEndHandle:s===Nr.Strict?(o==null?void 0:o.type)!==r:e!==(o==null?void 0:o.nodeId)||t!==(o==null?void 0:o.id),connectionInProcess:!!o,clickConnectionInProcess:!!i,valid:l&&c}};function hS({type:e="source",position:t=ue.Top,isValidConnection:r,isConnectable:n=!0,isConnectableStart:i=!0,isConnectableEnd:s=!0,id:a,onConnect:o,children:u,className:c,onMouseDown:l,onTouchStart:d,...f},p){var D,O;const m=a||null,x=e==="target",y=Se(),v=Jy(),{connectOnClick:w,noPanClassName:g,rfId:b}=me(dS,Ce),{connectingFrom:_,connectingTo:N,clickConnecting:E,isPossibleEndHandle:I,connectionInProcess:A,clickConnectionInProcess:L,valid:T}=me(fS(v,m,e),Ce);v||(O=(D=y.getState()).onError)==null||O.call(D,"010",yt.error010());const j=M=>{const{defaultEdgeOptions:R,onConnect:q,hasDefaultEdges:V}=y.getState(),G={...R,...M};if(V){const{edges:Y,setEdges:J}=y.getState();J(Jl(G,Y))}q==null||q(G),o==null||o(G)},F=M=>{if(!v)return;const R=Sy(M.nativeEvent);if(i&&(R&&M.button===0||!R)){const q=y.getState();nd.onPointerDown(M.nativeEvent,{handleDomNode:M.currentTarget,autoPanOnConnect:q.autoPanOnConnect,connectionMode:q.connectionMode,connectionRadius:q.connectionRadius,domNode:q.domNode,nodeLookup:q.nodeLookup,lib:q.lib,isTarget:x,handleId:m,nodeId:v,flowId:q.rfId,panBy:q.panBy,cancelConnection:q.cancelConnection,onConnectStart:q.onConnectStart,onConnectEnd:q.onConnectEnd,updateConnection:q.updateConnection,onConnect:j,isValidConnection:r||q.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:q.autoPanSpeed,dragThreshold:q.connectionDragThreshold})}R?l==null||l(M):d==null||d(M)},S=M=>{const{onClickConnectStart:R,onClickConnectEnd:q,connectionClickStartHandle:V,connectionMode:G,isValidConnection:Y,lib:J,rfId:P,nodeLookup:B,connection:z}=y.getState();if(!v||!V&&!i)return;if(!V){R==null||R(M.nativeEvent,{nodeId:v,handleId:m,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:v,type:e,id:m}});return}const $=Ey(M.target),K=r||Y,{connection:re,isValid:ee}=nd.isValid(M.nativeEvent,{handle:{nodeId:v,id:m,type:e},connectionMode:G,fromNodeId:V.nodeId,fromHandleId:V.id||null,fromType:V.type,isValidConnection:K,flowId:P,doc:$,lib:J,nodeLookup:B});ee&&re&&j(re);const ne=structuredClone(z);delete ne.inProgress,ne.toPosition=ne.toHandle?ne.toHandle.position:null,q==null||q(M,ne),y.setState({connectionClickStartHandle:null})};return h.jsx("div",{"data-handleid":m,"data-nodeid":v,"data-handlepos":t,"data-id":`${b}-${v}-${m}-${e}`,className:Oe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,c,{source:!x,target:x,connectable:n,connectablestart:i,connectableend:s,clickconnecting:E,connectingfrom:_,connectingto:N,valid:T,connectionindicator:n&&(!A||I)&&(A||L?s:i)}]),onMouseDown:F,onTouchStart:F,onClick:w?S:void 0,ref:p,...f,children:u})}const He=C.memo(Wy(hS));function pS({data:e,isConnectable:t,sourcePosition:r=ue.Bottom}){return h.jsxs(h.Fragment,{children:[e==null?void 0:e.label,h.jsx(He,{type:"source",position:r,isConnectable:t})]})}function gS({data:e,isConnectable:t,targetPosition:r=ue.Top,sourcePosition:n=ue.Bottom}){return h.jsxs(h.Fragment,{children:[h.jsx(He,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label,h.jsx(He,{type:"source",position:n,isConnectable:t})]})}function mS(){return null}function vS({data:e,isConnectable:t,targetPosition:r=ue.Top}){return h.jsxs(h.Fragment,{children:[h.jsx(He,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label]})}const ci={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Zf={input:pS,default:gS,output:vS,group:mS};function yS(e){var t,r,n,i;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((r=e.style)==null?void 0:r.height)}:{width:e.width??((n=e.style)==null?void 0:n.width),height:e.height??((i=e.style)==null?void 0:i.height)}}const xS=e=>{const{width:t,height:r,x:n,y:i}=ln(e.nodeLookup,{filter:s=>!!s.selected});return{width:at(t)?t:null,height:at(r)?r:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${n}px,${i}px)`}};function bS({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const n=Se(),{width:i,height:s,transformString:a,userSelectionActive:o}=me(xS,Ce),u=Qy(),c=C.useRef(null);if(C.useEffect(()=>{var f;r||(f=c.current)==null||f.focus({preventScroll:!0})},[r]),Zy({nodeRef:c}),o||!i||!s)return null;const l=e?f=>{const p=n.getState().nodes.filter(m=>m.selected);e(f,p)}:void 0,d=f=>{Object.prototype.hasOwnProperty.call(ci,f.key)&&(f.preventDefault(),u({direction:ci[f.key],factor:f.shiftKey?4:1}))};return h.jsx("div",{className:Oe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:a},children:h.jsx("div",{ref:c,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:r?void 0:-1,onKeyDown:r?void 0:d,style:{width:i,height:s}})})}const Qf=typeof window<"u"?window:void 0,wS=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function ex({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:a,paneClickDistance:o,deleteKeyCode:u,selectionKeyCode:c,selectionOnDrag:l,selectionMode:d,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:m,panActivationKeyCode:x,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:w,zoomOnPinch:g,panOnScroll:b,panOnScrollSpeed:_,panOnScrollMode:N,zoomOnDoubleClick:E,panOnDrag:I,defaultViewport:A,translateExtent:L,minZoom:T,maxZoom:j,preventScrolling:F,onSelectionContextMenu:S,noWheelClassName:D,noPanClassName:O,disableKeyboardA11y:M,onViewportChange:R,isControlledViewport:q}){const{nodesSelectionActive:V,userSelectionActive:G}=me(wS,Ce),Y=sn(c,{target:Qf}),J=sn(x,{target:Qf}),P=J||I,B=J||b,z=l&&P!==!0,$=Y||G||z;return tS({deleteKeyCode:u,multiSelectionKeyCode:m}),h.jsx(iS,{onPaneContextMenu:s,elementsSelectable:v,zoomOnScroll:w,zoomOnPinch:g,panOnScroll:B,panOnScrollSpeed:_,panOnScrollMode:N,zoomOnDoubleClick:E,panOnDrag:!Y&&P,defaultViewport:A,translateExtent:L,minZoom:T,maxZoom:j,zoomActivationKeyCode:y,preventScrolling:F,noWheelClassName:D,noPanClassName:O,onViewportChange:R,isControlledViewport:q,paneClickDistance:o,selectionOnDrag:z,children:h.jsxs(uS,{onSelectionStart:f,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:a,panOnDrag:P,isSelecting:!!$,selectionMode:d,selectionKeyPressed:Y,paneClickDistance:o,selectionOnDrag:z,children:[e,V&&h.jsx(bS,{onSelectionContextMenu:S,noPanClassName:O,disableKeyboardA11y:M})]})})}ex.displayName="FlowRenderer";const _S=C.memo(ex),NS=e=>t=>e?wd(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(r=>r.id):Array.from(t.nodeLookup.keys());function ES(e){return me(C.useCallback(NS(e),[e]),Ce)}const CS=e=>e.updateNodeInternals;function SS(){const e=me(CS),[t]=C.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(r=>{const n=new Map;r.forEach(i=>{const s=i.target.getAttribute("data-id");n.set(s,{id:s,nodeElement:i.target,force:!0})}),e(n)}));return C.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function jS({node:e,nodeType:t,hasDimensions:r,resizeObserver:n}){const i=Se(),s=C.useRef(null),a=C.useRef(null),o=C.useRef(e.sourcePosition),u=C.useRef(e.targetPosition),c=C.useRef(t),l=r&&!!e.internals.handleBounds;return C.useEffect(()=>{s.current&&!e.hidden&&(!l||a.current!==s.current)&&(a.current&&(n==null||n.unobserve(a.current)),n==null||n.observe(s.current),a.current=s.current)},[l,e.hidden]),C.useEffect(()=>()=>{a.current&&(n==null||n.unobserve(a.current),a.current=null)},[]),C.useEffect(()=>{if(s.current){const d=c.current!==t,f=o.current!==e.sourcePosition,p=u.current!==e.targetPosition;(d||f||p)&&(c.current=t,o.current=e.sourcePosition,u.current=e.targetPosition,i.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:s.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),s}function kS({id:e,onClick:t,onMouseEnter:r,onMouseMove:n,onMouseLeave:i,onContextMenu:s,onDoubleClick:a,nodesDraggable:o,elementsSelectable:u,nodesConnectable:c,nodesFocusable:l,resizeObserver:d,noDragClassName:f,noPanClassName:p,disableKeyboardA11y:m,rfId:x,nodeTypes:y,nodeClickDistance:v,onError:w}){const{node:g,internals:b,isParent:_}=me(K=>{const re=K.nodeLookup.get(e),ee=K.parentLookup.has(e);return{node:re,internals:re.internals,isParent:ee}},Ce);let N=g.type||"default",E=(y==null?void 0:y[N])||Zf[N];E===void 0&&(w==null||w("003",yt.error003(N)),N="default",E=(y==null?void 0:y.default)||Zf.default);const I=!!(g.draggable||o&&typeof g.draggable>"u"),A=!!(g.selectable||u&&typeof g.selectable>"u"),L=!!(g.connectable||c&&typeof g.connectable>"u"),T=!!(g.focusable||l&&typeof g.focusable>"u"),j=Se(),F=_y(g),S=jS({node:g,nodeType:N,hasDimensions:F,resizeObserver:d}),D=Zy({nodeRef:S,disabled:g.hidden||!I,noDragClassName:f,handleSelector:g.dragHandle,nodeId:e,isSelectable:A,nodeClickDistance:v}),O=Qy();if(g.hidden)return null;const M=jt(g),R=yS(g),q=A||I||t||r||n||i,V=r?K=>r(K,{...b.userNode}):void 0,G=n?K=>n(K,{...b.userNode}):void 0,Y=i?K=>i(K,{...b.userNode}):void 0,J=s?K=>s(K,{...b.userNode}):void 0,P=a?K=>a(K,{...b.userNode}):void 0,B=K=>{const{selectNodesOnDrag:re,nodeDragThreshold:ee}=j.getState();A&&(!re||!I||ee>0)&&id({id:e,store:j,nodeRef:S}),t&&t(K,{...b.userNode})},z=K=>{if(!(Cy(K.nativeEvent)||m)){if(hy.includes(K.key)&&A){const re=K.key==="Escape";id({id:e,store:j,unselect:re,nodeRef:S})}else if(I&&g.selected&&Object.prototype.hasOwnProperty.call(ci,K.key)){K.preventDefault();const{ariaLabelConfig:re}=j.getState();j.setState({ariaLiveMessage:re["node.a11yDescription.ariaLiveMessage"]({direction:K.key.replace("Arrow","").toLowerCase(),x:~~b.positionAbsolute.x,y:~~b.positionAbsolute.y})}),O({direction:ci[K.key],factor:K.shiftKey?4:1})}}},$=()=>{var le;if(m||!((le=S.current)!=null&&le.matches(":focus-visible")))return;const{transform:K,width:re,height:ee,autoPanOnNodeFocus:ne,setCenter:ce}=j.getState();if(!ne)return;wd(new Map([[e,g]]),{x:0,y:0,width:re,height:ee},K,!0).length>0||ce(g.position.x+M.width/2,g.position.y+M.height/2,{zoom:K[2]})};return h.jsx("div",{className:Oe(["react-flow__node",`react-flow__node-${N}`,{[p]:I},g.className,{selected:g.selected,selectable:A,parent:_,draggable:I,dragging:D}]),ref:S,style:{zIndex:b.z,transform:`translate(${b.positionAbsolute.x}px,${b.positionAbsolute.y}px)`,pointerEvents:q?"all":"none",visibility:F?"visible":"hidden",...g.style,...R},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:V,onMouseMove:G,onMouseLeave:Y,onContextMenu:J,onClick:B,onDoubleClick:P,onKeyDown:T?z:void 0,tabIndex:T?0:void 0,onFocus:T?$:void 0,role:g.ariaRole??(T?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${Hy}-${x}`,"aria-label":g.ariaLabel,...g.domAttributes,children:h.jsx(lS,{value:e,children:h.jsx(E,{id:e,data:g.data,type:N,positionAbsoluteX:b.positionAbsolute.x,positionAbsoluteY:b.positionAbsolute.y,selected:g.selected??!1,selectable:A,draggable:I,deletable:g.deletable??!0,isConnectable:L,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:D,dragHandle:g.dragHandle,zIndex:b.z,parentId:g.parentId,...M})})})}var RS=C.memo(kS);const IS=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function tx(e){const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:i,onError:s}=me(IS,Ce),a=ES(e.onlyRenderVisibleElements),o=SS();return h.jsx("div",{className:"react-flow__nodes",style:Ci,children:a.map(u=>h.jsx(RS,{id:u,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:o,nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:i,nodeClickDistance:e.nodeClickDistance,onError:s},u))})}tx.displayName="NodeRenderer";const AS=C.memo(tx);function TS(e){return me(C.useCallback(r=>{if(!e)return r.edges.map(i=>i.id);const n=[];if(r.width&&r.height)for(const i of r.edges){const s=r.nodeLookup.get(i.source),a=r.nodeLookup.get(i.target);s&&a&&DE({sourceNode:s,targetNode:a,width:r.width,height:r.height,transform:r.transform})&&n.push(i.id)}return n},[e]),Ce)}const qS=({color:e="none",strokeWidth:t=1})=>{const r={strokeWidth:t,...e&&{stroke:e}};return h.jsx("polyline",{className:"arrow",style:r,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},MS=({color:e="none",strokeWidth:t=1})=>{const r={strokeWidth:t,...e&&{stroke:e,fill:e}};return h.jsx("polyline",{className:"arrowclosed",style:r,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Jf={[Er.Arrow]:qS,[Er.ArrowClosed]:MS};function PS(e){const t=Se();return C.useMemo(()=>{var i,s;return Object.prototype.hasOwnProperty.call(Jf,e)?Jf[e]:((s=(i=t.getState()).onError)==null||s.call(i,"009",yt.error009(e)),null)},[e])}const OS=({id:e,type:t,color:r,width:n=12.5,height:i=12.5,markerUnits:s="strokeWidth",strokeWidth:a,orient:o="auto-start-reverse"})=>{const u=PS(t);return u?h.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:o,refX:"0",refY:"0",children:h.jsx(u,{color:r,strokeWidth:a})}):null},rx=({defaultColor:e,rfId:t})=>{const r=me(s=>s.edges),n=me(s=>s.defaultEdgeOptions),i=C.useMemo(()=>VE(r,{id:t,defaultColor:e,defaultMarkerStart:n==null?void 0:n.markerStart,defaultMarkerEnd:n==null?void 0:n.markerEnd}),[r,n,t,e]);return i.length?h.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:h.jsx("defs",{children:i.map(s=>h.jsx(OS,{id:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient},s.id))})}):null};rx.displayName="MarkerDefinitions";var DS=C.memo(rx);function nx({x:e,y:t,label:r,labelStyle:n,labelShowBg:i=!0,labelBgStyle:s,labelBgPadding:a=[2,4],labelBgBorderRadius:o=2,children:u,className:c,...l}){const[d,f]=C.useState({x:1,y:0,width:0,height:0}),p=Oe(["react-flow__edge-textwrapper",c]),m=C.useRef(null);return C.useEffect(()=>{if(m.current){const x=m.current.getBBox();f({x:x.x,y:x.y,width:x.width,height:x.height})}},[r]),r?h.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:p,visibility:d.width?"visible":"hidden",...l,children:[i&&h.jsx("rect",{width:d.width+2*a[0],x:-a[0],y:-a[1],height:d.height+2*a[1],className:"react-flow__edge-textbg",style:s,rx:o,ry:o}),h.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:m,style:n,children:r}),u]}):null}nx.displayName="EdgeText";const LS=C.memo(nx);function gn({path:e,labelX:t,labelY:r,label:n,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:o,labelBgBorderRadius:u,interactionWidth:c=20,...l}){return h.jsxs(h.Fragment,{children:[h.jsx("path",{...l,d:e,fill:"none",className:Oe(["react-flow__edge-path",l.className])}),c?h.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:c,className:"react-flow__edge-interaction"}):null,n&&at(t)&&at(r)?h.jsx(LS,{x:t,y:r,label:n,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:o,labelBgBorderRadius:u}):null]})}function eh({pos:e,x1:t,y1:r,x2:n,y2:i}){return e===ue.Left||e===ue.Right?[.5*(t+n),r]:[t,.5*(r+i)]}function ix({sourceX:e,sourceY:t,sourcePosition:r=ue.Bottom,targetX:n,targetY:i,targetPosition:s=ue.Top}){const[a,o]=eh({pos:r,x1:e,y1:t,x2:n,y2:i}),[u,c]=eh({pos:s,x1:n,y1:i,x2:e,y2:t}),[l,d,f,p]=jy({sourceX:e,sourceY:t,targetX:n,targetY:i,sourceControlX:a,sourceControlY:o,targetControlX:u,targetControlY:c});return[`M${e},${t} C${a},${o} ${u},${c} ${n},${i}`,l,d,f,p]}function sx(e){return C.memo(({id:t,sourceX:r,sourceY:n,targetX:i,targetY:s,sourcePosition:a,targetPosition:o,label:u,labelStyle:c,labelShowBg:l,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:x,markerStart:y,interactionWidth:v})=>{const[w,g,b]=ix({sourceX:r,sourceY:n,sourcePosition:a,targetX:i,targetY:s,targetPosition:o}),_=e.isInternal?void 0:t;return h.jsx(gn,{id:_,path:w,labelX:g,labelY:b,label:u,labelStyle:c,labelShowBg:l,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:x,markerStart:y,interactionWidth:v})})}const FS=sx({isInternal:!1}),ax=sx({isInternal:!0});FS.displayName="SimpleBezierEdge";ax.displayName="SimpleBezierEdgeInternal";function ox(e){return C.memo(({id:t,sourceX:r,sourceY:n,targetX:i,targetY:s,label:a,labelStyle:o,labelShowBg:u,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:d,style:f,sourcePosition:p=ue.Bottom,targetPosition:m=ue.Top,markerEnd:x,markerStart:y,pathOptions:v,interactionWidth:w})=>{const[g,b,_]=ed({sourceX:r,sourceY:n,sourcePosition:p,targetX:i,targetY:s,targetPosition:m,borderRadius:v==null?void 0:v.borderRadius,offset:v==null?void 0:v.offset,stepPosition:v==null?void 0:v.stepPosition}),N=e.isInternal?void 0:t;return h.jsx(gn,{id:N,path:g,labelX:b,labelY:_,label:a,labelStyle:o,labelShowBg:u,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:d,style:f,markerEnd:x,markerStart:y,interactionWidth:w})})}const ux=ox({isInternal:!1}),cx=ox({isInternal:!0});ux.displayName="SmoothStepEdge";cx.displayName="SmoothStepEdgeInternal";function lx(e){return C.memo(({id:t,...r})=>{var i;const n=e.isInternal?void 0:t;return h.jsx(ux,{...r,id:n,pathOptions:C.useMemo(()=>{var s;return{borderRadius:0,offset:(s=r.pathOptions)==null?void 0:s.offset}},[(i=r.pathOptions)==null?void 0:i.offset])})})}const $S=lx({isInternal:!1}),dx=lx({isInternal:!0});$S.displayName="StepEdge";dx.displayName="StepEdgeInternal";function fx(e){return C.memo(({id:t,sourceX:r,sourceY:n,targetX:i,targetY:s,label:a,labelStyle:o,labelShowBg:u,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:d,style:f,markerEnd:p,markerStart:m,interactionWidth:x})=>{const[y,v,w]=Ry({sourceX:r,sourceY:n,targetX:i,targetY:s}),g=e.isInternal?void 0:t;return h.jsx(gn,{id:g,path:y,labelX:v,labelY:w,label:a,labelStyle:o,labelShowBg:u,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:d,style:f,markerEnd:p,markerStart:m,interactionWidth:x})})}const zS=fx({isInternal:!1}),hx=fx({isInternal:!0});zS.displayName="StraightEdge";hx.displayName="StraightEdgeInternal";function px(e){return C.memo(({id:t,sourceX:r,sourceY:n,targetX:i,targetY:s,sourcePosition:a=ue.Bottom,targetPosition:o=ue.Top,label:u,labelStyle:c,labelShowBg:l,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:x,markerStart:y,pathOptions:v,interactionWidth:w})=>{const[g,b,_]=Ed({sourceX:r,sourceY:n,sourcePosition:a,targetX:i,targetY:s,targetPosition:o,curvature:v==null?void 0:v.curvature}),N=e.isInternal?void 0:t;return h.jsx(gn,{id:N,path:g,labelX:b,labelY:_,label:u,labelStyle:c,labelShowBg:l,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:x,markerStart:y,interactionWidth:w})})}const BS=px({isInternal:!1}),gx=px({isInternal:!0});BS.displayName="BezierEdge";gx.displayName="BezierEdgeInternal";const th={default:gx,straight:hx,step:dx,smoothstep:cx,simplebezier:ax},rh={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},HS=(e,t,r)=>r===ue.Left?e-t:r===ue.Right?e+t:e,VS=(e,t,r)=>r===ue.Top?e-t:r===ue.Bottom?e+t:e,nh="react-flow__edgeupdater";function ih({position:e,centerX:t,centerY:r,radius:n=10,onMouseDown:i,onMouseEnter:s,onMouseOut:a,type:o}){return h.jsx("circle",{onMouseDown:i,onMouseEnter:s,onMouseOut:a,className:Oe([nh,`${nh}-${o}`]),cx:HS(t,n,e),cy:VS(r,n,e),r:n,stroke:"transparent",fill:"transparent"})}function GS({isReconnectable:e,reconnectRadius:t,edge:r,sourceX:n,sourceY:i,targetX:s,targetY:a,sourcePosition:o,targetPosition:u,onReconnect:c,onReconnectStart:l,onReconnectEnd:d,setReconnecting:f,setUpdateHover:p}){const m=Se(),x=(b,_)=>{if(b.button!==0)return;const{autoPanOnConnect:N,domNode:E,isValidConnection:I,connectionMode:A,connectionRadius:L,lib:T,onConnectStart:j,onConnectEnd:F,cancelConnection:S,nodeLookup:D,rfId:O,panBy:M,updateConnection:R}=m.getState(),q=_.type==="target",V=(J,P)=>{f(!1),d==null||d(J,r,_.type,P)},G=J=>c==null?void 0:c(r,J),Y=(J,P)=>{f(!0),l==null||l(b,r,_.type),j==null||j(J,P)};nd.onPointerDown(b.nativeEvent,{autoPanOnConnect:N,connectionMode:A,connectionRadius:L,domNode:E,handleId:_.id,nodeId:_.nodeId,nodeLookup:D,isTarget:q,edgeUpdaterType:_.type,lib:T,flowId:O,cancelConnection:S,panBy:M,isValidConnection:I,onConnect:G,onConnectStart:Y,onConnectEnd:F,onReconnectEnd:V,updateConnection:R,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold,handleDomNode:b.currentTarget})},y=b=>x(b,{nodeId:r.target,id:r.targetHandle??null,type:"target"}),v=b=>x(b,{nodeId:r.source,id:r.sourceHandle??null,type:"source"}),w=()=>p(!0),g=()=>p(!1);return h.jsxs(h.Fragment,{children:[(e===!0||e==="source")&&h.jsx(ih,{position:o,centerX:n,centerY:i,radius:t,onMouseDown:y,onMouseEnter:w,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&h.jsx(ih,{position:u,centerX:s,centerY:a,radius:t,onMouseDown:v,onMouseEnter:w,onMouseOut:g,type:"target"})]})}function US({id:e,edgesFocusable:t,edgesReconnectable:r,elementsSelectable:n,onClick:i,onDoubleClick:s,onContextMenu:a,onMouseEnter:o,onMouseMove:u,onMouseLeave:c,reconnectRadius:l,onReconnect:d,onReconnectStart:f,onReconnectEnd:p,rfId:m,edgeTypes:x,noPanClassName:y,onError:v,disableKeyboardA11y:w}){let g=me(ce=>ce.edgeLookup.get(e));const b=me(ce=>ce.defaultEdgeOptions);g=b?{...b,...g}:g;let _=g.type||"default",N=(x==null?void 0:x[_])||th[_];N===void 0&&(v==null||v("011",yt.error011(_)),_="default",N=(x==null?void 0:x.default)||th.default);const E=!!(g.focusable||t&&typeof g.focusable>"u"),I=typeof d<"u"&&(g.reconnectable||r&&typeof g.reconnectable>"u"),A=!!(g.selectable||n&&typeof g.selectable>"u"),L=C.useRef(null),[T,j]=C.useState(!1),[F,S]=C.useState(!1),D=Se(),{zIndex:O,sourceX:M,sourceY:R,targetX:q,targetY:V,sourcePosition:G,targetPosition:Y}=me(C.useCallback(ce=>{const ie=ce.nodeLookup.get(g.source),le=ce.nodeLookup.get(g.target);if(!ie||!le)return{zIndex:g.zIndex,...rh};const oe=HE({id:e,sourceNode:ie,targetNode:le,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:ce.connectionMode,onError:v});return{zIndex:OE({selected:g.selected,zIndex:g.zIndex,sourceNode:ie,targetNode:le,elevateOnSelect:ce.elevateEdgesOnSelect,zIndexMode:ce.zIndexMode}),...oe||rh}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),Ce),J=C.useMemo(()=>g.markerStart?`url('#${td(g.markerStart,m)}')`:void 0,[g.markerStart,m]),P=C.useMemo(()=>g.markerEnd?`url('#${td(g.markerEnd,m)}')`:void 0,[g.markerEnd,m]);if(g.hidden||M===null||R===null||q===null||V===null)return null;const B=ce=>{var Z;const{addSelectedEdges:ie,unselectNodesAndEdges:le,multiSelectionActive:oe}=D.getState();A&&(D.setState({nodesSelectionActive:!1}),g.selected&&oe?(le({nodes:[],edges:[g]}),(Z=L.current)==null||Z.blur()):ie([e])),i&&i(ce,g)},z=s?ce=>{s(ce,{...g})}:void 0,$=a?ce=>{a(ce,{...g})}:void 0,K=o?ce=>{o(ce,{...g})}:void 0,re=u?ce=>{u(ce,{...g})}:void 0,ee=c?ce=>{c(ce,{...g})}:void 0,ne=ce=>{var ie;if(!w&&hy.includes(ce.key)&&A){const{unselectNodesAndEdges:le,addSelectedEdges:oe}=D.getState();ce.key==="Escape"?((ie=L.current)==null||ie.blur(),le({edges:[g]})):oe([e])}};return h.jsx("svg",{style:{zIndex:O},children:h.jsxs("g",{className:Oe(["react-flow__edge",`react-flow__edge-${_}`,g.className,y,{selected:g.selected,animated:g.animated,inactive:!A&&!i,updating:T,selectable:A}]),onClick:B,onDoubleClick:z,onContextMenu:$,onMouseEnter:K,onMouseMove:re,onMouseLeave:ee,onKeyDown:E?ne:void 0,tabIndex:E?0:void 0,role:g.ariaRole??(E?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":E?`${Vy}-${m}`:void 0,ref:L,...g.domAttributes,children:[!F&&h.jsx(N,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:A,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:M,sourceY:R,targetX:q,targetY:V,sourcePosition:G,targetPosition:Y,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:J,markerEnd:P,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),I&&h.jsx(GS,{edge:g,isReconnectable:I,reconnectRadius:l,onReconnect:d,onReconnectStart:f,onReconnectEnd:p,sourceX:M,sourceY:R,targetX:q,targetY:V,sourcePosition:G,targetPosition:Y,setUpdateHover:j,setReconnecting:S})]})})}var KS=C.memo(US);const YS=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function mx({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:r,edgeTypes:n,noPanClassName:i,onReconnect:s,onEdgeContextMenu:a,onEdgeMouseEnter:o,onEdgeMouseMove:u,onEdgeMouseLeave:c,onEdgeClick:l,reconnectRadius:d,onEdgeDoubleClick:f,onReconnectStart:p,onReconnectEnd:m,disableKeyboardA11y:x}){const{edgesFocusable:y,edgesReconnectable:v,elementsSelectable:w,onError:g}=me(YS,Ce),b=TS(t);return h.jsxs("div",{className:"react-flow__edges",children:[h.jsx(DS,{defaultColor:e,rfId:r}),b.map(_=>h.jsx(KS,{id:_,edgesFocusable:y,edgesReconnectable:v,elementsSelectable:w,noPanClassName:i,onReconnect:s,onContextMenu:a,onMouseEnter:o,onMouseMove:u,onMouseLeave:c,onClick:l,reconnectRadius:d,onDoubleClick:f,onReconnectStart:p,onReconnectEnd:m,rfId:r,onError:g,edgeTypes:n,disableKeyboardA11y:x},_))]})}mx.displayName="EdgeRenderer";const WS=C.memo(mx),XS=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function ZS({children:e}){const t=me(XS);return h.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function QS(e){const t=pn(),r=C.useRef(!1);C.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const JS=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function ej(e){const t=me(JS),r=Se();return C.useEffect(()=>{e&&(t==null||t(e),r.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function tj(e){return e.connection.inProgress?{...e.connection,to:fn(e.connection.to,e.transform)}:{...e.connection}}function rj(e){return tj}function nj(e){const t=rj();return me(t,Ce)}const ij=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function sj({containerStyle:e,style:t,type:r,component:n}){const{nodesConnectable:i,width:s,height:a,isValid:o,inProgress:u}=me(ij,Ce);return!(s&&i&&u)?null:h.jsx("svg",{style:e,width:s,height:a,className:"react-flow__connectionline react-flow__container",children:h.jsx("g",{className:Oe(["react-flow__connection",my(o)]),children:h.jsx(vx,{style:t,type:r,CustomComponent:n,isValid:o})})})}const vx=({style:e,type:t=Pt.Bezier,CustomComponent:r,isValid:n})=>{const{inProgress:i,from:s,fromNode:a,fromHandle:o,fromPosition:u,to:c,toNode:l,toHandle:d,toPosition:f,pointer:p}=nj();if(!i)return;if(r)return h.jsx(r,{connectionLineType:t,connectionLineStyle:e,fromNode:a,fromHandle:o,fromX:s.x,fromY:s.y,toX:c.x,toY:c.y,fromPosition:u,toPosition:f,connectionStatus:my(n),toNode:l,toHandle:d,pointer:p});let m="";const x={sourceX:s.x,sourceY:s.y,sourcePosition:u,targetX:c.x,targetY:c.y,targetPosition:f};switch(t){case Pt.Bezier:[m]=Ed(x);break;case Pt.SimpleBezier:[m]=ix(x);break;case Pt.Step:[m]=ed({...x,borderRadius:0});break;case Pt.SmoothStep:[m]=ed(x);break;default:[m]=Ry(x)}return h.jsx("path",{d:m,fill:"none",className:"react-flow__connection-path",style:e})};vx.displayName="ConnectionLine";const aj={};function sh(e=aj){C.useRef(e),Se(),C.useEffect(()=>{},[e])}function oj(){Se(),C.useRef(!1),C.useEffect(()=>{},[])}function yx({nodeTypes:e,edgeTypes:t,onInit:r,onNodeClick:n,onEdgeClick:i,onNodeDoubleClick:s,onEdgeDoubleClick:a,onNodeMouseEnter:o,onNodeMouseMove:u,onNodeMouseLeave:c,onNodeContextMenu:l,onSelectionContextMenu:d,onSelectionStart:f,onSelectionEnd:p,connectionLineType:m,connectionLineStyle:x,connectionLineComponent:y,connectionLineContainerStyle:v,selectionKeyCode:w,selectionOnDrag:g,selectionMode:b,multiSelectionKeyCode:_,panActivationKeyCode:N,zoomActivationKeyCode:E,deleteKeyCode:I,onlyRenderVisibleElements:A,elementsSelectable:L,defaultViewport:T,translateExtent:j,minZoom:F,maxZoom:S,preventScrolling:D,defaultMarkerColor:O,zoomOnScroll:M,zoomOnPinch:R,panOnScroll:q,panOnScrollSpeed:V,panOnScrollMode:G,zoomOnDoubleClick:Y,panOnDrag:J,onPaneClick:P,onPaneMouseEnter:B,onPaneMouseMove:z,onPaneMouseLeave:$,onPaneScroll:K,onPaneContextMenu:re,paneClickDistance:ee,nodeClickDistance:ne,onEdgeContextMenu:ce,onEdgeMouseEnter:ie,onEdgeMouseMove:le,onEdgeMouseLeave:oe,reconnectRadius:Z,onReconnect:de,onReconnectStart:Le,onReconnectEnd:Ne,noDragClassName:Ae,noWheelClassName:xe,noPanClassName:Te,disableKeyboardA11y:ve,nodeExtent:Fe,rfId:Ve,viewport:Be,onViewportChange:Ye}){return sh(e),sh(t),oj(),QS(r),ej(Be),h.jsx(_S,{onPaneClick:P,onPaneMouseEnter:B,onPaneMouseMove:z,onPaneMouseLeave:$,onPaneContextMenu:re,onPaneScroll:K,paneClickDistance:ee,deleteKeyCode:I,selectionKeyCode:w,selectionOnDrag:g,selectionMode:b,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:_,panActivationKeyCode:N,zoomActivationKeyCode:E,elementsSelectable:L,zoomOnScroll:M,zoomOnPinch:R,zoomOnDoubleClick:Y,panOnScroll:q,panOnScrollSpeed:V,panOnScrollMode:G,panOnDrag:J,defaultViewport:T,translateExtent:j,minZoom:F,maxZoom:S,onSelectionContextMenu:d,preventScrolling:D,noDragClassName:Ae,noWheelClassName:xe,noPanClassName:Te,disableKeyboardA11y:ve,onViewportChange:Ye,isControlledViewport:!!Be,children:h.jsxs(ZS,{children:[h.jsx(WS,{edgeTypes:t,onEdgeClick:i,onEdgeDoubleClick:a,onReconnect:de,onReconnectStart:Le,onReconnectEnd:Ne,onlyRenderVisibleElements:A,onEdgeContextMenu:ce,onEdgeMouseEnter:ie,onEdgeMouseMove:le,onEdgeMouseLeave:oe,reconnectRadius:Z,defaultMarkerColor:O,noPanClassName:Te,disableKeyboardA11y:ve,rfId:Ve}),h.jsx(sj,{style:x,type:m,component:y,containerStyle:v}),h.jsx("div",{className:"react-flow__edgelabel-renderer"}),h.jsx(AS,{nodeTypes:e,onNodeClick:n,onNodeDoubleClick:s,onNodeMouseEnter:o,onNodeMouseMove:u,onNodeMouseLeave:c,onNodeContextMenu:l,nodeClickDistance:ne,onlyRenderVisibleElements:A,noPanClassName:Te,noDragClassName:Ae,disableKeyboardA11y:ve,nodeExtent:Fe,rfId:Ve}),h.jsx("div",{className:"react-flow__viewport-portal"})]})})}yx.displayName="GraphView";const uj=C.memo(yx),ah=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:i,height:s,fitView:a,fitViewOptions:o,minZoom:u=.5,maxZoom:c=2,nodeOrigin:l,nodeExtent:d,zIndexMode:f="basic"}={})=>{const p=new Map,m=new Map,x=new Map,y=new Map,v=n??t??[],w=r??e??[],g=l??[0,0],b=d??en;Ty(x,y,v);const _=rd(w,p,m,{nodeOrigin:g,nodeExtent:b,zIndexMode:f});let N=[0,0,1];if(a&&i&&s){const E=ln(p,{filter:T=>!!((T.width||T.initialWidth)&&(T.height||T.initialHeight))}),{x:I,y:A,zoom:L}=_d(E,i,s,u,c,(o==null?void 0:o.padding)??.1);N=[I,A,L]}return{rfId:"1",width:i??0,height:s??0,transform:N,nodes:w,nodesInitialized:_,nodeLookup:p,parentLookup:m,edges:v,edgeLookup:y,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:r!==void 0,hasDefaultEdges:n!==void 0,panZoom:null,minZoom:u,maxZoom:c,translateExtent:en,nodeExtent:b,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Nr.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:g,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:a??!1,fitViewOptions:o,fitViewResolver:null,connection:{...gy},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:IE,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:py,zIndexMode:f,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},cj=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:i,height:s,fitView:a,fitViewOptions:o,minZoom:u,maxZoom:c,nodeOrigin:l,nodeExtent:d,zIndexMode:f})=>jC((p,m)=>{async function x(){const{nodeLookup:y,panZoom:v,fitViewOptions:w,fitViewResolver:g,width:b,height:_,minZoom:N,maxZoom:E}=m();v&&(await kE({nodes:y,width:b,height:_,panZoom:v,minZoom:N,maxZoom:E},w),g==null||g.resolve(!0),p({fitViewResolver:null}))}return{...ah({nodes:e,edges:t,width:i,height:s,fitView:a,fitViewOptions:o,minZoom:u,maxZoom:c,nodeOrigin:l,nodeExtent:d,defaultNodes:r,defaultEdges:n,zIndexMode:f}),setNodes:y=>{const{nodeLookup:v,parentLookup:w,nodeOrigin:g,elevateNodesOnSelect:b,fitViewQueued:_,zIndexMode:N}=m(),E=rd(y,v,w,{nodeOrigin:g,nodeExtent:d,elevateNodesOnSelect:b,checkEquality:!0,zIndexMode:N});_&&E?(x(),p({nodes:y,nodesInitialized:E,fitViewQueued:!1,fitViewOptions:void 0})):p({nodes:y,nodesInitialized:E})},setEdges:y=>{const{connectionLookup:v,edgeLookup:w}=m();Ty(v,w,y),p({edges:y})},setDefaultNodesAndEdges:(y,v)=>{if(y){const{setNodes:w}=m();w(y),p({hasDefaultNodes:!0})}if(v){const{setEdges:w}=m();w(v),p({hasDefaultEdges:!0})}},updateNodeInternals:y=>{const{triggerNodeChanges:v,nodeLookup:w,parentLookup:g,domNode:b,nodeOrigin:_,nodeExtent:N,debug:E,fitViewQueued:I,zIndexMode:A}=m(),{changes:L,updatedInternals:T}=ZE(y,w,g,b,_,N,A);T&&(KE(w,g,{nodeOrigin:_,nodeExtent:N,zIndexMode:A}),I?(x(),p({fitViewQueued:!1,fitViewOptions:void 0})):p({}),(L==null?void 0:L.length)>0&&(E&&console.log("React Flow: trigger node changes",L),v==null||v(L)))},updateNodePositions:(y,v=!1)=>{const w=[];let g=[];const{nodeLookup:b,triggerNodeChanges:_,connection:N,updateConnection:E,onNodesChangeMiddlewareMap:I}=m();for(const[A,L]of y){const T=b.get(A),j=!!(T!=null&&T.expandParent&&(T!=null&&T.parentId)&&(L!=null&&L.position)),F={id:A,type:"position",position:j?{x:Math.max(0,L.position.x),y:Math.max(0,L.position.y)}:L.position,dragging:v};if(T&&N.inProgress&&N.fromNode.id===T.id){const S=Qt(T,N.fromHandle,ue.Left,!0);E({...N,from:S})}j&&T.parentId&&w.push({id:A,parentId:T.parentId,rect:{...L.internals.positionAbsolute,width:L.measured.width??0,height:L.measured.height??0}}),g.push(F)}if(w.length>0){const{parentLookup:A,nodeOrigin:L}=m(),T=Rd(w,b,A,L);g.push(...T)}for(const A of I.values())g=A(g);_(g)},triggerNodeChanges:y=>{const{onNodesChange:v,setNodes:w,nodes:g,hasDefaultNodes:b,debug:_}=m();if(y!=null&&y.length){if(b){const N=Ky(y,g);w(N)}_&&console.log("React Flow: trigger node changes",y),v==null||v(y)}},triggerEdgeChanges:y=>{const{onEdgesChange:v,setEdges:w,edges:g,hasDefaultEdges:b,debug:_}=m();if(y!=null&&y.length){if(b){const N=Yy(y,g);w(N)}_&&console.log("React Flow: trigger edge changes",y),v==null||v(y)}},addSelectedNodes:y=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:g,triggerNodeChanges:b,triggerEdgeChanges:_}=m();if(v){const N=y.map(E=>Vt(E,!0));b(N);return}b(gr(g,new Set([...y]),!0)),_(gr(w))},addSelectedEdges:y=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:g,triggerNodeChanges:b,triggerEdgeChanges:_}=m();if(v){const N=y.map(E=>Vt(E,!0));_(N);return}_(gr(w,new Set([...y]))),b(gr(g,new Set,!0))},unselectNodesAndEdges:({nodes:y,edges:v}={})=>{const{edges:w,nodes:g,nodeLookup:b,triggerNodeChanges:_,triggerEdgeChanges:N}=m(),E=y||g,I=v||w,A=E.map(T=>{const j=b.get(T.id);return j&&(j.selected=!1),Vt(T.id,!1)}),L=I.map(T=>Vt(T.id,!1));_(A),N(L)},setMinZoom:y=>{const{panZoom:v,maxZoom:w}=m();v==null||v.setScaleExtent([y,w]),p({minZoom:y})},setMaxZoom:y=>{const{panZoom:v,minZoom:w}=m();v==null||v.setScaleExtent([w,y]),p({maxZoom:y})},setTranslateExtent:y=>{var v;(v=m().panZoom)==null||v.setTranslateExtent(y),p({translateExtent:y})},resetSelectedElements:()=>{const{edges:y,nodes:v,triggerNodeChanges:w,triggerEdgeChanges:g,elementsSelectable:b}=m();if(!b)return;const _=v.reduce((E,I)=>I.selected?[...E,Vt(I.id,!1)]:E,[]),N=y.reduce((E,I)=>I.selected?[...E,Vt(I.id,!1)]:E,[]);w(_),g(N)},setNodeExtent:y=>{const{nodes:v,nodeLookup:w,parentLookup:g,nodeOrigin:b,elevateNodesOnSelect:_,nodeExtent:N,zIndexMode:E}=m();y[0][0]===N[0][0]&&y[0][1]===N[0][1]&&y[1][0]===N[1][0]&&y[1][1]===N[1][1]||(rd(v,w,g,{nodeOrigin:b,nodeExtent:y,elevateNodesOnSelect:_,checkEquality:!1,zIndexMode:E}),p({nodeExtent:y}))},panBy:y=>{const{transform:v,width:w,height:g,panZoom:b,translateExtent:_}=m();return QE({delta:y,panZoom:b,transform:v,translateExtent:_,width:w,height:g})},setCenter:async(y,v,w)=>{const{width:g,height:b,maxZoom:_,panZoom:N}=m();if(!N)return Promise.resolve(!1);const E=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:_;return await N.setViewport({x:g/2-y*E,y:b/2-v*E,zoom:E},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{p({connection:{...gy}})},updateConnection:y=>{p({connection:y})},reset:()=>p({...ah()})}},Object.is);function lj({initialNodes:e,initialEdges:t,defaultNodes:r,defaultEdges:n,initialWidth:i,initialHeight:s,initialMinZoom:a,initialMaxZoom:o,initialFitViewOptions:u,fitView:c,nodeOrigin:l,nodeExtent:d,zIndexMode:f,children:p}){const[m]=C.useState(()=>cj({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:i,height:s,fitView:c,minZoom:a,maxZoom:o,fitViewOptions:u,nodeOrigin:l,nodeExtent:d,zIndexMode:f}));return h.jsx(kC,{value:m,children:h.jsx(ZC,{children:p})})}function dj({children:e,nodes:t,edges:r,defaultNodes:n,defaultEdges:i,width:s,height:a,fitView:o,fitViewOptions:u,minZoom:c,maxZoom:l,nodeOrigin:d,nodeExtent:f,zIndexMode:p}){return C.useContext(Ei)?h.jsx(h.Fragment,{children:e}):h.jsx(lj,{initialNodes:t,initialEdges:r,defaultNodes:n,defaultEdges:i,initialWidth:s,initialHeight:a,fitView:o,initialFitViewOptions:u,initialMinZoom:c,initialMaxZoom:l,nodeOrigin:d,nodeExtent:f,zIndexMode:p,children:e})}const fj={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function hj({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,className:i,nodeTypes:s,edgeTypes:a,onNodeClick:o,onEdgeClick:u,onInit:c,onMove:l,onMoveStart:d,onMoveEnd:f,onConnect:p,onConnectStart:m,onConnectEnd:x,onClickConnectStart:y,onClickConnectEnd:v,onNodeMouseEnter:w,onNodeMouseMove:g,onNodeMouseLeave:b,onNodeContextMenu:_,onNodeDoubleClick:N,onNodeDragStart:E,onNodeDrag:I,onNodeDragStop:A,onNodesDelete:L,onEdgesDelete:T,onDelete:j,onSelectionChange:F,onSelectionDragStart:S,onSelectionDrag:D,onSelectionDragStop:O,onSelectionContextMenu:M,onSelectionStart:R,onSelectionEnd:q,onBeforeDelete:V,connectionMode:G,connectionLineType:Y=Pt.Bezier,connectionLineStyle:J,connectionLineComponent:P,connectionLineContainerStyle:B,deleteKeyCode:z="Backspace",selectionKeyCode:$="Shift",selectionOnDrag:K=!1,selectionMode:re=tn.Full,panActivationKeyCode:ee="Space",multiSelectionKeyCode:ne=nn()?"Meta":"Control",zoomActivationKeyCode:ce=nn()?"Meta":"Control",snapToGrid:ie,snapGrid:le,onlyRenderVisibleElements:oe=!1,selectNodesOnDrag:Z,nodesDraggable:de,autoPanOnNodeFocus:Le,nodesConnectable:Ne,nodesFocusable:Ae,nodeOrigin:xe=Gy,edgesFocusable:Te,edgesReconnectable:ve,elementsSelectable:Fe=!0,defaultViewport:Ve=zC,minZoom:Be=.5,maxZoom:Ye=2,translateExtent:Q=en,preventScrolling:se=!0,nodeExtent:fe,defaultMarkerColor:he="#b1b1b7",zoomOnScroll:be=!0,zoomOnPinch:ge=!0,panOnScroll:we=!1,panOnScrollSpeed:Re=.5,panOnScrollMode:ke=Kt.Free,zoomOnDoubleClick:qe=!0,panOnDrag:_e=!0,onPaneClick:Ee,onPaneMouseEnter:dt,onPaneMouseMove:Ft,onPaneMouseLeave:We,onPaneScroll:wt,onPaneContextMenu:Mr,paneClickDistance:It=1,nodeClickDistance:wn=0,children:Ge,onReconnect:Pr,onReconnectStart:_n,onReconnectEnd:$t,onEdgeContextMenu:Hi,onEdgeDoubleClick:nr,onEdgeMouseEnter:Vi,onEdgeMouseMove:zt,onEdgeMouseLeave:ir,reconnectRadius:sr=10,onNodesChange:Or,onEdgesChange:Ie,noDragClassName:Nn="nodrag",noWheelClassName:ar="nowheel",noPanClassName:Dr="nopan",fitView:or,fitViewOptions:En,connectOnClick:At,attributionPosition:Cn,proOptions:Gi,defaultEdgeOptions:Sn,elevateNodesOnSelect:Ui=!0,elevateEdgesOnSelect:ur=!1,disableKeyboardA11y:jn=!1,autoPanOnConnect:Ki,autoPanOnNodeDrag:Yi,autoPanSpeed:Wi,connectionRadius:kn,isValidConnection:Xi,onError:Je,style:Tt,id:_t,nodeDragThreshold:Zi,connectionDragThreshold:Qi,viewport:Rn,onViewportChange:Bt,width:Nt,height:Ji,colorMode:es="light",debug:ft,onScroll:ht,ariaLabelConfig:ts,zIndexMode:In="basic",...An},Tn){const Ht=_t||"1",Lr=GC(es),rs=C.useCallback(qn=>{qn.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),ht==null||ht(qn)},[ht]);return h.jsx("div",{"data-testid":"rf__wrapper",...An,onScroll:rs,style:{...Tt,...fj},ref:Tn,className:Oe(["react-flow",i,Lr]),id:_t,role:"application",children:h.jsxs(dj,{nodes:e,edges:t,width:Nt,height:Ji,fitView:or,fitViewOptions:En,minZoom:Be,maxZoom:Ye,nodeOrigin:xe,nodeExtent:fe,zIndexMode:In,children:[h.jsx(uj,{onInit:c,onNodeClick:o,onEdgeClick:u,onNodeMouseEnter:w,onNodeMouseMove:g,onNodeMouseLeave:b,onNodeContextMenu:_,onNodeDoubleClick:N,nodeTypes:s,edgeTypes:a,connectionLineType:Y,connectionLineStyle:J,connectionLineComponent:P,connectionLineContainerStyle:B,selectionKeyCode:$,selectionOnDrag:K,selectionMode:re,deleteKeyCode:z,multiSelectionKeyCode:ne,panActivationKeyCode:ee,zoomActivationKeyCode:ce,onlyRenderVisibleElements:oe,defaultViewport:Ve,translateExtent:Q,minZoom:Be,maxZoom:Ye,preventScrolling:se,zoomOnScroll:be,zoomOnPinch:ge,zoomOnDoubleClick:qe,panOnScroll:we,panOnScrollSpeed:Re,panOnScrollMode:ke,panOnDrag:_e,onPaneClick:Ee,onPaneMouseEnter:dt,onPaneMouseMove:Ft,onPaneMouseLeave:We,onPaneScroll:wt,onPaneContextMenu:Mr,paneClickDistance:It,nodeClickDistance:wn,onSelectionContextMenu:M,onSelectionStart:R,onSelectionEnd:q,onReconnect:Pr,onReconnectStart:_n,onReconnectEnd:$t,onEdgeContextMenu:Hi,onEdgeDoubleClick:nr,onEdgeMouseEnter:Vi,onEdgeMouseMove:zt,onEdgeMouseLeave:ir,reconnectRadius:sr,defaultMarkerColor:he,noDragClassName:Nn,noWheelClassName:ar,noPanClassName:Dr,rfId:Ht,disableKeyboardA11y:jn,nodeExtent:fe,viewport:Rn,onViewportChange:Bt}),h.jsx(VC,{nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:p,onConnectStart:m,onConnectEnd:x,onClickConnectStart:y,onClickConnectEnd:v,nodesDraggable:de,autoPanOnNodeFocus:Le,nodesConnectable:Ne,nodesFocusable:Ae,edgesFocusable:Te,edgesReconnectable:ve,elementsSelectable:Fe,elevateNodesOnSelect:Ui,elevateEdgesOnSelect:ur,minZoom:Be,maxZoom:Ye,nodeExtent:fe,onNodesChange:Or,onEdgesChange:Ie,snapToGrid:ie,snapGrid:le,connectionMode:G,translateExtent:Q,connectOnClick:At,defaultEdgeOptions:Sn,fitView:or,fitViewOptions:En,onNodesDelete:L,onEdgesDelete:T,onDelete:j,onNodeDragStart:E,onNodeDrag:I,onNodeDragStop:A,onSelectionDrag:D,onSelectionDragStart:S,onSelectionDragStop:O,onMove:l,onMoveStart:d,onMoveEnd:f,noPanClassName:Dr,nodeOrigin:xe,rfId:Ht,autoPanOnConnect:Ki,autoPanOnNodeDrag:Yi,autoPanSpeed:Wi,onError:Je,connectionRadius:kn,isValidConnection:Xi,selectNodesOnDrag:Z,nodeDragThreshold:Zi,connectionDragThreshold:Qi,onBeforeDelete:V,debug:ft,ariaLabelConfig:ts,zIndexMode:In}),h.jsx($C,{onSelectionChange:F}),Ge,h.jsx(PC,{proOptions:Gi,position:Cn}),h.jsx(MC,{rfId:Ht,disableKeyboardA11y:jn})]})})}var pj=Wy(hj);const gj=e=>{var t;return(t=e.domNode)==null?void 0:t.querySelector(".react-flow__edgelabel-renderer")};function mj({children:e}){const t=me(gj);return t?Hl.createPortal(e,t):null}function vj(e){const[t,r]=C.useState(e),n=C.useCallback(i=>r(s=>Ky(i,s)),[]);return[t,r,n]}function yj(e){const[t,r]=C.useState(e),n=C.useCallback(i=>r(s=>Yy(i,s)),[]);return[t,r,n]}function xj({dimensions:e,lineWidth:t,variant:r,className:n}){return h.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:Oe(["react-flow__background-pattern",r,n])})}function bj({radius:e,className:t}){return h.jsx("circle",{cx:e,cy:e,r:e,className:Oe(["react-flow__background-pattern","dots",t])})}var Ot;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ot||(Ot={}));const wj={[Ot.Dots]:1,[Ot.Lines]:1,[Ot.Cross]:6},_j=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function xx({id:e,variant:t=Ot.Dots,gap:r=20,size:n,lineWidth:i=1,offset:s=0,color:a,bgColor:o,style:u,className:c,patternClassName:l}){const d=C.useRef(null),{transform:f,patternId:p}=me(_j,Ce),m=n||wj[t],x=t===Ot.Dots,y=t===Ot.Cross,v=Array.isArray(r)?r:[r,r],w=[v[0]*f[2]||1,v[1]*f[2]||1],g=m*f[2],b=Array.isArray(s)?s:[s,s],_=y?[g,g]:w,N=[b[0]*f[2]||1+_[0]/2,b[1]*f[2]||1+_[1]/2],E=`${p}${e||""}`;return h.jsxs("svg",{className:Oe(["react-flow__background",c]),style:{...u,...Ci,"--xy-background-color-props":o,"--xy-background-pattern-color-props":a},ref:d,"data-testid":"rf__background",children:[h.jsx("pattern",{id:E,x:f[0]%w[0],y:f[1]%w[1],width:w[0],height:w[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`,children:x?h.jsx(bj,{radius:g/2,className:l}):h.jsx(xj,{dimensions:_,lineWidth:i,variant:t,className:l})}),h.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${E})`})]})}xx.displayName="Background";const Nj=C.memo(xx);function Ej(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:h.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Cj(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:h.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Sj(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:h.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function jj(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function kj(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Vn({children:e,className:t,...r}){return h.jsx("button",{type:"button",className:Oe(["react-flow__controls-button",t]),...r,children:e})}const Rj=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function bx({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:n=!0,fitViewOptions:i,onZoomIn:s,onZoomOut:a,onFitView:o,onInteractiveChange:u,className:c,children:l,position:d="bottom-left",orientation:f="vertical","aria-label":p}){const m=Se(),{isInteractive:x,minZoomReached:y,maxZoomReached:v,ariaLabelConfig:w}=me(Rj,Ce),{zoomIn:g,zoomOut:b,fitView:_}=pn(),N=()=>{g(),s==null||s()},E=()=>{b(),a==null||a()},I=()=>{_(i),o==null||o()},A=()=>{m.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),u==null||u(!x)},L=f==="horizontal"?"horizontal":"vertical";return h.jsxs(hn,{className:Oe(["react-flow__controls",L,c]),position:d,style:e,"data-testid":"rf__controls","aria-label":p??w["controls.ariaLabel"],children:[t&&h.jsxs(h.Fragment,{children:[h.jsx(Vn,{onClick:N,className:"react-flow__controls-zoomin",title:w["controls.zoomIn.ariaLabel"],"aria-label":w["controls.zoomIn.ariaLabel"],disabled:v,children:h.jsx(Ej,{})}),h.jsx(Vn,{onClick:E,className:"react-flow__controls-zoomout",title:w["controls.zoomOut.ariaLabel"],"aria-label":w["controls.zoomOut.ariaLabel"],disabled:y,children:h.jsx(Cj,{})})]}),r&&h.jsx(Vn,{className:"react-flow__controls-fitview",onClick:I,title:w["controls.fitView.ariaLabel"],"aria-label":w["controls.fitView.ariaLabel"],children:h.jsx(Sj,{})}),n&&h.jsx(Vn,{className:"react-flow__controls-interactive",onClick:A,title:w["controls.interactive.ariaLabel"],"aria-label":w["controls.interactive.ariaLabel"],children:x?h.jsx(kj,{}):h.jsx(jj,{})}),l]})}bx.displayName="Controls";C.memo(bx);function Ij({id:e,x:t,y:r,width:n,height:i,style:s,color:a,strokeColor:o,strokeWidth:u,className:c,borderRadius:l,shapeRendering:d,selected:f,onClick:p}){const{background:m,backgroundColor:x}=s||{},y=a||m||x;return h.jsx("rect",{className:Oe(["react-flow__minimap-node",{selected:f},c]),x:t,y:r,rx:l,ry:l,width:n,height:i,style:{fill:y,stroke:o,strokeWidth:u},shapeRendering:d,onClick:p?v=>p(v,e):void 0})}const Aj=C.memo(Ij),Tj=e=>e.nodes.map(t=>t.id),ys=e=>e instanceof Function?e:()=>e;function qj({nodeStrokeColor:e,nodeColor:t,nodeClassName:r="",nodeBorderRadius:n=5,nodeStrokeWidth:i,nodeComponent:s=Aj,onClick:a}){const o=me(Tj,Ce),u=ys(t),c=ys(e),l=ys(r),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return h.jsx(h.Fragment,{children:o.map(f=>h.jsx(Pj,{id:f,nodeColorFunc:u,nodeStrokeColorFunc:c,nodeClassNameFunc:l,nodeBorderRadius:n,nodeStrokeWidth:i,NodeComponent:s,onClick:a,shapeRendering:d},f))})}function Mj({id:e,nodeColorFunc:t,nodeStrokeColorFunc:r,nodeClassNameFunc:n,nodeBorderRadius:i,nodeStrokeWidth:s,shapeRendering:a,NodeComponent:o,onClick:u}){const{node:c,x:l,y:d,width:f,height:p}=me(m=>{const{internals:x}=m.nodeLookup.get(e),y=x.userNode,{x:v,y:w}=x.positionAbsolute,{width:g,height:b}=jt(y);return{node:y,x:v,y:w,width:g,height:b}},Ce);return!c||c.hidden||!_y(c)?null:h.jsx(o,{x:l,y:d,width:f,height:p,style:c.style,selected:!!c.selected,className:n(c),color:t(c),borderRadius:i,strokeColor:r(c),strokeWidth:s,shapeRendering:a,onClick:u,id:c.id})}const Pj=C.memo(Mj);var Oj=C.memo(qj);const Dj=200,Lj=150,Fj=e=>!e.hidden,$j=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?wy(ln(e.nodeLookup,{filter:Fj}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},zj="react-flow__minimap-desc";function wx({style:e,className:t,nodeStrokeColor:r,nodeColor:n,nodeClassName:i="",nodeBorderRadius:s=5,nodeStrokeWidth:a,nodeComponent:o,bgColor:u,maskColor:c,maskStrokeColor:l,maskStrokeWidth:d,position:f="bottom-right",onClick:p,onNodeClick:m,pannable:x=!1,zoomable:y=!1,ariaLabel:v,inversePan:w,zoomStep:g=1,offsetScale:b=5}){const _=Se(),N=C.useRef(null),{boundingRect:E,viewBB:I,rfId:A,panZoom:L,translateExtent:T,flowWidth:j,flowHeight:F,ariaLabelConfig:S}=me($j,Ce),D=(e==null?void 0:e.width)??Dj,O=(e==null?void 0:e.height)??Lj,M=E.width/D,R=E.height/O,q=Math.max(M,R),V=q*D,G=q*O,Y=b*q,J=E.x-(V-E.width)/2-Y,P=E.y-(G-E.height)/2-Y,B=V+Y*2,z=G+Y*2,$=`${zj}-${A}`,K=C.useRef(0),re=C.useRef();K.current=q,C.useEffect(()=>{if(N.current&&L)return re.current=oC({domNode:N.current,panZoom:L,getTransform:()=>_.getState().transform,getViewScale:()=>K.current}),()=>{var ie;(ie=re.current)==null||ie.destroy()}},[L]),C.useEffect(()=>{var ie;(ie=re.current)==null||ie.update({translateExtent:T,width:j,height:F,inversePan:w,pannable:x,zoomStep:g,zoomable:y})},[x,y,w,g,T,j,F]);const ee=p?ie=>{var Z;const[le,oe]=((Z=re.current)==null?void 0:Z.pointer(ie))||[0,0];p(ie,{x:le,y:oe})}:void 0,ne=m?C.useCallback((ie,le)=>{const oe=_.getState().nodeLookup.get(le).internals.userNode;m(ie,oe)},[]):void 0,ce=v??S["minimap.ariaLabel"];return h.jsx(hn,{position:f,style:{...e,"--xy-minimap-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*q:void 0,"--xy-minimap-node-background-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-width-props":typeof a=="number"?a:void 0},className:Oe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:h.jsxs("svg",{width:D,height:O,viewBox:`${J} ${P} ${B} ${z}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":$,ref:N,onClick:ee,children:[ce&&h.jsx("title",{id:$,children:ce}),h.jsx(Oj,{onClick:ne,nodeColor:n,nodeStrokeColor:r,nodeBorderRadius:s,nodeClassName:i,nodeStrokeWidth:a,nodeComponent:o}),h.jsx("path",{className:"react-flow__minimap-mask",d:`M${J-Y},${P-Y}h${B+Y*2}v${z+Y*2}h${-B-Y*2}z
        M${I.x},${I.y}h${I.width}v${I.height}h${-I.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}wx.displayName="MiniMap";const Bj=C.memo(wx),Hj=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Vj={[kr.Line]:"right",[kr.Handle]:"bottom-right"};function Gj({nodeId:e,position:t,variant:r=kr.Handle,className:n,style:i=void 0,children:s,color:a,minWidth:o=10,minHeight:u=10,maxWidth:c=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:f,autoScale:p=!0,shouldResize:m,onResizeStart:x,onResize:y,onResizeEnd:v}){const w=Jy(),g=typeof e=="string"?e:w,b=Se(),_=C.useRef(null),N=r===kr.Handle,E=me(C.useCallback(Hj(N&&p),[N,p]),Ce),I=C.useRef(null),A=t??Vj[r];C.useEffect(()=>{if(!(!_.current||!g))return I.current||(I.current=wC({domNode:_.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:T,transform:j,snapGrid:F,snapToGrid:S,nodeOrigin:D,domNode:O}=b.getState();return{nodeLookup:T,transform:j,snapGrid:F,snapToGrid:S,nodeOrigin:D,paneDomNode:O}},onChange:(T,j)=>{const{triggerNodeChanges:F,nodeLookup:S,parentLookup:D,nodeOrigin:O}=b.getState(),M=[],R={x:T.x,y:T.y},q=S.get(g);if(q&&q.expandParent&&q.parentId){const V=q.origin??O,G=T.width??q.measured.width??0,Y=T.height??q.measured.height??0,J={id:q.id,parentId:q.parentId,rect:{width:G,height:Y,...Ny({x:T.x??q.position.x,y:T.y??q.position.y},{width:G,height:Y},q.parentId,S,V)}},P=Rd([J],S,D,O);M.push(...P),R.x=T.x?Math.max(V[0]*G,T.x):void 0,R.y=T.y?Math.max(V[1]*Y,T.y):void 0}if(R.x!==void 0&&R.y!==void 0){const V={id:g,type:"position",position:{...R}};M.push(V)}if(T.width!==void 0&&T.height!==void 0){const G={id:g,type:"dimensions",resizing:!0,setAttributes:f?f==="horizontal"?"width":"height":!0,dimensions:{width:T.width,height:T.height}};M.push(G)}for(const V of j){const G={...V,type:"position"};M.push(G)}F(M)},onEnd:({width:T,height:j})=>{const F={id:g,type:"dimensions",resizing:!1,dimensions:{width:T,height:j}};b.getState().triggerNodeChanges([F])}})),I.current.update({controlPosition:A,boundaries:{minWidth:o,minHeight:u,maxWidth:c,maxHeight:l},keepAspectRatio:d,resizeDirection:f,onResizeStart:x,onResize:y,onResizeEnd:v,shouldResize:m}),()=>{var T;(T=I.current)==null||T.destroy()}},[A,o,u,c,l,d,x,y,v,m]);const L=A.split("-");return h.jsx("div",{className:Oe(["react-flow__resize-control","nodrag",...L,r,n]),ref:_,style:{...i,scale:E,...a&&{[N?"backgroundColor":"borderColor"]:a}},children:s})}C.memo(Gj);var xs,oh;function Uj(){if(oh)return xs;oh=1;function e(){this.__data__=[],this.size=0}return xs=e,xs}var bs,uh;function Rr(){if(uh)return bs;uh=1;function e(t,r){return t===r||t!==t&&r!==r}return bs=e,bs}var ws,ch;function Si(){if(ch)return ws;ch=1;var e=Rr();function t(r,n){for(var i=r.length;i--;)if(e(r[i][0],n))return i;return-1}return ws=t,ws}var _s,lh;function Kj(){if(lh)return _s;lh=1;var e=Si(),t=Array.prototype,r=t.splice;function n(i){var s=this.__data__,a=e(s,i);if(a<0)return!1;var o=s.length-1;return a==o?s.pop():r.call(s,a,1),--this.size,!0}return _s=n,_s}var Ns,dh;function Yj(){if(dh)return Ns;dh=1;var e=Si();function t(r){var n=this.__data__,i=e(n,r);return i<0?void 0:n[i][1]}return Ns=t,Ns}var Es,fh;function Wj(){if(fh)return Es;fh=1;var e=Si();function t(r){return e(this.__data__,r)>-1}return Es=t,Es}var Cs,hh;function Xj(){if(hh)return Cs;hh=1;var e=Si();function t(r,n){var i=this.__data__,s=e(i,r);return s<0?(++this.size,i.push([r,n])):i[s][1]=n,this}return Cs=t,Cs}var Ss,ph;function ji(){if(ph)return Ss;ph=1;var e=Uj(),t=Kj(),r=Yj(),n=Wj(),i=Xj();function s(a){var o=-1,u=a==null?0:a.length;for(this.clear();++o<u;){var c=a[o];this.set(c[0],c[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,Ss=s,Ss}var js,gh;function Zj(){if(gh)return js;gh=1;var e=ji();function t(){this.__data__=new e,this.size=0}return js=t,js}var ks,mh;function Qj(){if(mh)return ks;mh=1;function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return ks=e,ks}var Rs,vh;function Jj(){if(vh)return Rs;vh=1;function e(t){return this.__data__.get(t)}return Rs=e,Rs}var Is,yh;function e2(){if(yh)return Is;yh=1;function e(t){return this.__data__.has(t)}return Is=e,Is}var As,xh;function _x(){if(xh)return As;xh=1;var e=typeof Mn=="object"&&Mn&&Mn.Object===Object&&Mn;return As=e,As}var Ts,bh;function lt(){if(bh)return Ts;bh=1;var e=_x(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return Ts=r,Ts}var qs,wh;function Ir(){if(wh)return qs;wh=1;var e=lt(),t=e.Symbol;return qs=t,qs}var Ms,_h;function t2(){if(_h)return Ms;_h=1;var e=Ir(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,i=e?e.toStringTag:void 0;function s(a){var o=r.call(a,i),u=a[i];try{a[i]=void 0;var c=!0}catch{}var l=n.call(a);return c&&(o?a[i]=u:delete a[i]),l}return Ms=s,Ms}var Ps,Nh;function r2(){if(Nh)return Ps;Nh=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return Ps=r,Ps}var Os,Eh;function Jt(){if(Eh)return Os;Eh=1;var e=Ir(),t=t2(),r=r2(),n="[object Null]",i="[object Undefined]",s=e?e.toStringTag:void 0;function a(o){return o==null?o===void 0?i:n:s&&s in Object(o)?t(o):r(o)}return Os=a,Os}var Ds,Ch;function tt(){if(Ch)return Ds;Ch=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return Ds=e,Ds}var Ls,Sh;function mn(){if(Sh)return Ls;Sh=1;var e=Jt(),t=tt(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function a(o){if(!t(o))return!1;var u=e(o);return u==n||u==i||u==r||u==s}return Ls=a,Ls}var Fs,jh;function n2(){if(jh)return Fs;jh=1;var e=lt(),t=e["__core-js_shared__"];return Fs=t,Fs}var $s,kh;function i2(){if(kh)return $s;kh=1;var e=n2(),t=(function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!t&&t in n}return $s=r,$s}var zs,Rh;function Nx(){if(Rh)return zs;Rh=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return zs=r,zs}var Bs,Ih;function s2(){if(Ih)return Bs;Ih=1;var e=mn(),t=i2(),r=tt(),n=Nx(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,a=Function.prototype,o=Object.prototype,u=a.toString,c=o.hasOwnProperty,l=RegExp("^"+u.call(c).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d(f){if(!r(f)||t(f))return!1;var p=e(f)?l:s;return p.test(n(f))}return Bs=d,Bs}var Hs,Ah;function a2(){if(Ah)return Hs;Ah=1;function e(t,r){return t==null?void 0:t[r]}return Hs=e,Hs}var Vs,Th;function er(){if(Th)return Vs;Th=1;var e=s2(),t=a2();function r(n,i){var s=t(n,i);return e(s)?s:void 0}return Vs=r,Vs}var Gs,qh;function Ad(){if(qh)return Gs;qh=1;var e=er(),t=lt(),r=e(t,"Map");return Gs=r,Gs}var Us,Mh;function ki(){if(Mh)return Us;Mh=1;var e=er(),t=e(Object,"create");return Us=t,Us}var Ks,Ph;function o2(){if(Ph)return Ks;Ph=1;var e=ki();function t(){this.__data__=e?e(null):{},this.size=0}return Ks=t,Ks}var Ys,Oh;function u2(){if(Oh)return Ys;Oh=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Ys=e,Ys}var Ws,Dh;function c2(){if(Dh)return Ws;Dh=1;var e=ki(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(s){var a=this.__data__;if(e){var o=a[s];return o===t?void 0:o}return n.call(a,s)?a[s]:void 0}return Ws=i,Ws}var Xs,Lh;function l2(){if(Lh)return Xs;Lh=1;var e=ki(),t=Object.prototype,r=t.hasOwnProperty;function n(i){var s=this.__data__;return e?s[i]!==void 0:r.call(s,i)}return Xs=n,Xs}var Zs,Fh;function d2(){if(Fh)return Zs;Fh=1;var e=ki(),t="__lodash_hash_undefined__";function r(n,i){var s=this.__data__;return this.size+=this.has(n)?0:1,s[n]=e&&i===void 0?t:i,this}return Zs=r,Zs}var Qs,$h;function f2(){if($h)return Qs;$h=1;var e=o2(),t=u2(),r=c2(),n=l2(),i=d2();function s(a){var o=-1,u=a==null?0:a.length;for(this.clear();++o<u;){var c=a[o];this.set(c[0],c[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,Qs=s,Qs}var Js,zh;function h2(){if(zh)return Js;zh=1;var e=f2(),t=ji(),r=Ad();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Js=n,Js}var ea,Bh;function p2(){if(Bh)return ea;Bh=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return ea=e,ea}var ta,Hh;function Ri(){if(Hh)return ta;Hh=1;var e=p2();function t(r,n){var i=r.__data__;return e(n)?i[typeof n=="string"?"string":"hash"]:i.map}return ta=t,ta}var ra,Vh;function g2(){if(Vh)return ra;Vh=1;var e=Ri();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return ra=t,ra}var na,Gh;function m2(){if(Gh)return na;Gh=1;var e=Ri();function t(r){return e(this,r).get(r)}return na=t,na}var ia,Uh;function v2(){if(Uh)return ia;Uh=1;var e=Ri();function t(r){return e(this,r).has(r)}return ia=t,ia}var sa,Kh;function y2(){if(Kh)return sa;Kh=1;var e=Ri();function t(r,n){var i=e(this,r),s=i.size;return i.set(r,n),this.size+=i.size==s?0:1,this}return sa=t,sa}var aa,Yh;function Td(){if(Yh)return aa;Yh=1;var e=h2(),t=g2(),r=m2(),n=v2(),i=y2();function s(a){var o=-1,u=a==null?0:a.length;for(this.clear();++o<u;){var c=a[o];this.set(c[0],c[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,aa=s,aa}var oa,Wh;function x2(){if(Wh)return oa;Wh=1;var e=ji(),t=Ad(),r=Td(),n=200;function i(s,a){var o=this.__data__;if(o instanceof e){var u=o.__data__;if(!t||u.length<n-1)return u.push([s,a]),this.size=++o.size,this;o=this.__data__=new r(u)}return o.set(s,a),this.size=o.size,this}return oa=i,oa}var ua,Xh;function Ii(){if(Xh)return ua;Xh=1;var e=ji(),t=Zj(),r=Qj(),n=Jj(),i=e2(),s=x2();function a(o){var u=this.__data__=new e(o);this.size=u.size}return a.prototype.clear=t,a.prototype.delete=r,a.prototype.get=n,a.prototype.has=i,a.prototype.set=s,ua=a,ua}var ca,Zh;function qd(){if(Zh)return ca;Zh=1;function e(t,r){for(var n=-1,i=t==null?0:t.length;++n<i&&r(t[n],n,t)!==!1;);return t}return ca=e,ca}var la,Qh;function Ex(){if(Qh)return la;Qh=1;var e=er(),t=(function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}})();return la=t,la}var da,Jh;function Ai(){if(Jh)return da;Jh=1;var e=Ex();function t(r,n,i){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return da=t,da}var fa,ep;function Ti(){if(ep)return fa;ep=1;var e=Ai(),t=Rr(),r=Object.prototype,n=r.hasOwnProperty;function i(s,a,o){var u=s[a];(!(n.call(s,a)&&t(u,o))||o===void 0&&!(a in s))&&e(s,a,o)}return fa=i,fa}var ha,tp;function vn(){if(tp)return ha;tp=1;var e=Ti(),t=Ai();function r(n,i,s,a){var o=!s;s||(s={});for(var u=-1,c=i.length;++u<c;){var l=i[u],d=a?a(s[l],n[l],l,s,n):void 0;d===void 0&&(d=n[l]),o?t(s,l,d):e(s,l,d)}return s}return ha=r,ha}var pa,rp;function b2(){if(rp)return pa;rp=1;function e(t,r){for(var n=-1,i=Array(t);++n<t;)i[n]=r(n);return i}return pa=e,pa}var ga,np;function bt(){if(np)return ga;np=1;function e(t){return t!=null&&typeof t=="object"}return ga=e,ga}var ma,ip;function w2(){if(ip)return ma;ip=1;var e=Jt(),t=bt(),r="[object Arguments]";function n(i){return t(i)&&e(i)==r}return ma=n,ma}var va,sp;function yn(){if(sp)return va;sp=1;var e=w2(),t=bt(),r=Object.prototype,n=r.hasOwnProperty,i=r.propertyIsEnumerable,s=e((function(){return arguments})())?e:function(a){return t(a)&&n.call(a,"callee")&&!i.call(a,"callee")};return va=s,va}var ya,ap;function De(){if(ap)return ya;ap=1;var e=Array.isArray;return ya=e,ya}var Hr={exports:{}},xa,op;function _2(){if(op)return xa;op=1;function e(){return!1}return xa=e,xa}Hr.exports;var up;function Ar(){return up||(up=1,(function(e,t){var r=lt(),n=_2(),i=t&&!t.nodeType&&t,s=i&&!0&&e&&!e.nodeType&&e,a=s&&s.exports===i,o=a?r.Buffer:void 0,u=o?o.isBuffer:void 0,c=u||n;e.exports=c})(Hr,Hr.exports)),Hr.exports}var ba,cp;function qi(){if(cp)return ba;cp=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,i){var s=typeof n;return i=i??e,!!i&&(s=="number"||s!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<i}return ba=r,ba}var wa,lp;function Md(){if(lp)return wa;lp=1;var e=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=e}return wa=t,wa}var _a,dp;function N2(){if(dp)return _a;dp=1;var e=Jt(),t=Md(),r=bt(),n="[object Arguments]",i="[object Array]",s="[object Boolean]",a="[object Date]",o="[object Error]",u="[object Function]",c="[object Map]",l="[object Number]",d="[object Object]",f="[object RegExp]",p="[object Set]",m="[object String]",x="[object WeakMap]",y="[object ArrayBuffer]",v="[object DataView]",w="[object Float32Array]",g="[object Float64Array]",b="[object Int8Array]",_="[object Int16Array]",N="[object Int32Array]",E="[object Uint8Array]",I="[object Uint8ClampedArray]",A="[object Uint16Array]",L="[object Uint32Array]",T={};T[w]=T[g]=T[b]=T[_]=T[N]=T[E]=T[I]=T[A]=T[L]=!0,T[n]=T[i]=T[y]=T[s]=T[v]=T[a]=T[o]=T[u]=T[c]=T[l]=T[d]=T[f]=T[p]=T[m]=T[x]=!1;function j(F){return r(F)&&t(F.length)&&!!T[e(F)]}return _a=j,_a}var Na,fp;function Mi(){if(fp)return Na;fp=1;function e(t){return function(r){return t(r)}}return Na=e,Na}var Vr={exports:{}};Vr.exports;var hp;function Pd(){return hp||(hp=1,(function(e,t){var r=_x(),n=t&&!t.nodeType&&t,i=n&&!0&&e&&!e.nodeType&&e,s=i&&i.exports===n,a=s&&r.process,o=(function(){try{var u=i&&i.require&&i.require("util").types;return u||a&&a.binding&&a.binding("util")}catch{}})();e.exports=o})(Vr,Vr.exports)),Vr.exports}var Ea,pp;function xn(){if(pp)return Ea;pp=1;var e=N2(),t=Mi(),r=Pd(),n=r&&r.isTypedArray,i=n?t(n):e;return Ea=i,Ea}var Ca,gp;function Cx(){if(gp)return Ca;gp=1;var e=b2(),t=yn(),r=De(),n=Ar(),i=qi(),s=xn(),a=Object.prototype,o=a.hasOwnProperty;function u(c,l){var d=r(c),f=!d&&t(c),p=!d&&!f&&n(c),m=!d&&!f&&!p&&s(c),x=d||f||p||m,y=x?e(c.length,String):[],v=y.length;for(var w in c)(l||o.call(c,w))&&!(x&&(w=="length"||p&&(w=="offset"||w=="parent")||m&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||i(w,v)))&&y.push(w);return y}return Ca=u,Ca}var Sa,mp;function Pi(){if(mp)return Sa;mp=1;var e=Object.prototype;function t(r){var n=r&&r.constructor,i=typeof n=="function"&&n.prototype||e;return r===i}return Sa=t,Sa}var ja,vp;function Sx(){if(vp)return ja;vp=1;function e(t,r){return function(n){return t(r(n))}}return ja=e,ja}var ka,yp;function E2(){if(yp)return ka;yp=1;var e=Sx(),t=e(Object.keys,Object);return ka=t,ka}var Ra,xp;function Od(){if(xp)return Ra;xp=1;var e=Pi(),t=E2(),r=Object.prototype,n=r.hasOwnProperty;function i(s){if(!e(s))return t(s);var a=[];for(var o in Object(s))n.call(s,o)&&o!="constructor"&&a.push(o);return a}return Ra=i,Ra}var Ia,bp;function kt(){if(bp)return Ia;bp=1;var e=mn(),t=Md();function r(n){return n!=null&&t(n.length)&&!e(n)}return Ia=r,Ia}var Aa,wp;function Lt(){if(wp)return Aa;wp=1;var e=Cx(),t=Od(),r=kt();function n(i){return r(i)?e(i):t(i)}return Aa=n,Aa}var Ta,_p;function C2(){if(_p)return Ta;_p=1;var e=vn(),t=Lt();function r(n,i){return n&&e(i,t(i),n)}return Ta=r,Ta}var qa,Np;function S2(){if(Np)return qa;Np=1;function e(t){var r=[];if(t!=null)for(var n in Object(t))r.push(n);return r}return qa=e,qa}var Ma,Ep;function j2(){if(Ep)return Ma;Ep=1;var e=tt(),t=Pi(),r=S2(),n=Object.prototype,i=n.hasOwnProperty;function s(a){if(!e(a))return r(a);var o=t(a),u=[];for(var c in a)c=="constructor"&&(o||!i.call(a,c))||u.push(c);return u}return Ma=s,Ma}var Pa,Cp;function tr(){if(Cp)return Pa;Cp=1;var e=Cx(),t=j2(),r=kt();function n(i){return r(i)?e(i,!0):t(i)}return Pa=n,Pa}var Oa,Sp;function k2(){if(Sp)return Oa;Sp=1;var e=vn(),t=tr();function r(n,i){return n&&e(i,t(i),n)}return Oa=r,Oa}var Gr={exports:{}};Gr.exports;var jp;function jx(){return jp||(jp=1,(function(e,t){var r=lt(),n=t&&!t.nodeType&&t,i=n&&!0&&e&&!e.nodeType&&e,s=i&&i.exports===n,a=s?r.Buffer:void 0,o=a?a.allocUnsafe:void 0;function u(c,l){if(l)return c.slice();var d=c.length,f=o?o(d):new c.constructor(d);return c.copy(f),f}e.exports=u})(Gr,Gr.exports)),Gr.exports}var Da,kp;function kx(){if(kp)return Da;kp=1;function e(t,r){var n=-1,i=t.length;for(r||(r=Array(i));++n<i;)r[n]=t[n];return r}return Da=e,Da}var La,Rp;function Rx(){if(Rp)return La;Rp=1;function e(t,r){for(var n=-1,i=t==null?0:t.length,s=0,a=[];++n<i;){var o=t[n];r(o,n,t)&&(a[s++]=o)}return a}return La=e,La}var Fa,Ip;function Ix(){if(Ip)return Fa;Ip=1;function e(){return[]}return Fa=e,Fa}var $a,Ap;function Dd(){if(Ap)return $a;Ap=1;var e=Rx(),t=Ix(),r=Object.prototype,n=r.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(a){return a==null?[]:(a=Object(a),e(i(a),function(o){return n.call(a,o)}))}:t;return $a=s,$a}var za,Tp;function R2(){if(Tp)return za;Tp=1;var e=vn(),t=Dd();function r(n,i){return e(n,t(n),i)}return za=r,za}var Ba,qp;function Ld(){if(qp)return Ba;qp=1;function e(t,r){for(var n=-1,i=r.length,s=t.length;++n<i;)t[s+n]=r[n];return t}return Ba=e,Ba}var Ha,Mp;function Oi(){if(Mp)return Ha;Mp=1;var e=Sx(),t=e(Object.getPrototypeOf,Object);return Ha=t,Ha}var Va,Pp;function Ax(){if(Pp)return Va;Pp=1;var e=Ld(),t=Oi(),r=Dd(),n=Ix(),i=Object.getOwnPropertySymbols,s=i?function(a){for(var o=[];a;)e(o,r(a)),a=t(a);return o}:n;return Va=s,Va}var Ga,Op;function I2(){if(Op)return Ga;Op=1;var e=vn(),t=Ax();function r(n,i){return e(n,t(n),i)}return Ga=r,Ga}var Ua,Dp;function Tx(){if(Dp)return Ua;Dp=1;var e=Ld(),t=De();function r(n,i,s){var a=i(n);return t(n)?a:e(a,s(n))}return Ua=r,Ua}var Ka,Lp;function qx(){if(Lp)return Ka;Lp=1;var e=Tx(),t=Dd(),r=Lt();function n(i){return e(i,r,t)}return Ka=n,Ka}var Ya,Fp;function A2(){if(Fp)return Ya;Fp=1;var e=Tx(),t=Ax(),r=tr();function n(i){return e(i,r,t)}return Ya=n,Ya}var Wa,$p;function T2(){if($p)return Wa;$p=1;var e=er(),t=lt(),r=e(t,"DataView");return Wa=r,Wa}var Xa,zp;function q2(){if(zp)return Xa;zp=1;var e=er(),t=lt(),r=e(t,"Promise");return Xa=r,Xa}var Za,Bp;function Mx(){if(Bp)return Za;Bp=1;var e=er(),t=lt(),r=e(t,"Set");return Za=r,Za}var Qa,Hp;function M2(){if(Hp)return Qa;Hp=1;var e=er(),t=lt(),r=e(t,"WeakMap");return Qa=r,Qa}var Ja,Vp;function Tr(){if(Vp)return Ja;Vp=1;var e=T2(),t=Ad(),r=q2(),n=Mx(),i=M2(),s=Jt(),a=Nx(),o="[object Map]",u="[object Object]",c="[object Promise]",l="[object Set]",d="[object WeakMap]",f="[object DataView]",p=a(e),m=a(t),x=a(r),y=a(n),v=a(i),w=s;return(e&&w(new e(new ArrayBuffer(1)))!=f||t&&w(new t)!=o||r&&w(r.resolve())!=c||n&&w(new n)!=l||i&&w(new i)!=d)&&(w=function(g){var b=s(g),_=b==u?g.constructor:void 0,N=_?a(_):"";if(N)switch(N){case p:return f;case m:return o;case x:return c;case y:return l;case v:return d}return b}),Ja=w,Ja}var eo,Gp;function P2(){if(Gp)return eo;Gp=1;var e=Object.prototype,t=e.hasOwnProperty;function r(n){var i=n.length,s=new n.constructor(i);return i&&typeof n[0]=="string"&&t.call(n,"index")&&(s.index=n.index,s.input=n.input),s}return eo=r,eo}var to,Up;function Px(){if(Up)return to;Up=1;var e=lt(),t=e.Uint8Array;return to=t,to}var ro,Kp;function Fd(){if(Kp)return ro;Kp=1;var e=Px();function t(r){var n=new r.constructor(r.byteLength);return new e(n).set(new e(r)),n}return ro=t,ro}var no,Yp;function O2(){if(Yp)return no;Yp=1;var e=Fd();function t(r,n){var i=n?e(r.buffer):r.buffer;return new r.constructor(i,r.byteOffset,r.byteLength)}return no=t,no}var io,Wp;function D2(){if(Wp)return io;Wp=1;var e=/\w*$/;function t(r){var n=new r.constructor(r.source,e.exec(r));return n.lastIndex=r.lastIndex,n}return io=t,io}var so,Xp;function L2(){if(Xp)return so;Xp=1;var e=Ir(),t=e?e.prototype:void 0,r=t?t.valueOf:void 0;function n(i){return r?Object(r.call(i)):{}}return so=n,so}var ao,Zp;function Ox(){if(Zp)return ao;Zp=1;var e=Fd();function t(r,n){var i=n?e(r.buffer):r.buffer;return new r.constructor(i,r.byteOffset,r.length)}return ao=t,ao}var oo,Qp;function F2(){if(Qp)return oo;Qp=1;var e=Fd(),t=O2(),r=D2(),n=L2(),i=Ox(),s="[object Boolean]",a="[object Date]",o="[object Map]",u="[object Number]",c="[object RegExp]",l="[object Set]",d="[object String]",f="[object Symbol]",p="[object ArrayBuffer]",m="[object DataView]",x="[object Float32Array]",y="[object Float64Array]",v="[object Int8Array]",w="[object Int16Array]",g="[object Int32Array]",b="[object Uint8Array]",_="[object Uint8ClampedArray]",N="[object Uint16Array]",E="[object Uint32Array]";function I(A,L,T){var j=A.constructor;switch(L){case p:return e(A);case s:case a:return new j(+A);case m:return t(A,T);case x:case y:case v:case w:case g:case b:case _:case N:case E:return i(A,T);case o:return new j;case u:case d:return new j(A);case c:return r(A);case l:return new j;case f:return n(A)}}return oo=I,oo}var uo,Jp;function Dx(){if(Jp)return uo;Jp=1;var e=tt(),t=Object.create,r=(function(){function n(){}return function(i){if(!e(i))return{};if(t)return t(i);n.prototype=i;var s=new n;return n.prototype=void 0,s}})();return uo=r,uo}var co,eg;function Lx(){if(eg)return co;eg=1;var e=Dx(),t=Oi(),r=Pi();function n(i){return typeof i.constructor=="function"&&!r(i)?e(t(i)):{}}return co=n,co}var lo,tg;function $2(){if(tg)return lo;tg=1;var e=Tr(),t=bt(),r="[object Map]";function n(i){return t(i)&&e(i)==r}return lo=n,lo}var fo,rg;function z2(){if(rg)return fo;rg=1;var e=$2(),t=Mi(),r=Pd(),n=r&&r.isMap,i=n?t(n):e;return fo=i,fo}var ho,ng;function B2(){if(ng)return ho;ng=1;var e=Tr(),t=bt(),r="[object Set]";function n(i){return t(i)&&e(i)==r}return ho=n,ho}var po,ig;function H2(){if(ig)return po;ig=1;var e=B2(),t=Mi(),r=Pd(),n=r&&r.isSet,i=n?t(n):e;return po=i,po}var go,sg;function Fx(){if(sg)return go;sg=1;var e=Ii(),t=qd(),r=Ti(),n=C2(),i=k2(),s=jx(),a=kx(),o=R2(),u=I2(),c=qx(),l=A2(),d=Tr(),f=P2(),p=F2(),m=Lx(),x=De(),y=Ar(),v=z2(),w=tt(),g=H2(),b=Lt(),_=tr(),N=1,E=2,I=4,A="[object Arguments]",L="[object Array]",T="[object Boolean]",j="[object Date]",F="[object Error]",S="[object Function]",D="[object GeneratorFunction]",O="[object Map]",M="[object Number]",R="[object Object]",q="[object RegExp]",V="[object Set]",G="[object String]",Y="[object Symbol]",J="[object WeakMap]",P="[object ArrayBuffer]",B="[object DataView]",z="[object Float32Array]",$="[object Float64Array]",K="[object Int8Array]",re="[object Int16Array]",ee="[object Int32Array]",ne="[object Uint8Array]",ce="[object Uint8ClampedArray]",ie="[object Uint16Array]",le="[object Uint32Array]",oe={};oe[A]=oe[L]=oe[P]=oe[B]=oe[T]=oe[j]=oe[z]=oe[$]=oe[K]=oe[re]=oe[ee]=oe[O]=oe[M]=oe[R]=oe[q]=oe[V]=oe[G]=oe[Y]=oe[ne]=oe[ce]=oe[ie]=oe[le]=!0,oe[F]=oe[S]=oe[J]=!1;function Z(de,Le,Ne,Ae,xe,Te){var ve,Fe=Le&N,Ve=Le&E,Be=Le&I;if(Ne&&(ve=xe?Ne(de,Ae,xe,Te):Ne(de)),ve!==void 0)return ve;if(!w(de))return de;var Ye=x(de);if(Ye){if(ve=f(de),!Fe)return a(de,ve)}else{var Q=d(de),se=Q==S||Q==D;if(y(de))return s(de,Fe);if(Q==R||Q==A||se&&!xe){if(ve=Ve||se?{}:m(de),!Fe)return Ve?u(de,i(ve,de)):o(de,n(ve,de))}else{if(!oe[Q])return xe?de:{};ve=p(de,Q,Fe)}}Te||(Te=new e);var fe=Te.get(de);if(fe)return fe;Te.set(de,ve),g(de)?de.forEach(function(ge){ve.add(Z(ge,Le,Ne,ge,de,Te))}):v(de)&&de.forEach(function(ge,we){ve.set(we,Z(ge,Le,Ne,we,de,Te))});var he=Be?Ve?l:c:Ve?_:b,be=Ye?void 0:he(de);return t(be||de,function(ge,we){be&&(we=ge,ge=de[we]),r(ve,we,Z(ge,Le,Ne,we,de,Te))}),ve}return go=Z,go}var mo,ag;function V2(){if(ag)return mo;ag=1;var e=Fx(),t=4;function r(n){return e(n,t)}return mo=r,mo}var vo,og;function $d(){if(og)return vo;og=1;function e(t){return function(){return t}}return vo=e,vo}var yo,ug;function G2(){if(ug)return yo;ug=1;function e(t){return function(r,n,i){for(var s=-1,a=Object(r),o=i(r),u=o.length;u--;){var c=o[t?u:++s];if(n(a[c],c,a)===!1)break}return r}}return yo=e,yo}var xo,cg;function zd(){if(cg)return xo;cg=1;var e=G2(),t=e();return xo=t,xo}var bo,lg;function Bd(){if(lg)return bo;lg=1;var e=zd(),t=Lt();function r(n,i){return n&&e(n,i,t)}return bo=r,bo}var wo,dg;function U2(){if(dg)return wo;dg=1;var e=kt();function t(r,n){return function(i,s){if(i==null)return i;if(!e(i))return r(i,s);for(var a=i.length,o=n?a:-1,u=Object(i);(n?o--:++o<a)&&s(u[o],o,u)!==!1;);return i}}return wo=t,wo}var _o,fg;function Di(){if(fg)return _o;fg=1;var e=Bd(),t=U2(),r=t(e);return _o=r,_o}var No,hg;function rr(){if(hg)return No;hg=1;function e(t){return t}return No=e,No}var Eo,pg;function $x(){if(pg)return Eo;pg=1;var e=rr();function t(r){return typeof r=="function"?r:e}return Eo=t,Eo}var Co,gg;function zx(){if(gg)return Co;gg=1;var e=qd(),t=Di(),r=$x(),n=De();function i(s,a){var o=n(s)?e:t;return o(s,r(a))}return Co=i,Co}var So,mg;function Bx(){return mg||(mg=1,So=zx()),So}var jo,vg;function K2(){if(vg)return jo;vg=1;var e=Di();function t(r,n){var i=[];return e(r,function(s,a,o){n(s,a,o)&&i.push(s)}),i}return jo=t,jo}var ko,yg;function Y2(){if(yg)return ko;yg=1;var e="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,e),this}return ko=t,ko}var Ro,xg;function W2(){if(xg)return Ro;xg=1;function e(t){return this.__data__.has(t)}return Ro=e,Ro}var Io,bg;function Hx(){if(bg)return Io;bg=1;var e=Td(),t=Y2(),r=W2();function n(i){var s=-1,a=i==null?0:i.length;for(this.__data__=new e;++s<a;)this.add(i[s])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,Io=n,Io}var Ao,wg;function X2(){if(wg)return Ao;wg=1;function e(t,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(t[n],n,t))return!0;return!1}return Ao=e,Ao}var To,_g;function Vx(){if(_g)return To;_g=1;function e(t,r){return t.has(r)}return To=e,To}var qo,Ng;function Gx(){if(Ng)return qo;Ng=1;var e=Hx(),t=X2(),r=Vx(),n=1,i=2;function s(a,o,u,c,l,d){var f=u&n,p=a.length,m=o.length;if(p!=m&&!(f&&m>p))return!1;var x=d.get(a),y=d.get(o);if(x&&y)return x==o&&y==a;var v=-1,w=!0,g=u&i?new e:void 0;for(d.set(a,o),d.set(o,a);++v<p;){var b=a[v],_=o[v];if(c)var N=f?c(_,b,v,o,a,d):c(b,_,v,a,o,d);if(N!==void 0){if(N)continue;w=!1;break}if(g){if(!t(o,function(E,I){if(!r(g,I)&&(b===E||l(b,E,u,c,d)))return g.push(I)})){w=!1;break}}else if(!(b===_||l(b,_,u,c,d))){w=!1;break}}return d.delete(a),d.delete(o),w}return qo=s,qo}var Mo,Eg;function Z2(){if(Eg)return Mo;Eg=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(i,s){n[++r]=[s,i]}),n}return Mo=e,Mo}var Po,Cg;function Hd(){if(Cg)return Po;Cg=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(i){n[++r]=i}),n}return Po=e,Po}var Oo,Sg;function Q2(){if(Sg)return Oo;Sg=1;var e=Ir(),t=Px(),r=Rr(),n=Gx(),i=Z2(),s=Hd(),a=1,o=2,u="[object Boolean]",c="[object Date]",l="[object Error]",d="[object Map]",f="[object Number]",p="[object RegExp]",m="[object Set]",x="[object String]",y="[object Symbol]",v="[object ArrayBuffer]",w="[object DataView]",g=e?e.prototype:void 0,b=g?g.valueOf:void 0;function _(N,E,I,A,L,T,j){switch(I){case w:if(N.byteLength!=E.byteLength||N.byteOffset!=E.byteOffset)return!1;N=N.buffer,E=E.buffer;case v:return!(N.byteLength!=E.byteLength||!T(new t(N),new t(E)));case u:case c:case f:return r(+N,+E);case l:return N.name==E.name&&N.message==E.message;case p:case x:return N==E+"";case d:var F=i;case m:var S=A&a;if(F||(F=s),N.size!=E.size&&!S)return!1;var D=j.get(N);if(D)return D==E;A|=o,j.set(N,E);var O=n(F(N),F(E),A,L,T,j);return j.delete(N),O;case y:if(b)return b.call(N)==b.call(E)}return!1}return Oo=_,Oo}var Do,jg;function J2(){if(jg)return Do;jg=1;var e=qx(),t=1,r=Object.prototype,n=r.hasOwnProperty;function i(s,a,o,u,c,l){var d=o&t,f=e(s),p=f.length,m=e(a),x=m.length;if(p!=x&&!d)return!1;for(var y=p;y--;){var v=f[y];if(!(d?v in a:n.call(a,v)))return!1}var w=l.get(s),g=l.get(a);if(w&&g)return w==a&&g==s;var b=!0;l.set(s,a),l.set(a,s);for(var _=d;++y<p;){v=f[y];var N=s[v],E=a[v];if(u)var I=d?u(E,N,v,a,s,l):u(N,E,v,s,a,l);if(!(I===void 0?N===E||c(N,E,o,u,l):I)){b=!1;break}_||(_=v=="constructor")}if(b&&!_){var A=s.constructor,L=a.constructor;A!=L&&"constructor"in s&&"constructor"in a&&!(typeof A=="function"&&A instanceof A&&typeof L=="function"&&L instanceof L)&&(b=!1)}return l.delete(s),l.delete(a),b}return Do=i,Do}var Lo,kg;function ek(){if(kg)return Lo;kg=1;var e=Ii(),t=Gx(),r=Q2(),n=J2(),i=Tr(),s=De(),a=Ar(),o=xn(),u=1,c="[object Arguments]",l="[object Array]",d="[object Object]",f=Object.prototype,p=f.hasOwnProperty;function m(x,y,v,w,g,b){var _=s(x),N=s(y),E=_?l:i(x),I=N?l:i(y);E=E==c?d:E,I=I==c?d:I;var A=E==d,L=I==d,T=E==I;if(T&&a(x)){if(!a(y))return!1;_=!0,A=!1}if(T&&!A)return b||(b=new e),_||o(x)?t(x,y,v,w,g,b):r(x,y,E,v,w,g,b);if(!(v&u)){var j=A&&p.call(x,"__wrapped__"),F=L&&p.call(y,"__wrapped__");if(j||F){var S=j?x.value():x,D=F?y.value():y;return b||(b=new e),g(S,D,v,w,b)}}return T?(b||(b=new e),n(x,y,v,w,g,b)):!1}return Lo=m,Lo}var Fo,Rg;function Ux(){if(Rg)return Fo;Rg=1;var e=ek(),t=bt();function r(n,i,s,a,o){return n===i?!0:n==null||i==null||!t(n)&&!t(i)?n!==n&&i!==i:e(n,i,s,a,r,o)}return Fo=r,Fo}var $o,Ig;function tk(){if(Ig)return $o;Ig=1;var e=Ii(),t=Ux(),r=1,n=2;function i(s,a,o,u){var c=o.length,l=c,d=!u;if(s==null)return!l;for(s=Object(s);c--;){var f=o[c];if(d&&f[2]?f[1]!==s[f[0]]:!(f[0]in s))return!1}for(;++c<l;){f=o[c];var p=f[0],m=s[p],x=f[1];if(d&&f[2]){if(m===void 0&&!(p in s))return!1}else{var y=new e;if(u)var v=u(m,x,p,s,a,y);if(!(v===void 0?t(x,m,r|n,u,y):v))return!1}}return!0}return $o=i,$o}var zo,Ag;function Kx(){if(Ag)return zo;Ag=1;var e=tt();function t(r){return r===r&&!e(r)}return zo=t,zo}var Bo,Tg;function rk(){if(Tg)return Bo;Tg=1;var e=Kx(),t=Lt();function r(n){for(var i=t(n),s=i.length;s--;){var a=i[s],o=n[a];i[s]=[a,o,e(o)]}return i}return Bo=r,Bo}var Ho,qg;function Yx(){if(qg)return Ho;qg=1;function e(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return Ho=e,Ho}var Vo,Mg;function nk(){if(Mg)return Vo;Mg=1;var e=tk(),t=rk(),r=Yx();function n(i){var s=t(i);return s.length==1&&s[0][2]?r(s[0][0],s[0][1]):function(a){return a===i||e(a,i,s)}}return Vo=n,Vo}var Go,Pg;function qr(){if(Pg)return Go;Pg=1;var e=Jt(),t=bt(),r="[object Symbol]";function n(i){return typeof i=="symbol"||t(i)&&e(i)==r}return Go=n,Go}var Uo,Og;function Vd(){if(Og)return Uo;Og=1;var e=De(),t=qr(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(s,a){if(e(s))return!1;var o=typeof s;return o=="number"||o=="symbol"||o=="boolean"||s==null||t(s)?!0:n.test(s)||!r.test(s)||a!=null&&s in Object(a)}return Uo=i,Uo}var Ko,Dg;function ik(){if(Dg)return Ko;Dg=1;var e=Td(),t="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(t);var s=function(){var a=arguments,o=i?i.apply(this,a):a[0],u=s.cache;if(u.has(o))return u.get(o);var c=n.apply(this,a);return s.cache=u.set(o,c)||u,c};return s.cache=new(r.Cache||e),s}return r.Cache=e,Ko=r,Ko}var Yo,Lg;function sk(){if(Lg)return Yo;Lg=1;var e=ik(),t=500;function r(n){var i=e(n,function(a){return s.size===t&&s.clear(),a}),s=i.cache;return i}return Yo=r,Yo}var Wo,Fg;function ak(){if(Fg)return Wo;Fg=1;var e=sk(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(t,function(a,o,u,c){s.push(u?c.replace(r,"$1"):o||a)}),s});return Wo=n,Wo}var Xo,$g;function Li(){if($g)return Xo;$g=1;function e(t,r){for(var n=-1,i=t==null?0:t.length,s=Array(i);++n<i;)s[n]=r(t[n],n,t);return s}return Xo=e,Xo}var Zo,zg;function ok(){if(zg)return Zo;zg=1;var e=Ir(),t=Li(),r=De(),n=qr(),i=e?e.prototype:void 0,s=i?i.toString:void 0;function a(o){if(typeof o=="string")return o;if(r(o))return t(o,a)+"";if(n(o))return s?s.call(o):"";var u=o+"";return u=="0"&&1/o==-1/0?"-0":u}return Zo=a,Zo}var Qo,Bg;function Wx(){if(Bg)return Qo;Bg=1;var e=ok();function t(r){return r==null?"":e(r)}return Qo=t,Qo}var Jo,Hg;function Fi(){if(Hg)return Jo;Hg=1;var e=De(),t=Vd(),r=ak(),n=Wx();function i(s,a){return e(s)?s:t(s,a)?[s]:r(n(s))}return Jo=i,Jo}var eu,Vg;function bn(){if(Vg)return eu;Vg=1;var e=qr();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return eu=t,eu}var tu,Gg;function $i(){if(Gg)return tu;Gg=1;var e=Fi(),t=bn();function r(n,i){i=e(i,n);for(var s=0,a=i.length;n!=null&&s<a;)n=n[t(i[s++])];return s&&s==a?n:void 0}return tu=r,tu}var ru,Ug;function uk(){if(Ug)return ru;Ug=1;var e=$i();function t(r,n,i){var s=r==null?void 0:e(r,n);return s===void 0?i:s}return ru=t,ru}var nu,Kg;function ck(){if(Kg)return nu;Kg=1;function e(t,r){return t!=null&&r in Object(t)}return nu=e,nu}var iu,Yg;function Xx(){if(Yg)return iu;Yg=1;var e=Fi(),t=yn(),r=De(),n=qi(),i=Md(),s=bn();function a(o,u,c){u=e(u,o);for(var l=-1,d=u.length,f=!1;++l<d;){var p=s(u[l]);if(!(f=o!=null&&c(o,p)))break;o=o[p]}return f||++l!=d?f:(d=o==null?0:o.length,!!d&&i(d)&&n(p,d)&&(r(o)||t(o)))}return iu=a,iu}var su,Wg;function Zx(){if(Wg)return su;Wg=1;var e=ck(),t=Xx();function r(n,i){return n!=null&&t(n,i,e)}return su=r,su}var au,Xg;function lk(){if(Xg)return au;Xg=1;var e=Ux(),t=uk(),r=Zx(),n=Vd(),i=Kx(),s=Yx(),a=bn(),o=1,u=2;function c(l,d){return n(l)&&i(d)?s(a(l),d):function(f){var p=t(f,l);return p===void 0&&p===d?r(f,l):e(d,p,o|u)}}return au=c,au}var ou,Zg;function Qx(){if(Zg)return ou;Zg=1;function e(t){return function(r){return r==null?void 0:r[t]}}return ou=e,ou}var uu,Qg;function dk(){if(Qg)return uu;Qg=1;var e=$i();function t(r){return function(n){return e(n,r)}}return uu=t,uu}var cu,Jg;function fk(){if(Jg)return cu;Jg=1;var e=Qx(),t=dk(),r=Vd(),n=bn();function i(s){return r(s)?e(n(s)):t(s)}return cu=i,cu}var lu,em;function Rt(){if(em)return lu;em=1;var e=nk(),t=lk(),r=rr(),n=De(),i=fk();function s(a){return typeof a=="function"?a:a==null?r:typeof a=="object"?n(a)?t(a[0],a[1]):e(a):i(a)}return lu=s,lu}var du,tm;function Jx(){if(tm)return du;tm=1;var e=Rx(),t=K2(),r=Rt(),n=De();function i(s,a){var o=n(s)?e:t;return o(s,r(a,3))}return du=i,du}var fu,rm;function hk(){if(rm)return fu;rm=1;var e=Object.prototype,t=e.hasOwnProperty;function r(n,i){return n!=null&&t.call(n,i)}return fu=r,fu}var hu,nm;function eb(){if(nm)return hu;nm=1;var e=hk(),t=Xx();function r(n,i){return n!=null&&t(n,i,e)}return hu=r,hu}var pu,im;function pk(){if(im)return pu;im=1;var e=Od(),t=Tr(),r=yn(),n=De(),i=kt(),s=Ar(),a=Pi(),o=xn(),u="[object Map]",c="[object Set]",l=Object.prototype,d=l.hasOwnProperty;function f(p){if(p==null)return!0;if(i(p)&&(n(p)||typeof p=="string"||typeof p.splice=="function"||s(p)||o(p)||r(p)))return!p.length;var m=t(p);if(m==u||m==c)return!p.size;if(a(p))return!e(p).length;for(var x in p)if(d.call(p,x))return!1;return!0}return pu=f,pu}var gu,sm;function tb(){if(sm)return gu;sm=1;function e(t){return t===void 0}return gu=e,gu}var mu,am;function rb(){if(am)return mu;am=1;var e=Di(),t=kt();function r(n,i){var s=-1,a=t(n)?Array(n.length):[];return e(n,function(o,u,c){a[++s]=i(o,u,c)}),a}return mu=r,mu}var vu,om;function nb(){if(om)return vu;om=1;var e=Li(),t=Rt(),r=rb(),n=De();function i(s,a){var o=n(s)?e:r;return o(s,t(a,3))}return vu=i,vu}var yu,um;function gk(){if(um)return yu;um=1;function e(t,r,n,i){var s=-1,a=t==null?0:t.length;for(i&&a&&(n=t[++s]);++s<a;)n=r(n,t[s],s,t);return n}return yu=e,yu}var xu,cm;function mk(){if(cm)return xu;cm=1;function e(t,r,n,i,s){return s(t,function(a,o,u){n=i?(i=!1,a):r(n,a,o,u)}),n}return xu=e,xu}var bu,lm;function ib(){if(lm)return bu;lm=1;var e=gk(),t=Di(),r=Rt(),n=mk(),i=De();function s(a,o,u){var c=i(a)?e:n,l=arguments.length<3;return c(a,r(o,4),u,l,t)}return bu=s,bu}var wu,dm;function vk(){if(dm)return wu;dm=1;var e=Jt(),t=De(),r=bt(),n="[object String]";function i(s){return typeof s=="string"||!t(s)&&r(s)&&e(s)==n}return wu=i,wu}var _u,fm;function yk(){if(fm)return _u;fm=1;var e=Qx(),t=e("length");return _u=t,_u}var Nu,hm;function xk(){if(hm)return Nu;hm=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=t+r+n,s="\\ufe0e\\ufe0f",a="\\u200d",o=RegExp("["+a+e+i+s+"]");function u(c){return o.test(c)}return Nu=u,Nu}var Eu,pm;function bk(){if(pm)return Eu;pm=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=t+r+n,s="\\ufe0e\\ufe0f",a="["+e+"]",o="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",c="(?:"+o+"|"+u+")",l="[^"+e+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",f="[\\ud800-\\udbff][\\udc00-\\udfff]",p="\\u200d",m=c+"?",x="["+s+"]?",y="(?:"+p+"(?:"+[l,d,f].join("|")+")"+x+m+")*",v=x+m+y,w="(?:"+[l+o+"?",o,d,f,a].join("|")+")",g=RegExp(u+"(?="+u+")|"+w+v,"g");function b(_){for(var N=g.lastIndex=0;g.test(_);)++N;return N}return Eu=b,Eu}var Cu,gm;function wk(){if(gm)return Cu;gm=1;var e=yk(),t=xk(),r=bk();function n(i){return t(i)?r(i):e(i)}return Cu=n,Cu}var Su,mm;function _k(){if(mm)return Su;mm=1;var e=Od(),t=Tr(),r=kt(),n=vk(),i=wk(),s="[object Map]",a="[object Set]";function o(u){if(u==null)return 0;if(r(u))return n(u)?i(u):u.length;var c=t(u);return c==s||c==a?u.size:e(u).length}return Su=o,Su}var ju,vm;function Nk(){if(vm)return ju;vm=1;var e=qd(),t=Dx(),r=Bd(),n=Rt(),i=Oi(),s=De(),a=Ar(),o=mn(),u=tt(),c=xn();function l(d,f,p){var m=s(d),x=m||a(d)||c(d);if(f=n(f,4),p==null){var y=d&&d.constructor;x?p=m?new y:[]:u(d)?p=o(y)?t(i(d)):{}:p={}}return(x?e:r)(d,function(v,w,g){return f(p,v,w,g)}),p}return ju=l,ju}var ku,ym;function Ek(){if(ym)return ku;ym=1;var e=Ir(),t=yn(),r=De(),n=e?e.isConcatSpreadable:void 0;function i(s){return r(s)||t(s)||!!(n&&s&&s[n])}return ku=i,ku}var Ru,xm;function Gd(){if(xm)return Ru;xm=1;var e=Ld(),t=Ek();function r(n,i,s,a,o){var u=-1,c=n.length;for(s||(s=t),o||(o=[]);++u<c;){var l=n[u];i>0&&s(l)?i>1?r(l,i-1,s,a,o):e(o,l):a||(o[o.length]=l)}return o}return Ru=r,Ru}var Iu,bm;function Ck(){if(bm)return Iu;bm=1;function e(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return Iu=e,Iu}var Au,wm;function sb(){if(wm)return Au;wm=1;var e=Ck(),t=Math.max;function r(n,i,s){return i=t(i===void 0?n.length-1:i,0),function(){for(var a=arguments,o=-1,u=t(a.length-i,0),c=Array(u);++o<u;)c[o]=a[i+o];o=-1;for(var l=Array(i+1);++o<i;)l[o]=a[o];return l[i]=s(c),e(n,this,l)}}return Au=r,Au}var Tu,_m;function Sk(){if(_m)return Tu;_m=1;var e=$d(),t=Ex(),r=rr(),n=t?function(i,s){return t(i,"toString",{configurable:!0,enumerable:!1,value:e(s),writable:!0})}:r;return Tu=n,Tu}var qu,Nm;function jk(){if(Nm)return qu;Nm=1;var e=800,t=16,r=Date.now;function n(i){var s=0,a=0;return function(){var o=r(),u=t-(o-a);if(a=o,u>0){if(++s>=e)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return qu=n,qu}var Mu,Em;function ab(){if(Em)return Mu;Em=1;var e=Sk(),t=jk(),r=t(e);return Mu=r,Mu}var Pu,Cm;function zi(){if(Cm)return Pu;Cm=1;var e=rr(),t=sb(),r=ab();function n(i,s){return r(t(i,s,e),i+"")}return Pu=n,Pu}var Ou,Sm;function ob(){if(Sm)return Ou;Sm=1;function e(t,r,n,i){for(var s=t.length,a=n+(i?1:-1);i?a--:++a<s;)if(r(t[a],a,t))return a;return-1}return Ou=e,Ou}var Du,jm;function kk(){if(jm)return Du;jm=1;function e(t){return t!==t}return Du=e,Du}var Lu,km;function Rk(){if(km)return Lu;km=1;function e(t,r,n){for(var i=n-1,s=t.length;++i<s;)if(t[i]===r)return i;return-1}return Lu=e,Lu}var Fu,Rm;function Ik(){if(Rm)return Fu;Rm=1;var e=ob(),t=kk(),r=Rk();function n(i,s,a){return s===s?r(i,s,a):e(i,t,a)}return Fu=n,Fu}var $u,Im;function Ak(){if(Im)return $u;Im=1;var e=Ik();function t(r,n){var i=r==null?0:r.length;return!!i&&e(r,n,0)>-1}return $u=t,$u}var zu,Am;function Tk(){if(Am)return zu;Am=1;function e(t,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;)if(n(r,t[i]))return!0;return!1}return zu=e,zu}var Bu,Tm;function qk(){if(Tm)return Bu;Tm=1;function e(){}return Bu=e,Bu}var Hu,qm;function Mk(){if(qm)return Hu;qm=1;var e=Mx(),t=qk(),r=Hd(),n=1/0,i=e&&1/r(new e([,-0]))[1]==n?function(s){return new e(s)}:t;return Hu=i,Hu}var Vu,Mm;function Pk(){if(Mm)return Vu;Mm=1;var e=Hx(),t=Ak(),r=Tk(),n=Vx(),i=Mk(),s=Hd(),a=200;function o(u,c,l){var d=-1,f=t,p=u.length,m=!0,x=[],y=x;if(l)m=!1,f=r;else if(p>=a){var v=c?null:i(u);if(v)return s(v);m=!1,f=n,y=new e}else y=c?[]:x;e:for(;++d<p;){var w=u[d],g=c?c(w):w;if(w=l||w!==0?w:0,m&&g===g){for(var b=y.length;b--;)if(y[b]===g)continue e;c&&y.push(g),x.push(w)}else f(y,g,l)||(y!==x&&y.push(g),x.push(w))}return x}return Vu=o,Vu}var Gu,Pm;function ub(){if(Pm)return Gu;Pm=1;var e=kt(),t=bt();function r(n){return t(n)&&e(n)}return Gu=r,Gu}var Uu,Om;function Ok(){if(Om)return Uu;Om=1;var e=Gd(),t=zi(),r=Pk(),n=ub(),i=t(function(s){return r(e(s,1,n,!0))});return Uu=i,Uu}var Ku,Dm;function Dk(){if(Dm)return Ku;Dm=1;var e=Li();function t(r,n){return e(n,function(i){return r[i]})}return Ku=t,Ku}var Yu,Lm;function cb(){if(Lm)return Yu;Lm=1;var e=Dk(),t=Lt();function r(n){return n==null?[]:e(n,t(n))}return Yu=r,Yu}var Wu,Fm;function rt(){if(Fm)return Wu;Fm=1;var e;if(typeof cd=="function")try{e={clone:V2(),constant:$d(),each:Bx(),filter:Jx(),has:eb(),isArray:De(),isEmpty:pk(),isFunction:mn(),isUndefined:tb(),keys:Lt(),map:nb(),reduce:ib(),size:_k(),transform:Nk(),union:Ok(),values:cb()}}catch{}return e||(e=window._),Wu=e,Wu}var Xu,$m;function Ud(){if($m)return Xu;$m=1;var e=rt();Xu=i;var t="\0",r="\0",n="";function i(l){this._isDirected=e.has(l,"directed")?l.directed:!0,this._isMultigraph=e.has(l,"multigraph")?l.multigraph:!1,this._isCompound=e.has(l,"compound")?l.compound:!1,this._label=void 0,this._defaultNodeLabelFn=e.constant(void 0),this._defaultEdgeLabelFn=e.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[r]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(l){return this._label=l,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(l){return e.isFunction(l)||(l=e.constant(l)),this._defaultNodeLabelFn=l,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return e.keys(this._nodes)},i.prototype.sources=function(){var l=this;return e.filter(this.nodes(),function(d){return e.isEmpty(l._in[d])})},i.prototype.sinks=function(){var l=this;return e.filter(this.nodes(),function(d){return e.isEmpty(l._out[d])})},i.prototype.setNodes=function(l,d){var f=arguments,p=this;return e.each(l,function(m){f.length>1?p.setNode(m,d):p.setNode(m)}),this},i.prototype.setNode=function(l,d){return e.has(this._nodes,l)?(arguments.length>1&&(this._nodes[l]=d),this):(this._nodes[l]=arguments.length>1?d:this._defaultNodeLabelFn(l),this._isCompound&&(this._parent[l]=r,this._children[l]={},this._children[r][l]=!0),this._in[l]={},this._preds[l]={},this._out[l]={},this._sucs[l]={},++this._nodeCount,this)},i.prototype.node=function(l){return this._nodes[l]},i.prototype.hasNode=function(l){return e.has(this._nodes,l)},i.prototype.removeNode=function(l){var d=this;if(e.has(this._nodes,l)){var f=function(p){d.removeEdge(d._edgeObjs[p])};delete this._nodes[l],this._isCompound&&(this._removeFromParentsChildList(l),delete this._parent[l],e.each(this.children(l),function(p){d.setParent(p)}),delete this._children[l]),e.each(e.keys(this._in[l]),f),delete this._in[l],delete this._preds[l],e.each(e.keys(this._out[l]),f),delete this._out[l],delete this._sucs[l],--this._nodeCount}return this},i.prototype.setParent=function(l,d){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(e.isUndefined(d))d=r;else{d+="";for(var f=d;!e.isUndefined(f);f=this.parent(f))if(f===l)throw new Error("Setting "+d+" as parent of "+l+" would create a cycle");this.setNode(d)}return this.setNode(l),this._removeFromParentsChildList(l),this._parent[l]=d,this._children[d][l]=!0,this},i.prototype._removeFromParentsChildList=function(l){delete this._children[this._parent[l]][l]},i.prototype.parent=function(l){if(this._isCompound){var d=this._parent[l];if(d!==r)return d}},i.prototype.children=function(l){if(e.isUndefined(l)&&(l=r),this._isCompound){var d=this._children[l];if(d)return e.keys(d)}else{if(l===r)return this.nodes();if(this.hasNode(l))return[]}},i.prototype.predecessors=function(l){var d=this._preds[l];if(d)return e.keys(d)},i.prototype.successors=function(l){var d=this._sucs[l];if(d)return e.keys(d)},i.prototype.neighbors=function(l){var d=this.predecessors(l);if(d)return e.union(d,this.successors(l))},i.prototype.isLeaf=function(l){var d;return this.isDirected()?d=this.successors(l):d=this.neighbors(l),d.length===0},i.prototype.filterNodes=function(l){var d=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});d.setGraph(this.graph());var f=this;e.each(this._nodes,function(x,y){l(y)&&d.setNode(y,x)}),e.each(this._edgeObjs,function(x){d.hasNode(x.v)&&d.hasNode(x.w)&&d.setEdge(x,f.edge(x))});var p={};function m(x){var y=f.parent(x);return y===void 0||d.hasNode(y)?(p[x]=y,y):y in p?p[y]:m(y)}return this._isCompound&&e.each(d.nodes(),function(x){d.setParent(x,m(x))}),d},i.prototype.setDefaultEdgeLabel=function(l){return e.isFunction(l)||(l=e.constant(l)),this._defaultEdgeLabelFn=l,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return e.values(this._edgeObjs)},i.prototype.setPath=function(l,d){var f=this,p=arguments;return e.reduce(l,function(m,x){return p.length>1?f.setEdge(m,x,d):f.setEdge(m,x),x}),this},i.prototype.setEdge=function(){var l,d,f,p,m=!1,x=arguments[0];typeof x=="object"&&x!==null&&"v"in x?(l=x.v,d=x.w,f=x.name,arguments.length===2&&(p=arguments[1],m=!0)):(l=x,d=arguments[1],f=arguments[3],arguments.length>2&&(p=arguments[2],m=!0)),l=""+l,d=""+d,e.isUndefined(f)||(f=""+f);var y=o(this._isDirected,l,d,f);if(e.has(this._edgeLabels,y))return m&&(this._edgeLabels[y]=p),this;if(!e.isUndefined(f)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(l),this.setNode(d),this._edgeLabels[y]=m?p:this._defaultEdgeLabelFn(l,d,f);var v=u(this._isDirected,l,d,f);return l=v.v,d=v.w,Object.freeze(v),this._edgeObjs[y]=v,s(this._preds[d],l),s(this._sucs[l],d),this._in[d][y]=v,this._out[l][y]=v,this._edgeCount++,this},i.prototype.edge=function(l,d,f){var p=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,l,d,f);return this._edgeLabels[p]},i.prototype.hasEdge=function(l,d,f){var p=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,l,d,f);return e.has(this._edgeLabels,p)},i.prototype.removeEdge=function(l,d,f){var p=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,l,d,f),m=this._edgeObjs[p];return m&&(l=m.v,d=m.w,delete this._edgeLabels[p],delete this._edgeObjs[p],a(this._preds[d],l),a(this._sucs[l],d),delete this._in[d][p],delete this._out[l][p],this._edgeCount--),this},i.prototype.inEdges=function(l,d){var f=this._in[l];if(f){var p=e.values(f);return d?e.filter(p,function(m){return m.v===d}):p}},i.prototype.outEdges=function(l,d){var f=this._out[l];if(f){var p=e.values(f);return d?e.filter(p,function(m){return m.w===d}):p}},i.prototype.nodeEdges=function(l,d){var f=this.inEdges(l,d);if(f)return f.concat(this.outEdges(l,d))};function s(l,d){l[d]?l[d]++:l[d]=1}function a(l,d){--l[d]||delete l[d]}function o(l,d,f,p){var m=""+d,x=""+f;if(!l&&m>x){var y=m;m=x,x=y}return m+n+x+n+(e.isUndefined(p)?t:p)}function u(l,d,f,p){var m=""+d,x=""+f;if(!l&&m>x){var y=m;m=x,x=y}var v={v:m,w:x};return p&&(v.name=p),v}function c(l,d){return o(l,d.v,d.w,d.name)}return Xu}var Zu,zm;function Lk(){return zm||(zm=1,Zu="2.1.8"),Zu}var Qu,Bm;function Fk(){return Bm||(Bm=1,Qu={Graph:Ud(),version:Lk()}),Qu}var Ju,Hm;function $k(){if(Hm)return Ju;Hm=1;var e=rt(),t=Ud();Ju={write:r,read:s};function r(a){var o={options:{directed:a.isDirected(),multigraph:a.isMultigraph(),compound:a.isCompound()},nodes:n(a),edges:i(a)};return e.isUndefined(a.graph())||(o.value=e.clone(a.graph())),o}function n(a){return e.map(a.nodes(),function(o){var u=a.node(o),c=a.parent(o),l={v:o};return e.isUndefined(u)||(l.value=u),e.isUndefined(c)||(l.parent=c),l})}function i(a){return e.map(a.edges(),function(o){var u=a.edge(o),c={v:o.v,w:o.w};return e.isUndefined(o.name)||(c.name=o.name),e.isUndefined(u)||(c.value=u),c})}function s(a){var o=new t(a.options).setGraph(a.value);return e.each(a.nodes,function(u){o.setNode(u.v,u.value),u.parent&&o.setParent(u.v,u.parent)}),e.each(a.edges,function(u){o.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),o}return Ju}var ec,Vm;function zk(){if(Vm)return ec;Vm=1;var e=rt();ec=t;function t(r){var n={},i=[],s;function a(o){e.has(n,o)||(n[o]=!0,s.push(o),e.each(r.successors(o),a),e.each(r.predecessors(o),a))}return e.each(r.nodes(),function(o){s=[],a(o),s.length&&i.push(s)}),i}return ec}var tc,Gm;function lb(){if(Gm)return tc;Gm=1;var e=rt();tc=t;function t(){this._arr=[],this._keyIndices={}}return t.prototype.size=function(){return this._arr.length},t.prototype.keys=function(){return this._arr.map(function(r){return r.key})},t.prototype.has=function(r){return e.has(this._keyIndices,r)},t.prototype.priority=function(r){var n=this._keyIndices[r];if(n!==void 0)return this._arr[n].priority},t.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},t.prototype.add=function(r,n){var i=this._keyIndices;if(r=String(r),!e.has(i,r)){var s=this._arr,a=s.length;return i[r]=a,s.push({key:r,priority:n}),this._decrease(a),!0}return!1},t.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var r=this._arr.pop();return delete this._keyIndices[r.key],this._heapify(0),r.key},t.prototype.decrease=function(r,n){var i=this._keyIndices[r];if(n>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+r+" Old: "+this._arr[i].priority+" New: "+n);this._arr[i].priority=n,this._decrease(i)},t.prototype._heapify=function(r){var n=this._arr,i=2*r,s=i+1,a=r;i<n.length&&(a=n[i].priority<n[a].priority?i:a,s<n.length&&(a=n[s].priority<n[a].priority?s:a),a!==r&&(this._swap(r,a),this._heapify(a)))},t.prototype._decrease=function(r){for(var n=this._arr,i=n[r].priority,s;r!==0&&(s=r>>1,!(n[s].priority<i));)this._swap(r,s),r=s},t.prototype._swap=function(r,n){var i=this._arr,s=this._keyIndices,a=i[r],o=i[n];i[r]=o,i[n]=a,s[o.key]=r,s[a.key]=n},tc}var rc,Um;function db(){if(Um)return rc;Um=1;var e=rt(),t=lb();rc=n;var r=e.constant(1);function n(s,a,o,u){return i(s,String(a),o||r,u||function(c){return s.outEdges(c)})}function i(s,a,o,u){var c={},l=new t,d,f,p=function(m){var x=m.v!==d?m.v:m.w,y=c[x],v=o(m),w=f.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+v);w<y.distance&&(y.distance=w,y.predecessor=d,l.decrease(x,w))};for(s.nodes().forEach(function(m){var x=m===a?0:Number.POSITIVE_INFINITY;c[m]={distance:x},l.add(m,x)});l.size()>0&&(d=l.removeMin(),f=c[d],f.distance!==Number.POSITIVE_INFINITY);)u(d).forEach(p);return c}return rc}var nc,Km;function Bk(){if(Km)return nc;Km=1;var e=db(),t=rt();nc=r;function r(n,i,s){return t.transform(n.nodes(),function(a,o){a[o]=e(n,o,i,s)},{})}return nc}var ic,Ym;function fb(){if(Ym)return ic;Ym=1;var e=rt();ic=t;function t(r){var n=0,i=[],s={},a=[];function o(u){var c=s[u]={onStack:!0,lowlink:n,index:n++};if(i.push(u),r.successors(u).forEach(function(f){e.has(s,f)?s[f].onStack&&(c.lowlink=Math.min(c.lowlink,s[f].index)):(o(f),c.lowlink=Math.min(c.lowlink,s[f].lowlink))}),c.lowlink===c.index){var l=[],d;do d=i.pop(),s[d].onStack=!1,l.push(d);while(u!==d);a.push(l)}}return r.nodes().forEach(function(u){e.has(s,u)||o(u)}),a}return ic}var sc,Wm;function Hk(){if(Wm)return sc;Wm=1;var e=rt(),t=fb();sc=r;function r(n){return e.filter(t(n),function(i){return i.length>1||i.length===1&&n.hasEdge(i[0],i[0])})}return sc}var ac,Xm;function Vk(){if(Xm)return ac;Xm=1;var e=rt();ac=r;var t=e.constant(1);function r(i,s,a){return n(i,s||t,a||function(o){return i.outEdges(o)})}function n(i,s,a){var o={},u=i.nodes();return u.forEach(function(c){o[c]={},o[c][c]={distance:0},u.forEach(function(l){c!==l&&(o[c][l]={distance:Number.POSITIVE_INFINITY})}),a(c).forEach(function(l){var d=l.v===c?l.w:l.v,f=s(l);o[c][d]={distance:f,predecessor:c}})}),u.forEach(function(c){var l=o[c];u.forEach(function(d){var f=o[d];u.forEach(function(p){var m=f[c],x=l[p],y=f[p],v=m.distance+x.distance;v<y.distance&&(y.distance=v,y.predecessor=x.predecessor)})})}),o}return ac}var oc,Zm;function hb(){if(Zm)return oc;Zm=1;var e=rt();oc=t,t.CycleException=r;function t(n){var i={},s={},a=[];function o(u){if(e.has(s,u))throw new r;e.has(i,u)||(s[u]=!0,i[u]=!0,e.each(n.predecessors(u),o),delete s[u],a.push(u))}if(e.each(n.sinks(),o),e.size(i)!==n.nodeCount())throw new r;return a}function r(){}return r.prototype=new Error,oc}var uc,Qm;function Gk(){if(Qm)return uc;Qm=1;var e=hb();uc=t;function t(r){try{e(r)}catch(n){if(n instanceof e.CycleException)return!1;throw n}return!0}return uc}var cc,Jm;function pb(){if(Jm)return cc;Jm=1;var e=rt();cc=t;function t(n,i,s){e.isArray(i)||(i=[i]);var a=(n.isDirected()?n.successors:n.neighbors).bind(n),o=[],u={};return e.each(i,function(c){if(!n.hasNode(c))throw new Error("Graph does not have node: "+c);r(n,c,s==="post",u,a,o)}),o}function r(n,i,s,a,o,u){e.has(a,i)||(a[i]=!0,s||u.push(i),e.each(o(i),function(c){r(n,c,s,a,o,u)}),s&&u.push(i))}return cc}var lc,ev;function Uk(){if(ev)return lc;ev=1;var e=pb();lc=t;function t(r,n){return e(r,n,"post")}return lc}var dc,tv;function Kk(){if(tv)return dc;tv=1;var e=pb();dc=t;function t(r,n){return e(r,n,"pre")}return dc}var fc,rv;function Yk(){if(rv)return fc;rv=1;var e=rt(),t=Ud(),r=lb();fc=n;function n(i,s){var a=new t,o={},u=new r,c;function l(f){var p=f.v===c?f.w:f.v,m=u.priority(p);if(m!==void 0){var x=s(f);x<m&&(o[p]=c,u.decrease(p,x))}}if(i.nodeCount()===0)return a;e.each(i.nodes(),function(f){u.add(f,Number.POSITIVE_INFINITY),a.setNode(f)}),u.decrease(i.nodes()[0],0);for(var d=!1;u.size()>0;){if(c=u.removeMin(),e.has(o,c))a.setEdge(c,o[c]);else{if(d)throw new Error("Input graph is not connected: "+i);d=!0}i.nodeEdges(c).forEach(l)}return a}return fc}var hc,nv;function Wk(){return nv||(nv=1,hc={components:zk(),dijkstra:db(),dijkstraAll:Bk(),findCycles:Hk(),floydWarshall:Vk(),isAcyclic:Gk(),postorder:Uk(),preorder:Kk(),prim:Yk(),tarjan:fb(),topsort:hb()}),hc}var pc,iv;function Xk(){if(iv)return pc;iv=1;var e=Fk();return pc={Graph:e.Graph,json:$k(),alg:Wk(),version:e.version},pc}var gc,sv;function ut(){if(sv)return gc;sv=1;var e;if(typeof cd=="function")try{e=Xk()}catch{}return e||(e=window.graphlib),gc=e,gc}var mc,av;function Zk(){if(av)return mc;av=1;var e=Fx(),t=1,r=4;function n(i){return e(i,t|r)}return mc=n,mc}var vc,ov;function Bi(){if(ov)return vc;ov=1;var e=Rr(),t=kt(),r=qi(),n=tt();function i(s,a,o){if(!n(o))return!1;var u=typeof a;return(u=="number"?t(o)&&r(a,o.length):u=="string"&&a in o)?e(o[a],s):!1}return vc=i,vc}var yc,uv;function Qk(){if(uv)return yc;uv=1;var e=zi(),t=Rr(),r=Bi(),n=tr(),i=Object.prototype,s=i.hasOwnProperty,a=e(function(o,u){o=Object(o);var c=-1,l=u.length,d=l>2?u[2]:void 0;for(d&&r(u[0],u[1],d)&&(l=1);++c<l;)for(var f=u[c],p=n(f),m=-1,x=p.length;++m<x;){var y=p[m],v=o[y];(v===void 0||t(v,i[y])&&!s.call(o,y))&&(o[y]=f[y])}return o});return yc=a,yc}var xc,cv;function Jk(){if(cv)return xc;cv=1;var e=Rt(),t=kt(),r=Lt();function n(i){return function(s,a,o){var u=Object(s);if(!t(s)){var c=e(a,3);s=r(s),a=function(d){return c(u[d],d,u)}}var l=i(s,a,o);return l>-1?u[c?s[l]:l]:void 0}}return xc=n,xc}var bc,lv;function eR(){if(lv)return bc;lv=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return bc=t,bc}var wc,dv;function tR(){if(dv)return wc;dv=1;var e=eR(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return wc=r,wc}var _c,fv;function rR(){if(fv)return _c;fv=1;var e=tR(),t=tt(),r=qr(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt;function u(c){if(typeof c=="number")return c;if(r(c))return n;if(t(c)){var l=typeof c.valueOf=="function"?c.valueOf():c;c=t(l)?l+"":l}if(typeof c!="string")return c===0?c:+c;c=e(c);var d=s.test(c);return d||a.test(c)?o(c.slice(2),d?2:8):i.test(c)?n:+c}return _c=u,_c}var Nc,hv;function gb(){if(hv)return Nc;hv=1;var e=rR(),t=1/0,r=17976931348623157e292;function n(i){if(!i)return i===0?i:0;if(i=e(i),i===t||i===-t){var s=i<0?-1:1;return s*r}return i===i?i:0}return Nc=n,Nc}var Ec,pv;function nR(){if(pv)return Ec;pv=1;var e=gb();function t(r){var n=e(r),i=n%1;return n===n?i?n-i:n:0}return Ec=t,Ec}var Cc,gv;function iR(){if(gv)return Cc;gv=1;var e=ob(),t=Rt(),r=nR(),n=Math.max;function i(s,a,o){var u=s==null?0:s.length;if(!u)return-1;var c=o==null?0:r(o);return c<0&&(c=n(u+c,0)),e(s,t(a,3),c)}return Cc=i,Cc}var Sc,mv;function sR(){if(mv)return Sc;mv=1;var e=Jk(),t=iR(),r=e(t);return Sc=r,Sc}var jc,vv;function mb(){if(vv)return jc;vv=1;var e=Gd();function t(r){var n=r==null?0:r.length;return n?e(r,1):[]}return jc=t,jc}var kc,yv;function aR(){if(yv)return kc;yv=1;var e=zd(),t=$x(),r=tr();function n(i,s){return i==null?i:e(i,t(s),r)}return kc=n,kc}var Rc,xv;function oR(){if(xv)return Rc;xv=1;function e(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return Rc=e,Rc}var Ic,bv;function uR(){if(bv)return Ic;bv=1;var e=Ai(),t=Bd(),r=Rt();function n(i,s){var a={};return s=r(s,3),t(i,function(o,u,c){e(a,u,s(o,u,c))}),a}return Ic=n,Ic}var Ac,wv;function Kd(){if(wv)return Ac;wv=1;var e=qr();function t(r,n,i){for(var s=-1,a=r.length;++s<a;){var o=r[s],u=n(o);if(u!=null&&(c===void 0?u===u&&!e(u):i(u,c)))var c=u,l=o}return l}return Ac=t,Ac}var Tc,_v;function cR(){if(_v)return Tc;_v=1;function e(t,r){return t>r}return Tc=e,Tc}var qc,Nv;function lR(){if(Nv)return qc;Nv=1;var e=Kd(),t=cR(),r=rr();function n(i){return i&&i.length?e(i,r,t):void 0}return qc=n,qc}var Mc,Ev;function vb(){if(Ev)return Mc;Ev=1;var e=Ai(),t=Rr();function r(n,i,s){(s!==void 0&&!t(n[i],s)||s===void 0&&!(i in n))&&e(n,i,s)}return Mc=r,Mc}var Pc,Cv;function dR(){if(Cv)return Pc;Cv=1;var e=Jt(),t=Oi(),r=bt(),n="[object Object]",i=Function.prototype,s=Object.prototype,a=i.toString,o=s.hasOwnProperty,u=a.call(Object);function c(l){if(!r(l)||e(l)!=n)return!1;var d=t(l);if(d===null)return!0;var f=o.call(d,"constructor")&&d.constructor;return typeof f=="function"&&f instanceof f&&a.call(f)==u}return Pc=c,Pc}var Oc,Sv;function yb(){if(Sv)return Oc;Sv=1;function e(t,r){if(!(r==="constructor"&&typeof t[r]=="function")&&r!="__proto__")return t[r]}return Oc=e,Oc}var Dc,jv;function fR(){if(jv)return Dc;jv=1;var e=vn(),t=tr();function r(n){return e(n,t(n))}return Dc=r,Dc}var Lc,kv;function hR(){if(kv)return Lc;kv=1;var e=vb(),t=jx(),r=Ox(),n=kx(),i=Lx(),s=yn(),a=De(),o=ub(),u=Ar(),c=mn(),l=tt(),d=dR(),f=xn(),p=yb(),m=fR();function x(y,v,w,g,b,_,N){var E=p(y,w),I=p(v,w),A=N.get(I);if(A){e(y,w,A);return}var L=_?_(E,I,w+"",y,v,N):void 0,T=L===void 0;if(T){var j=a(I),F=!j&&u(I),S=!j&&!F&&f(I);L=I,j||F||S?a(E)?L=E:o(E)?L=n(E):F?(T=!1,L=t(I,!0)):S?(T=!1,L=r(I,!0)):L=[]:d(I)||s(I)?(L=E,s(E)?L=m(E):(!l(E)||c(E))&&(L=i(I))):T=!1}T&&(N.set(I,L),b(L,I,g,_,N),N.delete(I)),e(y,w,L)}return Lc=x,Lc}var Fc,Rv;function pR(){if(Rv)return Fc;Rv=1;var e=Ii(),t=vb(),r=zd(),n=hR(),i=tt(),s=tr(),a=yb();function o(u,c,l,d,f){u!==c&&r(c,function(p,m){if(f||(f=new e),i(p))n(u,c,m,l,o,d,f);else{var x=d?d(a(u,m),p,m+"",u,c,f):void 0;x===void 0&&(x=p),t(u,m,x)}},s)}return Fc=o,Fc}var $c,Iv;function gR(){if(Iv)return $c;Iv=1;var e=zi(),t=Bi();function r(n){return e(function(i,s){var a=-1,o=s.length,u=o>1?s[o-1]:void 0,c=o>2?s[2]:void 0;for(u=n.length>3&&typeof u=="function"?(o--,u):void 0,c&&t(s[0],s[1],c)&&(u=o<3?void 0:u,o=1),i=Object(i);++a<o;){var l=s[a];l&&n(i,l,a,u)}return i})}return $c=r,$c}var zc,Av;function mR(){if(Av)return zc;Av=1;var e=pR(),t=gR(),r=t(function(n,i,s){e(n,i,s)});return zc=r,zc}var Bc,Tv;function xb(){if(Tv)return Bc;Tv=1;function e(t,r){return t<r}return Bc=e,Bc}var Hc,qv;function vR(){if(qv)return Hc;qv=1;var e=Kd(),t=xb(),r=rr();function n(i){return i&&i.length?e(i,r,t):void 0}return Hc=n,Hc}var Vc,Mv;function yR(){if(Mv)return Vc;Mv=1;var e=Kd(),t=Rt(),r=xb();function n(i,s){return i&&i.length?e(i,t(s,2),r):void 0}return Vc=n,Vc}var Gc,Pv;function xR(){if(Pv)return Gc;Pv=1;var e=lt(),t=function(){return e.Date.now()};return Gc=t,Gc}var Uc,Ov;function bR(){if(Ov)return Uc;Ov=1;var e=Ti(),t=Fi(),r=qi(),n=tt(),i=bn();function s(a,o,u,c){if(!n(a))return a;o=t(o,a);for(var l=-1,d=o.length,f=d-1,p=a;p!=null&&++l<d;){var m=i(o[l]),x=u;if(m==="__proto__"||m==="constructor"||m==="prototype")return a;if(l!=f){var y=p[m];x=c?c(y,m,p):void 0,x===void 0&&(x=n(y)?y:r(o[l+1])?[]:{})}e(p,m,x),p=p[m]}return a}return Uc=s,Uc}var Kc,Dv;function wR(){if(Dv)return Kc;Dv=1;var e=$i(),t=bR(),r=Fi();function n(i,s,a){for(var o=-1,u=s.length,c={};++o<u;){var l=s[o],d=e(i,l);a(d,l)&&t(c,r(l,i),d)}return c}return Kc=n,Kc}var Yc,Lv;function _R(){if(Lv)return Yc;Lv=1;var e=wR(),t=Zx();function r(n,i){return e(n,i,function(s,a){return t(n,a)})}return Yc=r,Yc}var Wc,Fv;function NR(){if(Fv)return Wc;Fv=1;var e=mb(),t=sb(),r=ab();function n(i){return r(t(i,void 0,e),i+"")}return Wc=n,Wc}var Xc,$v;function ER(){if($v)return Xc;$v=1;var e=_R(),t=NR(),r=t(function(n,i){return n==null?{}:e(n,i)});return Xc=r,Xc}var Zc,zv;function CR(){if(zv)return Zc;zv=1;var e=Math.ceil,t=Math.max;function r(n,i,s,a){for(var o=-1,u=t(e((i-n)/(s||1)),0),c=Array(u);u--;)c[a?u:++o]=n,n+=s;return c}return Zc=r,Zc}var Qc,Bv;function SR(){if(Bv)return Qc;Bv=1;var e=CR(),t=Bi(),r=gb();function n(i){return function(s,a,o){return o&&typeof o!="number"&&t(s,a,o)&&(a=o=void 0),s=r(s),a===void 0?(a=s,s=0):a=r(a),o=o===void 0?s<a?1:-1:r(o),e(s,a,o,i)}}return Qc=n,Qc}var Jc,Hv;function jR(){if(Hv)return Jc;Hv=1;var e=SR(),t=e();return Jc=t,Jc}var el,Vv;function kR(){if(Vv)return el;Vv=1;function e(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return el=e,el}var tl,Gv;function RR(){if(Gv)return tl;Gv=1;var e=qr();function t(r,n){if(r!==n){var i=r!==void 0,s=r===null,a=r===r,o=e(r),u=n!==void 0,c=n===null,l=n===n,d=e(n);if(!c&&!d&&!o&&r>n||o&&u&&l&&!c&&!d||s&&u&&l||!i&&l||!a)return 1;if(!s&&!o&&!d&&r<n||d&&i&&a&&!s&&!o||c&&i&&a||!u&&a||!l)return-1}return 0}return tl=t,tl}var rl,Uv;function IR(){if(Uv)return rl;Uv=1;var e=RR();function t(r,n,i){for(var s=-1,a=r.criteria,o=n.criteria,u=a.length,c=i.length;++s<u;){var l=e(a[s],o[s]);if(l){if(s>=c)return l;var d=i[s];return l*(d=="desc"?-1:1)}}return r.index-n.index}return rl=t,rl}var nl,Kv;function AR(){if(Kv)return nl;Kv=1;var e=Li(),t=$i(),r=Rt(),n=rb(),i=kR(),s=Mi(),a=IR(),o=rr(),u=De();function c(l,d,f){d.length?d=e(d,function(x){return u(x)?function(y){return t(y,x.length===1?x[0]:x)}:x}):d=[o];var p=-1;d=e(d,s(r));var m=n(l,function(x,y,v){var w=e(d,function(g){return g(x)});return{criteria:w,index:++p,value:x}});return i(m,function(x,y){return a(x,y,f)})}return nl=c,nl}var il,Yv;function TR(){if(Yv)return il;Yv=1;var e=Gd(),t=AR(),r=zi(),n=Bi(),i=r(function(s,a){if(s==null)return[];var o=a.length;return o>1&&n(s,a[0],a[1])?a=[]:o>2&&n(a[0],a[1],a[2])&&(a=[a[0]]),t(s,e(a,1),[])});return il=i,il}var sl,Wv;function qR(){if(Wv)return sl;Wv=1;var e=Wx(),t=0;function r(n){var i=++t;return e(n)+i}return sl=r,sl}var al,Xv;function MR(){if(Xv)return al;Xv=1;function e(t,r,n){for(var i=-1,s=t.length,a=r.length,o={};++i<s;){var u=i<a?r[i]:void 0;n(o,t[i],u)}return o}return al=e,al}var ol,Zv;function PR(){if(Zv)return ol;Zv=1;var e=Ti(),t=MR();function r(n,i){return t(n||[],i||[],e)}return ol=r,ol}var ul,Qv;function je(){if(Qv)return ul;Qv=1;var e;if(typeof cd=="function")try{e={cloneDeep:Zk(),constant:$d(),defaults:Qk(),each:Bx(),filter:Jx(),find:sR(),flatten:mb(),forEach:zx(),forIn:aR(),has:eb(),isUndefined:tb(),last:oR(),map:nb(),mapValues:uR(),max:lR(),merge:mR(),min:vR(),minBy:yR(),now:xR(),pick:ER(),range:jR(),reduce:ib(),sortBy:TR(),uniqueId:qR(),values:cb(),zipObject:PR()}}catch{}return e||(e=window._),ul=e,ul}var cl,Jv;function OR(){if(Jv)return cl;Jv=1,cl=e;function e(){var n={};n._next=n._prev=n,this._sentinel=n}e.prototype.dequeue=function(){var n=this._sentinel,i=n._prev;if(i!==n)return t(i),i},e.prototype.enqueue=function(n){var i=this._sentinel;n._prev&&n._next&&t(n),n._next=i._next,i._next._prev=n,i._next=n,n._prev=i},e.prototype.toString=function(){for(var n=[],i=this._sentinel,s=i._prev;s!==i;)n.push(JSON.stringify(s,r)),s=s._prev;return"["+n.join(", ")+"]"};function t(n){n._prev._next=n._next,n._next._prev=n._prev,delete n._next,delete n._prev}function r(n,i){if(n!=="_next"&&n!=="_prev")return i}return cl}var ll,e0;function DR(){if(e0)return ll;e0=1;var e=je(),t=ut().Graph,r=OR();ll=i;var n=e.constant(1);function i(c,l){if(c.nodeCount()<=1)return[];var d=o(c,l||n),f=s(d.graph,d.buckets,d.zeroIdx);return e.flatten(e.map(f,function(p){return c.outEdges(p.v,p.w)}),!0)}function s(c,l,d){for(var f=[],p=l[l.length-1],m=l[0],x;c.nodeCount();){for(;x=m.dequeue();)a(c,l,d,x);for(;x=p.dequeue();)a(c,l,d,x);if(c.nodeCount()){for(var y=l.length-2;y>0;--y)if(x=l[y].dequeue(),x){f=f.concat(a(c,l,d,x,!0));break}}}return f}function a(c,l,d,f,p){var m=p?[]:void 0;return e.forEach(c.inEdges(f.v),function(x){var y=c.edge(x),v=c.node(x.v);p&&m.push({v:x.v,w:x.w}),v.out-=y,u(l,d,v)}),e.forEach(c.outEdges(f.v),function(x){var y=c.edge(x),v=x.w,w=c.node(v);w.in-=y,u(l,d,w)}),c.removeNode(f.v),m}function o(c,l){var d=new t,f=0,p=0;e.forEach(c.nodes(),function(y){d.setNode(y,{v:y,in:0,out:0})}),e.forEach(c.edges(),function(y){var v=d.edge(y.v,y.w)||0,w=l(y),g=v+w;d.setEdge(y.v,y.w,g),p=Math.max(p,d.node(y.v).out+=w),f=Math.max(f,d.node(y.w).in+=w)});var m=e.range(p+f+3).map(function(){return new r}),x=f+1;return e.forEach(d.nodes(),function(y){u(m,x,d.node(y))}),{graph:d,buckets:m,zeroIdx:x}}function u(c,l,d){d.out?d.in?c[d.out-d.in+l].enqueue(d):c[c.length-1].enqueue(d):c[0].enqueue(d)}return ll}var dl,t0;function LR(){if(t0)return dl;t0=1;var e=je(),t=DR();dl={run:r,undo:i};function r(s){var a=s.graph().acyclicer==="greedy"?t(s,o(s)):n(s);e.forEach(a,function(u){var c=s.edge(u);s.removeEdge(u),c.forwardName=u.name,c.reversed=!0,s.setEdge(u.w,u.v,c,e.uniqueId("rev"))});function o(u){return function(c){return u.edge(c).weight}}}function n(s){var a=[],o={},u={};function c(l){e.has(u,l)||(u[l]=!0,o[l]=!0,e.forEach(s.outEdges(l),function(d){e.has(o,d.w)?a.push(d):c(d.w)}),delete o[l])}return e.forEach(s.nodes(),c),a}function i(s){e.forEach(s.edges(),function(a){var o=s.edge(a);if(o.reversed){s.removeEdge(a);var u=o.forwardName;delete o.reversed,delete o.forwardName,s.setEdge(a.w,a.v,o,u)}})}return dl}var fl,r0;function Ke(){if(r0)return fl;r0=1;var e=je(),t=ut().Graph;fl={addDummyNode:r,simplify:n,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:a,intersectRect:o,buildLayerMatrix:u,normalizeRanks:c,removeEmptyRanks:l,addBorderNode:d,maxRank:f,partition:p,time:m,notime:x};function r(y,v,w,g){var b;do b=e.uniqueId(g);while(y.hasNode(b));return w.dummy=v,y.setNode(b,w),b}function n(y){var v=new t().setGraph(y.graph());return e.forEach(y.nodes(),function(w){v.setNode(w,y.node(w))}),e.forEach(y.edges(),function(w){var g=v.edge(w.v,w.w)||{weight:0,minlen:1},b=y.edge(w);v.setEdge(w.v,w.w,{weight:g.weight+b.weight,minlen:Math.max(g.minlen,b.minlen)})}),v}function i(y){var v=new t({multigraph:y.isMultigraph()}).setGraph(y.graph());return e.forEach(y.nodes(),function(w){y.children(w).length||v.setNode(w,y.node(w))}),e.forEach(y.edges(),function(w){v.setEdge(w,y.edge(w))}),v}function s(y){var v=e.map(y.nodes(),function(w){var g={};return e.forEach(y.outEdges(w),function(b){g[b.w]=(g[b.w]||0)+y.edge(b).weight}),g});return e.zipObject(y.nodes(),v)}function a(y){var v=e.map(y.nodes(),function(w){var g={};return e.forEach(y.inEdges(w),function(b){g[b.v]=(g[b.v]||0)+y.edge(b).weight}),g});return e.zipObject(y.nodes(),v)}function o(y,v){var w=y.x,g=y.y,b=v.x-w,_=v.y-g,N=y.width/2,E=y.height/2;if(!b&&!_)throw new Error("Not possible to find intersection inside of the rectangle");var I,A;return Math.abs(_)*N>Math.abs(b)*E?(_<0&&(E=-E),I=E*b/_,A=E):(b<0&&(N=-N),I=N,A=N*_/b),{x:w+I,y:g+A}}function u(y){var v=e.map(e.range(f(y)+1),function(){return[]});return e.forEach(y.nodes(),function(w){var g=y.node(w),b=g.rank;e.isUndefined(b)||(v[b][g.order]=w)}),v}function c(y){var v=e.min(e.map(y.nodes(),function(w){return y.node(w).rank}));e.forEach(y.nodes(),function(w){var g=y.node(w);e.has(g,"rank")&&(g.rank-=v)})}function l(y){var v=e.min(e.map(y.nodes(),function(_){return y.node(_).rank})),w=[];e.forEach(y.nodes(),function(_){var N=y.node(_).rank-v;w[N]||(w[N]=[]),w[N].push(_)});var g=0,b=y.graph().nodeRankFactor;e.forEach(w,function(_,N){e.isUndefined(_)&&N%b!==0?--g:g&&e.forEach(_,function(E){y.node(E).rank+=g})})}function d(y,v,w,g){var b={width:0,height:0};return arguments.length>=4&&(b.rank=w,b.order=g),r(y,"border",b,v)}function f(y){return e.max(e.map(y.nodes(),function(v){var w=y.node(v).rank;if(!e.isUndefined(w))return w}))}function p(y,v){var w={lhs:[],rhs:[]};return e.forEach(y,function(g){v(g)?w.lhs.push(g):w.rhs.push(g)}),w}function m(y,v){var w=e.now();try{return v()}finally{console.log(y+" time: "+(e.now()-w)+"ms")}}function x(y,v){return v()}return fl}var hl,n0;function FR(){if(n0)return hl;n0=1;var e=je(),t=Ke();hl={run:r,undo:i};function r(s){s.graph().dummyChains=[],e.forEach(s.edges(),function(a){n(s,a)})}function n(s,a){var o=a.v,u=s.node(o).rank,c=a.w,l=s.node(c).rank,d=a.name,f=s.edge(a),p=f.labelRank;if(l!==u+1){s.removeEdge(a);var m,x,y;for(y=0,++u;u<l;++y,++u)f.points=[],x={width:0,height:0,edgeLabel:f,edgeObj:a,rank:u},m=t.addDummyNode(s,"edge",x,"_d"),u===p&&(x.width=f.width,x.height=f.height,x.dummy="edge-label",x.labelpos=f.labelpos),s.setEdge(o,m,{weight:f.weight},d),y===0&&s.graph().dummyChains.push(m),o=m;s.setEdge(o,c,{weight:f.weight},d)}}function i(s){e.forEach(s.graph().dummyChains,function(a){var o=s.node(a),u=o.edgeLabel,c;for(s.setEdge(o.edgeObj,u);o.dummy;)c=s.successors(a)[0],s.removeNode(a),u.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(u.x=o.x,u.y=o.y,u.width=o.width,u.height=o.height),a=c,o=s.node(a)})}return hl}var pl,i0;function li(){if(i0)return pl;i0=1;var e=je();pl={longestPath:t,slack:r};function t(n){var i={};function s(a){var o=n.node(a);if(e.has(i,a))return o.rank;i[a]=!0;var u=e.min(e.map(n.outEdges(a),function(c){return s(c.w)-n.edge(c).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),o.rank=u}e.forEach(n.sources(),s)}function r(n,i){return n.node(i.w).rank-n.node(i.v).rank-n.edge(i).minlen}return pl}var gl,s0;function bb(){if(s0)return gl;s0=1;var e=je(),t=ut().Graph,r=li().slack;gl=n;function n(o){var u=new t({directed:!1}),c=o.nodes()[0],l=o.nodeCount();u.setNode(c,{});for(var d,f;i(u,o)<l;)d=s(u,o),f=u.hasNode(d.v)?r(o,d):-r(o,d),a(u,o,f);return u}function i(o,u){function c(l){e.forEach(u.nodeEdges(l),function(d){var f=d.v,p=l===f?d.w:f;!o.hasNode(p)&&!r(u,d)&&(o.setNode(p,{}),o.setEdge(l,p,{}),c(p))})}return e.forEach(o.nodes(),c),o.nodeCount()}function s(o,u){return e.minBy(u.edges(),function(c){if(o.hasNode(c.v)!==o.hasNode(c.w))return r(u,c)})}function a(o,u,c){e.forEach(o.nodes(),function(l){u.node(l).rank+=c})}return gl}var ml,a0;function $R(){if(a0)return ml;a0=1;var e=je(),t=bb(),r=li().slack,n=li().longestPath,i=ut().alg.preorder,s=ut().alg.postorder,a=Ke().simplify;ml=o,o.initLowLimValues=d,o.initCutValues=u,o.calcCutValue=l,o.leaveEdge=p,o.enterEdge=m,o.exchangeEdges=x;function o(g){g=a(g),n(g);var b=t(g);d(b),u(b,g);for(var _,N;_=p(b);)N=m(b,g,_),x(b,g,_,N)}function u(g,b){var _=s(g,g.nodes());_=_.slice(0,_.length-1),e.forEach(_,function(N){c(g,b,N)})}function c(g,b,_){var N=g.node(_),E=N.parent;g.edge(_,E).cutvalue=l(g,b,_)}function l(g,b,_){var N=g.node(_),E=N.parent,I=!0,A=b.edge(_,E),L=0;return A||(I=!1,A=b.edge(E,_)),L=A.weight,e.forEach(b.nodeEdges(_),function(T){var j=T.v===_,F=j?T.w:T.v;if(F!==E){var S=j===I,D=b.edge(T).weight;if(L+=S?D:-D,v(g,_,F)){var O=g.edge(_,F).cutvalue;L+=S?-O:O}}}),L}function d(g,b){arguments.length<2&&(b=g.nodes()[0]),f(g,{},1,b)}function f(g,b,_,N,E){var I=_,A=g.node(N);return b[N]=!0,e.forEach(g.neighbors(N),function(L){e.has(b,L)||(_=f(g,b,_,L,N))}),A.low=I,A.lim=_++,E?A.parent=E:delete A.parent,_}function p(g){return e.find(g.edges(),function(b){return g.edge(b).cutvalue<0})}function m(g,b,_){var N=_.v,E=_.w;b.hasEdge(N,E)||(N=_.w,E=_.v);var I=g.node(N),A=g.node(E),L=I,T=!1;I.lim>A.lim&&(L=A,T=!0);var j=e.filter(b.edges(),function(F){return T===w(g,g.node(F.v),L)&&T!==w(g,g.node(F.w),L)});return e.minBy(j,function(F){return r(b,F)})}function x(g,b,_,N){var E=_.v,I=_.w;g.removeEdge(E,I),g.setEdge(N.v,N.w,{}),d(g),u(g,b),y(g,b)}function y(g,b){var _=e.find(g.nodes(),function(E){return!b.node(E).parent}),N=i(g,_);N=N.slice(1),e.forEach(N,function(E){var I=g.node(E).parent,A=b.edge(E,I),L=!1;A||(A=b.edge(I,E),L=!0),b.node(E).rank=b.node(I).rank+(L?A.minlen:-A.minlen)})}function v(g,b,_){return g.hasEdge(b,_)}function w(g,b,_){return _.low<=b.lim&&b.lim<=_.lim}return ml}var vl,o0;function zR(){if(o0)return vl;o0=1;var e=li(),t=e.longestPath,r=bb(),n=$R();vl=i;function i(u){switch(u.graph().ranker){case"network-simplex":o(u);break;case"tight-tree":a(u);break;case"longest-path":s(u);break;default:o(u)}}var s=t;function a(u){t(u),r(u)}function o(u){n(u)}return vl}var yl,u0;function BR(){if(u0)return yl;u0=1;var e=je();yl=t;function t(i){var s=n(i);e.forEach(i.graph().dummyChains,function(a){for(var o=i.node(a),u=o.edgeObj,c=r(i,s,u.v,u.w),l=c.path,d=c.lca,f=0,p=l[f],m=!0;a!==u.w;){if(o=i.node(a),m){for(;(p=l[f])!==d&&i.node(p).maxRank<o.rank;)f++;p===d&&(m=!1)}if(!m){for(;f<l.length-1&&i.node(p=l[f+1]).minRank<=o.rank;)f++;p=l[f]}i.setParent(a,p),a=i.successors(a)[0]}})}function r(i,s,a,o){var u=[],c=[],l=Math.min(s[a].low,s[o].low),d=Math.max(s[a].lim,s[o].lim),f,p;f=a;do f=i.parent(f),u.push(f);while(f&&(s[f].low>l||d>s[f].lim));for(p=f,f=o;(f=i.parent(f))!==p;)c.push(f);return{path:u.concat(c.reverse()),lca:p}}function n(i){var s={},a=0;function o(u){var c=a;e.forEach(i.children(u),o),s[u]={low:c,lim:a++}}return e.forEach(i.children(),o),s}return yl}var xl,c0;function HR(){if(c0)return xl;c0=1;var e=je(),t=Ke();xl={run:r,cleanup:a};function r(o){var u=t.addDummyNode(o,"root",{},"_root"),c=i(o),l=e.max(e.values(c))-1,d=2*l+1;o.graph().nestingRoot=u,e.forEach(o.edges(),function(p){o.edge(p).minlen*=d});var f=s(o)+1;e.forEach(o.children(),function(p){n(o,u,d,f,l,c,p)}),o.graph().nodeRankFactor=d}function n(o,u,c,l,d,f,p){var m=o.children(p);if(!m.length){p!==u&&o.setEdge(u,p,{weight:0,minlen:c});return}var x=t.addBorderNode(o,"_bt"),y=t.addBorderNode(o,"_bb"),v=o.node(p);o.setParent(x,p),v.borderTop=x,o.setParent(y,p),v.borderBottom=y,e.forEach(m,function(w){n(o,u,c,l,d,f,w);var g=o.node(w),b=g.borderTop?g.borderTop:w,_=g.borderBottom?g.borderBottom:w,N=g.borderTop?l:2*l,E=b!==_?1:d-f[p]+1;o.setEdge(x,b,{weight:N,minlen:E,nestingEdge:!0}),o.setEdge(_,y,{weight:N,minlen:E,nestingEdge:!0})}),o.parent(p)||o.setEdge(u,x,{weight:0,minlen:d+f[p]})}function i(o){var u={};function c(l,d){var f=o.children(l);f&&f.length&&e.forEach(f,function(p){c(p,d+1)}),u[l]=d}return e.forEach(o.children(),function(l){c(l,1)}),u}function s(o){return e.reduce(o.edges(),function(u,c){return u+o.edge(c).weight},0)}function a(o){var u=o.graph();o.removeNode(u.nestingRoot),delete u.nestingRoot,e.forEach(o.edges(),function(c){var l=o.edge(c);l.nestingEdge&&o.removeEdge(c)})}return xl}var bl,l0;function VR(){if(l0)return bl;l0=1;var e=je(),t=Ke();bl=r;function r(i){function s(a){var o=i.children(a),u=i.node(a);if(o.length&&e.forEach(o,s),e.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var c=u.minRank,l=u.maxRank+1;c<l;++c)n(i,"borderLeft","_bl",a,u,c),n(i,"borderRight","_br",a,u,c)}}e.forEach(i.children(),s)}function n(i,s,a,o,u,c){var l={width:0,height:0,rank:c,borderType:s},d=u[s][c-1],f=t.addDummyNode(i,"border",l,a);u[s][c]=f,i.setParent(f,o),d&&i.setEdge(d,f,{weight:1})}return bl}var wl,d0;function GR(){if(d0)return wl;d0=1;var e=je();wl={adjust:t,undo:r};function t(c){var l=c.graph().rankdir.toLowerCase();(l==="lr"||l==="rl")&&n(c)}function r(c){var l=c.graph().rankdir.toLowerCase();(l==="bt"||l==="rl")&&s(c),(l==="lr"||l==="rl")&&(o(c),n(c))}function n(c){e.forEach(c.nodes(),function(l){i(c.node(l))}),e.forEach(c.edges(),function(l){i(c.edge(l))})}function i(c){var l=c.width;c.width=c.height,c.height=l}function s(c){e.forEach(c.nodes(),function(l){a(c.node(l))}),e.forEach(c.edges(),function(l){var d=c.edge(l);e.forEach(d.points,a),e.has(d,"y")&&a(d)})}function a(c){c.y=-c.y}function o(c){e.forEach(c.nodes(),function(l){u(c.node(l))}),e.forEach(c.edges(),function(l){var d=c.edge(l);e.forEach(d.points,u),e.has(d,"x")&&u(d)})}function u(c){var l=c.x;c.x=c.y,c.y=l}return wl}var _l,f0;function UR(){if(f0)return _l;f0=1;var e=je();_l=t;function t(r){var n={},i=e.filter(r.nodes(),function(c){return!r.children(c).length}),s=e.max(e.map(i,function(c){return r.node(c).rank})),a=e.map(e.range(s+1),function(){return[]});function o(c){if(!e.has(n,c)){n[c]=!0;var l=r.node(c);a[l.rank].push(c),e.forEach(r.successors(c),o)}}var u=e.sortBy(i,function(c){return r.node(c).rank});return e.forEach(u,o),a}return _l}var Nl,h0;function KR(){if(h0)return Nl;h0=1;var e=je();Nl=t;function t(n,i){for(var s=0,a=1;a<i.length;++a)s+=r(n,i[a-1],i[a]);return s}function r(n,i,s){for(var a=e.zipObject(s,e.map(s,function(f,p){return p})),o=e.flatten(e.map(i,function(f){return e.sortBy(e.map(n.outEdges(f),function(p){return{pos:a[p.w],weight:n.edge(p).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var c=2*u-1;u-=1;var l=e.map(new Array(c),function(){return 0}),d=0;return e.forEach(o.forEach(function(f){var p=f.pos+u;l[p]+=f.weight;for(var m=0;p>0;)p%2&&(m+=l[p+1]),p=p-1>>1,l[p]+=f.weight;d+=f.weight*m})),d}return Nl}var El,p0;function YR(){if(p0)return El;p0=1;var e=je();El=t;function t(r,n){return e.map(n,function(i){var s=r.inEdges(i);if(s.length){var a=e.reduce(s,function(o,u){var c=r.edge(u),l=r.node(u.v);return{sum:o.sum+c.weight*l.order,weight:o.weight+c.weight}},{sum:0,weight:0});return{v:i,barycenter:a.sum/a.weight,weight:a.weight}}else return{v:i}})}return El}var Cl,g0;function WR(){if(g0)return Cl;g0=1;var e=je();Cl=t;function t(i,s){var a={};e.forEach(i,function(u,c){var l=a[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:c};e.isUndefined(u.barycenter)||(l.barycenter=u.barycenter,l.weight=u.weight)}),e.forEach(s.edges(),function(u){var c=a[u.v],l=a[u.w];!e.isUndefined(c)&&!e.isUndefined(l)&&(l.indegree++,c.out.push(a[u.w]))});var o=e.filter(a,function(u){return!u.indegree});return r(o)}function r(i){var s=[];function a(c){return function(l){l.merged||(e.isUndefined(l.barycenter)||e.isUndefined(c.barycenter)||l.barycenter>=c.barycenter)&&n(c,l)}}function o(c){return function(l){l.in.push(c),--l.indegree===0&&i.push(l)}}for(;i.length;){var u=i.pop();s.push(u),e.forEach(u.in.reverse(),a(u)),e.forEach(u.out,o(u))}return e.map(e.filter(s,function(c){return!c.merged}),function(c){return e.pick(c,["vs","i","barycenter","weight"])})}function n(i,s){var a=0,o=0;i.weight&&(a+=i.barycenter*i.weight,o+=i.weight),s.weight&&(a+=s.barycenter*s.weight,o+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=a/o,i.weight=o,i.i=Math.min(s.i,i.i),s.merged=!0}return Cl}var Sl,m0;function XR(){if(m0)return Sl;m0=1;var e=je(),t=Ke();Sl=r;function r(s,a){var o=t.partition(s,function(x){return e.has(x,"barycenter")}),u=o.lhs,c=e.sortBy(o.rhs,function(x){return-x.i}),l=[],d=0,f=0,p=0;u.sort(i(!!a)),p=n(l,c,p),e.forEach(u,function(x){p+=x.vs.length,l.push(x.vs),d+=x.barycenter*x.weight,f+=x.weight,p=n(l,c,p)});var m={vs:e.flatten(l,!0)};return f&&(m.barycenter=d/f,m.weight=f),m}function n(s,a,o){for(var u;a.length&&(u=e.last(a)).i<=o;)a.pop(),s.push(u.vs),o++;return o}function i(s){return function(a,o){return a.barycenter<o.barycenter?-1:a.barycenter>o.barycenter?1:s?o.i-a.i:a.i-o.i}}return Sl}var jl,v0;function ZR(){if(v0)return jl;v0=1;var e=je(),t=YR(),r=WR(),n=XR();jl=i;function i(o,u,c,l){var d=o.children(u),f=o.node(u),p=f?f.borderLeft:void 0,m=f?f.borderRight:void 0,x={};p&&(d=e.filter(d,function(_){return _!==p&&_!==m}));var y=t(o,d);e.forEach(y,function(_){if(o.children(_.v).length){var N=i(o,_.v,c,l);x[_.v]=N,e.has(N,"barycenter")&&a(_,N)}});var v=r(y,c);s(v,x);var w=n(v,l);if(p&&(w.vs=e.flatten([p,w.vs,m],!0),o.predecessors(p).length)){var g=o.node(o.predecessors(p)[0]),b=o.node(o.predecessors(m)[0]);e.has(w,"barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+g.order+b.order)/(w.weight+2),w.weight+=2}return w}function s(o,u){e.forEach(o,function(c){c.vs=e.flatten(c.vs.map(function(l){return u[l]?u[l].vs:l}),!0)})}function a(o,u){e.isUndefined(o.barycenter)?(o.barycenter=u.barycenter,o.weight=u.weight):(o.barycenter=(o.barycenter*o.weight+u.barycenter*u.weight)/(o.weight+u.weight),o.weight+=u.weight)}return jl}var kl,y0;function QR(){if(y0)return kl;y0=1;var e=je(),t=ut().Graph;kl=r;function r(i,s,a){var o=n(i),u=new t({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(function(c){return i.node(c)});return e.forEach(i.nodes(),function(c){var l=i.node(c),d=i.parent(c);(l.rank===s||l.minRank<=s&&s<=l.maxRank)&&(u.setNode(c),u.setParent(c,d||o),e.forEach(i[a](c),function(f){var p=f.v===c?f.w:f.v,m=u.edge(p,c),x=e.isUndefined(m)?0:m.weight;u.setEdge(p,c,{weight:i.edge(f).weight+x})}),e.has(l,"minRank")&&u.setNode(c,{borderLeft:l.borderLeft[s],borderRight:l.borderRight[s]}))}),u}function n(i){for(var s;i.hasNode(s=e.uniqueId("_root")););return s}return kl}var Rl,x0;function JR(){if(x0)return Rl;x0=1;var e=je();Rl=t;function t(r,n,i){var s={},a;e.forEach(i,function(o){for(var u=r.parent(o),c,l;u;){if(c=r.parent(u),c?(l=s[c],s[c]=u):(l=a,a=u),l&&l!==u){n.setEdge(l,u);return}u=c}})}return Rl}var Il,b0;function eI(){if(b0)return Il;b0=1;var e=je(),t=UR(),r=KR(),n=ZR(),i=QR(),s=JR(),a=ut().Graph,o=Ke();Il=u;function u(f){var p=o.maxRank(f),m=c(f,e.range(1,p+1),"inEdges"),x=c(f,e.range(p-1,-1,-1),"outEdges"),y=t(f);d(f,y);for(var v=Number.POSITIVE_INFINITY,w,g=0,b=0;b<4;++g,++b){l(g%2?m:x,g%4>=2),y=o.buildLayerMatrix(f);var _=r(f,y);_<v&&(b=0,w=e.cloneDeep(y),v=_)}d(f,w)}function c(f,p,m){return e.map(p,function(x){return i(f,x,m)})}function l(f,p){var m=new a;e.forEach(f,function(x){var y=x.graph().root,v=n(x,y,m,p);e.forEach(v.vs,function(w,g){x.node(w).order=g}),s(x,m,v.vs)})}function d(f,p){e.forEach(p,function(m){e.forEach(m,function(x,y){f.node(x).order=y})})}return Il}var Al,w0;function tI(){if(w0)return Al;w0=1;var e=je(),t=ut().Graph,r=Ke();Al={positionX:m,findType1Conflicts:n,findType2Conflicts:i,addConflict:a,hasConflict:o,verticalAlignment:u,horizontalCompaction:c,alignCoordinates:f,findSmallestWidthAlignment:d,balance:p};function n(v,w){var g={};function b(_,N){var E=0,I=0,A=_.length,L=e.last(N);return e.forEach(N,function(T,j){var F=s(v,T),S=F?v.node(F).order:A;(F||T===L)&&(e.forEach(N.slice(I,j+1),function(D){e.forEach(v.predecessors(D),function(O){var M=v.node(O),R=M.order;(R<E||S<R)&&!(M.dummy&&v.node(D).dummy)&&a(g,O,D)})}),I=j+1,E=S)}),N}return e.reduce(w,b),g}function i(v,w){var g={};function b(N,E,I,A,L){var T;e.forEach(e.range(E,I),function(j){T=N[j],v.node(T).dummy&&e.forEach(v.predecessors(T),function(F){var S=v.node(F);S.dummy&&(S.order<A||S.order>L)&&a(g,F,T)})})}function _(N,E){var I=-1,A,L=0;return e.forEach(E,function(T,j){if(v.node(T).dummy==="border"){var F=v.predecessors(T);F.length&&(A=v.node(F[0]).order,b(E,L,j,I,A),L=j,I=A)}b(E,L,E.length,A,N.length)}),E}return e.reduce(w,_),g}function s(v,w){if(v.node(w).dummy)return e.find(v.predecessors(w),function(g){return v.node(g).dummy})}function a(v,w,g){if(w>g){var b=w;w=g,g=b}var _=v[w];_||(v[w]=_={}),_[g]=!0}function o(v,w,g){if(w>g){var b=w;w=g,g=b}return e.has(v[w],g)}function u(v,w,g,b){var _={},N={},E={};return e.forEach(w,function(I){e.forEach(I,function(A,L){_[A]=A,N[A]=A,E[A]=L})}),e.forEach(w,function(I){var A=-1;e.forEach(I,function(L){var T=b(L);if(T.length){T=e.sortBy(T,function(O){return E[O]});for(var j=(T.length-1)/2,F=Math.floor(j),S=Math.ceil(j);F<=S;++F){var D=T[F];N[L]===L&&A<E[D]&&!o(g,L,D)&&(N[D]=L,N[L]=_[L]=_[D],A=E[D])}}})}),{root:_,align:N}}function c(v,w,g,b,_){var N={},E=l(v,w,g,_),I=_?"borderLeft":"borderRight";function A(j,F){for(var S=E.nodes(),D=S.pop(),O={};D;)O[D]?j(D):(O[D]=!0,S.push(D),S=S.concat(F(D))),D=S.pop()}function L(j){N[j]=E.inEdges(j).reduce(function(F,S){return Math.max(F,N[S.v]+E.edge(S))},0)}function T(j){var F=E.outEdges(j).reduce(function(D,O){return Math.min(D,N[O.w]-E.edge(O))},Number.POSITIVE_INFINITY),S=v.node(j);F!==Number.POSITIVE_INFINITY&&S.borderType!==I&&(N[j]=Math.max(N[j],F))}return A(L,E.predecessors.bind(E)),A(T,E.successors.bind(E)),e.forEach(b,function(j){N[j]=N[g[j]]}),N}function l(v,w,g,b){var _=new t,N=v.graph(),E=x(N.nodesep,N.edgesep,b);return e.forEach(w,function(I){var A;e.forEach(I,function(L){var T=g[L];if(_.setNode(T),A){var j=g[A],F=_.edge(j,T);_.setEdge(j,T,Math.max(E(v,L,A),F||0))}A=L})}),_}function d(v,w){return e.minBy(e.values(w),function(g){var b=Number.NEGATIVE_INFINITY,_=Number.POSITIVE_INFINITY;return e.forIn(g,function(N,E){var I=y(v,E)/2;b=Math.max(N+I,b),_=Math.min(N-I,_)}),b-_})}function f(v,w){var g=e.values(w),b=e.min(g),_=e.max(g);e.forEach(["u","d"],function(N){e.forEach(["l","r"],function(E){var I=N+E,A=v[I],L;if(A!==w){var T=e.values(A);L=E==="l"?b-e.min(T):_-e.max(T),L&&(v[I]=e.mapValues(A,function(j){return j+L}))}})})}function p(v,w){return e.mapValues(v.ul,function(g,b){if(w)return v[w.toLowerCase()][b];var _=e.sortBy(e.map(v,b));return(_[1]+_[2])/2})}function m(v){var w=r.buildLayerMatrix(v),g=e.merge(n(v,w),i(v,w)),b={},_;e.forEach(["u","d"],function(E){_=E==="u"?w:e.values(w).reverse(),e.forEach(["l","r"],function(I){I==="r"&&(_=e.map(_,function(j){return e.values(j).reverse()}));var A=(E==="u"?v.predecessors:v.successors).bind(v),L=u(v,_,g,A),T=c(v,_,L.root,L.align,I==="r");I==="r"&&(T=e.mapValues(T,function(j){return-j})),b[E+I]=T})});var N=d(v,b);return f(b,N),p(b,v.graph().align)}function x(v,w,g){return function(b,_,N){var E=b.node(_),I=b.node(N),A=0,L;if(A+=E.width/2,e.has(E,"labelpos"))switch(E.labelpos.toLowerCase()){case"l":L=-E.width/2;break;case"r":L=E.width/2;break}if(L&&(A+=g?L:-L),L=0,A+=(E.dummy?w:v)/2,A+=(I.dummy?w:v)/2,A+=I.width/2,e.has(I,"labelpos"))switch(I.labelpos.toLowerCase()){case"l":L=I.width/2;break;case"r":L=-I.width/2;break}return L&&(A+=g?L:-L),L=0,A}}function y(v,w){return v.node(w).width}return Al}var Tl,_0;function rI(){if(_0)return Tl;_0=1;var e=je(),t=Ke(),r=tI().positionX;Tl=n;function n(s){s=t.asNonCompoundGraph(s),i(s),e.forEach(r(s),function(a,o){s.node(o).x=a})}function i(s){var a=t.buildLayerMatrix(s),o=s.graph().ranksep,u=0;e.forEach(a,function(c){var l=e.max(e.map(c,function(d){return s.node(d).height}));e.forEach(c,function(d){s.node(d).y=u+l/2}),u+=l+o})}return Tl}var ql,N0;function nI(){if(N0)return ql;N0=1;var e=je(),t=LR(),r=FR(),n=zR(),i=Ke().normalizeRanks,s=BR(),a=Ke().removeEmptyRanks,o=HR(),u=VR(),c=GR(),l=eI(),d=rI(),f=Ke(),p=ut().Graph;ql=m;function m(P,B){var z=B&&B.debugTiming?f.time:f.notime;z("layout",function(){var $=z("  buildLayoutGraph",function(){return A(P)});z("  runLayout",function(){x($,z)}),z("  updateInputGraph",function(){y(P,$)})})}function x(P,B){B("    makeSpaceForEdgeLabels",function(){L(P)}),B("    removeSelfEdges",function(){q(P)}),B("    acyclic",function(){t.run(P)}),B("    nestingGraph.run",function(){o.run(P)}),B("    rank",function(){n(f.asNonCompoundGraph(P))}),B("    injectEdgeLabelProxies",function(){T(P)}),B("    removeEmptyRanks",function(){a(P)}),B("    nestingGraph.cleanup",function(){o.cleanup(P)}),B("    normalizeRanks",function(){i(P)}),B("    assignRankMinMax",function(){j(P)}),B("    removeEdgeLabelProxies",function(){F(P)}),B("    normalize.run",function(){r.run(P)}),B("    parentDummyChains",function(){s(P)}),B("    addBorderSegments",function(){u(P)}),B("    order",function(){l(P)}),B("    insertSelfEdges",function(){V(P)}),B("    adjustCoordinateSystem",function(){c.adjust(P)}),B("    position",function(){d(P)}),B("    positionSelfEdges",function(){G(P)}),B("    removeBorderNodes",function(){R(P)}),B("    normalize.undo",function(){r.undo(P)}),B("    fixupEdgeLabelCoords",function(){O(P)}),B("    undoCoordinateSystem",function(){c.undo(P)}),B("    translateGraph",function(){S(P)}),B("    assignNodeIntersects",function(){D(P)}),B("    reversePoints",function(){M(P)}),B("    acyclic.undo",function(){t.undo(P)})}function y(P,B){e.forEach(P.nodes(),function(z){var $=P.node(z),K=B.node(z);$&&($.x=K.x,$.y=K.y,B.children(z).length&&($.width=K.width,$.height=K.height))}),e.forEach(P.edges(),function(z){var $=P.edge(z),K=B.edge(z);$.points=K.points,e.has(K,"x")&&($.x=K.x,$.y=K.y)}),P.graph().width=B.graph().width,P.graph().height=B.graph().height}var v=["nodesep","edgesep","ranksep","marginx","marginy"],w={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},g=["acyclicer","ranker","rankdir","align"],b=["width","height"],_={width:0,height:0},N=["minlen","weight","width","height","labeloffset"],E={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},I=["labelpos"];function A(P){var B=new p({multigraph:!0,compound:!0}),z=J(P.graph());return B.setGraph(e.merge({},w,Y(z,v),e.pick(z,g))),e.forEach(P.nodes(),function($){var K=J(P.node($));B.setNode($,e.defaults(Y(K,b),_)),B.setParent($,P.parent($))}),e.forEach(P.edges(),function($){var K=J(P.edge($));B.setEdge($,e.merge({},E,Y(K,N),e.pick(K,I)))}),B}function L(P){var B=P.graph();B.ranksep/=2,e.forEach(P.edges(),function(z){var $=P.edge(z);$.minlen*=2,$.labelpos.toLowerCase()!=="c"&&(B.rankdir==="TB"||B.rankdir==="BT"?$.width+=$.labeloffset:$.height+=$.labeloffset)})}function T(P){e.forEach(P.edges(),function(B){var z=P.edge(B);if(z.width&&z.height){var $=P.node(B.v),K=P.node(B.w),re={rank:(K.rank-$.rank)/2+$.rank,e:B};f.addDummyNode(P,"edge-proxy",re,"_ep")}})}function j(P){var B=0;e.forEach(P.nodes(),function(z){var $=P.node(z);$.borderTop&&($.minRank=P.node($.borderTop).rank,$.maxRank=P.node($.borderBottom).rank,B=e.max(B,$.maxRank))}),P.graph().maxRank=B}function F(P){e.forEach(P.nodes(),function(B){var z=P.node(B);z.dummy==="edge-proxy"&&(P.edge(z.e).labelRank=z.rank,P.removeNode(B))})}function S(P){var B=Number.POSITIVE_INFINITY,z=0,$=Number.POSITIVE_INFINITY,K=0,re=P.graph(),ee=re.marginx||0,ne=re.marginy||0;function ce(ie){var le=ie.x,oe=ie.y,Z=ie.width,de=ie.height;B=Math.min(B,le-Z/2),z=Math.max(z,le+Z/2),$=Math.min($,oe-de/2),K=Math.max(K,oe+de/2)}e.forEach(P.nodes(),function(ie){ce(P.node(ie))}),e.forEach(P.edges(),function(ie){var le=P.edge(ie);e.has(le,"x")&&ce(le)}),B-=ee,$-=ne,e.forEach(P.nodes(),function(ie){var le=P.node(ie);le.x-=B,le.y-=$}),e.forEach(P.edges(),function(ie){var le=P.edge(ie);e.forEach(le.points,function(oe){oe.x-=B,oe.y-=$}),e.has(le,"x")&&(le.x-=B),e.has(le,"y")&&(le.y-=$)}),re.width=z-B+ee,re.height=K-$+ne}function D(P){e.forEach(P.edges(),function(B){var z=P.edge(B),$=P.node(B.v),K=P.node(B.w),re,ee;z.points?(re=z.points[0],ee=z.points[z.points.length-1]):(z.points=[],re=K,ee=$),z.points.unshift(f.intersectRect($,re)),z.points.push(f.intersectRect(K,ee))})}function O(P){e.forEach(P.edges(),function(B){var z=P.edge(B);if(e.has(z,"x"))switch((z.labelpos==="l"||z.labelpos==="r")&&(z.width-=z.labeloffset),z.labelpos){case"l":z.x-=z.width/2+z.labeloffset;break;case"r":z.x+=z.width/2+z.labeloffset;break}})}function M(P){e.forEach(P.edges(),function(B){var z=P.edge(B);z.reversed&&z.points.reverse()})}function R(P){e.forEach(P.nodes(),function(B){if(P.children(B).length){var z=P.node(B),$=P.node(z.borderTop),K=P.node(z.borderBottom),re=P.node(e.last(z.borderLeft)),ee=P.node(e.last(z.borderRight));z.width=Math.abs(ee.x-re.x),z.height=Math.abs(K.y-$.y),z.x=re.x+z.width/2,z.y=$.y+z.height/2}}),e.forEach(P.nodes(),function(B){P.node(B).dummy==="border"&&P.removeNode(B)})}function q(P){e.forEach(P.edges(),function(B){if(B.v===B.w){var z=P.node(B.v);z.selfEdges||(z.selfEdges=[]),z.selfEdges.push({e:B,label:P.edge(B)}),P.removeEdge(B)}})}function V(P){var B=f.buildLayerMatrix(P);e.forEach(B,function(z){var $=0;e.forEach(z,function(K,re){var ee=P.node(K);ee.order=re+$,e.forEach(ee.selfEdges,function(ne){f.addDummyNode(P,"selfedge",{width:ne.label.width,height:ne.label.height,rank:ee.rank,order:re+ ++$,e:ne.e,label:ne.label},"_se")}),delete ee.selfEdges})})}function G(P){e.forEach(P.nodes(),function(B){var z=P.node(B);if(z.dummy==="selfedge"){var $=P.node(z.e.v),K=$.x+$.width/2,re=$.y,ee=z.x-K,ne=$.height/2;P.setEdge(z.e,z.label),P.removeNode(B),z.label.points=[{x:K+2*ee/3,y:re-ne},{x:K+5*ee/6,y:re-ne},{x:K+ee,y:re},{x:K+5*ee/6,y:re+ne},{x:K+2*ee/3,y:re+ne}],z.label.x=z.x,z.label.y=z.y}})}function Y(P,B){return e.mapValues(e.pick(P,B),Number)}function J(P){var B={};return e.forEach(P,function(z,$){B[$.toLowerCase()]=z}),B}return ql}var Ml,E0;function iI(){if(E0)return Ml;E0=1;var e=je(),t=Ke(),r=ut().Graph;Ml={debugOrdering:n};function n(i){var s=t.buildLayerMatrix(i),a=new r({compound:!0,multigraph:!0}).setGraph({});return e.forEach(i.nodes(),function(o){a.setNode(o,{label:o}),a.setParent(o,"layer"+i.node(o).rank)}),e.forEach(i.edges(),function(o){a.setEdge(o.v,o.w,{},o.name)}),e.forEach(s,function(o,u){var c="layer"+u;a.setNode(c,{rank:"same"}),e.reduce(o,function(l,d){return a.setEdge(l,d,{style:"invis"}),d})}),a}return Ml}var Pl,C0;function sI(){return C0||(C0=1,Pl="0.8.5"),Pl}var Ol,S0;function aI(){return S0||(S0=1,Ol={graphlib:ut(),layout:nI(),debug:iI(),util:{time:Ke().time,notime:Ke().notime},version:sI()}),Ol}var oI=aI();const j0=Bb(oI);function uI({className:e="",minZoom:t=.5,maxZoom:r=2,step:n=.1}){const{setViewport:i,getZoom:s,getViewport:a}=pn(),o=s(),c=(Math.min(Math.max(o,t),r)-t)/(r-t)*100,l=p=>Math.min(Math.max(p,t),r),d=p=>{const{x:m,y:x}=a();i({x:m,y:x,zoom:l(p)},{duration:200})},f=p=>{const m=parseFloat(p.target.value),x=t+m/100*(r-t);d(x)};return h.jsxs("div",{className:`flex flex-col items-center gap-2 p-2 ${e}`,children:[h.jsx("button",{onClick:()=>d(o+n),className:"w-6 h-6 flex items-center justify-center rounded border border-border bg-background hover:bg-accent transition-colors",title:"Zoom In",children:h.jsx(xr,{className:"w-4 h-4"})}),h.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:f,className:"slider-vertical h-24 w-1.5",style:{writingMode:"vertical-lr",direction:"rtl"},title:`Zoom: ${Math.round(o*100)}%`}),h.jsx("button",{onClick:()=>d(o-n),className:"w-6 h-6 flex items-center justify-center rounded border border-border bg-background hover:bg-accent transition-colors",title:"Zoom Out",children:h.jsx($w,{className:"w-4 h-4"})})]})}const wb=C.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,role:"group",className:Yt("inline-flex items-center gap-1",e),...t}));wb.displayName="ButtonGroup";const cI=C.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"aria-hidden":"true",className:Yt("h-4 w-px bg-border mx-1",e),...t}));cI.displayName="ButtonGroupSeparator";const lI=C.forwardRef(({className:e,...t},r)=>h.jsx("span",{ref:r,className:Yt("text-sm font-medium text-foreground/90",e),...t}));lI.displayName="ButtonGroupText";const _b=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive;return h.jsxs("div",{className:`
				min-w-[200px] rounded-lg border-2 bg-card shadow-lg
				${t||n?"border-primary ring-2 ring-primary/20":"border-green-500"}
			`,children:[h.jsxs("div",{className:"bg-green-500 text-white px-4 py-2 rounded-t-md flex items-center gap-2",children:[h.jsx(Jn,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||r("editor.nodes.start")})]}),h.jsx("div",{className:"p-4",children:h.jsx("p",{className:"text-xs text-muted-foreground",children:r("editor.nodes.startDescription")})}),h.jsx(He,{type:"source",position:ue.Bottom,className:"!bg-green-500 !w-3 !h-3 !border-2 !border-white"})]})});_b.displayName="StartNode";const Nb=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive,i=e.dialogueRows||(e.text?[{text:e.text}]:[]),s=i[0],a=i.length>1,o=s!=null&&s.text?s.text.length>50?s.text.substring(0,50)+"...":s.text:r("editor.nodes.npcPlaceholder"),u=[];e.participant&&u.push(`${r("editor.nodes.tooltip.participant")}: ${e.participant}`),e.decorators&&e.decorators.length>0&&u.push(`${r("editor.nodes.tooltip.decorators")}: ${e.decorators.length}`),i.length>0&&u.push(`${r("editor.nodes.tooltip.dialogueRows")}: ${i.length}`);const c=u.join(`
`);return h.jsxs("div",{className:`
				min-w-[250px] rounded-lg border-2 bg-card shadow-lg
				${t||n?"border-primary ring-2 ring-primary/20":"border-blue-500"}
			`,title:c,children:[h.jsx(He,{type:"target",position:ue.Top,className:"!bg-blue-500 !w-3 !h-3 !border-2 !border-white"}),h.jsxs("div",{className:"bg-blue-500 text-white px-4 py-2 rounded-t-md flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ud,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||e.participant||r("editor.nodes.npc")})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[a&&h.jsx("span",{className:"text-xs opacity-80",children:r("editor.nodes.rows",{count:i.length})}),e.hasAudio&&h.jsx(an,{className:"h-3 w-3"})]})]}),h.jsxs("div",{className:"p-4 space-y-2",children:[h.jsx("p",{className:"text-sm text-foreground",children:o}),e.participant&&h.jsx("div",{className:"flex items-center gap-2 pt-1",children:h.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded-full text-xs",children:[h.jsx(br,{className:"h-3 w-3"}),e.participant]})}),e.decorators&&e.decorators.length>0&&h.jsx("div",{className:"flex flex-wrap gap-1 pt-2 border-t",children:e.decorators.map((l,d)=>h.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded-full text-xs",title:l.values&&Object.keys(l.values).length>0?Object.entries(l.values).map(([f,p])=>`${f}: ${p}`).join(", "):void 0,children:[h.jsx(hi,{className:"h-3 w-3"}),l.name||l]},d))})]}),h.jsx(He,{type:"source",position:ue.Bottom,className:"!bg-blue-500 !w-3 !h-3 !border-2 !border-white"})]})});Nb.displayName="LeadNode";const Eb=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive,i=e.dialogueRows||(e.text?[{text:e.text}]:[]),s=i[0],a=i.length>1,o=s!=null&&s.text?s.text.length>50?s.text.substring(0,50)+"...":s.text:r("editor.nodes.playerPlaceholder"),u=[];e.participant&&u.push(`${r("editor.nodes.tooltip.participant")}: ${e.participant}`),e.decorators&&e.decorators.length>0&&u.push(`${r("editor.nodes.tooltip.decorators")}: ${e.decorators.length}`),i.length>0&&u.push(`${r("editor.nodes.tooltip.dialogueRows")}: ${i.length}`);const c=u.join(`
`);return h.jsxs("div",{className:`
				min-w-[250px] rounded-lg border-2 bg-card shadow-lg
				${t||n?"border-primary ring-2 ring-primary/20":"border-purple-500"}
			`,title:c,children:[h.jsx(He,{type:"target",position:ue.Top,className:"!bg-purple-500 !w-3 !h-3 !border-2 !border-white"}),h.jsxs("div",{className:"bg-purple-500 text-white px-4 py-2 rounded-t-md flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(br,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||e.participant||r("editor.nodes.player")})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[a&&h.jsx("span",{className:"text-xs opacity-80",children:r("editor.nodes.rows",{count:i.length})}),e.hasAudio&&h.jsx(an,{className:"h-3 w-3"})]})]}),h.jsxs("div",{className:"p-4 space-y-2",children:[h.jsx("p",{className:"text-sm text-foreground",children:o}),e.participant&&h.jsx("div",{className:"flex items-center gap-2 pt-1",children:h.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded-full text-xs",children:[h.jsx(br,{className:"h-3 w-3"}),e.participant]})}),e.decorators&&e.decorators.length>0&&h.jsx("div",{className:"flex flex-wrap gap-1 pt-2 border-t",children:e.decorators.map((l,d)=>h.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded-full text-xs",title:l.values&&Object.keys(l.values).length>0?Object.entries(l.values).map(([f,p])=>`${f}: ${p}`).join(", "):void 0,children:[h.jsx(hi,{className:"h-3 w-3"}),l.name||l]},d))})]}),h.jsx(He,{type:"source",position:ue.Bottom,className:"!bg-purple-500 !w-3 !h-3 !border-2 !border-white"})]})});Eb.displayName="AnswerNode";const Cb=C.memo(({data:e,selected:t})=>{var c,l;const{t:r}=Qe(),n=e==null?void 0:e.previewActive,{getNodes:i}=pn(),a=i().find(d=>d.id===e.targetNode),o=((c=a==null?void 0:a.data)==null?void 0:c.displayName)||((l=a==null?void 0:a.data)==null?void 0:l.label)||r("editor.nodes.returnSelectNode"),u=e.targetNode?e.targetNode.substring(0,8):"";return h.jsxs("div",{className:`
				min-w-[220px] rounded-lg border-2 bg-card shadow-lg
				${t||n?"border-primary ring-2 ring-primary/20":"border-orange-500"}
			`,children:[h.jsx(He,{type:"target",position:ue.Top,className:"!bg-orange-500 !w-3 !h-3 !border-2 !border-white"}),h.jsxs("div",{className:"bg-orange-500 text-white px-4 py-2 rounded-t-md flex items-center gap-2",children:[h.jsx(pi,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||r("editor.nodes.return")})]}),h.jsxs("div",{className:"p-4 space-y-2",children:[h.jsx("div",{className:"text-xs text-muted-foreground",children:r("editor.nodes.returnTarget")}),h.jsx("div",{className:"font-medium text-sm text-foreground",children:o}),u&&h.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[h.jsx(O0,{className:"h-3 w-3"}),h.jsx("code",{children:u})]})]})]})});Cb.displayName="ReturnNode";const Sb=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive,s=M0(u=>u.dialogues).find(u=>u.id===e.targetDialogue),a=(s==null?void 0:s.name)||r("editor.nodes.openChildGraphSelectDialogue"),o=e.targetDialogue?e.targetDialogue.substring(0,8):"";return h.jsxs("div",{className:`
				min-w-[220px] rounded-lg border-2 bg-card shadow-lg
				${t||n?"border-primary ring-2 ring-primary/20":"border-cyan-500"}
			`,children:[h.jsx(He,{type:"target",position:ue.Top,className:"!bg-cyan-500 !w-3 !h-3 !border-2 !border-white"}),h.jsxs("div",{className:"bg-cyan-500 text-slate-900 px-4 py-2 rounded-t-md flex items-center gap-2",children:[h.jsx(gi,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||r("editor.nodes.openChildGraph")})]}),h.jsxs("div",{className:"p-4 space-y-2",children:[h.jsx("div",{className:"text-xs text-muted-foreground",children:r("editor.nodes.openChildGraphTarget")}),h.jsx("div",{className:"font-medium text-sm text-foreground",children:a}),o&&h.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[h.jsx(O0,{className:"h-3 w-3"}),h.jsx("code",{children:o})]})]})]})});Sb.displayName="OpenChildGraphNode";const jb=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive,i="#CC2100",s="rgba(204, 33, 0, 0.12)",a=e.dialogueRows||(e.text?[{text:e.text}]:[]),o=a[0],u=a.length>1,c=o!=null&&o.text?o.text.length>50?o.text.substring(0,50)+"...":o.text:r("editor.nodes.completePlaceholder"),l=[];e.participant&&l.push(`${r("editor.nodes.tooltip.participant")}: ${e.participant}`),e.decorators&&e.decorators.length>0&&l.push(`${r("editor.nodes.tooltip.decorators")}: ${e.decorators.length}`),a.length>0&&l.push(`${r("editor.nodes.tooltip.dialogueRows")}: ${a.length}`);const d=l.join(`
`);return h.jsxs("div",{className:"min-w-[250px] rounded-lg border-2 bg-card shadow-lg",style:{borderColor:i,boxShadow:t||n?`0 0 0 4px ${s}`:void 0},title:d,children:[h.jsx(He,{type:"target",position:ue.Top,className:"!w-3 !h-3 !border-2 !border-white",style:{backgroundColor:i}}),h.jsxs("div",{className:"text-white px-4 py-2 rounded-t-md flex items-center justify-between",style:{backgroundColor:i},children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(fi,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||e.participant||r("editor.nodes.complete")})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[u&&h.jsx("span",{className:"text-xs opacity-80",children:r("editor.nodes.rows",{count:a.length})}),e.hasAudio&&h.jsx(an,{className:"h-3 w-3"})]})]}),h.jsxs("div",{className:"p-4 space-y-2",children:[h.jsx("p",{className:"text-sm text-foreground",children:c}),e.participant&&h.jsx("div",{className:"flex items-center gap-2 pt-1",children:h.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:s,color:i},children:[h.jsx(br,{className:"h-3 w-3"}),e.participant]})}),e.decorators&&e.decorators.length>0&&h.jsx("div",{className:"flex flex-wrap gap-1 pt-2 border-t",children:e.decorators.map((f,p)=>h.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:s,color:i},title:f.values&&Object.keys(f.values).length>0?Object.entries(f.values).map(([m,x])=>`${m}: ${x}`).join(", "):void 0,children:[h.jsx(hi,{className:"h-3 w-3"}),f.name||f]},p))})]})]})});jb.displayName="CompleteNode";function dI({id:e,data:t,selected:r,positionAbsoluteX:n,positionAbsoluteY:i}){const{t:s}=Qe(),a=()=>{if(t.onClick){const o={x:n,y:i};t.onClick(e,o,t.parentNodeId)}};return h.jsxs("div",{className:`
				relative bg-card border-2 border-dashed rounded-lg p-4 min-w-[180px]
				transition-all cursor-pointer hover:border-primary hover:bg-accent
				${r?"border-primary shadow-lg":"border-border"}
			`,onClick:a,children:[h.jsx(He,{type:"target",position:ue.Top,className:"w-3 h-3 !bg-muted-foreground"}),h.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-muted-foreground",children:[h.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:h.jsx(xr,{className:"h-5 w-5"})}),h.jsx("span",{className:"text-sm font-medium",children:s("editor.placeholder.addNode")})]}),h.jsx(He,{type:"source",position:ue.Bottom,className:"w-3 h-3 !bg-muted-foreground"})]})}const fI=C.memo(dI),kb=C.memo(({data:e,selected:t})=>{const{t:r}=Qe(),n=e==null?void 0:e.previewActive,i="#7dd3fc",s="rgba(125, 211, 252, 0.18)",a=typeof e.duration=="number"?e.duration:1;return h.jsxs("div",{className:"min-w-[230px] rounded-lg border-2 bg-card shadow-lg",style:{borderColor:i,boxShadow:t||n?`0 0 0 4px ${s}`:void 0},children:[h.jsx(He,{type:"target",position:ue.Top,className:"!w-3 !h-3 !border-2 !border-white",style:{backgroundColor:i}}),h.jsxs("div",{className:"text-slate-900 px-4 py-2 rounded-t-md flex items-center justify-between",style:{backgroundColor:i},children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ld,{className:"h-4 w-4"}),h.jsx("span",{className:"font-semibold text-sm",children:e.displayName||r("editor.nodes.delay")})]}),h.jsx("span",{className:"text-xs font-medium",children:r("editor.nodes.delaySeconds",{count:a})})]}),h.jsx("div",{className:"p-4",children:h.jsx("p",{className:"text-sm text-foreground",children:r("editor.nodes.delayDescription",{count:a})})}),h.jsx(He,{type:"source",position:ue.Bottom,className:"!w-3 !h-3 !border-2 !border-white",style:{backgroundColor:i}})]})});kb.displayName="DelayNode";const Rb=C.memo(e=>{var w;const{id:t,sourceX:r,sourceY:n,targetX:i,targetY:s,sourcePosition:a,targetPosition:o,style:u,markerEnd:c,data:l,selected:d}=e,[f,p,m]=Ed({sourceX:r,sourceY:n,sourcePosition:a,targetX:i,targetY:s,targetPosition:o}),x=!!(l!=null&&l.isPlaceholder),v=(Array.isArray((w=l==null?void 0:l.conditions)==null?void 0:w.rules)?l.conditions.rules.length:0)>0;return h.jsxs(h.Fragment,{children:[h.jsx(gn,{id:t,path:f,markerEnd:c,style:u}),!x&&h.jsx(mj,{children:h.jsx("div",{className:"nodrag nopan absolute",style:{transform:`translate(-50%, -50%) translate(${p}px, ${m}px)`,pointerEvents:"all"},children:h.jsxs("button",{type:"button",className:`relative h-7 w-7 rounded-full border bg-background shadow-sm inline-flex items-center justify-center transition-colors ${d?"border-primary text-primary bg-background":v?"border-primary/50 text-primary bg-background hover:border-primary/70":"border-border text-muted-foreground bg-background hover:text-foreground hover:border-primary/40"}`,onClick:g=>{var b;g.preventDefault(),g.stopPropagation(),(b=l==null?void 0:l.onOpenDetails)==null||b.call(l,t)},"aria-label":"Open edge conditions",children:[h.jsx(bw,{className:"h-3.5 w-3.5"}),v&&h.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-primary/80 ring-2 ring-background"})]})})})]})});Rb.displayName="ConditionEdge";const Ib=e=>{const t={};return e!=null&&e.properties&&e.properties.forEach(r=>{t[r.name]=r.defaultValue??""}),t},hI=e=>({id:e.id,name:e.name,values:Ib(e),negate:!1}),Dl=e=>typeof e=="boolean"?e:typeof e=="string"?e.toLowerCase()==="true":!!e;function pI({conditionGroup:e,availableConditions:t=[],onChange:r}){const{t:n}=Qe(),[i,s]=C.useState(""),a=C.useMemo(()=>({mode:(e==null?void 0:e.mode)==="any"?"any":"all",rules:Array.isArray(e==null?void 0:e.rules)?e.rules:[]}),[e]),o=f=>{r==null||r({mode:(f==null?void 0:f.mode)==="any"?"any":"all",rules:Array.isArray(f==null?void 0:f.rules)?f.rules:[]})},u=(f,p,m)=>{const x=[...a.rules],y=x[f];y&&(x[f]={...y,values:{...y.values||{},[p]:m}},o({...a,rules:x}))},c=()=>{if(!i)return;const f=t.find(p=>p.id===i);f&&(o({...a,rules:[...a.rules,hI(f)]}),s(""))},l=f=>{o({...a,rules:a.rules.filter((p,m)=>m!==f)})},d=(f,p)=>{const m=[...a.rules],x=m[f];x&&(m[f]={...x,negate:p},o({...a,rules:m}))};return h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"grid gap-2",children:[h.jsx($e,{children:n("editor.conditions.passWhen")}),h.jsxs(mr,{value:a.mode,onChange:f=>o({...a,mode:f.target.value}),children:[h.jsx("option",{value:"all",children:n("editor.conditions.modeAll")}),h.jsx("option",{value:"any",children:n("editor.conditions.modeAny")})]})]}),a.rules.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:n("editor.conditions.empty")}):h.jsx("div",{className:"space-y-3",children:a.rules.map((f,p)=>{const m=t.find(v=>v.id===f.id),x=(m==null?void 0:m.properties)||[],y={...Ib(m),...f.values||{}};return h.jsxs("div",{className:"rounded-lg border border-border p-3 space-y-3 bg-card",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold",children:f.name||f.id}),(m==null?void 0:m.description)&&h.jsx("p",{className:"text-xs text-muted-foreground",children:m.description})]}),h.jsx(ye,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:()=>l(p),children:h.jsx(Wr,{className:"h-3.5 w-3.5 text-destructive"})})]}),h.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[h.jsx($e,{className:"text-sm",children:n("editor.conditions.negate")}),h.jsx(Qn,{checked:Dl(f.negate),onCheckedChange:v=>d(p,v)})]}),x.map(v=>h.jsxs("div",{className:"space-y-2",children:[h.jsxs($e,{children:[v.name,h.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",v.type,")"]})]}),v.type==="string"&&h.jsx(Dt,{value:y[v.name]??"",onChange:w=>u(p,v.name,w.target.value)}),(v.type==="int"||v.type==="float")&&h.jsx(Dt,{type:"number",step:v.type==="int"?1:.01,value:y[v.name]??0,onChange:w=>{const g=w.target.value,b=v.type==="int"?parseInt(g,10):parseFloat(g);u(p,v.name,Number.isNaN(b)?0:b)}}),v.type==="bool"&&h.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[h.jsx($e,{className:"text-sm font-medium",children:Dl(y[v.name])?n("common.true"):n("common.false")}),h.jsx(Qn,{checked:Dl(y[v.name]),onCheckedChange:w=>u(p,v.name,w)})]})]},v.name))]},`${f.id}-${p}`)})}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs(mr,{value:i,onChange:f=>s(f.target.value),className:"flex-1",children:[h.jsx("option",{value:"",children:n("editor.conditions.selectPlaceholder")}),t.map(f=>h.jsx("option",{value:f.id,children:f.name},f.id))]}),h.jsxs(ye,{variant:"outline",size:"sm",onClick:c,disabled:!i,className:"gap-2 shrink-0",children:[h.jsx(xr,{className:"h-3.5 w-3.5"}),n("common.add")]})]})]})}const Ab=C.forwardRef(({className:e,min:t=0,max:r=100,step:n=1,value:i=[50],onValueChange:s,...a},o)=>{const u=c=>{const l=parseFloat(c.target.value);s&&s([l])};return h.jsx("input",{ref:o,type:"range",min:t,max:r,step:n,value:i[0],onChange:u,className:Yt("w-full h-2 bg-secondary rounded-lg appearance-none cursor-pointer","[&::-webkit-slider-thumb]:appearance-none","[&::-webkit-slider-thumb]:w-5","[&::-webkit-slider-thumb]:h-5","[&::-webkit-slider-thumb]:rounded-full","[&::-webkit-slider-thumb]:bg-primary","[&::-webkit-slider-thumb]:cursor-pointer","[&::-webkit-slider-thumb]:border-2","[&::-webkit-slider-thumb]:border-background","[&::-webkit-slider-thumb]:shadow-sm","[&::-moz-range-thumb]:w-5","[&::-moz-range-thumb]:h-5","[&::-moz-range-thumb]:rounded-full","[&::-moz-range-thumb]:bg-primary","[&::-moz-range-thumb]:cursor-pointer","[&::-moz-range-thumb]:border-2","[&::-moz-range-thumb]:border-background","[&::-moz-range-thumb]:shadow-sm","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",e),...a})});Ab.displayName="Slider";async function gI(e){try{const t=await e.arrayBuffer(),r={id:crypto.randomUUID(),name:e.name,type:e.type,size:e.size,data:t,createdAt:new Date().toISOString()};return{id:r.id,name:r.name,type:r.type,size:r.size,blob:new Blob([t],{type:e.type}),dataUrl:await mI(e)}}catch(t){throw console.error("Error storing audio file:",t),t}}function mI(e){return new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)})}function vI(e){return new Promise((t,r)=>{const n=new Audio,i=URL.createObjectURL(e);n.addEventListener("loadedmetadata",()=>{URL.revokeObjectURL(i),t(n.duration)}),n.addEventListener("error",()=>{URL.revokeObjectURL(i),r(new Error("Failed to load audio"))}),n.src=i})}function yI(e){return["audio/wav","audio/mpeg","audio/mp3"].includes(e.type)?e.size>10485760?{valid:!1,error:"File too large. Maximum size is 10MB."}:{valid:!0}:{valid:!1,error:"Invalid file type. Please upload WAV or MP3 files."}}function xI({dialogueRows:e=[],onChange:t,participants:r=[]}){const{toast:n}=P0(),[i,s]=C.useState(new Set([0])),[a,o]=C.useState(null),u=C.useRef({}),c=C.useRef({}),l=C.useRef({}),[d,f]=C.useState({});C.useEffect(()=>{if(!e.some(q=>!(q!=null&&q.id)))return;const R=e.map(q=>({...q,id:(q==null?void 0:q.id)||hr(),text:(q==null?void 0:q.text)||"",duration:typeof(q==null?void 0:q.duration)=="number"?q.duration:3,audioFile:(q==null?void 0:q.audioFile)||null}));t(R)},[e,t]),C.useEffect(()=>{const M=new Set;e.forEach(R=>{if(R.audioFile){M.add(R.id);let q=null,V=!1;if(R.audioFile.blob)q=URL.createObjectURL(R.audioFile.blob),V=!0;else if(R.audioFile.dataUrl)try{const G=R.audioFile.dataUrl.split(","),Y=G[0].match(/:(.*?);/)[1],J=atob(G[1]);let P=J.length;const B=new Uint8Array(P);for(;P--;)B[P]=J.charCodeAt(P);const z=new Blob([B],{type:Y});q=URL.createObjectURL(z),V=!0}catch(G){console.error("Error creating audio URL:",G)}else R.audioFile.url&&(q=R.audioFile.url);q&&c.current[R.id]!==q&&(c.current[R.id]&&l.current[R.id]&&c.current[R.id].startsWith("blob:")&&c.current[R.id]!==q&&URL.revokeObjectURL(c.current[R.id]),c.current[R.id]=q,l.current[R.id]=V)}}),Object.keys(c.current).forEach(R=>{M.has(R)||(c.current[R]&&l.current[R]&&c.current[R].startsWith("blob:")&&URL.revokeObjectURL(c.current[R]),delete c.current[R],delete l.current[R])}),Object.keys(u.current).forEach(R=>{M.has(R)||delete u.current[R]}),f({...c.current})},[e]),C.useEffect(()=>{const M=c.current,R=l.current;return()=>{Object.keys(M).forEach(q=>{const V=M[q];V&&R[q]&&V.startsWith("blob:")&&URL.revokeObjectURL(V)})}},[]);const p=M=>{const R=new Set(i);R.has(M)?R.delete(M):R.add(M),s(R)},m=()=>{const M={id:hr(),text:"",audioFile:null,duration:3},R=[...e,M];t(R),s(new Set([...i,e.length]))},x=M=>{const R=e.filter((V,G)=>G!==M);t(R);const q=new Set(i);q.delete(M),s(q)},y=(M,R)=>{const q=e.map((V,G)=>G===M?{...V,...R}:V);t(q)},[v,w]=C.useState(null),[g,b]=C.useState(!1),[_,N]=C.useState({top:0,left:0}),[E,I]=C.useState(""),A=C.useRef({}),L=(M,R,q)=>{y(M,{text:R});const V=q.target.selectionStart,G=R.substring(0,V),Y=G.lastIndexOf("$");if(Y!==-1&&V-Y<=20){const J=G.substring(Y+1);if(!J.includes("}")&&!J.includes(" ")&&!J.includes(`
`)){w(M),I(J.toLowerCase()),b(!0);const B=q.target.getBoundingClientRect();N({top:B.top-150,left:B.left+10})}else b(!1)}else b(!1)},T=M=>{if(v===null)return;const R=e[v],q=A.current[v];if(!q)return;const V=q.selectionStart,Y=R.text.substring(0,V).lastIndexOf("$"),J=R.text.substring(0,Y)+`\${${M}}`+R.text.substring(V);y(v,{text:J}),b(!1),setTimeout(()=>{q.focus();const P=Y+M.length+3;q.setSelectionRange(P,P)},0)},j=r.filter(M=>M.name.toLowerCase().includes(E)),F=async(M,R)=>{if(!R)return;const q=yI(R);if(!q.valid){n({variant:"error",title:"Invalid Audio File",description:q.error});return}try{const V=await gI(R),G=await vI(R);y(M,{audioFile:V,duration:G||3}),n({variant:"success",title:"Audio Uploaded",description:`${R.name} uploaded successfully`})}catch(V){console.error("Error uploading audio:",V),n({variant:"error",title:"Upload Failed",description:"Failed to upload audio file. Please try again."})}},S=M=>{const R=u.current[M];if(!R)return;const q=c.current[M]||d[M];if(!q){n({variant:"error",title:"Playback Failed",description:"No audio source found for this row."});return}R.src!==q&&(R.src=q,R.load()),a===M?(R.pause(),o(null)):(a!==null&&u.current[a]&&u.current[a].pause(),R.play().then(()=>{o(M)}).catch(V=>{console.error("Error playing audio:",V),o(null),n({variant:"error",title:"Playback Failed",description:"Failed to play audio clip."})}))},D=M=>{a===M&&o(null)},O=M=>{const R=e[M];R&&(c.current[R.id]&&l.current[R.id]&&c.current[R.id].startsWith("blob:")&&URL.revokeObjectURL(c.current[R.id]),delete c.current[R.id],delete l.current[R.id],f(q=>{const V={...q};return delete V[R.id],V})),y(M,{audioFile:null}),R&&a===R.id&&o(null)};return h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx($e,{className:"text-sm font-bold",children:"Dialogue Rows"}),h.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.length," ",e.length===1?"row":"rows"]})]}),e.length===0?h.jsxs("div",{className:"text-center py-6 border border-dashed border-border rounded-lg",children:[h.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"No dialogue rows yet"}),h.jsxs(ye,{variant:"outline",size:"sm",onClick:m,className:"gap-2",children:[h.jsx(xr,{className:"h-3.5 w-3.5"}),"Add First Row"]})]}):h.jsx("div",{className:"space-y-2",children:e.map((M,R)=>{const q=i.has(R),V=M.text?M.text.length>40?M.text.substring(0,40)+"...":M.text:"Empty dialogue...";return h.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[h.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>p(R),children:[h.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[q?h.jsx(fd,{className:"h-4 w-4 text-muted-foreground shrink-0"}):h.jsx(dd,{className:"h-4 w-4 text-muted-foreground shrink-0"}),h.jsxs("span",{className:"text-xs font-medium text-muted-foreground shrink-0",children:["[",R,"]"]}),h.jsx("span",{className:"text-sm flex-1 truncate",children:V})]}),h.jsx(ye,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:G=>{G.stopPropagation(),x(R)},children:h.jsx(Wr,{className:"h-3.5 w-3.5 text-destructive"})})]}),q&&h.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-border",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs($e,{htmlFor:`text-${M.id}`,children:["Dialogue Text",h.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Type $ for participants)"})]}),h.jsx(Hb,{id:`text-${M.id}`,ref:G=>A.current[R]=G,value:M.text||"",onChange:G=>L(R,G.target.value,G),placeholder:"Enter dialogue text... Type $ to insert participant names",className:"min-h-[100px] font-mono text-sm"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx($e,{htmlFor:`audio-${M.id}`,children:"Audio Clip"}),M.audioFile?h.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent/50 rounded-lg border border-border",children:[h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>S(M.id),children:a===M.id?h.jsx(Hw,{className:"h-4 w-4"}):h.jsx(Jn,{className:"h-4 w-4"})}),h.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(an,{className:"h-3 w-3 text-muted-foreground"}),h.jsx("span",{className:"text-sm font-medium truncate",children:M.audioFile.name})]}),h.jsxs("span",{className:"text-xs text-muted-foreground",children:[(M.audioFile.size/1024).toFixed(1)," KB"]})]}),h.jsx(ye,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:()=>O(R),children:h.jsx(Un,{className:"h-3.5 w-3.5 text-destructive"})}),h.jsx("audio",{ref:G=>u.current[M.id]=G,src:d[M.id]||"",onEnded:()=>D(M.id),className:"hidden"})]}):h.jsx(Dt,{id:`audio-${M.id}`,type:"file",accept:".wav,.mp3,audio/wav,audio/mpeg",onChange:G=>{var J;const Y=(J=G.target.files)==null?void 0:J[0];Y&&F(R,Y),G.target.value=""},className:"cursor-pointer"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx($e,{htmlFor:`duration-${M.id}`,children:"Duration (seconds)"}),h.jsxs("span",{className:"text-sm font-medium",children:[M.duration.toFixed(1),"s"]})]}),h.jsx(Ab,{id:`duration-${M.id}`,value:[M.duration],onValueChange:([G])=>y(R,{duration:G}),min:.5,max:30,step:.1,className:"w-full"})]})]})]},M.id)})}),e.length>0&&h.jsxs(ye,{variant:"outline",size:"sm",onClick:m,className:"w-full gap-2",children:[h.jsx(xr,{className:"h-3.5 w-3.5"}),"Add Dialogue Row"]}),g&&j.length>0&&h.jsx("div",{className:"fixed z-50 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto",style:{top:`${_.top}px`,left:`${_.left}px`,minWidth:"200px"},children:j.map(M=>h.jsxs("button",{onClick:()=>T(M.name),className:"w-full px-3 py-2 text-left text-sm hover:bg-accent transition-colors flex items-center gap-2",children:[h.jsx("span",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:M.name.charAt(0).toUpperCase()}),h.jsx("span",{children:M.name})]},M.id))})]})}function bI({decorators:e=[],availableDecorators:t=[],onAddDecorator:r,onRemoveDecorator:n,onUpdateDecorator:i}){const{t:s}=Qe(),[a,o]=C.useState(new Set([0])),[u,c]=C.useState(""),l=m=>{const x=new Set(a);x.has(m)?x.delete(m):x.add(m),o(x)},d=()=>{if(!u)return;const m=t.find(x=>x.id===u);m&&(r(m),c(""),o(new Set([...a,e.length])))},f=(m,x,y)=>{const w={...e[m].values,[x]:y};i(m,w)},p=m=>typeof m=="boolean"?m:typeof m=="string"?m.toLowerCase()==="true":!!m;return h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx($e,{className:"text-sm font-bold",children:s("decorators.panelTitle")}),h.jsx("span",{className:"text-xs text-muted-foreground",children:s("decorators.count",{count:e.length})})]}),e.length===0?h.jsx("div",{className:"text-center py-6 border border-dashed border-border rounded-lg",children:h.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s("decorators.none")})}):h.jsx("div",{className:"space-y-2",children:e.map((m,x)=>{const y=a.has(x),v=t.find(g=>g.id===m.id),w=(v==null?void 0:v.properties)&&v.properties.length>0;return h.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[h.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>l(x),children:[h.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[y?h.jsx(fd,{className:"h-4 w-4 text-muted-foreground shrink-0"}):h.jsx(dd,{className:"h-4 w-4 text-muted-foreground shrink-0"}),h.jsxs("span",{className:"text-xs font-medium text-muted-foreground shrink-0",children:["[",x,"]"]}),h.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[h.jsx(hi,{className:"h-3.5 w-3.5 text-primary shrink-0"}),h.jsx("span",{className:"text-sm font-medium truncate",children:m.name||s("decorators.unnamed")})]})]}),h.jsx(ye,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:g=>{g.stopPropagation(),n(x)},children:h.jsx(Wr,{className:"h-3.5 w-3.5 text-destructive"})})]}),y&&w&&h.jsx("div",{className:"p-4 pt-0 space-y-4 border-t border-border",children:v.properties.map(g=>h.jsxs("div",{className:"space-y-2",children:[h.jsxs($e,{htmlFor:`${m.id}-${x}-${g.name}`,children:[g.name,h.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",g.type,")"]})]}),g.type==="string"&&h.jsx(Dt,{id:`${m.id}-${x}-${g.name}`,value:m.values[g.name]||"",onChange:b=>f(x,g.name,b.target.value),placeholder:s("decorators.enterProperty",{name:g.name})}),g.type==="number"&&h.jsx(Dt,{id:`${m.id}-${x}-${g.name}`,type:"number",value:m.values[g.name]||0,onChange:b=>f(x,g.name,parseFloat(b.target.value)||0),placeholder:s("decorators.enterProperty",{name:g.name})}),g.type==="boolean"&&h.jsxs("div",{className:"flex items-center justify-between rounded-md border border-input bg-background px-3 py-2",children:[h.jsx($e,{htmlFor:`${m.id}-${x}-${g.name}`,className:"text-sm font-medium",children:p(m.values[g.name])?s("common.true"):s("common.false")}),h.jsx(Qn,{id:`${m.id}-${x}-${g.name}`,checked:p(m.values[g.name]),onCheckedChange:b=>f(x,g.name,b)})]})]},g.name))})]},`${m.id}-${x}`)})}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs(mr,{value:u,onChange:m=>c(m.target.value),className:"flex-1",children:[h.jsx("option",{value:"",children:s("decorators.selectPlaceholder")}),t.map(m=>h.jsx("option",{value:m.id,children:m.name},m.id))]}),h.jsxs(ye,{variant:"outline",size:"sm",onClick:d,disabled:!u,className:"gap-2 shrink-0",children:[h.jsx(xr,{className:"h-3.5 w-3.5"}),s("common.add")]})]})]})}function k0({title:e,defaultOpen:t=!0,children:r}){const[n,i]=C.useState(t);return h.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[h.jsxs("button",{onClick:()=>i(!n),className:"w-full px-4 py-3 flex items-center justify-between bg-muted/50 hover:bg-muted transition-colors",children:[h.jsx("h4",{className:"text-sm font-semibold",children:e}),n?h.jsx(fd,{className:"h-4 w-4 text-muted-foreground"}):h.jsx(dd,{className:"h-4 w-4 text-muted-foreground"})]}),n&&h.jsx("div",{className:"p-4 space-y-3",children:r})]})}function wI({status:e="saved",lastSaved:t,className:r}){const{t:n}=Qe(),i={saved:{icon:Dw,iconClass:"text-green-500",text:n("editor.saveStatus.saved"),dotClass:"bg-green-500"},saving:{icon:Gb,iconClass:"text-blue-500 animate-spin",text:n("editor.saveStatus.saving"),dotClass:"bg-blue-500"},unsaved:{icon:Lw,iconClass:"text-orange-500",text:n("editor.saveStatus.unsaved"),dotClass:"bg-orange-500 animate-pulse"},error:{icon:Vb,iconClass:"text-red-500",text:n("editor.saveStatus.error"),dotClass:"bg-red-500"}},s=i[e]||i.saved,a=s.icon,o=u=>{if(!u)return"";const l=new Date-u;if(l<6e4)return n("common.time.justNow");if(l<36e5){const d=Math.floor(l/6e4);return n("common.time.minutesAgo",{count:d})}if(l<864e5){const d=Math.floor(l/36e5);return n("common.time.hoursAgo",{count:d})}return u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return h.jsxs("div",{className:Yt("flex items-center gap-2 text-sm text-muted-foreground",r),children:[h.jsxs("div",{className:"flex items-center gap-1.5",children:[h.jsx(a,{className:Yt("h-3.5 w-3.5",s.iconClass)}),h.jsx("span",{className:"font-medium",children:s.text})]}),t&&e==="saved"&&h.jsxs("span",{className:"text-xs opacity-70",children:["(",o(t),")"]})]})}const _I={type:"startNode",label:"Start",description:"Dialogue entry point",section:"system",creatable:!1,canHaveOutputs:!0,minimapColor:"#22c55e",defaultData:{label:"Dialogue entry point",displayName:"Start",text:"",participant:"",decorators:[],dialogueRows:[],selectionTitle:"",hasAudio:!1},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]}]},NI={type:"leadNode",label:"NPC",description:"Add an NPC dialogue node",section:"dialogue",creatable:!0,canHaveOutputs:!0,icon:"messageCircle",colorClass:"text-blue-500",minimapColor:"#3b82f6",defaultData:{label:"New NPC",displayName:"NPC",text:"",participant:"",decorators:[],dialogueRows:[],selectionTitle:"",hasAudio:!1},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"participant",type:"select",labelKey:"editor.sections.participant",placeholderKey:"editor.sections.participantPlaceholder",required:!0,options:"participants"},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]},{id:"dialogueDetails",titleKey:"editor.sections.dialogueDetails",defaultOpen:!0,fields:[{id:"selectionTitle",type:"text",labelKey:"editor.sections.selectionTitle",placeholderKey:"editor.sections.selectionTitlePlaceholder"},{id:"dialogueRows",type:"dialogueRows",labelKey:"editor.sections.dialogueRows"}]},{id:"nodeDecorators",titleKey:"editor.sections.nodeDecorators",defaultOpen:!1,fields:[{id:"decorators",type:"decorators"}]}]},EI={type:"answerNode",label:"Player",description:"Add a player response node",section:"dialogue",creatable:!0,canHaveOutputs:!0,icon:"user",colorClass:"text-purple-500",minimapColor:"#8b5cf6",defaultData:{label:"New Player",displayName:"Player",text:"",participant:"",decorators:[],dialogueRows:[],selectionTitle:"",hasAudio:!1},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"participant",type:"select",labelKey:"editor.sections.participant",placeholderKey:"editor.sections.participantPlaceholder",required:!0,options:"participants"},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]},{id:"dialogueDetails",titleKey:"editor.sections.dialogueDetails",defaultOpen:!0,fields:[{id:"selectionTitle",type:"text",labelKey:"editor.sections.selectionTitle",placeholderKey:"editor.sections.selectionTitlePlaceholder"},{id:"dialogueRows",type:"dialogueRows",labelKey:"editor.sections.dialogueRows"}]},{id:"nodeDecorators",titleKey:"editor.sections.nodeDecorators",defaultOpen:!1,fields:[{id:"decorators",type:"decorators"}]}]},CI={type:"returnNode",label:"Return",description:"Return to a previous node",section:"flow",creatable:!0,canHaveOutputs:!1,icon:"cornerUpLeft",colorClass:"text-orange-500",minimapColor:"#f97316",defaultData:{label:"New Return",displayName:"Return",targetNode:""},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]},{id:"returnTarget",titleKey:"editor.sections.dialogueDetails",defaultOpen:!0,fields:[{id:"targetNode",type:"select",labelKey:"editor.sections.targetNode",placeholderKey:"editor.sections.targetNodePlaceholder",options:"nodes"}]}]},SI={type:"openChildGraphNode",label:"Open Child Graph",description:"Open another dialogue in this project",section:"flow",creatable:!0,canHaveOutputs:!1,icon:"externalLink",colorClass:"text-cyan-500",minimapColor:"#06b6d4",defaultData:{label:"Open Child Graph",displayName:"Open Child Graph",targetDialogue:""},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]},{id:"childGraphTarget",titleKey:"editor.sections.dialogueDetails",defaultOpen:!0,fields:[{id:"targetDialogue",type:"select",labelKey:"editor.sections.targetDialogue",placeholderKey:"editor.sections.targetDialoguePlaceholder",options:"dialogues",required:!0}]}]},jI={type:"completeNode",label:"Complete",description:"Mark dialogue as complete",section:"flow",creatable:!0,canHaveOutputs:!1,icon:"checkCircle2",colorClass:"text-[#CC2100]",minimapColor:"#CC2100",defaultData:{label:"New Complete",displayName:"Complete",text:"",participant:"",decorators:[],dialogueRows:[],selectionTitle:"",hasAudio:!1},sections:[{id:"nodeData",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"displayName",type:"text",labelKey:"editor.sections.displayName",placeholderKey:"editor.sections.displayNamePlaceholder",required:!0,maxLength:64},{id:"participant",type:"select",labelKey:"editor.sections.participant",placeholderKey:"editor.sections.participantPlaceholder",required:!0,options:"participants"},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]},{id:"dialogueDetails",titleKey:"editor.sections.dialogueDetails",defaultOpen:!0,fields:[{id:"selectionTitle",type:"text",labelKey:"editor.sections.selectionTitle",placeholderKey:"editor.sections.selectionTitlePlaceholder"},{id:"dialogueRows",type:"dialogueRows",labelKey:"editor.sections.dialogueRows"}]},{id:"nodeDecorators",titleKey:"editor.sections.nodeDecorators",defaultOpen:!1,fields:[{id:"decorators",type:"decorators"}]}]},kI={type:"delayNode",label:"Delay",description:"Pause the dialogue for a set duration",section:"flow",creatable:!0,canHaveOutputs:!0,icon:"clock",colorClass:"text-sky-400",minimapColor:"#7dd3fc",defaultData:{label:"New Delay",displayName:"Delay",duration:1},sections:[{id:"delaySettings",titleKey:"editor.sections.nodeData",defaultOpen:!0,fields:[{id:"duration",type:"slider",label:"Duration (seconds)",min:.1,max:30,step:.1,unit:"s"},{id:"nodeId",type:"nodeId",labelKey:"editor.sections.nodeId"}]}]},RI={startNode:_I,leadNode:NI,answerNode:EI,returnNode:CI,openChildGraphNode:SI,completeNode:jI,delayNode:kI},Yd=RI,gt=e=>Yd[e],II=()=>Object.values(Yd).filter(e=>e.creatable),sd=e=>{var t;return((t=Yd[e])==null?void 0:t.defaultData)||{}};function AI({open:e,onOpenChange:t,onSelectType:r}){const n={messageCircle:ud,user:br,cornerUpLeft:pi,checkCircle2:fi,clock:ld,externalLink:gi},i=II(),s=a=>{r(a),t(!1)};return h.jsx(Ub,{open:e,onOpenChange:t,children:h.jsxs(Kb,{className:"sm:max-w-md",children:[h.jsxs(Yb,{children:[h.jsx(Wb,{children:"Select Node Type"}),h.jsx(Xb,{children:"Choose the type of node you want to add to the dialogue"})]}),h.jsx("div",{className:"grid gap-2 py-4",children:i.map(a=>{const o=n[a.icon];return h.jsxs(ye,{variant:"outline",className:"h-auto p-4 justify-start gap-4",onClick:()=>s(a.type),children:[h.jsx("div",{className:`w-10 h-10 rounded-lg bg-muted flex items-center justify-center ${a.colorClass||""}`,children:o?h.jsx(o,{className:"h-5 w-5"}):null}),h.jsxs("div",{className:"flex flex-col items-start gap-1 text-left",children:[h.jsx("span",{className:"font-semibold",children:a.label}),h.jsx("span",{className:"text-xs text-muted-foreground",children:a.description})]})]},a.type)})})]})})}const ad=C.forwardRef(({className:e,value:t=0,...r},n)=>h.jsx("div",{ref:n,role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.max(0,Math.min(100,t)),className:Yt("relative h-2 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:h.jsx("div",{className:"h-full w-full flex-1 bg-primary transition-all duration-300",style:{transform:`translateX(-${100-Math.max(0,Math.min(100,t))}%)`}})}));ad.displayName="Progress";const di="00000000-0000-0000-0000-000000000001",TI=new Set(["completeNode","openChildGraphNode"]),qI=(e=[],t=[])=>{const r=Array.isArray(e)?e.filter(i=>(i==null?void 0:i.type)!=="placeholderNode"):[],n=Array.isArray(t)?t.filter(i=>{var s;return!((s=i==null?void 0:i.data)!=null&&s.isPlaceholder)}):[];return{regularNodes:r,regularEdges:n}},MI=(e=[],t=[],{maxNodes:r=100}={})=>{const{regularNodes:n,regularEdges:i}=qI(e,t),s=new Map(n.map(d=>[d.id,d]));if(!s.get(di))return{valid:!1,reason:"missing_start"};if(n.length===0)return{valid:!1,reason:"empty_graph"};if(n.length>r)return{valid:!1,reason:"too_many_nodes",details:{maxNodes:r,count:n.length}};if(i.find(d=>!(d!=null&&d.source)||!(d!=null&&d.target)||!s.has(d.source)||!s.has(d.target)))return{valid:!1,reason:"broken_edges"};const u=PI(i),c=new Set,l=[di];for(;l.length>0;){const d=l.shift();c.has(d)||(c.add(d),(u.get(d)||[]).forEach(f=>{c.has(f)||l.push(f)}))}return c.size<=1?{valid:!1,reason:"no_playable_path"}:{valid:!0,graph:{nodeMap:s,outgoing:u,regularNodes:n,regularEdges:i}}},PI=(e=[])=>{const t=new Map;return e.forEach(r=>{!(r!=null&&r.source)||!(r!=null&&r.target)||(t.has(r.source)||t.set(r.source,[]),t.get(r.source).push(r.target))}),t},OI=e=>{if(!(e!=null&&e.data))return[];const t=Array.isArray(e.data.dialogueRows)?e.data.dialogueRows:[];return t.length>0?t:typeof e.data.text=="string"&&e.data.text.trim().length>0?[{id:`${e.id}:legacy`,text:e.data.text,duration:3}]:[]},Ll=(e,t)=>{var r,n,i;if(!e)return"";if((r=e.data)!=null&&r.participant)return e.data.participant;if((n=e.data)!=null&&n.displayName)return e.data.displayName;if((i=e.data)!=null&&i.label)return e.data.label;switch(e.type){case"leadNode":return t("editor.nodes.npc");case"answerNode":return t("editor.nodes.player");case"completeNode":return t("editor.nodes.complete");case"delayNode":return t("editor.nodes.delay");case"returnNode":return t("editor.nodes.return");case"openChildGraphNode":return t("editor.nodes.openChildGraph");default:return t("editor.nodes.start")}},R0=e=>TI.has(e==null?void 0:e.type),DI=e=>{if(!e||typeof e!="object"||Array.isArray(e))return"{}";const t=Object.keys(e).sort().reduce((r,n)=>(r[n]=e[n],r),{});return JSON.stringify(t)},Tb=e=>{if(!e||!e.id)return"";const t=DI(e.values);return`${e.id}:${t}`},LI=(e=[])=>{const t=new Set,r=[];return e.forEach(n=>{var s,a;const i=(a=(s=n==null?void 0:n.data)==null?void 0:s.conditions)==null?void 0:a.rules;Array.isArray(i)&&i.forEach(o=>{const u=Tb(o);!u||t.has(u)||(t.add(u),r.push({key:u,id:o.id,name:o.name||o.id,values:o.values||{}}))})}),r},Fl=(e,t={})=>{var a;const r=(a=e==null?void 0:e.data)==null?void 0:a.conditions,n=Array.isArray(r==null?void 0:r.rules)?r.rules:[];if(n.length===0)return!0;const i=(r==null?void 0:r.mode)==="any"?"any":"all",s=n.map(o=>{const u=Tb(o),c=u&&Object.prototype.hasOwnProperty.call(t,u)?!!t[u]:!0;return o!=null&&o.negate?!c:c});return i==="any"?s.some(Boolean):s.every(Boolean)},FI=e=>{const t=e==null?void 0:e.audioFile;return t?t.blob?{url:URL.createObjectURL(t.blob),revokeOnCleanup:!0}:typeof t.url=="string"&&t.url.trim().length>0?{url:t.url,revokeOnCleanup:!1}:typeof t.dataUrl=="string"&&t.dataUrl.trim().length>0?{url:t.dataUrl,revokeOnCleanup:!1}:null:null},$I=260,I0=600,Gn=220;function zI({open:e,nodes:t=[],edges:r=[],onStop:n,onNodeFocus:i,onNodeChange:s}){const{t:a}=Qe(),[o,u]=C.useState(e),[c,l]=C.useState(!1),[d,f]=C.useState(""),[p,m]=C.useState(""),[x,y]=C.useState([]),[v,w]=C.useState(null),[g,b]=C.useState(100),[_,N]=C.useState(!1),[E,I]=C.useState([]),[A,L]=C.useState({}),[T,j]=C.useState(null),[F,S]=C.useState(0),[D,O]=C.useState(0),[M,R]=C.useState(0),[q,V]=C.useState([]),[G,Y]=C.useState({}),[J,P]=C.useState(!1),[B,z]=C.useState(""),$=C.useRef({timer:null,rowProgressTimer:null,stepCount:0,audio:null,audioObjectUrl:null,closeTimeout:null,isClosingLocked:!1}),K=C.useRef(!1),re=C.useMemo(()=>t.filter(Q=>(Q==null?void 0:Q.type)!=="placeholderNode"),[t]),ee=C.useMemo(()=>r.filter(Q=>{var se;return!((se=Q==null?void 0:Q.data)!=null&&se.isPlaceholder)}),[r]),ne=C.useMemo(()=>new Map(re.map(Q=>[Q.id,Q])),[re]),ce=C.useMemo(()=>{const Q=new Map;return ee.forEach(se=>{Q.has(se.source)||Q.set(se.source,[]),Q.get(se.source).push(se)}),Q},[ee]),ie=C.useCallback(Q=>(ce.get(Q)||[]).filter(fe=>Fl(fe,G)).map(fe=>ne.get(fe.target)).filter(Boolean),[ce,G,ne]),le=C.useMemo(()=>LI(ee),[ee]),oe=C.useCallback(Q=>{const fe=(ce.get(di)||[]).find(he=>ne.has(he.target)&&Fl(he,Q));return(fe==null?void 0:fe.target)||null},[ce,ne]),Z=C.useMemo(()=>{var ge;const Q=oe(G),se=[],fe=new Set;let he=Q,be=0;for(;he&&ne.has(he)&&be<I0&&!fe.has(he);){se.push(he),fe.add(he),be+=1;const we=ne.get(he);if(!we||R0(we))break;if(we.type==="returnNode"){const ke=(ge=we.data)==null?void 0:ge.targetNode;if(!ke||!ne.has(ke))break;he=ke;continue}const Re=ie(he);if(Re.length===0)break;if(Re.length>1&&we.type!=="answerNode"){const ke=A[he];if(!ke||!ne.has(ke))break;he=ke;continue}he=Re[0].id}return se},[ne,ie,A,G,oe]),de=C.useMemo(()=>{const Q=new Set(Z);return E.filter(se=>Q.has(se)).length},[E,Z]),Le=C.useMemo(()=>Z.length===0?0:Math.min(100,Math.round(de/Z.length*100)),[de,Z]),Ne=C.useCallback(()=>{$.current.timer&&(window.clearTimeout($.current.timer),$.current.timer=null),$.current.rowProgressTimer&&(window.clearInterval($.current.rowProgressTimer),$.current.rowProgressTimer=null)},[]),Ae=C.useCallback(()=>{$.current.audio&&($.current.audio.pause(),$.current.audio.src="",$.current.audio=null),$.current.audioObjectUrl&&(URL.revokeObjectURL($.current.audioObjectUrl),$.current.audioObjectUrl=null)},[]),xe=C.useCallback(({withAnimation:Q=!0}={})=>{if(!$.current.isClosingLocked){if($.current.isClosingLocked=!0,Ne(),Ae(),$.current.closeTimeout&&(window.clearTimeout($.current.closeTimeout),$.current.closeTimeout=null),y([]),w(null),m(""),f(""),N(!1),S(0),O(0),R(0),L({}),j(null),s==null||s(null),!Q){l(!1),u(!1),$.current.isClosingLocked=!1,n==null||n({reason:"manual",withAnimation:!1});return}l(!0),$.current.closeTimeout=window.setTimeout(()=>{l(!1),u(!1),$.current.closeTimeout=null,$.current.isClosingLocked=!1,n==null||n({reason:"manual",withAnimation:!0})},$I)}},[Ne,Ae,n,s]),Te=C.useCallback((Q,{available:se=!0,isConditional:fe=!1}={})=>{var we,Re,ke,qe;const he=ie(Q.id),be=Array.isArray((we=Q.data)==null?void 0:we.decorators)?Q.data.decorators.length:0;let ge="continue";return Q.type==="completeNode"?ge="complete":Q.type==="returnNode"?ge="return":Q.type==="openChildGraphNode"?ge="openChildGraph":he.length===0?ge="end":he.length===1&&he[0].type==="completeNode"?ge="complete":he.length===1&&he[0].type==="returnNode"?ge="return":he.length===1&&he[0].type==="openChildGraphNode"&&(ge="openChildGraph"),{id:Q.id,label:((Re=Q.data)==null?void 0:Re.selectionTitle)||((ke=Q.data)==null?void 0:ke.displayName)||((qe=Q.data)==null?void 0:qe.label)||a("editor.preview.choiceFallback"),outcome:ge,decoratorsCount:be,available:se,isConditional:fe}},[ie,a]),ve=C.useCallback(Q=>{const se=ce.get(Q)||[],fe=new Set,he=[];return se.forEach(be=>{var qe,_e;const ge=ne.get(be.target);if(!ge||fe.has(ge.id))return;fe.add(ge.id);const we=(_e=(qe=be==null?void 0:be.data)==null?void 0:qe.conditions)==null?void 0:_e.rules,Re=Array.isArray(we)&&we.length>0,ke=Fl(be,G);he.push(Te(ge,{available:ke,isConditional:Re}))}),he},[ce,ne,G,Te]),Fe=C.useCallback(Q=>{var Re,ke,qe;const se=ne.get(Q);if(!se){xe({withAnimation:!0});return}if($.current.stepCount+=1,$.current.stepCount>I0){xe({withAnimation:!0});return}if(w(se.id),s==null||s(se.id),i==null||i(se.id),se.id!==di&&I(_e=>_e.includes(se.id)?_e:[..._e,se.id]),se.type==="returnNode"){const _e=(Re=se.data)==null?void 0:Re.targetNode;if(!_e||!ne.has(_e)){xe({withAnimation:!0});return}$.current.timer=window.setTimeout(()=>{Fe(_e)},Gn);return}if(se.type==="openChildGraphNode"){xe({withAnimation:!0});return}if(se.type==="delayNode"){const _e=Math.max(200,(Number((ke=se.data)==null?void 0:ke.duration)||.1)*1e3),Ee=ie(se.id),dt=ve(se.id);f(Ll(se,a)),m(a("editor.nodes.delayDescription",{count:Number((qe=se.data)==null?void 0:qe.duration)||1})),N(!1),y([]),O(1),S(1),R(0);const Ft=Date.now();$.current.rowProgressTimer&&window.clearInterval($.current.rowProgressTimer),$.current.rowProgressTimer=window.setInterval(()=>{const We=Date.now()-Ft,wt=Math.min(100,Math.round(We/_e*100));R(wt),wt>=100&&$.current.rowProgressTimer&&(window.clearInterval($.current.rowProgressTimer),$.current.rowProgressTimer=null)},50),$.current.timer=window.setTimeout(()=>{if(R(0),Ee.length===0){xe({withAnimation:!0});return}if(dt.length>1){j(se.id),y(dt);return}window.setTimeout(()=>{Fe(Ee[0].id)},Gn)},_e);return}const fe=OI(se),he=ie(se.id),be=()=>{if(R0(se)){xe({withAnimation:!0});return}const _e=se.type!=="answerNode"?ve(se.id):[];if(_e.length>1){j(se.id),y(_e);return}if(he.length===0){xe({withAnimation:!0});return}R(0),$.current.timer=window.setTimeout(()=>{Fe(he[0].id)},Gn)};if(fe.length===0){m(""),f(Ll(se,a)),N(!1),S(0),O(0),R(0),y([]),be();return}let ge=0;y([]),O(fe.length);const we=()=>{const _e=fe[ge];if(!_e){R(0),be();return}Ae(),f(Ll(se,a)),m(_e.text||""),S(ge+1);const Ee=FI(_e);if(N(!!(Ee!=null&&Ee.url)),Ee!=null&&Ee.url){const We=new Audio(Ee.url);We.volume=Math.max(0,Math.min(1,g/100)),$.current.audio=We,Ee.revokeOnCleanup&&($.current.audioObjectUrl=Ee.url),We.play().catch(()=>{})}const dt=Math.max(200,(Number(_e.duration)||.1)*1e3),Ft=Date.now();R(0),$.current.rowProgressTimer&&window.clearInterval($.current.rowProgressTimer),$.current.rowProgressTimer=window.setInterval(()=>{const We=Date.now()-Ft,wt=Math.min(100,Math.round(We/dt*100));R(wt),wt>=100&&$.current.rowProgressTimer&&(window.clearInterval($.current.rowProgressTimer),$.current.rowProgressTimer=null)},50),ge+=1,$.current.timer=window.setTimeout(we,dt)};we()},[ne,s,i,ie,a,g,xe,Ae,ve]),Ve=C.useCallback(()=>{const Q=oe(G);if(!Q){z(a("editor.preview.invalidNoPlayablePath"));return}z(""),P(!0),$.current.stepCount=0,Fe(Q)},[Fe,oe,G,a]);C.useEffect(()=>{if(!e){K.current=!1,$.current.closeTimeout&&(window.clearTimeout($.current.closeTimeout),$.current.closeTimeout=null),$.current.isClosingLocked=!1,u(!1);return}if(K.current)return;K.current=!0,u(!0),l(!1),y([]),N(!1),I([]),L({}),j(null),S(0),O(0),R(0),z("");const Q=le.reduce((he,be)=>(he[be.key]=!0,he),{}),se=oe(Q);V(le),Y(Q);const fe=le.length>0;if(P(!fe),w(fe?null:se),!fe&&!se){xe({withAnimation:!0});return}return fe||($.current.stepCount=0,Fe(se)),()=>{Ne(),Ae()}},[e,Fe,Ne,Ae,xe,oe,le]),C.useEffect(()=>{if(!o)return;const Q=se=>{if(se.key==="Escape"&&(se.preventDefault(),xe({withAnimation:!1})),se.key==="Backspace"){const fe=se.target;(fe==null?void 0:fe.tagName)==="INPUT"||(fe==null?void 0:fe.tagName)==="TEXTAREA"||(fe==null?void 0:fe.isContentEditable)||(se.preventDefault(),xe({withAnimation:!1}))}};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[o,xe]),C.useEffect(()=>{$.current.audio&&($.current.audio.volume=Math.max(0,Math.min(1,g/100)))},[g]);const Be=!J&&q.length>0,Ye=C.useCallback(Q=>{const se=Object.entries(Q||{});return se.length===0?"":se.map(([fe,he])=>`${fe}: ${String(he)}`).join(", ")},[]);return o?h.jsx("div",{className:"absolute inset-0 z-40 flex items-center justify-center bg-background/45 backdrop-blur-sm",children:h.jsxs("div",{className:`w-full max-w-2xl mx-6 rounded-2xl border border-border/70 bg-card/95 shadow-2xl transition-all duration-300 ${c?"opacity-0 scale-[0.96] translate-y-2":"opacity-100 scale-100 translate-y-0 animate-in fade-in zoom-in-95"}`,children:[h.jsxs("div",{className:"border-b border-border/60 px-6 py-4 flex items-center justify-between",children:[h.jsxs("div",{className:"min-w-0 flex-1 pr-4",children:[h.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:a("editor.preview.title")}),h.jsx("p",{className:"text-sm font-semibold",children:d||a("editor.preview.waiting")}),h.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[h.jsx(ad,{value:Le,className:"h-1.5"}),h.jsxs("span",{className:"text-[11px] text-muted-foreground whitespace-nowrap",children:[de,"/",Z.length||0]})]})]}),h.jsxs(ye,{type:"button",variant:"destructive",size:"sm",className:"gap-2",onClick:()=>xe({withAnimation:!0}),children:[h.jsx(Vw,{className:"h-4 w-4"}),a("editor.preview.stop")]})]}),h.jsxs("div",{className:"px-6 py-5 space-y-5",children:[Be&&h.jsxs("div",{className:"rounded-xl border border-border bg-background/70 p-4 space-y-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold",children:"Scenario Conditions"}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Set condition results before starting preview."})]}),h.jsx("div",{className:"space-y-2 max-h-[260px] overflow-auto pr-1",children:q.map(Q=>{const se=Ye(Q.values),fe=!!G[Q.key];return h.jsxs("div",{className:"rounded-lg border border-border bg-card/70 p-3 flex items-center justify-between gap-3",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium truncate",children:Q.name||Q.id}),se&&h.jsx("p",{className:"text-xs text-muted-foreground truncate",children:se})]}),h.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:a(fe?"common.true":"common.false")}),h.jsx(Qn,{checked:fe,onCheckedChange:he=>{z(""),Y(be=>({...be,[Q.key]:he}))}})]})]},Q.key)})}),B&&h.jsx("p",{className:"text-xs text-destructive",children:B}),h.jsx("div",{className:"flex justify-end",children:h.jsxs(ye,{type:"button",onClick:Ve,className:"gap-2",children:[h.jsx(Jn,{className:"h-4 w-4"}),"Start Preview"]})})]}),!Be&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"min-h-[130px] rounded-xl border border-border bg-background/70 p-4",children:[h.jsx("p",{className:"text-base leading-relaxed whitespace-pre-wrap",children:p||a("editor.preview.waiting")}),D>0&&h.jsxs("div",{className:"mt-4 space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between text-[11px] text-muted-foreground",children:[h.jsxs("span",{children:[a("editor.preview.currentRowProgress"),": ",F,"/",D]}),h.jsxs("span",{children:[M,"%"]})]}),h.jsx(ad,{value:M,className:"h-1.5"})]})]}),x.length>0&&h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("editor.preview.chooseAnswer")}),h.jsx("div",{className:"grid gap-2",children:x.map(Q=>h.jsx(ye,{type:"button",variant:"outline",disabled:!Q.available,className:`justify-start text-left h-auto py-2.5 ${Q.available?"":"opacity-60 cursor-not-allowed"} ${Q.outcome==="complete"?"border-destructive/40 bg-destructive/5":Q.outcome==="end"?"border-amber-500/35 bg-amber-500/5":Q.outcome==="openChildGraph"?"border-cyan-500/35 bg-cyan-500/5":""}`,onClick:()=>{Q.available&&(y([]),T&&L(se=>({...se,[T]:Q.id})),j(null),window.setTimeout(()=>{Fe(Q.id)},Gn))},children:h.jsxs("div",{className:"w-full",children:[h.jsx("div",{className:"font-medium",children:Q.label}),h.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-1.5 text-[11px] text-muted-foreground",children:[Q.outcome==="end"&&h.jsx("span",{className:"inline-flex items-center rounded-full border border-amber-500/35 bg-amber-500/10 px-2 py-0.5",children:a("editor.preview.choiceEnds")}),Q.outcome==="complete"&&h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-destructive/35 bg-destructive/10 px-2 py-0.5 text-destructive",children:[h.jsx(fi,{className:"h-3 w-3"}),a("editor.preview.choiceComplete")]}),Q.outcome==="return"&&h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/25 bg-primary/10 px-2 py-0.5",children:[h.jsx(pi,{className:"h-3 w-3"}),a("editor.preview.choiceReturn")]}),Q.outcome==="openChildGraph"&&h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-cyan-500/35 bg-cyan-500/10 px-2 py-0.5",children:[h.jsx(gi,{className:"h-3 w-3"}),a("editor.preview.choiceOpenChildGraph")]}),Q.isConditional&&h.jsx("span",{className:"inline-flex items-center rounded-full border border-primary/25 bg-primary/10 px-2 py-0.5",children:"Conditional"}),!Q.available&&h.jsx("span",{className:"inline-flex items-center rounded-full border border-muted-foreground/35 bg-muted px-2 py-0.5 text-muted-foreground",children:"Unavailable"}),Q.decoratorsCount>0&&h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-muted px-2 py-0.5",children:[h.jsx(Zb,{className:"h-3 w-3"}),a("editor.preview.choiceDecorators",{count:Q.decoratorsCount})]})]})]})},Q.id))})]}),h.jsxs("div",{className:"rounded-xl border border-border bg-background/60 p-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(an,{className:"h-4 w-4 text-muted-foreground"}),h.jsx(Dt,{type:"range",min:0,max:100,step:1,value:g,onChange:Q=>b(Number(Q.target.value)),disabled:!_,className:_?void 0:"opacity-40 cursor-not-allowed"}),h.jsxs("span",{className:"text-xs w-10 text-right text-muted-foreground",children:[g,"%"]})]}),v&&h.jsxs("div",{className:"mt-2 text-xs text-muted-foreground flex items-center gap-1",children:[h.jsx(Jn,{className:"h-3 w-3"}),a("editor.preview.activeNode"),": ",h.jsx("code",{children:v.slice(0,8)})]})]})]})]})]})}):null}const dr=gt("startNode"),$l=sd("startNode"),A0=e=>[{id:"00000000-0000-0000-0000-000000000001",type:"startNode",data:{...$l,label:$l.label||(dr==null?void 0:dr.description)||e("editor.nodes.startDescription"),displayName:$l.displayName||(dr==null?void 0:dr.label)||e("editor.nodes.start")},position:{x:0,y:0},deletable:!1}],T0=[],BI={startNode:_b,leadNode:Nb,answerNode:Eb,returnNode:Cb,openChildGraphNode:Sb,completeNode:jb,delayNode:kb,placeholderNode:fI},HI={conditionEdge:Rb},VI={startNode:{width:200,height:88},leadNode:{width:250,height:124},answerNode:{width:250,height:124},returnNode:{width:250,height:110},openChildGraphNode:{width:250,height:110},completeNode:{width:250,height:124},delayNode:{width:250,height:100},placeholderNode:{width:160,height:72}},od="00000000-0000-0000-0000-000000000001",q0={x:0,y:0},zl={x:0,y:0,zoom:1},fr=e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=parseFloat(e);return Number.isFinite(t)?t:void 0}},Yr=e=>{var u,c,l,d;const t=fr((u=e==null?void 0:e.measured)==null?void 0:u.width),r=fr((c=e==null?void 0:e.measured)==null?void 0:c.height),n=fr(e==null?void 0:e.width),i=fr(e==null?void 0:e.height),s=fr((l=e==null?void 0:e.style)==null?void 0:l.width),a=fr((d=e==null?void 0:e.style)==null?void 0:d.height),o=VI[e==null?void 0:e.type]||{width:250,height:120};return{width:t||n||s||o.width,height:r||i||a||o.height}},GI=e=>{if(!e||typeof e!="object")return!1;const t=Number(e.x),r=Number(e.y),n=Number(e.zoom);return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)?!1:Math.abs(t-zl.x)>.01||Math.abs(r-zl.y)>.01||Math.abs(n-zl.zoom)>.01},Bl=(e,t,r="TB")=>{const n=new j0.graphlib.Graph;n.setDefaultEdgeLabel(()=>({})),n.setGraph({rankdir:r,nodesep:50,ranksep:100}),e.forEach(u=>{const{width:c,height:l}=Yr(u);n.setNode(u.id,{width:c,height:l})}),t.forEach(u=>{n.setEdge(u.source,u.target)}),j0.layout(n);const i=e.map(u=>{const c=n.node(u.id),{width:l,height:d}=Yr(u);return c?{...u,position:{x:c.x-l/2,y:c.y-d/2}}:u}),s=i.find(u=>u.id===od),a=s?{x:q0.x-s.position.x,y:q0.y-s.position.y}:{x:0,y:0};return{nodes:i.map(u=>({...u,position:{x:u.position.x+a.x,y:u.position.y+a.y}})),edges:t}};function eA(){var Wd,Xd,Zd;const{t:e}=Qe(),{theme:t,resolvedTheme:r,setTheme:n}=Qb(),{projectId:i,dialogueId:s}=Jb.useParams(),{projects:a,loadProjects:o}=ew(),{dialogues:u,loadDialogues:c,saveDialogueGraph:l,loadDialogueGraph:d,exportDialogue:f}=M0(),{participants:p,loadParticipants:m}=ww(),{decorators:x,loadDecorators:y}=_w(),{conditions:v,loadConditions:w}=Nw(),{categories:g,loadCategories:b}=Sw(),[_,N,E]=vj(A0(e)),[I,A,L]=yj(T0),T=C.useCallback(k=>{const H=k.filter(X=>!(X.type==="remove"&&X.id==="00000000-0000-0000-0000-000000000001"));E(H)},[E]),[j,F]=C.useState(null),[S,D]=C.useState(null),[O,M]=C.useState(!1),[R,q]=C.useState(!1),[V,G]=C.useState("saved"),[Y,J]=C.useState(null),[P,B]=C.useState({x:0,y:0,zoom:1}),[z,$]=C.useState(null),[K,re]=C.useState(!1),ee=C.useCallback(()=>{re(!0),G(k=>k==="saving"?k:"unsaved")},[]),{runTour:ne,finishTour:ce,resetTour:ie}=Iw("dialogue-editor");P0();const le=tw(k=>k.openWithContext),oe=rw(k=>k.openWithActions),[Z,de]=C.useState("desktop"),[Le,Ne]=C.useState(!1),[Ae,xe]=C.useState(null),[Te,ve]=C.useState(!1),[Fe,Ve]=C.useState(!1),[Be,Ye]=C.useState(!1),[Q,se]=C.useState(null),fe=C.useRef(null),he=C.useRef(null),be=C.useRef(null);C.useEffect(()=>{const k=()=>{de(Pn())};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]),C.useLayoutEffect(()=>{if(!fe.current)return;const k=()=>{const X=fe.current.getBoundingClientRect().height;document.documentElement.style.setProperty("--app-header-height",`${X}px`)};k();const H=new ResizeObserver(k);return H.observe(fe.current),window.addEventListener("resize",k),()=>{H.disconnect(),window.removeEventListener("resize",k)}},[]),C.useEffect(()=>{if(Z!=="mobile"){he.current!==null&&(document.body.style.overflow=he.current,he.current=null);return}return he.current===null&&(he.current=document.body.style.overflow),document.body.style.overflow="hidden",()=>{he.current!==null&&(document.body.style.overflow=he.current,he.current=null)}},[Z,Te]);const[ge,we]=C.useState([{nodes:A0(e),edges:T0}]),[Re,ke]=C.useState(0);C.useEffect(()=>{o(),c(i),m(i),y(i),w(i),b(i)},[o,c,m,y,w,b,i]);const[qe,_e]=C.useState(!1),[Ee,dt]=C.useState(!1),[Ft,We]=C.useState(0),[wt,Mr]=C.useState(0),[It,wn]=C.useState(!1),[Ge,Pr]=C.useState(!1),[_n,$t]=C.useState(0),[Hi,nr]=C.useState(!1),[Vi,zt]=C.useState(!1);C.useEffect(()=>{(async()=>{if(s){dt(!1),_e(!1),wn(!1),Pr(!1),We(0),Mr(0),$t(0),nr(Pn()==="mobile"),zt(Pn()!=="mobile");try{const H=await d(s),{nodes:X,edges:U,viewport:W}=H;(X.length>0||U.length>0)&&(N(X),A(U),we([{nodes:X,edges:U}]),ke(0));const te=Pn()!=="mobile";GI(W)&&z&&te&&(z.setViewport(W,{duration:0}),_e(!0))}catch(H){console.error("Failed to load dialogue graph:",H)}finally{dt(!0)}}})()},[s,d,N,A,z]);const ir=Z==="mobile"&&(!Ee||!qe&&(!It||!Ge));C.useEffect(()=>{if(Z!=="mobile"){nr(!1),$t(100),be.current=null;return}ir&&(nr(!0),be.current===null&&(be.current=Date.now()))},[Z,ir]),C.useEffect(()=>{if(Z!=="mobile")return;let k=15;Ee&&(k=55),Ee&&It&&(k=85),(qe||Ge)&&(k=100),$t(H=>k>H?k:H)},[Z,Ee,It,qe,Ge]),C.useEffect(()=>{if(Z!=="mobile")return;if(!ir){$t(100);const H=be.current??Date.now(),X=Date.now()-H,U=Math.max(2e3-X,0),W=setTimeout(()=>{nr(!1),be.current=null},U);return()=>clearTimeout(W)}const k=setInterval(()=>{$t(H=>Math.min(H+1,96))},70);return()=>clearInterval(k)},[Z,ir]),C.useEffect(()=>{if(Z==="mobile"){zt(!1);return}if(!Ee){zt(!0);return}if(qe||Ge){const H=setTimeout(()=>zt(!1),220);return()=>clearTimeout(H)}zt(!0)},[Z,Ee,qe,Ge]),C.useEffect(()=>{if(j){const k=_.find(H=>H.id===j.id);k&&F(k)}},[_]),C.useEffect(()=>{if(S){const k=I.find(H=>H.id===S.id);k&&D(k)}},[I,S]),C.useEffect(()=>{K&&V==="saved"&&G("unsaved")},[K,V]);const sr=C.useCallback(()=>{if(!z)return;const k=_.find(U=>U.id==="00000000-0000-0000-0000-000000000001");if(!k)return;const{width:H,height:X}=Yr(k);z.setCenter(k.position.x+H/2,k.position.y+X/2,{zoom:1,duration:300}),Pr(!0)},[z,_]),Or=C.useCallback(k=>{if(!z)return;const H=k.find(X=>X.id==="00000000-0000-0000-0000-000000000001");H&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{try{z.fitView({nodes:[{id:H.id}],padding:.45,duration:320,minZoom:.7,maxZoom:1.15})}catch{const{width:U,height:W}=Yr(H);z.setCenter(H.position.x+U/2,H.position.y+W/2,{zoom:1,duration:320})}Pr(!0)})})},[z]);C.useEffect(()=>{if(Z!=="mobile"&&Ee&&z&&_.length>0&&!Ge&&!qe){const k=setTimeout(()=>{sr()},120);return()=>clearTimeout(k)}},[Ee,Z,z,_.length,Ge,qe,sr]);const Ie=C.useCallback((k,H)=>{we(X=>{const U=X.slice(0,Re+1);return U.push({nodes:k,edges:H}),U.length>50?(U.shift(),ke(U.length-1),U):(ke(U.length-1),U)})},[Re]),Nn=C.useRef(j);C.useEffect(()=>{const k=Nn.current;k&&k!==j&&(Ie(_,I),ee()),Nn.current=j},[j,_,I,Ie,ee]),C.useEffect(()=>{const k=H=>{if(K)return H.preventDefault(),H.returnValue="",""};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[K]);const ar=Ow({shouldBlockFn:()=>K,enableBeforeUnload:!0,withResolver:!0});C.useEffect(()=>{if(ar.status!=="blocked")return;window.confirm(`${e("editor.validation.unsavedLeaveTitle")}
${e("editor.validation.unsavedLeaveDescription")}`)?ar.proceed():ar.reset()},[ar,e]),C.useEffect(()=>()=>{us()},[]);const Dr=a.find(k=>k.id===i),or=u.find(k=>k.id===s),En=v.filter(k=>k.projectId===i),At=j?gt(j.type):null,Cn=g.filter(k=>k.projectId===i),Gi=k=>{if(!j)return null;const H=k.labelKey?e(k.labelKey):k.label||"",X=k.required?`${H} *`:H;switch(k.type){case"text":return h.jsxs("div",{className:"grid gap-2",children:[h.jsx($e,{htmlFor:k.id,children:X}),h.jsx(Dt,{id:k.id,value:j.data[k.id]||"",onChange:U=>Nt(j.id,{[k.id]:U.target.value}),placeholder:k.placeholderKey?e(k.placeholderKey):void 0,maxLength:k.maxLength})]},k.id);case"select":if(k.options==="participants"){const U=new Map,W=ae=>{const pe=Cn.find(nt=>nt.name===ae);if(!pe)return ae;const Me=[];let Pe=pe;for(;Pe;)Me.unshift(Pe.name),Pe=Cn.find(nt=>nt.id===Pe.parentCategoryId);return Me.join(" > ")};p.forEach(ae=>{const pe=ae.category||e("categories.title"),Me=W(pe),Pe=Me.split(" > ")[0]||pe;U.has(Pe)||U.set(Pe,[]),U.get(Pe).push({id:ae.id,name:ae.name,label:`${Me}  ${ae.name}`})});const te=Array.from(U.entries()).map(([ae,pe])=>({label:ae,options:pe.sort((Me,Pe)=>Me.label.localeCompare(Pe.label))})).sort((ae,pe)=>ae.label.localeCompare(pe.label));return h.jsxs("div",{className:"space-y-2",children:[h.jsx($e,{htmlFor:k.id,children:X}),h.jsxs(mr,{id:k.id,value:j.data[k.id]||"",onChange:ae=>Nt(j.id,{[k.id]:ae.target.value}),children:[h.jsx("option",{value:"",disabled:!0,children:k.placeholderKey?e(k.placeholderKey):void 0}),te.map(ae=>h.jsx("optgroup",{label:ae.label,children:ae.options.map(pe=>h.jsx("option",{value:pe.name,children:pe.label},pe.id))},ae.label))]})]},k.id)}if(k.options==="nodes"){const U=new Map;_.filter(te=>te.id!==j.id).forEach(te=>{var pe;const ae=((pe=gt(te.type))==null?void 0:pe.label)||te.type||"Node";U.has(ae)||U.set(ae,[]),U.get(ae).push({id:te.id,label:te.data.displayName||te.data.label||te.id})});const W=Array.from(U.entries()).map(([te,ae])=>({label:te,options:ae.sort((pe,Me)=>pe.label.localeCompare(Me.label))})).sort((te,ae)=>te.label.localeCompare(ae.label));return h.jsxs("div",{className:"space-y-2",children:[h.jsx($e,{htmlFor:k.id,children:X}),h.jsxs(mr,{id:k.id,value:j.data[k.id]||"",onChange:te=>Nt(j.id,{[k.id]:te.target.value}),children:[h.jsx("option",{value:"",disabled:!0,children:k.placeholderKey?e(k.placeholderKey):void 0}),W.map(te=>h.jsx("optgroup",{label:te.label,children:te.options.map(ae=>h.jsx("option",{value:ae.id,children:ae.label},ae.id))},te.label))]})]},k.id)}if(k.options==="dialogues"){const U=u.filter(W=>W.projectId===i&&W.id!==s).sort((W,te)=>(W.name||"").localeCompare(te.name||""));return h.jsxs("div",{className:"space-y-2",children:[h.jsx($e,{htmlFor:k.id,children:X}),h.jsxs(mr,{id:k.id,value:j.data[k.id]||"",onChange:W=>Nt(j.id,{[k.id]:W.target.value}),children:[h.jsx("option",{value:"",disabled:!0,children:k.placeholderKey?e(k.placeholderKey):void 0}),U.map(W=>h.jsx("option",{value:W.id,children:W.name||W.id},W.id))]})]},k.id)}return null;case"dialogueRows":return h.jsx("div",{className:"space-y-2",children:h.jsx(xI,{dialogueRows:j.data.dialogueRows||[],onChange:U=>Nt(j.id,{dialogueRows:U}),participants:p})},k.id);case"decorators":return h.jsx(bI,{decorators:j.data.decorators||[],availableDecorators:x,onAddDecorator:U=>Ji(j.id,U),onRemoveDecorator:U=>es(j.id,U),onUpdateDecorator:(U,W)=>{const te=[...j.data.decorators];te[U]={...te[U],values:W},Nt(j.id,{decorators:te})}},k.id);case"slider":return h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx($e,{htmlFor:k.id,children:X}),h.jsxs("span",{className:"text-xs text-muted-foreground",children:[j.data[k.id]??k.min,k.unit?` ${k.unit}`:""]})]}),h.jsx(Dt,{id:k.id,type:"range",min:k.min,max:k.max,step:k.step,value:j.data[k.id]??k.min,onChange:U=>Nt(j.id,{[k.id]:parseFloat(U.target.value)})})]},k.id);case"nodeId":return h.jsxs("div",{children:[h.jsx($e,{className:"text-xs text-muted-foreground",children:X}),h.jsx("code",{className:"text-xs font-mono bg-muted px-2 py-1 rounded block mt-1",children:j.id})]},k.id);default:return null}},Sn=C.useCallback(k=>{const H=I.find(X=>X.id===k);H&&(F(null),D(H),Z==="mobile"&&ve(!0))},[I,Z]),Ui=C.useCallback((k,H)=>{A(X=>{const U=X.map(W=>W.id===k?{...W,data:{...W.data||{},...H}}:W);return Ie(_,U),ee(),U})},[A,Ie,_,ee]),ur=C.useCallback((k,H=I)=>{const X=k==null?void 0:k.source,U=k==null?void 0:k.target;if(!X||!U)return!1;if(X!==od)return!0;const W=H.filter(te=>{var ae;return te.source===od&&!((ae=te==null?void 0:te.data)!=null&&ae.isPlaceholder)});return W.length===0?!0:W.some(te=>te.target===U)},[I]),jn=C.useCallback(k=>{if(!ur(k))return;const H={...k,type:"conditionEdge",data:{conditions:{mode:"all",rules:[]}},markerEnd:{type:Er.ArrowClosed}};A(X=>{if(!ur(k,X))return X;const U=Jl(H,X);return Ie(_,U),ee(),U})},[A,_,Ie,ee,ur]),Ki=C.useCallback((k,H)=>{H.type!=="placeholderNode"&&(F(H),D(null))},[]),Yi=C.useCallback((k,H)=>{D(H),F(null),Z==="mobile"&&ve(!0)},[Z]),Wi=C.useCallback(()=>{F(null),D(null)},[]),kn=C.useCallback(()=>{j&&j.id!=="00000000-0000-0000-0000-000000000001"&&(N(k=>{const H=k.filter(U=>{var W;return U.type==="placeholderNode"&&((W=U.data)==null?void 0:W.parentNodeId)===j.id}).map(U=>U.id),X=k.filter(U=>U.id!==j.id&&!H.includes(U.id));return A(U=>{const W=U.filter(te=>te.source!==j.id&&te.target!==j.id&&!H.includes(te.source)&&!H.includes(te.target));return Ie(X,W),ee(),W}),X}),F(null))},[j,N,A,Ie,ee]),Xi=C.useCallback(()=>{if(!j||j.id==="00000000-0000-0000-0000-000000000001")return;const k=new Set([j.id]),H=[j.id];for(;H.length>0;){const X=H.shift();I.forEach(U=>{U.source===X&&!k.has(U.target)&&(k.add(U.target),H.push(U.target))})}N(X=>{X.filter(te=>{var ae;return te.type==="placeholderNode"&&k.has((ae=te.data)==null?void 0:ae.parentNodeId)}).map(te=>te.id).forEach(te=>k.add(te));const W=X.filter(te=>!k.has(te.id));return A(te=>{const ae=te.filter(pe=>!k.has(pe.source)&&!k.has(pe.target));return Ie(W,ae),ee(),ae}),W}),F(null)},[j,I,N,A,Ie,ee]),Je=C.useCallback(()=>{const k=new Map;return _.forEach(H=>{if(H.type==="placeholderNode")return;const X=gt(H.type);if(!(X!=null&&X.sections))return;const U=[];X.sections.forEach(W=>{var te;(te=W.fields)==null||te.forEach(ae=>{var Pe;if(!ae.required)return;const pe=(Pe=H.data)==null?void 0:Pe[ae.id];(pe==null||typeof pe=="string"&&pe.trim()==="")&&U.push(ae.id)})}),U.length>0&&k.set(H.id,{node:H,missingFields:U})}),k},[_]),Tt=C.useCallback(()=>{var H,X,U;const k=Je();if(k.size===0){console.info("[validation] No missing required fields.");return}console.warn("[validation] Missing required fields:");for(const[W,te]of k.entries()){const ae=te.node,pe=((H=ae.data)==null?void 0:H.displayName)||((X=ae.data)==null?void 0:X.label)||((U=gt(ae.type))==null?void 0:U.label)||ae.type;console.warn(`- ${pe} (${W})`,te.missingFields)}},[Je]),_t=C.useCallback(k=>{var H,X,U;if(k.size!==0)for(const[W,te]of k.entries()){const ae=te.node,pe=((H=ae.data)==null?void 0:H.displayName)||((X=ae.data)==null?void 0:X.label)||((U=gt(ae.type))==null?void 0:U.label)||ae.type,Me=cs({variant:"warning",title:e("editor.validation.nodeMissingTitle"),description:e("editor.validation.nodeMissingDescription",{name:pe}),duration:8e3,action:{label:e("editor.validation.focusNode"),onClick:()=>{F(ae),D(null),Z==="mobile"&&ve(!0)}}});console.log("[validation] toast",Me,W)}},[e,Z]),Zi=C.useCallback(()=>{Ye(!1),se(null)},[]),Qi=C.useCallback(k=>{if(!(!z||!k))try{z.fitView({nodes:[{id:k}],padding:.45,duration:280,minZoom:.7,maxZoom:1.3})}catch{const X=_.find(te=>te.id===k);if(!X)return;const{width:U,height:W}=Yr(X);z.setCenter(X.position.x+U/2,X.position.y+W/2,{zoom:1,duration:280})}},[z,_]),Rn=C.useCallback(()=>{var X,U,W;if(Z==="mobile")return;const k=Je();if(k.size>0){const te=(X=k.values().next().value)==null?void 0:X.node;te&&(F(te),D(null),ve(!1)),cs({variant:"error",title:e("editor.preview.invalidGraphTitle"),description:e("editor.preview.invalidRequiredFieldsDescription",{count:k.size})});return}const H=MI(_,I,{maxNodes:100});if(!H.valid){const ae={missing_start:"editor.preview.invalidMissingStart",empty_graph:"editor.preview.invalidEmptyGraph",too_many_nodes:"editor.preview.invalidTooManyNodes",broken_edges:"editor.preview.invalidBrokenEdges",no_playable_path:"editor.preview.invalidNoPlayablePath"}[H.reason]||"editor.preview.invalidGeneric";cs({variant:"error",title:e("editor.preview.invalidGraphTitle"),description:H.reason==="too_many_nodes"?e(ae,{count:((U=H.details)==null?void 0:U.count)||0,max:((W=H.details)==null?void 0:W.maxNodes)||100}):e(ae)});return}F(null),D(null),ve(!1),se(null),Ye(!0)},[Z,Je,_,I,e]),Bt=C.useCallback(async()=>{M(!0),q(!1),G("saving");try{us();const k=_.filter(W=>W.type!=="placeholderNode"),H=I.filter(W=>{var te;return!((te=W.data)!=null&&te.isPlaceholder)}),X=Je();Tt(),_t(X),await l(s,k,H,P),J(new Date),q(!0),G("saved"),re(!1),Ew(),setTimeout(()=>q(!1),2e3)}catch(k){console.error("Failed to save dialogue:",k),G("error"),setTimeout(()=>G("unsaved"),3e3)}finally{M(!1)}},[I,_,P,s,l,Je,Tt,_t,us,M,q,G,re,J,Z]),Nt=C.useCallback((k,H)=>{N(X=>X.map(U=>U.id===k?{...U,data:{...U.data,...H}}:U))},[N]),Ji=C.useCallback((k,H)=>{N(X=>{const U=X.map(W=>{if(W.id===k){const te={id:H.id,name:H.name,values:{}};return H.properties&&H.properties.length>0&&H.properties.forEach(ae=>{te.values[ae.name]=ae.defaultValue||""}),{...W,data:{...W.data,decorators:[...W.data.decorators||[],te]}}}return W});return Ie(U,I),ee(),U})},[N,I,Ie,ee]),es=C.useCallback((k,H)=>{N(X=>{const U=X.map(W=>W.id===k?{...W,data:{...W.data,decorators:W.data.decorators.filter((te,ae)=>ae!==H)}}:W);return Ie(U,I),ee(),U})},[N,I,Ie,ee]),ft=C.useCallback((k,H)=>{const X=gt(k),U=sd(k),W=(X==null?void 0:X.label)||"Node",te=U.label||`New ${W}`,ae=U.displayName||W,pe={id:hr(),type:k,data:{...U,label:te,displayName:ae},position:H||{x:Math.random()*400+100,y:Math.random()*400+100}};N(Pe=>{const nt=[...Pe,pe];return Ie(nt,I),nt}),ee();const Me=Je();Tt(),_t(Me)},[N,I,Ie,ee,Tt,Je,_t]),ht=C.useCallback((k,H,X)=>{xe({placeholderId:k,position:H,parentNodeId:X}),Ne(!0)},[]),ts=C.useCallback(k=>{if(!Ae)return;const{placeholderId:H,position:X,parentNodeId:U}=Ae,W=hr(),te=gt(k),ae=sd(k),pe=(te==null?void 0:te.label)||"Node",Me=ae.label||`New ${pe}`,Pe=ae.displayName||pe,nt={id:W,type:k,position:X,data:{...ae,label:Me,displayName:Pe}},Qd=U==="00000000-0000-0000-0000-000000000001",is=(te==null?void 0:te.canHaveOutputs)??!0,ss=is?hr():null;N(as=>{let et=[...as];return Qd&&(et=et.filter(os=>os.id!==H)),et.push(nt),is&&et.push({id:ss,type:"placeholderNode",data:{label:"Add Node",onClick:ht,parentNodeId:W},position:{x:X.x,y:X.y+250}}),et}),ee();const Db=Je();Tt(),_t(Db),A(as=>{let et=[...as];Qd&&(et=et.filter(Lb=>Lb.id!==`${U}-${H}`));const os={id:`${U}-${W}`,source:U,target:W,type:"default",markerEnd:{type:Er.ArrowClosed}};return et=Jl(os,et),is&&et.push({id:`${W}-${ss}`,source:W,target:ss,type:"default",style:{strokeWidth:1,stroke:"#94a3b8",strokeDasharray:"5,5"},data:{isPlaceholder:!0}}),et}),Ne(!1),xe(null)},[Ae,N,A,ht,ee,Tt,Je,_t]);C.useEffect(()=>{if(Z!=="mobile"||_.length===0)return;const k=_.filter(W=>W.type!=="placeholderNode"),H=_.filter(W=>W.type==="placeholderNode"),X=[],U=[];k.forEach(W=>{const te=gt(W.type);if(te&&te.canHaveOutputs===!1)return;if(!H.some(pe=>{var Me;return((Me=pe.data)==null?void 0:Me.parentNodeId)===W.id})){const pe=hr();W.id==="00000000-0000-0000-0000-000000000001"?I.some(Pe=>{var nt;return Pe.source===W.id&&!((nt=Pe.data)!=null&&nt.isPlaceholder)})||(X.push({id:pe,type:"placeholderNode",data:{label:"Add Node",onClick:ht,parentNodeId:W.id},position:{x:W.position.x,y:W.position.y+250}}),U.push({id:`${W.id}-${pe}`,source:W.id,target:pe,type:"default",style:{strokeWidth:1,stroke:"#94a3b8",strokeDasharray:"5,5"},data:{isPlaceholder:!0}})):(X.push({id:pe,type:"placeholderNode",data:{label:"Add Node",onClick:ht,parentNodeId:W.id},position:{x:W.position.x,y:W.position.y+250}}),U.push({id:`${W.id}-${pe}`,source:W.id,target:pe,type:"default",style:{strokeWidth:1,stroke:"#94a3b8",strokeDasharray:"5,5"},data:{isPlaceholder:!0}}))}}),X.length>0&&(N(W=>[...W,...X]),A(W=>[...W,...U]))},[Z,_,I,ht,N,A]);const In=C.useCallback(()=>{const{nodes:k,edges:H}=Bl(_,I);N(k),A(H),Ie(k,H),ee()},[_,I,N,A,Ie,ee]),An=C.useCallback(()=>{if(!z)return;const k=_.filter(H=>H.type!=="placeholderNode");if(k.length!==0)try{z.fitView({nodes:k.map(H=>({id:H.id})),padding:.18,duration:300})}catch{z.fitView({padding:.18,duration:300})}},[z,_]),Tn=C.useCallback(()=>{sr()},[sr]);C.useEffect(()=>{if(Z!=="mobile"||!Ee)return;const k=_.filter(U=>U.type!=="placeholderNode").length,H=_.length-k;if(!It&&_.length>0&&k>0){const{nodes:U,edges:W}=Bl(_,I);N(U),A(W),We(k),Mr(H),wn(!0),Ge||Or(U);return}const X=k!==Ft||H!==wt;if(It&&k>0&&X){const{nodes:U,edges:W}=Bl(_,I);N(U),A(W),We(k),Mr(H),Ge||Or(U)}},[Z,Ee,_.length,I.length,It,Ge,Or]);const Ht=C.useCallback(()=>{if(Re>0){const k=Re-1,{nodes:H,edges:X}=ge[k];N(H),A(X),ke(k)}},[Re,ge,N,A]),Lr=C.useCallback(()=>{if(Re<ge.length-1){const k=Re+1,{nodes:H,edges:X}=ge[k];N(H),A(X),ke(k)}},[Re,ge,N,A]);C.useEffect(()=>{const k=H=>{if(Be)return;if((H.ctrlKey||H.metaKey)&&H.key.toLowerCase()==="s"){H.preventDefault(),Bt();return}const X=H.target,U=X.tagName==="INPUT"||X.tagName==="TEXTAREA"||X.isContentEditable;if(!U&&(H.ctrlKey||H.metaKey)){const W=H.key.toLowerCase();if(W==="z"&&!H.shiftKey){H.preventDefault(),Ht();return}if(W==="y"||W==="z"&&H.shiftKey){H.preventDefault(),Lr();return}}(H.key==="Delete"||H.key==="Backspace")&&!U&&(H.preventDefault(),j&&j.id!=="00000000-0000-0000-0000-000000000001"?kn():S&&Z!=="mobile"&&(A(W=>{const te=W.filter(ae=>ae.id!==S.id);return Ie(_,te),ee(),te}),D(null)))};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[j,S,Z,kn,A,_,Ie,ee,Bt,Ht,Lr,Be]);const rs=C.useCallback((k,H)=>{B(H)},[]),qn=C.useCallback(k=>{var H;return((H=gt(k.type))==null?void 0:H.minimapColor)||"#6b7280"},[]),qb=C.useMemo(()=>_.map(k=>({...k,data:{...k.data,previewActive:k.id===Q}})),[_,Q]),Mb=C.useMemo(()=>I.map(k=>{var H;return{...k,type:(H=k==null?void 0:k.data)!=null&&H.isPlaceholder?k.type||"default":"conditionEdge",data:{...k.data,onOpenDetails:Sn},animated:(S==null?void 0:S.id)===k.id,style:{...k.style,stroke:(S==null?void 0:S.id)===k.id?"#3b82f6":void 0,strokeWidth:(S==null?void 0:S.id)===k.id?3:2}}}),[I,S,Sn]),cr=C.useCallback((k,H)=>{k.dataTransfer.setData("application/reactflow",H),k.dataTransfer.effectAllowed="move"},[]),Pb=C.useCallback(k=>{k.preventDefault();const H=k.dataTransfer.getData("application/reactflow");if(!H||!z)return;const X=z.screenToFlowPosition({x:k.clientX,y:k.clientY});ft(H,X)},[z,ft]),Ob=C.useCallback(k=>{k.preventDefault(),k.dataTransfer.dropEffect="move"},[]),ns=async()=>{try{const k=_.filter(X=>X.type!=="placeholderNode"),H=I.filter(X=>{var U;return!((U=X.data)!=null&&U.isPlaceholder)});await l(s,k,H,P),await f(s)}catch(k){console.error("Failed to export dialogue:",k)}};return C.useEffect(()=>{const k=X=>{const U=X==null?void 0:X.detail;!U||U.dialogueId!==s||Bt()},H=X=>{const U=X==null?void 0:X.detail;!U||U.dialogueId!==s||ns()};return window.addEventListener("command:dialogue-save",k),window.addEventListener("command:dialogue-export",H),()=>{window.removeEventListener("command:dialogue-save",k),window.removeEventListener("command:dialogue-export",H)}},[s,Bt,ns]),!or||!Dr?h.jsx("div",{className:"h-screen flex items-center justify-center",children:h.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})}):h.jsxs("div",{className:"h-screen flex flex-col overflow-hidden",children:[Z!=="mobile"&&h.jsx(Aw,{run:ne,onFinish:ce,tourType:"editor"}),h.jsx(jw,{ref:fe,"data-tour":"editor-header",left:h.jsxs(h.Fragment,{children:[h.jsx(uw,{to:"/projects/$projectId",params:{projectId:i},children:h.jsx(ye,{variant:"ghost",size:"icon",className:"rounded-full shrink-0",children:h.jsx(Rw,{className:"h-5 w-5"})})}),h.jsxs("div",{className:"min-w-0",children:[h.jsx("h1",{className:"text-sm md:text-2xl font-bold tracking-tight truncate",children:or.name}),h.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",children:Dr.name})]})]}),right:h.jsxs(h.Fragment,{children:[h.jsx("span",{className:"hidden md:flex","data-header-mobile-hidden":!0,children:h.jsx(wI,{status:V,lastSaved:Y,className:"hidden md:flex"})}),h.jsx(ye,{variant:"outline",size:"icon",className:"rounded-full","data-tour":"save-button",onClick:()=>oe({placeholder:e("common.search"),actions:[{group:e("editor.menu.file"),items:[{icon:nw,label:e(O?"common.saving":"common.save"),shortcut:"Ctrl+S",onSelect:Bt},{icon:iw,label:e("common.export"),shortcut:"Ctrl+E",onSelect:ns},...Z!=="mobile"?[{icon:tf,label:e("editor.preview.start"),shortcut:"",onSelect:Rn}]:[]]},{group:e("editor.menu.edit"),items:[{icon:sw,label:e("editor.menu.undo"),shortcut:"Ctrl+Z",onSelect:Ht},{icon:aw,label:e("editor.menu.redo"),shortcut:"Ctrl+Y",onSelect:Lr}]},{group:e("editor.menu.view"),items:[{key:"language-selector",render:()=>h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:e("settings.language")}),h.jsx(kw,{})]})},{icon:r==="dark"?qw:Mw,label:e(r==="dark"?"settings.lightMode":"settings.darkMode"),shortcut:"",onSelect:()=>n(r==="dark"?"light":"dark")},{icon:rf,label:e("editor.nodeToolbar.recenter"),shortcut:"",onSelect:An},{icon:nf,label:e("editor.nodeToolbar.backToStart"),shortcut:"",onSelect:Tn},...Z!=="mobile"?[{icon:Tw,label:e("editor.menu.showTour"),shortcut:"",onSelect:ie}]:[]]},{group:e("settings.title"),items:[{icon:ow,label:e("settings.title"),shortcut:"",onSelect:()=>le({context:{type:"dialogue",name:or.name,projectId:i,dialogueId:s},mode:"detail"})},{icon:Fw,label:e("editor.menu.support"),shortcut:"",onSelect:()=>window.open("https://github.com/sponsors/Mountea-Framework","_blank")}]}]}),children:h.jsx(Cw,{className:"h-4 w-4"})})]})}),h.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[h.jsxs("div",{className:"flex-1 relative",onDrop:Z!=="mobile"?Pb:void 0,onDragOver:Z!=="mobile"?Ob:void 0,"data-tour":"canvas",children:[h.jsxs(pj,{nodes:qb,edges:Mb,onNodesChange:T,onEdgesChange:L,onConnect:jn,onNodeClick:Ki,onEdgeClick:Yi,onPaneClick:Wi,onMove:rs,onInit:$,isValidConnection:ur,nodeTypes:BI,edgeTypes:HI,className:"bg-grid",proOptions:{hideAttribution:!0},nodesDraggable:Z!=="mobile",panOnDrag:!0,panOnScroll:!1,zoomOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,nodesConnectable:Z!=="mobile",elementsSelectable:!0,minZoom:.5,maxZoom:2,children:[h.jsx(Nj,{}),h.jsx(hn,{position:"bottom-left",className:"mb-2",children:h.jsxs("div",{className:"bg-card border border-border rounded-full shadow-lg px-2 py-2 absolute bottom-6 flex flex-col items-center gap-1",children:[h.jsx(pt,{content:e("editor.nodeToolbar.recenterTooltip"),side:"top",children:h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:An,children:h.jsx(rf,{className:"h-4 w-4"})})}),h.jsx(pt,{content:e("editor.nodeToolbar.startFocusTooltip"),side:"top",children:h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:Tn,children:h.jsx(nf,{className:"h-4 w-4"})})}),h.jsx("div",{className:"w-6 h-px bg-border my-1"}),h.jsx(uI,{className:"!p-0 !bg-transparent !border-0 !shadow-none "})]})}),Z!=="mobile"&&h.jsx(Bj,{nodeColor:qn,className:"!bg-card !border !border-border !rounded-lg !shadow-lg",maskColor:"rgb(0, 0, 0, 0.1)","data-tour":"minimap"})]}),Z!=="mobile"&&h.jsx(zI,{open:Be,nodes:_,edges:I,onStop:Zi,onNodeFocus:Qi,onNodeChange:se})]}),Z==="mobile"&&j&&h.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex items-center gap-2 bg-card border rounded-full shadow-lg px-4 py-2",children:[h.jsx("span",{className:"text-sm font-medium truncate max-w-32",children:j.data.displayName||((Wd=j.type)==null?void 0:Wd.replace("Node",""))}),h.jsx("div",{className:"h-4 w-px bg-border"}),h.jsx("div",{className:"flex items-center gap-1",children:h.jsxs(wb,{children:[h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>ve(!0),children:h.jsx(Bw,{className:"h-4 w-4"})}),j.id!=="00000000-0000-0000-0000-000000000001"&&h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10 rounded-full",onClick:()=>Ve(!0),children:h.jsx(Wr,{className:"h-4 w-4"})}),h.jsx(ye,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>F(null),children:h.jsx(Un,{className:"h-4 w-4"})})]})})]}),Z==="mobile"&&h.jsx(cw,{open:Fe,onOpenChange:Ve,children:h.jsxs(lw,{variant:"destructive",size:"sm",children:[h.jsxs(dw,{children:[h.jsx(fw,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:h.jsx(Wr,{className:"h-6 w-6"})}),h.jsx(hw,{children:e("editor.deleteCascadeTitle")}),h.jsx(pw,{children:e("editor.deleteCascadeDescription")})]}),h.jsxs(gw,{children:[h.jsx(mw,{variant:"outline",children:e("common.cancel")}),h.jsx(vw,{variant:"destructive",onClick:()=>{Ve(!1),Xi()},children:e("editor.deleteCascadeConfirm")})]})]})}),h.jsx(yw,{open:Z==="mobile"?!!((j||S)&&Te):!!(j||S),onOpenChange:k=>{k||(Z==="mobile"?ve(!1):(F(null),D(null)))},direction:Z==="mobile"?"bottom":"right",children:h.jsxs(xw,{side:Z==="mobile"?"bottom":"right",size:Z==="mobile"?"md":"2xl",className:Z==="mobile"?"max-h-[82vh] overscroll-contain touch-pan-y":null,children:[j&&h.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[h.jsx(Jd,{className:"p-0",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(ef,{className:"text-lg font-bold",children:((At==null?void 0:At.label)||"Node")+" "+e("editor.nodeDetails")}),h.jsx(ye,{variant:"ghost",size:"icon",onClick:()=>{Z==="mobile"?ve(!1):F(null)},className:"h-8 w-8",children:h.jsx(Un,{className:"h-4 w-4"})})]})}),(Xd=At==null?void 0:At.sections)==null?void 0:Xd.map(k=>h.jsx(k0,{title:e(k.titleKey),defaultOpen:k.defaultOpen??!0,children:h.jsx("div",{className:"space-y-4",children:k.fields.map(H=>Gi(H))})},k.id))]}),!j&&S&&h.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[h.jsx(Jd,{className:"p-0",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(ef,{className:"text-lg font-bold",children:e("editor.edgeDetails")}),h.jsx(ye,{variant:"ghost",size:"icon",onClick:()=>{Z==="mobile"?ve(!1):D(null)},className:"h-8 w-8",children:h.jsx(Un,{className:"h-4 w-4"})})]})}),h.jsx(k0,{title:e("editor.sections.conditions"),defaultOpen:!0,children:h.jsxs("div",{className:"space-y-4",children:[h.jsx(pI,{conditionGroup:(Zd=S.data)==null?void 0:Zd.conditions,availableConditions:En,onChange:k=>Ui(S.id,{conditions:k})}),h.jsxs("div",{children:[h.jsx($e,{className:"text-xs text-muted-foreground",children:e("editor.sections.edgeId")}),h.jsx("code",{className:"text-xs font-mono bg-muted px-2 py-1 rounded block mt-1",children:S.id})]})]})})]})]})})]}),Z!=="mobile"&&h.jsxs("div",{className:`border-t bg-card px-6 py-3 flex items-center justify-between transition-opacity ${Be?"pointer-events-none opacity-40 select-none":""}`,"data-tour":"node-toolbar",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(pt,{content:e("editor.nodeToolbar.autoLayoutTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2",onClick:In,children:[h.jsx(zw,{className:"h-4 w-4"}),e("editor.nodeToolbar.autoLayout")]})}),h.jsx(pt,{content:e("editor.preview.startTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2",onClick:Rn,children:[h.jsx(tf,{className:"h-4 w-4"}),e("editor.preview.start")]})}),h.jsx("div",{className:"h-6 w-px bg-border mx-1"}),h.jsx(pt,{content:e("editor.nodeToolbar.addNpcTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"leadNode"),onClick:()=>ft("leadNode"),children:[h.jsx(ud,{className:"h-4 w-4"}),e("editor.nodeToolbar.npc")]})}),h.jsx(pt,{content:e("editor.nodeToolbar.addPlayerTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"answerNode"),onClick:()=>ft("answerNode"),children:[h.jsx(br,{className:"h-4 w-4"}),e("editor.nodeToolbar.player")]})}),h.jsx(pt,{content:e("editor.nodeToolbar.addReturnTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"returnNode"),onClick:()=>ft("returnNode"),children:[h.jsx(pi,{className:"h-4 w-4"}),e("editor.nodeToolbar.return")]})}),h.jsx(pt,{content:e("editor.nodeToolbar.addOpenChildGraphTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"openChildGraphNode"),onClick:()=>ft("openChildGraphNode"),children:[h.jsx(gi,{className:"h-4 w-4"}),e("editor.nodeToolbar.openChildGraph")]})}),h.jsx(pt,{content:e("editor.nodeToolbar.addCompleteTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"completeNode"),onClick:()=>ft("completeNode"),children:[h.jsx(fi,{className:"h-4 w-4"}),e("editor.nodeToolbar.complete")]})}),h.jsx(pt,{content:e("editor.nodeToolbar.addDelayTooltip"),side:"top",children:h.jsxs(ye,{variant:"outline",size:"sm",className:"gap-2 cursor-move",draggable:!0,onDragStart:k=>cr(k,"delayNode"),onClick:()=>ft("delayNode"),children:[h.jsx(ld,{className:"h-4 w-4"}),e("editor.nodeToolbar.delay")]})})]}),h.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[h.jsxs("span",{children:[_.length," ",e("dialogues.nodes"),"  ",I.length," ",e("dialogues.edges")]}),h.jsxs("span",{className:"text-xs hidden md:block",children:[e("editor.nodeToolbar.poweredBy")," ",h.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary transition-colors",children:"React Flow"})]})]})]}),h.jsx(AI,{open:Le,onOpenChange:Ne,onSelectType:ts}),Hi&&Z==="mobile"&&typeof document<"u"&&Hl.createPortal(h.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-2xl backdrop-saturate-150",children:h.jsxs("div",{className:"w-[82%] max-w-xs rounded-xl border border-border/70 bg-card/95 p-4 shadow-2xl",children:[h.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[h.jsx("span",{className:"font-medium",children:e("common.loading")}),h.jsxs("span",{className:"text-muted-foreground",children:[_n,"%"]})]}),h.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-muted",children:h.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${_n}%`}})}),h.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Preparing dialogue graph..."})]})}),document.body),Vi&&Z!=="mobile"&&typeof document<"u"&&Hl.createPortal(h.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/35 backdrop-blur-xl backdrop-saturate-125",children:h.jsxs("div",{className:"w-[420px] max-w-[82%] rounded-xl border border-border/70 bg-card/95 p-4 shadow-2xl",children:[h.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[h.jsx("span",{className:"font-medium",children:e("common.loading")}),h.jsx("span",{className:"text-muted-foreground",children:qe||Ge?"100%":"65%"})]}),h.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-muted",children:h.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:qe||Ge?"100%":"65%"}})}),h.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Preparing dialogue graph..."})]})}),document.body)]})}export{eA as component};
