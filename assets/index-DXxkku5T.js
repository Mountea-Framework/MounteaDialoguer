import{c as G,j as e,t as _,u as O,l as _e,v as Me,M as le,B as k,X as Ae,C as st,w as at,q as ve,x as Y,y as Z,n as q,o as R,F as rt,z as $e,s as nt,A as Be,m as oe,a as Ze,k as Oe,r as v,D as ee,d as te,e as se,f as ae,g as re,L as M,I as $,T as it,h as ne,E as Ne,G as be,H as ye,J as we,K as Ce,N as ke,O as De,P as Ie,Q as Se,R as Ye,U as lt,V as Ve,b as ot,W as ct}from"./index-k2W7E5KF.js";import{C as dt,c as mt,a as ut,u as ue,b as Ge,T as Ke,d as xe,M as xt,S as ht}from"./confetti-DAW394N5.js";import{useCategoryStore as K}from"./categoryStore-B4ZhbexF.js";import{D as he,a as pe,E as ge,b as fe,c as W,d as pt,N as ce,C as Qe,A as gt,L as ft}from"./app-header-BM2N2isX.js";import{C as jt,E as vt}from"./empty-state-meX67VgQ.js";import{P as U}from"./plus-CRYi2bEe.js";import{S as Nt,M as bt,A as yt}from"./sun-w9583uMC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=G("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=G("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=G("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=G("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=G("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=G("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=G("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Dt={variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600"}};function Le({className:a,variant:d="default",...s}){return e.jsx("div",{className:_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",Dt.variant[d],a),...s})}function It({activeSection:a,onSectionChange:d,project:s,dialogueCount:o=0,participantCount:r=0,isMobileOpen:C=!1,onMobileClose:y}){const{t:x}=O(),{status:m,setLoginDialogOpen:u}=_e(),p=Me(h=>h.openWithContext),c={connected:"text-green-500",connecting:"text-blue-500",syncing:"text-blue-500",error:"text-red-500",disconnected:"text-muted-foreground"}[m]||"text-muted-foreground",w=[{id:"overview",label:x("navigation.dashboard"),icon:Ct,color:"text-blue-500"},{id:"dialogues",label:x("dialogues.title"),icon:le,color:"text-blue-500",count:o},{id:"participants",label:x("participants.title"),icon:Xe,color:"text-purple-500",count:r},{id:"categories",label:x("categories.title"),icon:We,color:"text-orange-500"},{id:"decorators",label:x("decorators.title"),icon:kt,color:"text-green-500"}];return e.jsxs("aside",{className:_("flex-shrink-0 bg-card border-border flex flex-col transition-transform duration-300 ease-in-out","fixed inset-y-0 left-0 z-50 h-full w-64","lg:static lg:z-0 lg:translate-x-0","lg:w-80","lg:rounded-none",C?"translate-x-0 rounded-none":"-translate-x-full lg:translate-x-0 md:rounded-xl"),children:[e.jsx("div",{className:"lg:hidden flex justify-end p-4",children:e.jsx(k,{variant:"ghost",size:"icon",onClick:y,className:"rounded-full",children:e.jsx(Ae,{className:"h-5 w-5"})})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:_("p-4 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 border border-blue-100 dark:border-blue-900/30 flex flex-col items-center text-center",C?"flex-row justify-between":""),children:[e.jsx("div",{className:_("w-12 h-12 rounded-lg bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white shadow-md mb-2",C?"hidden":""),children:e.jsx(We,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-sm line-clamp-1",children:s==null?void 0:s.name}),(s==null?void 0:s.version)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["v",s.version]})]})}),e.jsx("nav",{className:"flex-1 px-3 py-2 space-y-1 overflow-y-auto",children:w.map(h=>{const F=h.icon,z=a===h.id;return e.jsxs("button",{onClick:()=>d(h.id),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",z?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(F,{className:_("h-5 w-5",z&&h.color)}),e.jsx("span",{className:"flex-1 text-left",children:h.label}),h.count!==void 0&&e.jsx("span",{className:"text-[10px] bg-muted px-1.5 py-0.5 rounded-md",children:h.count})]},h.id)})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>u(!0),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors","text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(st,{className:_("h-5 w-5",c)}),e.jsx("span",{children:x("sync.title")})]})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>p({context:{type:"project",projectId:s==null?void 0:s.id},onOpenSettings:d?()=>d("settings"):null,mode:"detail"}),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",a==="settings"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{children:x("navigation.settings")})]})})]})}function St({project:a,dialogues:d=[],participants:s=[],categories:o=[],decorators:r=[],onExport:C,onImport:y,onDelete:x,onSectionChange:m,fileInputRef:u,isImporting:p=!1}){const{t:c}=O(),w=oe(),h=Me(g=>g.openWithContext),F=d.reduce((g,l)=>g+(l.nodeCount||0),0),z=[...d].sort((g,l)=>new Date(l.modifiedAt)-new Date(g.modifiedAt)).slice(0,5);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 text-xs font-medium text-muted-foreground mb-4 ${w?"hidden":""}`,children:[e.jsx(ve,{to:"/",className:"hover:text-primary cursor-pointer",children:c("projects.title")}),e.jsx(He,{className:"h-3 w-3"}),e.jsx("span",{className:"text-foreground",children:a.name})]}),e.jsxs("div",{className:"flex items-start justify-between mb-10",children:[e.jsxs("div",{className:"group flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-1",children:c("projects.projectName")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl md:text-4xl font-bold tracking-tight",children:a.name}),a.version&&e.jsxs(Le,{variant:"success",children:["v",a.version]}),e.jsx("button",{onClick:()=>h({context:{type:"project",projectId:a==null?void 0:a.id},onOpenSettings:m?()=>m("settings"):null,mode:"detail"}),className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-full hover:bg-accent text-muted-foreground hover:text-primary transition-all",title:"Project Settings",children:e.jsx(me,{className:"h-5 w-5"})})]}),a.description&&e.jsx("p",{className:"mt-3 text-lg text-muted-foreground leading-relaxed max-w-2xl",children:a.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".mnteadlgproj",onChange:y,className:"hidden"}),e.jsx("div",{className:"md:hidden",children:e.jsxs(he,{className:!0,children:[e.jsx(pe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(W,{onClick:()=>{var g;return(g=u==null?void 0:u.current)==null?void 0:g.click()},disabled:p,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),c("common.import")]}),e.jsxs(W,{onClick:C,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),c("common.export")]}),e.jsx(pt,{}),e.jsxs(W,{onClick:x,className:"text-destructive focus:text-destructive",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),c("common.delete")]})]})]})}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var g;return(g=u==null?void 0:u.current)==null?void 0:g.click()},disabled:p,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),c("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:C,className:"gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),c("common.export")]}),e.jsx(k,{variant:"outline",size:"sm",onClick:x,className:"gap-2 text-destructive hover:text-destructive hover:border-destructive/50",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 mb-6",children:[e.jsx(q,{children:e.jsx(R,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-primary shrink-0",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:"File Size"}),e.jsx("h3",{className:"text-lg font-bold",children:"--"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[F," ",c("dialogues.nodes")]})]})]})})}),e.jsx(q,{children:e.jsx(R,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400 shrink-0",children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:c("projects.modified")}),e.jsx("h3",{className:"text-lg font-bold truncate",children:$e(a.modifiedAt)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Current User"})]})]})})}),e.jsx(q,{children:e.jsx(R,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center text-orange-600 dark:text-orange-400 shrink-0",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:c("projects.created")}),e.jsx("h3",{className:"text-lg font-bold",children:nt(a.createdAt)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.version?`v${a.version}`:"v1.0.0"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:c("dialogues.title")}),e.jsxs("button",{onClick:()=>m==null?void 0:m("dialogues"),className:"text-sm text-primary hover:text-blue-600 font-medium flex items-center gap-1 transition-colors",children:["View All ",e.jsx(He,{className:"h-4 w-4"})]})]}),e.jsx(q,{children:e.jsx(R,{className:"p-0",children:z.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(le,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c("dialogues.noDialogues")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-border",children:z.map(g=>e.jsxs(ve,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:a.id,dialogueId:g.id},className:"p-4 flex items-center justify-between group hover:bg-accent transition-colors cursor-pointer hover:rounded-lg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center text-blue-500",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:g.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[$e(g.modifiedAt)," â€¢ ",g.nodeCount||0," ",c("dialogues.nodes")]})]})]}),e.jsx("button",{className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-card shadow-sm border border-border text-primary hover:bg-primary hover:text-primary-foreground transition-all",children:e.jsx(me,{className:"h-4 w-4"})})]},g.id))}),e.jsx("div",{className:"bg-muted/50 px-4 py-3 border-t border-border text-center",children:e.jsxs("button",{type:"button",onClick:()=>m==null?void 0:m("dialogues"),className:"text-xs font-medium text-muted-foreground hover:text-primary transition-colors",children:["+ ",c("dialogues.createNew")]})})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{children:e.jsxs(R,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Project Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Project ID"}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-lg border border-border",children:[e.jsxs("code",{className:"text-xs font-mono",children:[a.id.substring(0,12),"..."]}),e.jsxs("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(a.id).then(()=>{Be({variant:"success",title:"Copied",description:"Project ID copied to clipboard."})}).catch(()=>{Be({variant:"error",title:"Copy failed",description:"Unable to copy Project ID."})})},className:"text-muted-foreground hover:text-primary p-1 rounded-md hover:bg-accent transition-colors","aria-label":"Copy Project ID",children:[e.jsx("span",{className:"sr-only",children:"Copy"}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("dialogues.title")}),e.jsx("span",{className:"font-medium",children:d.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("participants.title")}),e.jsx("span",{className:"font-medium",children:s.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:c("categories.title")}),e.jsx("span",{className:"font-medium",children:o.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:c("decorators.title")}),e.jsx("span",{className:"font-medium",children:r.length})]})]})]})]})}),s.length>0&&e.jsx(q,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider",children:c("participants.top")}),e.jsx("button",{onClick:()=>m==null?void 0:m("participants"),className:"text-xs text-primary hover:underline",children:c("common.manage")})]}),e.jsxs("div",{className:"flex -space-x-2 overflow-hidden mb-3",children:[s.slice(0,4).map(g=>e.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-card bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:g.name.charAt(0).toUpperCase()},g.id)),s.length>4&&e.jsxs("div",{className:"h-8 w-8 rounded-full ring-2 ring-card bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:["+",s.length-4]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c("participants.inProject",{count:s.length})})]})})]})]})]})}function Pt({dialogue:a,projectId:d}){const{t:s}=O(),o=Ze(),r=Me(y=>y.openWithContext),C=a.nodeCount||0;return e.jsx(ve,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:d,dialogueId:a.id},children:e.jsxs(q,{className:"group cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all h-full flex flex-col overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 flex items-center justify-center relative overflow-hidden rounded-t-lg",children:[e.jsx("div",{className:"absolute inset-0 opacity-30 dark:opacity-20 bg-[radial-gradient(#9333ea_1px,transparent_1px)] [background-size:16px_16px]"}),e.jsx(le,{className:"h-12 w-12 text-purple-500 dark:text-purple-400 opacity-80 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 relative z-10"}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full bg-background/90 backdrop-blur-sm",onClick:y=>{y.preventDefault(),y.stopPropagation(),r({context:{type:"dialogue",name:a.name,projectId:d,dialogueId:a.id},onOpenSettings:()=>o({to:"/projects/$projectId/dialogue/$dialogueId/settings",params:{projectId:d,dialogueId:a.id}}),mode:"detail"})},children:e.jsx(wt,{className:"h-3.5 w-3.5"})})})]}),e.jsxs(R,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsx("h3",{className:"font-bold text-base group-hover:text-primary transition-colors line-clamp-1",children:a.name})}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2 leading-relaxed",children:a.description}),e.jsx("div",{className:"mt-auto pt-3 border-t flex items-center justify-center text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(le,{className:"h-3.5 w-3.5 group-hover:text-purple-500 transition-colors"}),e.jsx("span",{className:"font-medium",children:s("dialogues.nodeCount",{count:C})})]})})]})]})})}function Et({open:a,onOpenChange:d,projectId:s}){const{t:o}=O(),r=Ze(),{createDialogue:C,dialogues:y}=Oe(),[x,m]=v.useState({name:"",description:""}),[u,p]=v.useState({}),[c,w]=v.useState(!1),h=(l,n)=>{m(t=>({...t,[l]:n})),u[l]&&p(t=>({...t,[l]:null}))},F=()=>{const l={};return x.name.trim()?/\s/.test(x.name)&&(l.name="Name cannot contain whitespace"):l.name=o("validation.required"),p(l),Object.keys(l).length===0},z=async l=>{if(l.preventDefault(),!!F()){w(!0);try{const t=y.filter(f=>f.projectId===s).length===0,i=await C({projectId:s,name:x.name.trim(),description:x.description.trim()});t?mt():ut(),m({name:"",description:""}),p({}),d(!1),setTimeout(()=>{r({to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:s,dialogueId:i.id}})},1e3)}catch(n){console.error("Error creating dialogue:",n),p({submit:o("common.error")})}finally{w(!1)}}},g=()=>{m({name:"",description:""}),p({}),d(!1)};return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(se,{children:[e.jsx(ae,{children:o("dialogues.createNew")}),e.jsx(re,{children:o("dialogues.createFirst")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"dialogue-name",children:[o("dialogues.dialogueName")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"dialogue-name",placeholder:"Welcome Conversation",value:x.name,onChange:l=>h("name",l.target.value),className:u.name?"border-destructive":"",autoFocus:!0}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"dialogue-description",children:o("projects.projectDescription")}),e.jsx(it,{id:"dialogue-description",placeholder:"A brief description of this dialogue...",value:x.description,onChange:l=>h("description",l.target.value),rows:3})]}),u.submit&&e.jsx("p",{className:"text-sm text-destructive",children:u.submit})]})}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:g,disabled:c,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:c,children:o(c?"common.loading":"common.create")})]})]})]})})}function Ft({projectId:a,dialogues:d=[]}){const{t:s}=O(),{importDialogue:o}=Oe(),[r,C]=v.useState(!1),[y,x]=v.useState(!1),m=v.useRef(null),u=oe(),p=async c=>{var h;const w=(h=c.target.files)==null?void 0:h[0];if(w){x(!0);try{await o(a,w)}catch(F){console.error("Failed to import dialogue:",F)}finally{x(!1),m.current&&(m.current.value="")}}};return e.jsxs("div",{children:[e.jsx(Et,{open:r,onOpenChange:C,projectId:a}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("dialogues.title")," (",d.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:m,type:"file",accept:".mnteadlg",onChange:p,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsx(fe,{align:"end",children:e.jsxs(W,{onClick:()=>{var c;return(c=m.current)==null?void 0:c.click()},disabled:y,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),s("common.import")]})})]}),e.jsxs(k,{size:"icon",onClick:()=>C(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(U,{className:"h-4 w-4"}),!u&&s("dialogues.createNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var c;return(c=m.current)==null?void 0:c.click()},disabled:y,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{size:"sm",onClick:()=>C(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("dialogues.createNew")]})]})]})]}),d.length===0?e.jsx(vt,{icon:le,title:s("dialogues.noDialogues"),description:s("dialogues.createFirst"),action:e.jsxs(k,{type:"button",onClick:()=>C(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),s("dialogues.createNew")]}),tips:["Dialogues are the backbone of your interactive narratives","Use nodes to create branching conversations","Connect nodes to create dialogue flow"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(c=>e.jsx(Pt,{dialogue:c,projectId:a},c.id))})]})}function zt({open:a,onOpenChange:d,projectId:s}){const{t:o}=O(),{createParticipant:r,participants:C}=ue(),{categories:y,loadCategories:x}=K(),[m,u]=v.useState(!1),[p,c]=v.useState({name:"",category:""}),[w,h]=v.useState({});v.useEffect(()=>{a&&s&&x(s)},[a,s,x]);const F=n=>{const t=[];let i=y.find(f=>f.id===n);for(;i;)t.unshift(i.name),i=y.find(f=>f.id===i.parentCategoryId);return t.join(" > ")},z=(()=>{const n=new Map;return y.forEach(t=>{const i=F(t.id);if(!i)return;const[f]=i.split(" > ");n.has(f)||n.set(f,[]),n.get(f).push({id:t.id,name:t.name,label:i})}),Array.from(n.entries()).map(([t,i])=>({label:t,options:i.sort((f,S)=>f.label.localeCompare(S.label))})).sort((t,i)=>t.label.localeCompare(i.label))})(),g=()=>{const n={};if(p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(n.name="Name must be 16 characters or fewer"):n.name="Name must contain only letters and numbers":n.name=o("validation.required"),p.category||(n.category=o("validation.required")),!n.name&&p.category){const t=p.name.trim(),i=y.filter(I=>I.name===p.category),f=I=>{let b=I;const D=new Set;for(;b;){if(D.has(b))return null;D.add(b);const N=y.find(P=>P.id===b);if(!N)return null;if(!N.parentCategoryId)return N.id;b=N.parentCategoryId}return null},S=i.map(I=>f(I.id)).filter(Boolean),j=C.filter(I=>I.projectId===s).some(I=>{if(I.name!==t)return!1;const b=y.find(N=>N.name===I.category);if(!b)return!1;const D=f(b.id);return D&&S.includes(D)});S.length>0&&j&&(n.name="Participant name must be unique within its category tree")}return h(n),Object.keys(n).length===0},l=async n=>{if(n.preventDefault(),!!g()){u(!0);try{await r({...p,projectId:s}),c({name:"",category:""}),h({}),d(!1)}catch(t){console.error("Failed to create participant:",t)}finally{u(!1)}}};return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[425px]",children:[e.jsxs(se,{children:[e.jsx(ae,{children:o("participants.addNew")}),e.jsx(re,{children:o("participants.createDescription")})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:p.name,onChange:n=>{c({...p,name:n.target.value}),w.name&&h({...w,name:null})},placeholder:o("participants.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[o("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ce,{id:"category",value:p.category,onChange:n=>{c({...p,category:n.target.value}),w.category&&h({...w,category:null})},className:w.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:o("participants.categoryPlaceholder")}),z.length===0?e.jsx("option",{value:"",disabled:!0,children:o("categories.noCategories")}):z.map(n=>e.jsx("optgroup",{label:n.label,children:n.options.map(t=>e.jsx("option",{value:t.name,children:t.label},t.id))},n.label))]}),w.category&&e.jsx("p",{className:"text-xs text-destructive",children:w.category})]})]}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:m,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:m||!p.name.trim()||!p.category,children:o(m?"common.creating":"common.create")})]})]})]})})}function Mt({open:a,onOpenChange:d,participant:s,projectId:o}){const{t:r}=O(),{updateParticipant:C,participants:y}=ue(),{categories:x,loadCategories:m}=K(),[u,p]=v.useState(!1),[c,w]=v.useState({name:"",category:""}),[h,F]=v.useState({});v.useEffect(()=>{a&&o&&m(o),a&&s&&w({name:s.name||"",category:s.category||""})},[a,o,s,m]);const z=t=>{const i=[];let f=x.find(S=>S.id===t);for(;f;)i.unshift(f.name),f=x.find(S=>S.id===f.parentCategoryId);return i.join(" > ")},g=(()=>{const t=new Map;return x.forEach(i=>{const f=z(i.id);if(!f)return;const[S]=f.split(" > ");t.has(S)||t.set(S,[]),t.get(S).push({id:i.id,name:i.name,label:f})}),Array.from(t.entries()).map(([i,f])=>({label:i,options:f.sort((S,E)=>S.label.localeCompare(E.label))})).sort((i,f)=>i.label.localeCompare(f.label))})();v.useEffect(()=>{a||F({})},[a]);const l=()=>{const t={};if(c.name.trim()?/^[A-Za-z0-9]+$/.test(c.name)?c.name.length>16&&(t.name="Name must be 16 characters or fewer"):t.name="Name must contain only letters and numbers":t.name=r("validation.required"),c.category||(t.category=r("validation.required")),!t.name&&c.category&&s){const i=c.name.trim(),f=x.filter(b=>b.name===c.category),S=b=>{let D=b;const N=new Set;for(;D;){if(N.has(D))return null;N.add(D);const P=x.find(L=>L.id===D);if(!P)return null;if(!P.parentCategoryId)return P.id;D=P.parentCategoryId}return null},E=f.map(b=>S(b.id)).filter(Boolean),I=y.filter(b=>b.projectId===o).some(b=>{if(b.id===s.id||b.name!==i)return!1;const D=x.find(P=>P.name===b.category);if(!D)return!1;const N=S(D.id);return N&&E.includes(N)});E.length>0&&I&&(t.name="Participant name must be unique within its category tree")}return F(t),Object.keys(t).length===0},n=async t=>{if(t.preventDefault(),!!l()){p(!0);try{await C(s.id,c),d(!1)}catch(i){console.error("Failed to update participant:",i)}finally{p(!1)}}};return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[425px]",children:[e.jsxs(se,{children:[e.jsxs(ae,{children:[r("common.edit")," ",r("participants.title").slice(0,-1)]}),e.jsx(re,{children:r("participants.updateDescription")})]}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:c.name,onChange:t=>{w({...c,name:t.target.value}),h.name&&F({...h,name:null})},placeholder:r("participants.namePlaceholder"),className:h.name?"border-destructive":"",required:!0}),h.name&&e.jsx("p",{className:"text-xs text-destructive",children:h.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[r("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ce,{id:"category",value:c.category,onChange:t=>{w({...c,category:t.target.value}),h.category&&F({...h,category:null})},className:h.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:r("participants.categoryPlaceholder")}),g.length===0?e.jsx("option",{value:"",disabled:!0,children:r("categories.noCategories")}):g.map(t=>e.jsx("optgroup",{label:t.label,children:t.options.map(i=>e.jsx("option",{value:i.name,children:i.label},i.id))},t.label))]}),h.category&&e.jsx("p",{className:"text-xs text-destructive",children:h.category})]})]}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:u,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:u||!c.name.trim()||!c.category,children:r(u?"common.saving":"common.save")})]})]})]})})}function Je({participant:a}){const{t:d}=O(),{deleteParticipant:s}=ue(),[o,r]=v.useState(!1),[C,y]=v.useState(!1),[x,m]=v.useState(!1),u=async()=>{m(!0);try{await s(a.id),r(!1)}catch(p){console.error("Failed to delete participant:",p)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.category&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.category})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>r(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Mt,{open:C,onOpenChange:y,participant:a,projectId:a.projectId}),e.jsx(Ne,{open:o,onOpenChange:r,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(ye,{children:[e.jsx(we,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(Ce,{children:d("participants.deleteTitle")}),e.jsx(ke,{children:d("participants.deleteDescription",{name:a.name})})]}),e.jsxs(De,{children:[e.jsx(Ie,{variant:"outline",disabled:x,children:d("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:u,disabled:x,children:d(x?"common.deleting":"common.delete")})]})]})})]})}function At({projectId:a,participants:d=[]}){const{t:s}=O(),{importParticipants:o,exportParticipants:r}=ue(),{categories:C,loadCategories:y}=K(),[x,m]=v.useState(!1),[u,p]=v.useState(!1),c=v.useRef(null),w=oe(),[h,F]=v.useState(new Set);v.useEffect(()=>{a&&y(a)},[a,y]);const{rootCategories:z,childrenByParent:g,participantsByCategory:l,unmatchedParticipants:n}=v.useMemo(()=>{const j=new Map;C.forEach(N=>{const P=N.parentCategoryId||null;j.has(P)||j.set(P,[]),j.get(P).push(N)}),j.forEach(N=>{N.sort((P,L)=>P.name.localeCompare(L.name))});const I=new Map;C.forEach(N=>{I.has(N.name)||I.set(N.name,N)});const b=new Map,D=[];return d.forEach(N=>{const P=I.get(N.category);if(!P){D.push(N);return}b.has(P.id)||b.set(P.id,[]),b.get(P.id).push(N)}),b.forEach(N=>{N.sort((P,L)=>P.name.localeCompare(L.name))}),{rootCategories:(j.get(null)||[]).slice().sort((N,P)=>N.name.localeCompare(P.name)),childrenByParent:j,participantsByCategory:b,unmatchedParticipants:D.sort((N,P)=>N.name.localeCompare(P.name))}},[C,d]),t=j=>{F(I=>{const b=new Set(I);return b.has(j)?b.delete(j):b.add(j),b})},i=j=>l.has(j)?!0:(g.get(j)||[]).some(b=>i(b.id)),f=j=>{const I=(g.get(j.id)||[]).filter(N=>i(N.id)),b=l.get(j.id)||[];if(I.length===0&&b.length===0)return null;const D=h.has(j.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>t(j.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[D?e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:j.name})]})}),!D&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[b.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(N=>e.jsx(Je,{participant:N},N.id))}),I.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:I.map(N=>f(N))})]})]},j.id)},S=async()=>{try{const j=await r(a),I=new Blob([JSON.stringify(j,null,2)],{type:"application/json"}),b=URL.createObjectURL(I),D=document.createElement("a");D.href=b,D.download=`participants-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(b)}catch(j){console.error("Failed to export participants:",j)}},E=async j=>{var b;const I=(b=j.target.files)==null?void 0:b[0];if(I){p(!0);try{const D=await I.text(),N=JSON.parse(D);await o(a,Array.isArray(N)?N:[N])}catch(D){console.error("Failed to import participants:",D)}finally{p(!1),c.current&&(c.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("participants.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("participants.description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:c,type:"file",accept:".json",onChange:E,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(W,{onClick:()=>{var j;return(j=c.current)==null?void 0:j.click()},disabled:u,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(W,{onClick:S,disabled:d.length===0,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>m(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(U,{className:"h-4 w-4"}),!w&&s("participants.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var j;return(j=c.current)==null?void 0:j.click()},disabled:u,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:S,disabled:d.length===0,className:"gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>m(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("participants.addNew")]})]})]})]}),d.length===0?e.jsx(q,{children:e.jsx(R,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Xe,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("participants.noParticipants")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("participants.noParticipantsDescription")}),e.jsxs(k,{onClick:()=>m(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("participants.addNew")]})]})})}):e.jsxs("div",{className:"space-y-6",children:[z.map(j=>f(j)),n.length>0&&e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3",children:e.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"Uncategorized"})}),e.jsx("div",{className:"p-4 pt-4 border-t border-border",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(j=>e.jsx(Je,{participant:j},j.id))})})]})]}),e.jsx(zt,{open:x,onOpenChange:m,projectId:a})]})}function Ot({open:a,onOpenChange:d,projectId:s}){const{t:o}=O(),{categories:r,createCategory:C,loadCategories:y}=K(),[x,m]=v.useState(!1),[u,p]=v.useState({name:"",parentCategoryId:null}),[c,w]=v.useState({});v.useEffect(()=>{a&&s&&y(s)},[a,s,y]),v.useEffect(()=>{a||(p({name:"",parentCategoryId:null}),w({}))},[a]);const h=()=>{const l={};if(u.name.trim()?/^[A-Za-z0-9]+$/.test(u.name)?u.name.length>16&&(l.name="Name must be 16 characters or fewer"):l.name="Name must contain only letters and numbers":l.name=o("validation.required"),u.parentCategoryId){let t=0,i=u.parentCategoryId;const f=new Set;for(;i;){if(f.has(i)){t=Number.POSITIVE_INFINITY;break}f.add(i);const S=r.find(E=>E.id===i);if(!S)break;t+=1,i=S.parentCategoryId||null}(!Number.isFinite(t)||t+1>5)&&(l.parentCategoryId="Category depth cannot exceed 5 levels")}if(u.name.trim()){const n=u.name.trim(),t=E=>{let j=E;const I=new Set;for(;j;){if(I.has(j))return null;I.add(j);const b=r.find(D=>D.id===j);if(!b)return null;if(!b.parentCategoryId)return b.id;j=b.parentCategoryId}return null},i=u.parentCategoryId?t(u.parentCategoryId):null;(i?!(E=>{const j=[E],I=new Set;for(;j.length>0;){const b=j.pop();if(!b||I.has(b))continue;I.add(b);const D=r.find(N=>N.id===b);if(D){if(D.name===n)return!0;r.filter(N=>N.parentCategoryId===D.id).forEach(N=>j.push(N.id))}}return!1})(i):!r.some(E=>!E.parentCategoryId&&E.name===n))||(l.name="Category name must be unique within its tree")}return w(l),Object.keys(l).length===0},F=async l=>{if(l.preventDefault(),!!h()){m(!0);try{await C({name:u.name,parentCategoryId:u.parentCategoryId||null,projectId:s}),p({name:"",parentCategoryId:null}),w({}),d(!1)}catch(n){console.error("Failed to create category:",n)}finally{m(!1)}}},z=l=>{const n=[];let t=r.find(i=>i.id===l);for(;t;)n.unshift(t.name),t=r.find(i=>i.id===t.parentCategoryId);return n.join(" > ")},g=(()=>{const l=new Map;return r.forEach(n=>{const t=z(n.id);if(!t)return;const[i]=t.split(" > ");l.has(i)||l.set(i,[]),l.get(i).push({id:n.id,label:t})}),Array.from(l.entries()).map(([n,t])=>({label:n,options:t.sort((i,f)=>i.label.localeCompare(f.label))})).sort((n,t)=>n.label.localeCompare(t.label))})();return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[425px]",children:[e.jsxs(se,{children:[e.jsx(ae,{children:o("categories.addNew")}),e.jsx(re,{children:o("categories.createDescription")})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:u.name,onChange:l=>{p({...u,name:l.target.value}),c.name&&w({...c,name:null})},placeholder:o("categories.namePlaceholder"),className:c.name?"border-destructive":"",required:!0}),c.name&&e.jsx("p",{className:"text-xs text-destructive",children:c.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:o("categories.parentCategory")}),e.jsxs(ce,{id:"parentCategory",value:u.parentCategoryId||"none",onChange:l=>{const n=l.target.value;p({...u,parentCategoryId:n==="none"?null:n}),c.parentCategoryId?w({...c,parentCategoryId:null}):c.name&&w({...c,name:null})},children:[e.jsx("option",{value:"none",children:o("categories.noParent")}),g.map(l=>e.jsx("optgroup",{label:l.label,children:l.options.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))},l.label))]}),c.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:c.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("categories.parentCategoryHelp")})]})]}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:x,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:x||!u.name.trim(),children:o(x?"common.creating":"common.create")})]})]})]})})}function Lt({open:a,onOpenChange:d,category:s,projectId:o}){const{t:r}=O(),{categories:C,updateCategory:y,loadCategories:x}=K(),[m,u]=v.useState(!1),[p,c]=v.useState({name:"",parentCategoryId:null}),[w,h]=v.useState({});v.useEffect(()=>{a&&o&&x(o),a&&s&&c({name:s.name||"",parentCategoryId:s.parentCategoryId||null})},[a,o,s,x]),v.useEffect(()=>{a||h({})},[a]);const F=()=>{const n={};p.name.trim()?/^[A-Za-z0-9]+$/.test(p.name)?p.name.length>16&&(n.name="Name must be 16 characters or fewer"):n.name="Name must contain only letters and numbers":n.name=r("validation.required");const t=5,i=new Map;C.forEach(E=>{const j=E.parentCategoryId||null;i.has(j)||i.set(j,[]),i.get(j).push(E.id)});const f=E=>{const j=new Set,I=b=>{if(j.has(b))return 0;j.add(b);const D=i.get(b)||[];if(D.length===0)return 1;let N=0;return D.forEach(P=>{N=Math.max(N,I(P))}),1+N};return I(s==null?void 0:s.id)},S=E=>{let j=0,I=E;const b=new Set;for(;I;){if(b.has(I))return Number.POSITIVE_INFINITY;b.add(I);const D=C.find(N=>N.id===I);if(!D)break;j+=1,I=D.parentCategoryId||null}return j};if(s){const E=p.parentCategoryId?S(p.parentCategoryId):0,j=f(s.id),I=E+j;(!Number.isFinite(E)||I>t)&&(n.parentCategoryId=`Category depth cannot exceed ${t} levels`)}if(s&&p.name.trim()){const E=p.name.trim(),j=N=>{let P=N;const L=new Set;for(;P;){if(L.has(P))return null;L.add(P);const T=C.find(B=>B.id===P);if(!T)return null;if(!T.parentCategoryId)return T.id;P=T.parentCategoryId}return null},I=p.parentCategoryId?j(p.parentCategoryId):s.id;(I?!(N=>{const P=[N],L=new Set;for(;P.length>0;){const T=P.pop();if(!T||L.has(T))continue;L.add(T);const B=C.find(Q=>Q.id===T);if(B){if(B.id!==s.id&&B.name===E)return!0;C.filter(Q=>Q.parentCategoryId===B.id).forEach(Q=>P.push(Q.id))}}return!1})(I):!C.some(N=>!N.parentCategoryId&&N.id!==s.id&&N.name===E))||(n.name="Category name must be unique within its tree")}return h(n),Object.keys(n).length===0},z=async n=>{if(n.preventDefault(),!!F()){u(!0);try{await y(s.id,{name:p.name,parentCategoryId:p.parentCategoryId||null}),d(!1)}catch(t){console.error("Failed to update category:",t)}finally{u(!1)}}},g=n=>{const t=[];let i=C.find(f=>f.id===n);for(;i;)t.unshift(i.name),i=C.find(f=>f.id===i.parentCategoryId);return t.join(" > ")},l=(()=>{const n=new Map;return C.filter(t=>t.id!==(s==null?void 0:s.id)).forEach(t=>{const i=g(t.id);if(!i)return;const[f]=i.split(" > ");n.has(f)||n.set(f,[]),n.get(f).push({id:t.id,label:i})}),Array.from(n.entries()).map(([t,i])=>({label:t,options:i.sort((f,S)=>f.label.localeCompare(S.label))})).sort((t,i)=>t.label.localeCompare(i.label))})();return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[425px]",children:[e.jsxs(se,{children:[e.jsxs(ae,{children:[r("common.edit")," ",r("categories.title").slice(0,-1)]}),e.jsx(re,{children:r("categories.updateDescription")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:p.name,onChange:n=>{c({...p,name:n.target.value}),w.name&&h({...w,name:null})},placeholder:r("categories.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:r("categories.parentCategory")}),e.jsxs(ce,{id:"parentCategory",value:p.parentCategoryId||"none",onChange:n=>{const t=n.target.value;c({...p,parentCategoryId:t==="none"?null:t}),w.parentCategoryId?h({...w,parentCategoryId:null}):w.name&&h({...w,name:null})},children:[e.jsx("option",{value:"none",children:r("categories.noParent")}),l.map(n=>e.jsx("optgroup",{label:n.label,children:n.options.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))},n.label))]}),w.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:w.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("categories.parentCategoryHelp")})]})]}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:m,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:m||!p.name.trim(),children:r(m?"common.saving":"common.save")})]})]})]})})}function Ut({category:a}){const{t:d}=O(),{categories:s,deleteCategory:o}=K(),[r,C]=v.useState(!1),[y,x]=v.useState(!1),[m,u]=v.useState(!1),p=async()=>{u(!0);try{await o(a.id),C(!1)}catch(h){console.error("Failed to delete category:",h)}finally{u(!1)}},w=(()=>{if(!a.parentCategoryId)return null;const h=s.find(F=>F.id===a.parentCategoryId);return h?h.name:null})();return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center text-white",children:e.jsx(Ke,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),w&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:w})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>x(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>C(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Lt,{open:y,onOpenChange:x,category:a,projectId:a.projectId}),e.jsx(Ne,{open:r,onOpenChange:C,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(ye,{children:[e.jsx(we,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(Ce,{children:d("categories.deleteTitle")}),e.jsx(ke,{children:d("categories.deleteDescription",{name:a.name})})]}),e.jsxs(De,{children:[e.jsx(Ie,{variant:"outline",disabled:m,children:d("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:p,disabled:m,children:d(m?"common.deleting":"common.delete")})]})]})})]})}function Tt({projectId:a,categories:d=[]}){const{t:s}=O(),{importCategories:o,exportCategories:r}=K(),[C,y]=v.useState(!1),[x,m]=v.useState(!1),u=v.useRef(null),p=oe(),[c,w]=v.useState(new Set),h=new Map;d.forEach(t=>{const i=t.parentCategoryId||null;h.has(i)||h.set(i,[]),h.get(i).push(t)});const F=(h.get(null)||[]).slice().sort((t,i)=>t.name.localeCompare(i.name)),z=t=>{w(i=>{const f=new Set(i);return f.has(t)?f.delete(t):f.add(t),f})},g=t=>{const i=(h.get(t.id)||[]).slice().sort((S,E)=>S.name.localeCompare(E.name)),f=c.has(t.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>z(t.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[f?e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:t.name})]})}),!f&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(Ut,{category:t})}),i.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:i.map(S=>g(S))})]})]},t.id)},l=async()=>{try{const t=await r(a),i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),f=URL.createObjectURL(i),S=document.createElement("a");S.href=f,S.download=`categories-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(f)}catch(t){console.error("Failed to export categories:",t)}},n=async t=>{var f;const i=(f=t.target.files)==null?void 0:f[0];if(i){m(!0);try{const S=await i.text(),E=JSON.parse(S);await o(a,Array.isArray(E)?E:[E])}catch(S){console.error("Failed to import categories:",S)}finally{m(!1),u.current&&(u.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("categories.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("categories.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".json",onChange:n,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(W,{onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},disabled:x,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(W,{onClick:l,disabled:d.length===0,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(U,{className:"h-4 w-4"}),!p&&s("categories.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},disabled:x,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:l,disabled:d.length===0,className:"gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("categories.addNew")]})]})]})]}),d.length===0?e.jsx(q,{children:e.jsx(R,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ke,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("categories.noCategories")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("categories.noCategoriesDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("categories.addNew")]})]})})}):e.jsx("div",{className:"space-y-6",children:F.map(t=>g(t))}),e.jsx(Ot,{open:C,onOpenChange:y,projectId:a})]})}function qt({open:a,onOpenChange:d,projectId:s}){const{t:o}=O(),{createDecorator:r}=xe(),[C,y]=v.useState(!1),[x,m]=v.useState({name:"",type:"",properties:[]}),[u,p]=v.useState({}),c=()=>{m({...x,properties:[...x.properties,{name:"",type:"string",defaultValue:""}]})},w=(g,l,n)=>{const t=[...x.properties];t[g]={...t[g],[l]:n},m({...x,properties:t})},h=g=>{m({...x,properties:x.properties.filter((l,n)=>n!==g)})},F=()=>{const g={};return x.name.trim()?/\s/.test(x.name)&&(g.name=o("decorators.validation.noWhitespace")):g.name=o("validation.required"),p(g),Object.keys(g).length===0},z=async g=>{if(g.preventDefault(),!!F()){y(!0);try{await r({...x,projectId:s}),m({name:"",type:"",properties:[]}),p({}),d(!1)}catch(l){console.error("Failed to create decorator:",l)}finally{y(!1)}}};return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsx(ae,{children:o("decorators.addNew")}),e.jsx(re,{children:o("decorators.createDescription")})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[o("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:x.name,onChange:g=>{m({...x,name:g.target.value}),u.name&&p({...u,name:null})},placeholder:o("decorators.namePlaceholder"),className:u.name?"border-destructive":"",required:!0}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:o("decorators.type")}),e.jsx($,{id:"type",value:x.type,onChange:g=>m({...x,type:g.target.value}),placeholder:o("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:o("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:c,className:"gap-2",children:[e.jsx(U,{className:"h-3 w-3"}),o("decorators.properties.add")]})]}),x.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:o("decorators.properties.empty")}),x.properties.map((g,l)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.name")}),e.jsx($,{value:g.name,onChange:n=>w(l,"name",n.target.value),placeholder:o("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.type")}),e.jsx(ce,{value:g.type,onChange:n=>w(l,"type",n.target.value),children:[{value:"string",label:o("decorators.types.string")},{value:"int",label:o("decorators.types.integer")},{value:"float",label:o("decorators.types.float")},{value:"bool",label:o("decorators.types.boolean")}].map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:o("decorators.properties.defaultValue")}),e.jsx($,{value:g.defaultValue,onChange:n=>w(l,"defaultValue",n.target.value),placeholder:g.type==="bool"?o("decorators.properties.placeholders.bool"):g.type==="int"?o("decorators.properties.placeholders.int"):g.type==="float"?o("decorators.properties.placeholders.float"):o("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>h(l),className:"h-9 w-9",children:e.jsx(Ae,{className:"h-4 w-4"})})]},l))]})]})}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:C,children:o("common.cancel")}),e.jsx(k,{type:"submit",disabled:C||!x.name.trim(),children:o(C?"common.creating":"common.create")})]})]})]})})}function Rt({open:a,onOpenChange:d,decorator:s,projectId:o}){const{t:r}=O(),{updateDecorator:C}=xe(),[y,x]=v.useState(!1),[m,u]=v.useState({name:"",type:"",properties:[]}),[p,c]=v.useState({});v.useEffect(()=>{a&&s&&u({name:s.name||"",type:s.type||"",properties:Array.isArray(s.properties)?s.properties:[]})},[a,s]),v.useEffect(()=>{a||c({})},[a]);const w=()=>{u(l=>({...l,properties:[...l.properties,{name:"",type:"string",defaultValue:""}]}))},h=(l,n,t)=>{const i=[...m.properties];i[l]={...i[l],[n]:t},u({...m,properties:i})},F=l=>{u(n=>({...n,properties:n.properties.filter((t,i)=>i!==l)}))},z=()=>{const l={};return m.name.trim()?/\s/.test(m.name)&&(l.name=r("decorators.validation.noWhitespace")):l.name=r("validation.required"),c(l),Object.keys(l).length===0},g=async l=>{if(l.preventDefault(),!!z()){x(!0);try{await C(s.id,{name:m.name,type:m.type,properties:m.properties,projectId:o}),d(!1)}catch(n){console.error("Failed to update decorator:",n)}finally{x(!1)}}};return e.jsx(ee,{open:a,onOpenChange:d,children:e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(ae,{children:[r("common.edit")," ",r("decorators.title").slice(0,-1)]}),e.jsx(re,{children:r("decorators.updateDescription")})]}),e.jsxs("form",{onSubmit:g,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[r("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:m.name,onChange:l=>{u({...m,name:l.target.value}),p.name&&c({...p,name:null})},placeholder:r("decorators.namePlaceholder"),className:p.name?"border-destructive":"",required:!0}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:r("decorators.type")}),e.jsx($,{id:"type",value:m.type,onChange:l=>u({...m,type:l.target.value}),placeholder:r("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:r("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:w,className:"gap-2",children:[e.jsx(U,{className:"h-3 w-3"}),r("decorators.properties.add")]})]}),m.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:r("decorators.properties.empty")}),m.properties.map((l,n)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.name")}),e.jsx($,{value:l.name,onChange:t=>h(n,"name",t.target.value),placeholder:r("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.type")}),e.jsx(ce,{value:l.type,onChange:t=>h(n,"type",t.target.value),children:[{value:"string",label:r("decorators.types.string")},{value:"int",label:r("decorators.types.integer")},{value:"float",label:r("decorators.types.float")},{value:"bool",label:r("decorators.types.boolean")}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:r("decorators.properties.defaultValue")}),e.jsx($,{value:l.defaultValue,onChange:t=>h(n,"defaultValue",t.target.value),placeholder:r("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>F(n),children:e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})})]},n))]})]})}),e.jsxs(ne,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:y,children:r("common.cancel")}),e.jsx(k,{type:"submit",disabled:y||!m.name.trim(),children:r(y?"common.saving":"common.save")})]})]})]})})}function $t({decorator:a}){const{t:d}=O(),{deleteDecorator:s}=xe(),[o,r]=v.useState(!1),[C,y]=v.useState(!1),[x,m]=v.useState(!1),u=async()=>{m(!0);try{await s(a.id),r(!1)}catch(p){console.error("Failed to delete decorator:",p)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white",children:e.jsx(Ye,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.type&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.type})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>r(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Rt,{open:C,onOpenChange:y,decorator:a,projectId:a.projectId}),e.jsx(Ne,{open:o,onOpenChange:r,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(ye,{children:[e.jsx(we,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(Ce,{children:d("decorators.deleteTitle")}),e.jsx(ke,{children:d("decorators.deleteDescription",{name:a.name})})]}),e.jsxs(De,{children:[e.jsx(Ie,{variant:"outline",disabled:x,children:d("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:u,disabled:x,children:d(x?"common.deleting":"common.delete")})]})]})})]})}function Bt({projectId:a,decorators:d=[]}){const{t:s}=O(),{importDecorators:o,exportDecorators:r}=xe(),[C,y]=v.useState(!1),[x,m]=v.useState(!1),u=v.useRef(null),p=oe(),c=async()=>{try{const h=await r(a),F=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),z=URL.createObjectURL(F),g=document.createElement("a");g.href=z,g.download=`decorators-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(z)}catch(h){console.error("Failed to export decorators:",h)}},w=async h=>{var z;const F=(z=h.target.files)==null?void 0:z[0];if(F){m(!0);try{const g=await F.text(),l=JSON.parse(g);await o(a,Array.isArray(l)?l:[l])}catch(g){console.error("Failed to import decorators:",g)}finally{m(!1),u.current&&(u.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("decorators.title")," (",d.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("decorators.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".json",onChange:w,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(W,{onClick:()=>{var h;return(h=u.current)==null?void 0:h.click()},disabled:x,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(W,{onClick:c,disabled:d.length===0,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(U,{className:"h-4 w-4"}),!p&&s("decorators.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var h;return(h=u.current)==null?void 0:h.click()},disabled:x,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:c,disabled:d.length===0,className:"gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("decorators.addNew")]})]})]})]}),d.length===0?e.jsx(q,{children:e.jsx(R,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ye,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("decorators.noDecorators")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("decorators.noDecoratorsDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("decorators.addNew")]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(h=>e.jsx($t,{decorator:h},h.id))}),e.jsx(qt,{open:C,onOpenChange:y,projectId:a})]})}function Gt(){const{t:a}=O(),{theme:d,resolvedTheme:s,setTheme:o}=lt(),{projectId:r}=Ve.useParams(),C=Ve.useSearch(),y=oe(),{projects:x,loadProjects:m,deleteProject:u,exportProject:p,importProject:c,updateProject:w}=ot(),{dialogues:h,loadDialogues:F}=Oe(),{participants:z,loadParticipants:g}=ue(),{categories:l,loadCategories:n}=K(),{decorators:t,loadDecorators:i}=xe(),{status:f,checkRemoteDiff:S,startPull:E,lastSyncedAt:j}=_e(),[I,b]=v.useState(!0),[D,N]=v.useState((C==null?void 0:C.section)||"overview"),[P,L]=v.useState(!1),[T,B]=v.useState(!1),[Q,Pe]=v.useState(!1),Ue=v.useRef(new Set),Ee=v.useRef(null),de=v.useCallback(async()=>{b(!0),await Promise.all([m(),F(),g(r),n(r),i(r)]),b(!1)},[m,F,g,n,i,r]);v.useEffect(()=>{de()},[de]),v.useEffect(()=>{j&&de()},[j,de]),v.useEffect(()=>{(async()=>{if(!r||f!=="connected"||Ue.current.has(r))return;Ue.current.add(r),await S(r)&&await E(r,{simulate:!0})})()},[r,f,S,E]);const V=x.find(A=>A.id===r),Fe=h.filter(A=>A.projectId===r),ze=z.filter(A=>A.projectId===r),Te=l.filter(A=>A.projectId===r),qe=t.filter(A=>A.projectId===r),je=async()=>{try{await p(r)}catch(A){console.error("Failed to export project:",A)}};v.useEffect(()=>{const A=H=>{const X=H==null?void 0:H.detail;!X||X.projectId!==r||V&&w(r,{name:V.name,description:V.description,version:V.version})},ie=H=>{const X=H==null?void 0:H.detail;!X||X.projectId!==r||je()};return window.addEventListener("command:project-save",A),window.addEventListener("command:project-export",ie),()=>{window.removeEventListener("command:project-save",A),window.removeEventListener("command:project-export",ie)}},[r,V,w,je]);const et=async A=>{var H;const ie=(H=A.target.files)==null?void 0:H[0];if(ie){L(!0);try{await c(ie),await de()}catch(X){console.error("Failed to import project:",X)}finally{L(!1),Ee.current&&(Ee.current.value="")}}},tt=async()=>{await u(r),window.location.href="#/"},Re=()=>{Pe(!0)};return I?e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsx("p",{className:"text-muted-foreground",children:a("common.loading")})}):V?e.jsxs("div",{className:`${y?"min-h-screen":"h-screen"} flex flex-col`,children:[e.jsx(gt,{className:T?"z-40":void 0,left:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>B(!0),className:"lg:hidden rounded-full shrink-0",children:e.jsx(xt,{className:"h-5 w-5"})}),e.jsx(ve,{to:"/",children:e.jsx(ht,{content:a("common.back"),side:"bottom",children:e.jsx(k,{variant:"ghost",size:"icon",className:"rounded-full shrink-0",children:e.jsx(yt,{className:"h-5 w-5"})})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-sm md:text-2xl font-bold tracking-tight truncate",children:V.name}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:a("projects.projectDetails")})]})]}),right:e.jsxs("div",{className:"hidden md:flex items-center text-xs font-medium text-muted-foreground bg-muted px-3 py-1.5 rounded-full","data-header-mobile-hidden":!0,children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),a("dialogues.autoSaved")]}),menuItems:e.jsxs(e.Fragment,{children:[e.jsx(ft,{}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>o(s==="dark"?"light":"dark"),className:"justify-start",children:s==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),a("settings.lightMode")]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),a("settings.darkMode")]})})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>B(!1)}),e.jsxs("div",{className:`flex-1 flex min-h-0 ${y?"":"overflow-hidden"}`,children:[e.jsx(It,{activeSection:D,onSectionChange:A=>{N(A),B(!1)},project:V,dialogueCount:Fe.length,participantCount:ze.length,isMobileOpen:T,onMobileClose:()=>B(!1)}),e.jsx("main",{className:`flex-1 bg-grid ${y?"":"overflow-y-auto"}`,children:e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8 lg:p-12",children:[D==="overview"&&e.jsx(St,{project:V,dialogues:Fe,participants:ze,categories:Te,decorators:qe,onExport:je,onImport:et,onDelete:Re,onSectionChange:N,fileInputRef:Ee,isImporting:P}),D==="dialogues"&&e.jsx(Ft,{projectId:r,dialogues:Fe}),D==="participants"&&e.jsx(At,{projectId:r,participants:ze}),D==="categories"&&e.jsx(Tt,{projectId:r,categories:Te}),D==="decorators"&&e.jsx(Bt,{projectId:r,decorators:qe}),D==="settings"&&e.jsx(ct,{project:V,onExport:je,onDelete:Re})]})})]}),e.jsx(Ne,{open:Q,onOpenChange:Pe,children:e.jsxs(be,{variant:"destructive",size:"sm",children:[e.jsxs(ye,{children:[e.jsx(we,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(Ce,{children:a("projects.deleteProject")}),e.jsx(ke,{children:a("projects.deleteConfirm")})]}),e.jsxs(De,{children:[e.jsx(Ie,{variant:"outline",children:a("common.cancel")}),e.jsx(Se,{variant:"destructive",onClick:()=>{Pe(!1),tt()},children:a("common.delete")})]})]})})]}):e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a("projects.notFound")}),e.jsx("p",{className:"text-muted-foreground",children:a("projects.notFoundDescription")})]})})}export{Gt as component};
