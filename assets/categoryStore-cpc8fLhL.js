import{d as s,w as o}from"./index-BTPfJjN_.js";import{c as m,v as f}from"./label-DB8iLE3I.js";const I=m((u,n)=>({categories:[],isLoading:!1,loadCategories:async t=>{u({isLoading:!0});try{const e=await s.categories.where("projectId").equals(t).toArray();u({categories:e,isLoading:!1})}catch(e){console.error("Failed to load categories:",e),o({variant:"error",title:"Failed to Load Categories",description:e.message||"An unexpected error occurred"}),u({isLoading:!1})}},createCategory:async t=>{try{const e=new Date().toISOString(),a={id:f(),...t,createdAt:e,modifiedAt:e};return await s.categories.add(a),await n().loadCategories(t.projectId),o({variant:"success",title:"Category Created",description:`${t.name} has been created successfully`}),a}catch(e){throw console.error("Error creating category:",e),o({variant:"error",title:"Failed to Create Category",description:e.message||"An unexpected error occurred"}),e}},updateCategory:async(t,e)=>{try{const r=await s.categories.get(t);if(!r)throw new Error("Category not found");const a={...r,...e,modifiedAt:new Date().toISOString()};return await s.categories.update(t,a),await n().loadCategories(r.projectId),o({variant:"success",title:"Category Updated",description:"Category has been updated successfully"}),a}catch(r){throw console.error("Error updating category:",r),o({variant:"error",title:"Failed to Update Category",description:r.message||"An unexpected error occurred"}),r}},deleteCategory:async t=>{try{const e=await s.categories.get(t);if(!e)throw new Error("Category not found");await s.categories.delete(t),await n().loadCategories(e.projectId),o({variant:"success",title:"Category Deleted",description:"Category has been deleted"})}catch(e){throw console.error("Error deleting category:",e),o({variant:"error",title:"Failed to Delete Category",description:e.message||"An unexpected error occurred"}),e}},importCategories:async(t,e)=>{try{const r=new Date().toISOString(),a=await s.categories.where("projectId").equals(t).toArray(),i=new Map;a.forEach(d=>{const g=n().buildCategoryPath(d.id,a);i.set(g,d.id)});const p=[];for(const d of e){const g=d.fullPath||d.name;if(i.has(g))continue;const w=g.split(".");let c="",y=null;for(let h=0;h<w.length;h++){const C=w[h];if(c=c?`${c}.${C}`:C,i.has(c)){y=i.get(c);continue}const l={id:f(),name:C,parentCategoryId:y,projectId:t,createdAt:r,modifiedAt:r};await s.categories.add(l),i.set(c,l.id),p.push(l),y=l.id}}return await n().loadCategories(t),o({variant:"success",title:"Categories Imported",description:`${p.length} categories have been imported`}),p}catch(r){throw console.error("Error importing categories:",r),o({variant:"error",title:"Failed to Import Categories",description:r.message||"An unexpected error occurred"}),r}},buildCategoryPath:(t,e)=>{const r=[];let a=e.find(i=>i.id===t);for(;a;)r.unshift(a.name),a=e.find(i=>i.id===a.parentCategoryId);return r.join(".")},exportCategories:async t=>{try{const e=await s.categories.where("projectId").equals(t).toArray();return e.map(r=>({name:r.name,fullPath:n().buildCategoryPath(r.id,e)}))}catch(e){throw console.error("Error exporting categories:",e),o({variant:"error",title:"Failed to Export Categories",description:e.message||"An unexpected error occurred"}),e}}}));export{I as useCategoryStore};
