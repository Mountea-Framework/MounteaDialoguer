import{c as ce,j as e,i as _,u as L,m as Ze,w as Fe,M as oe,B as k,X as Ae,C as st,x as at,r as j,o as ee,F as rt,y as Ve,s as nt,t as be,U as W,z as G,A as Z,q as V,v as B,E as Be,a as Ke,l as Me,D as te,d as se,e as ae,f as re,g as ne,L as M,I as $,T as it,h as ie,G as Ne,H as ye,J as we,K as Ce,N as ke,O as De,P as Ie,Q as Se,R as Ee,S as Ye,V as lt,W as He,b as ot,Y as ct,Z as dt}from"./index-mU7h8hRK.js";import{C as mt,c as ut,a as xt,u as he,b as Xe,T as Ge,d as pe,M as ht}from"./confetti-CPdCz4f7.js";import{useCategoryStore as Q}from"./categoryStore-M6OlhPSm.js";import{D as ge,a as fe,E as je,b as ve,c as H,d as pt,N as de,C as Qe,A as gt,L as ft,e as jt}from"./app-header-uGGFvY-e.js";import{A as vt,c as bt,d as We,C as Nt,a as yt,b as wt,E as Ct}from"./empty-state-BcsK6Lbn.js";import{P as R}from"./plus-BEmJsT-E.js";import{S as kt,M as Dt}from"./sun-CqPQOzOE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=ce("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ce("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=ce("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=ce("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ce("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ce("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Pt={variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600"}};function Le({className:a,variant:m="default",...s}){return e.jsx("div",{className:_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",Pt.variant[m],a),...s})}function zt({activeSection:a,onSectionChange:m,project:s,dialogueCount:c=0,participantCount:n=0,isMobileOpen:C=!1,onMobileClose:y}){const{t:p}=L(),{status:u,setLoginDialogOpen:x}=Ze(),g=Fe(h=>h.openWithContext),d={connected:"text-green-500",connecting:"text-blue-500",syncing:"text-blue-500",error:"text-red-500",disconnected:"text-muted-foreground"}[u]||"text-muted-foreground",w=[{id:"overview",label:p("navigation.dashboard"),icon:St,color:"text-blue-500"},{id:"dialogues",label:p("dialogues.title"),icon:oe,color:"text-blue-500",count:c},{id:"participants",label:p("participants.title"),icon:et,color:"text-purple-500",count:n},{id:"categories",label:p("categories.title"),icon:Je,color:"text-orange-500"},{id:"decorators",label:p("decorators.title"),icon:Et,color:"text-green-500"}];return e.jsxs("aside",{className:_("flex-shrink-0 bg-card border-border flex flex-col transition-transform duration-300 ease-in-out","fixed inset-y-0 left-0 z-50 h-full w-64","lg:static lg:z-0 lg:translate-x-0","lg:w-80","lg:rounded-none",C?"translate-x-0 rounded-none":"-translate-x-full lg:translate-x-0 md:rounded-xl"),children:[e.jsx("div",{className:"lg:hidden flex justify-end p-4",children:e.jsx(k,{variant:"ghost",size:"icon",onClick:y,className:"rounded-full",children:e.jsx(Ae,{className:"h-5 w-5"})})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:_("p-4 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 border border-blue-100 dark:border-blue-900/30 flex flex-col items-center text-center",C?"flex-row justify-between":""),children:[e.jsx("div",{className:_("w-12 h-12 rounded-lg bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white shadow-md mb-2",C?"hidden":""),children:e.jsx(Je,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-sm line-clamp-1",children:s==null?void 0:s.name}),(s==null?void 0:s.version)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["v",s.version]})]})}),e.jsx("nav",{className:"flex-1 px-3 py-2 space-y-1 overflow-y-auto",children:w.map(h=>{const E=h.icon,F=a===h.id;return e.jsxs("button",{onClick:()=>m(h.id),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",F?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(E,{className:_("h-5 w-5",F&&h.color)}),e.jsx("span",{className:"flex-1 text-left",children:h.label}),h.count!==void 0&&e.jsx("span",{className:"text-[10px] bg-muted px-1.5 py-0.5 rounded-md",children:h.count})]},h.id)})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>x(!0),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors","text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(st,{className:_("h-5 w-5",d)}),e.jsx("span",{children:p("sync.title")})]})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("button",{onClick:()=>g({context:{type:"project",projectId:s==null?void 0:s.id},onOpenSettings:m?()=>m("settings"):null,mode:"detail"}),className:_("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",a==="settings"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-accent hover:text-foreground"),children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{children:p("navigation.settings")})]})})]})}function Ft({project:a,dialogues:m=[],participants:s=[],categories:c=[],decorators:n=[],onExport:C,onImport:y,onDelete:p,onSectionChange:u,fileInputRef:x,isImporting:g=!1}){const{t:d}=L(),[w,h]=j.useState(!ee()),[E,F]=j.useState(),[D,o]=j.useState(0),r=Fe(l=>l.openWithContext),t=j.useRef(vt({delay:2500,stopOnInteraction:!1}));j.useEffect(()=>{const l=()=>h(!ee());return l(),window.addEventListener("resize",l),window.addEventListener("orientationchange",l),window.addEventListener("device-override",l),()=>{window.removeEventListener("resize",l),window.removeEventListener("orientationchange",l),window.removeEventListener("device-override",l)}},[]);const i=!w,v=m.reduce((l,f)=>l+(f.nodeCount||0),0),I=[...m].sort((l,f)=>new Date(f.modifiedAt)-new Date(l.modifiedAt)).slice(0,5);j.useEffect(()=>{i||o(0)},[i]),j.useEffect(()=>{if(!E||!i)return;const l=()=>{o(E.selectedScrollSnap())};return l(),E.on("select",l),E.on("reInit",l),()=>{E.off("select",l),E.off("reInit",l)}},[E,i]);const P=[{id:"file-size",label:"File Size",value:"--",meta:`${v} ${d("dialogues.nodes")}`,icon:e.jsx(rt,{className:"h-4 w-4"}),iconContainerClass:"bg-blue-50 dark:bg-blue-900/20 text-primary"},{id:"modified",label:d("projects.modified"),value:Ve(a.modifiedAt),meta:"Current User",icon:e.jsx(mt,{className:"h-4 w-4"}),iconContainerClass:"bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400"},{id:"created",label:d("projects.created"),value:nt(a.createdAt),meta:a.version?`v${a.version}`:"v1.0.0",icon:e.jsx(bt,{className:"h-4 w-4"}),iconContainerClass:"bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400"}],b=l=>e.jsx(V,{children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${l.iconContainerClass}`,children:l.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:l.label}),e.jsx("h3",{className:"text-lg font-bold truncate",children:l.value}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:l.meta})]})]})})},l.id);return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 text-xs font-medium text-muted-foreground mb-4 ${i?"hidden":""}`,children:[e.jsx(be,{to:"/",className:"hover:text-primary cursor-pointer",children:d("projects.title")}),e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{className:"text-foreground",children:a.name})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-10 min-w-0",children:[e.jsxs("div",{className:"group flex-1 min-w-0",children:[e.jsx("label",{className:"hidden md:block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-1",children:d("projects.projectName")}),e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-4xl font-bold tracking-tight truncate",children:a.name}),a.version&&e.jsxs(Le,{variant:"success",children:["v",a.version]}),e.jsx("button",{onClick:()=>r({context:{type:"project",projectId:a==null?void 0:a.id},onOpenSettings:u?()=>u("settings"):null,mode:"detail"}),className:"hidden md:flex opacity-0 group-hover:opacity-100 p-1.5 rounded-full hover:bg-accent text-muted-foreground hover:text-primary transition-all",title:"Project Settings",children:e.jsx(xe,{className:"h-5 w-5"})})]}),a.description&&e.jsx("p",{className:"mt-3 leading-relaxed max-w-2xl text-muted-foreground text-sm md:text-lg",children:a.description})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs(ge,{className:!0,children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var l;return(l=x==null?void 0:x.current)==null?void 0:l.click()},disabled:g,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),d("common.import")]}),e.jsxs(H,{onClick:C,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),d("common.export")]}),e.jsx(pt,{}),e.jsxs(H,{onClick:p,className:"text-destructive focus:text-destructive",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),d("common.delete")]})]})]})}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var l;return(l=x==null?void 0:x.current)==null?void 0:l.click()},disabled:g,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),d("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:C,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),d("common.export")]}),e.jsx(k,{variant:"outline",size:"sm",onClick:p,className:"gap-2 text-destructive hover:text-destructive hover:border-destructive/50",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]}),i?e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Nt,{opts:{loop:!0,align:"start"},plugins:[t.current],setApi:F,className:"w-full",children:e.jsx(yt,{children:P.map(l=>e.jsx(wt,{children:b(l)},l.id))})}),e.jsx("div",{className:"mt-3 flex items-center justify-center gap-2",children:P.map((l,f)=>e.jsx("button",{type:"button",onClick:()=>E==null?void 0:E.scrollTo(f),className:`h-2 rounded-full transition-all ${D===f?"w-5 bg-primary":"w-2 bg-muted-foreground/40"}`,"aria-label":l.label},l.id))})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 mb-6",children:P.map(l=>b(l))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:d("dialogues.title")}),e.jsxs("button",{onClick:()=>u==null?void 0:u("dialogues"),className:"text-sm text-primary hover:text-blue-600 font-medium flex items-center gap-1 transition-colors",children:["View All ",e.jsx(We,{className:"h-4 w-4"})]})]}),e.jsx(V,{children:e.jsx(B,{className:"p-0",children:I.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d("dialogues.noDialogues")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-border",children:I.map(l=>e.jsxs(be,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:a.id,dialogueId:l.id},className:"p-4 flex items-center justify-between group hover:bg-accent transition-colors cursor-pointer hover:rounded-lg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center text-blue-500",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:l.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Ve(l.modifiedAt)," â€¢ ",l.nodeCount||0," ",d("dialogues.nodes")]})]})]}),e.jsx("button",{className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-card shadow-sm border border-border text-primary hover:bg-primary hover:text-primary-foreground transition-all",children:e.jsx(xe,{className:"h-4 w-4"})})]},l.id))}),e.jsx("div",{className:"bg-muted/50 px-4 py-3 border-t border-border text-center",children:e.jsxs("button",{type:"button",onClick:()=>u==null?void 0:u("dialogues"),className:"text-xs font-medium text-muted-foreground hover:text-primary transition-colors",children:["+ ",d("dialogues.createNew")]})})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{children:e.jsxs(B,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Project Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Project ID"}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-lg border border-border",children:[e.jsxs("code",{className:"text-xs font-mono",children:[a.id.substring(0,12),"..."]}),e.jsxs("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(a.id).then(()=>{Be({variant:"success",title:"Copied",description:"Project ID copied to clipboard."})}).catch(()=>{Be({variant:"error",title:"Copy failed",description:"Unable to copy Project ID."})})},className:"text-muted-foreground hover:text-primary p-1 rounded-md hover:bg-accent transition-colors","aria-label":"Copy Project ID",children:[e.jsx("span",{className:"sr-only",children:"Copy"}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:d("dialogues.title")}),e.jsx("span",{className:"font-medium",children:m.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:d("participants.title")}),e.jsx("span",{className:"font-medium",children:s.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:d("categories.title")}),e.jsx("span",{className:"font-medium",children:c.length})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:d("decorators.title")}),e.jsx("span",{className:"font-medium",children:n.length})]})]})]})]})}),s.length>0&&e.jsx(V,{children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider",children:d("participants.top")}),e.jsx("button",{onClick:()=>u==null?void 0:u("participants"),className:"text-xs text-primary hover:underline",children:d("common.manage")})]}),e.jsxs("div",{className:"flex -space-x-2 overflow-hidden mb-3",children:[s.slice(0,4).map(l=>e.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-card bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:l.name.charAt(0).toUpperCase()},l.id)),s.length>4&&e.jsxs("div",{className:"h-8 w-8 rounded-full ring-2 ring-card bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:["+",s.length-4]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d("participants.inProject",{count:s.length})})]})})]})]})]})}function At({dialogue:a,projectId:m}){const{t:s}=L(),c=Ke(),n=Fe(y=>y.openWithContext),C=a.nodeCount||0;return e.jsx(be,{to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:m,dialogueId:a.id},children:e.jsxs(V,{className:"group cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all h-full flex flex-col overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 flex items-center justify-center relative overflow-hidden rounded-t-lg",children:[e.jsx("div",{className:"absolute inset-0 opacity-30 dark:opacity-20 bg-[radial-gradient(#9333ea_1px,transparent_1px)] [background-size:16px_16px]"}),e.jsx(oe,{className:"h-12 w-12 text-purple-500 dark:text-purple-400 opacity-80 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 relative z-10"}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full bg-background/90 backdrop-blur-sm",onClick:y=>{y.preventDefault(),y.stopPropagation(),n({context:{type:"dialogue",name:a.name,projectId:m,dialogueId:a.id},onOpenSettings:()=>c({to:"/projects/$projectId/dialogue/$dialogueId/settings",params:{projectId:m,dialogueId:a.id}}),mode:"detail"})},children:e.jsx(It,{className:"h-3.5 w-3.5"})})})]}),e.jsxs(B,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsx("h3",{className:"font-bold text-base group-hover:text-primary transition-colors line-clamp-1",children:a.name})}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2 leading-relaxed",children:a.description}),e.jsx("div",{className:"mt-auto pt-3 border-t flex items-center justify-center text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{className:"h-3.5 w-3.5 group-hover:text-purple-500 transition-colors"}),e.jsx("span",{className:"font-medium",children:s("dialogues.nodeCount",{count:C})})]})})]})]})})}function Mt({open:a,onOpenChange:m,projectId:s}){const{t:c}=L(),n=Ke(),{createDialogue:C,dialogues:y}=Me(),[p,u]=j.useState({name:"",description:""}),[x,g]=j.useState({}),[d,w]=j.useState(!1),h=(o,r)=>{u(t=>({...t,[o]:r})),x[o]&&g(t=>({...t,[o]:null}))},E=()=>{const o={};return p.name.trim()?/\s/.test(p.name)&&(o.name="Name cannot contain whitespace"):o.name=c("validation.required"),g(o),Object.keys(o).length===0},F=async o=>{if(o.preventDefault(),!!E()){w(!0);try{const t=y.filter(v=>v.projectId===s).length===0,i=await C({projectId:s,name:p.name.trim(),description:p.description.trim()});t?ut():xt(),u({name:"",description:""}),g({}),m(!1),setTimeout(()=>{n({to:"/projects/$projectId/dialogue/$dialogueId",params:{projectId:s,dialogueId:i.id}})},1e3)}catch(r){console.error("Error creating dialogue:",r),g({submit:c("common.error")})}finally{w(!1)}}},D=()=>{u({name:"",description:""}),g({}),m(!1)};return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:c("dialogues.createNew")}),e.jsx(ne,{children:c("dialogues.createFirst")})]}),e.jsxs("form",{onSubmit:F,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"dialogue-name",children:[c("dialogues.dialogueName")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"dialogue-name",placeholder:"Welcome Conversation",value:p.name,onChange:o=>h("name",o.target.value),className:x.name?"border-destructive":"",autoFocus:!0}),x.name&&e.jsx("p",{className:"text-xs text-destructive",children:x.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"dialogue-description",children:c("projects.projectDescription")}),e.jsx(it,{id:"dialogue-description",placeholder:"A brief description of this dialogue...",value:p.description,onChange:o=>h("description",o.target.value),rows:3})]}),x.submit&&e.jsx("p",{className:"text-sm text-destructive",children:x.submit})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:D,disabled:d,children:c("common.cancel")}),e.jsx(k,{type:"submit",disabled:d,children:c(d?"common.loading":"common.create")})]})]})]})})}function Lt({projectId:a,dialogues:m=[]}){const{t:s}=L(),{importDialogue:c}=Me(),[n,C]=j.useState(!1),[y,p]=j.useState(!1),u=j.useRef(null),x=ee(),g=async d=>{var h;const w=(h=d.target.files)==null?void 0:h[0];if(w){p(!0);try{await c(a,w)}catch(E){console.error("Failed to import dialogue:",E)}finally{p(!1),u.current&&(u.current.value="")}}};return e.jsxs("div",{children:[e.jsx(Mt,{open:n,onOpenChange:C,projectId:a}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("dialogues.title")," (",m.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:u,type:"file",accept:".mnteadlg",onChange:g,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(ve,{align:"end",children:e.jsxs(H,{onClick:()=>{var d;return(d=u.current)==null?void 0:d.click()},disabled:y,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]})})]}),e.jsxs(k,{size:"icon",onClick:()=>C(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(R,{className:"h-4 w-4"}),!x&&s("dialogues.createNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var d;return(d=u.current)==null?void 0:d.click()},disabled:y,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{size:"sm",onClick:()=>C(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("dialogues.createNew")]})]})]})]}),m.length===0?e.jsx(Ct,{icon:oe,title:s("dialogues.noDialogues"),description:s("dialogues.createFirst"),action:e.jsxs(k,{type:"button",onClick:()=>C(!0),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),s("dialogues.createNew")]}),tips:["Dialogues are the backbone of your interactive narratives","Use nodes to create branching conversations","Connect nodes to create dialogue flow"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(d=>e.jsx(At,{dialogue:d,projectId:a},d.id))})]})}function Ot({open:a,onOpenChange:m,projectId:s}){const{t:c}=L(),{createParticipant:n,participants:C}=he(),{categories:y,loadCategories:p}=Q(),[u,x]=j.useState(!1),[g,d]=j.useState({name:"",category:""}),[w,h]=j.useState({});j.useEffect(()=>{a&&s&&p(s)},[a,s,p]);const E=r=>{const t=[];let i=y.find(v=>v.id===r);for(;i;)t.unshift(i.name),i=y.find(v=>v.id===i.parentCategoryId);return t.join(" > ")},F=(()=>{const r=new Map;return y.forEach(t=>{const i=E(t.id);if(!i)return;const[v]=i.split(" > ");r.has(v)||r.set(v,[]),r.get(v).push({id:t.id,name:t.name,label:i})}),Array.from(r.entries()).map(([t,i])=>({label:t,options:i.sort((v,I)=>v.label.localeCompare(I.label))})).sort((t,i)=>t.label.localeCompare(i.label))})(),D=()=>{const r={};if(g.name.trim()?/^[A-Za-z0-9]+$/.test(g.name)?g.name.length>16&&(r.name="Name must be 16 characters or fewer"):r.name="Name must contain only letters and numbers":r.name=c("validation.required"),g.category||(r.category=c("validation.required")),!r.name&&g.category){const t=g.name.trim(),i=y.filter(l=>l.name===g.category),v=l=>{let f=l;const S=new Set;for(;f;){if(S.has(f))return null;S.add(f);const N=y.find(z=>z.id===f);if(!N)return null;if(!N.parentCategoryId)return N.id;f=N.parentCategoryId}return null},I=i.map(l=>v(l.id)).filter(Boolean),b=C.filter(l=>l.projectId===s).some(l=>{if(l.name!==t)return!1;const f=y.find(N=>N.name===l.category);if(!f)return!1;const S=v(f.id);return S&&I.includes(S)});I.length>0&&b&&(r.name="Participant name must be unique within its category tree")}return h(r),Object.keys(r).length===0},o=async r=>{if(r.preventDefault(),!!D()){x(!0);try{await n({...g,projectId:s}),d({name:"",category:""}),h({}),m(!1)}catch(t){console.error("Failed to create participant:",t)}finally{x(!1)}}};return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:c("participants.addNew")}),e.jsx(ne,{children:c("participants.createDescription")})]}),e.jsxs("form",{onSubmit:o,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[c("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:g.name,onChange:r=>{d({...g,name:r.target.value}),w.name&&h({...w,name:null})},placeholder:c("participants.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[c("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(de,{id:"category",value:g.category,onChange:r=>{d({...g,category:r.target.value}),w.category&&h({...w,category:null})},className:w.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:c("participants.categoryPlaceholder")}),F.length===0?e.jsx("option",{value:"",disabled:!0,children:c("categories.noCategories")}):F.map(r=>e.jsx("optgroup",{label:r.label,children:r.options.map(t=>e.jsx("option",{value:t.name,children:t.label},t.id))},r.label))]}),w.category&&e.jsx("p",{className:"text-xs text-destructive",children:w.category})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:u,children:c("common.cancel")}),e.jsx(k,{type:"submit",disabled:u||!g.name.trim()||!g.category,children:c(u?"common.creating":"common.create")})]})]})]})})}function Tt({open:a,onOpenChange:m,participant:s,projectId:c}){const{t:n}=L(),{updateParticipant:C,participants:y}=he(),{categories:p,loadCategories:u}=Q(),[x,g]=j.useState(!1),[d,w]=j.useState({name:"",category:""}),[h,E]=j.useState({});j.useEffect(()=>{a&&c&&u(c),a&&s&&w({name:s.name||"",category:s.category||""})},[a,c,s,u]);const F=t=>{const i=[];let v=p.find(I=>I.id===t);for(;v;)i.unshift(v.name),v=p.find(I=>I.id===v.parentCategoryId);return i.join(" > ")},D=(()=>{const t=new Map;return p.forEach(i=>{const v=F(i.id);if(!v)return;const[I]=v.split(" > ");t.has(I)||t.set(I,[]),t.get(I).push({id:i.id,name:i.name,label:v})}),Array.from(t.entries()).map(([i,v])=>({label:i,options:v.sort((I,P)=>I.label.localeCompare(P.label))})).sort((i,v)=>i.label.localeCompare(v.label))})();j.useEffect(()=>{a||E({})},[a]);const o=()=>{const t={};if(d.name.trim()?/^[A-Za-z0-9]+$/.test(d.name)?d.name.length>16&&(t.name="Name must be 16 characters or fewer"):t.name="Name must contain only letters and numbers":t.name=n("validation.required"),d.category||(t.category=n("validation.required")),!t.name&&d.category&&s){const i=d.name.trim(),v=p.filter(f=>f.name===d.category),I=f=>{let S=f;const N=new Set;for(;S;){if(N.has(S))return null;N.add(S);const z=p.find(O=>O.id===S);if(!z)return null;if(!z.parentCategoryId)return z.id;S=z.parentCategoryId}return null},P=v.map(f=>I(f.id)).filter(Boolean),l=y.filter(f=>f.projectId===c).some(f=>{if(f.id===s.id||f.name!==i)return!1;const S=p.find(z=>z.name===f.category);if(!S)return!1;const N=I(S.id);return N&&P.includes(N)});P.length>0&&l&&(t.name="Participant name must be unique within its category tree")}return E(t),Object.keys(t).length===0},r=async t=>{if(t.preventDefault(),!!o()){g(!0);try{await C(s.id,d),m(!1)}catch(i){console.error("Failed to update participant:",i)}finally{g(!1)}}};return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[n("common.edit")," ",n("participants.title").slice(0,-1)]}),e.jsx(ne,{children:n("participants.updateDescription")})]}),e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[n("participants.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:d.name,onChange:t=>{w({...d,name:t.target.value}),h.name&&E({...h,name:null})},placeholder:n("participants.namePlaceholder"),className:h.name?"border-destructive":"",required:!0}),h.name&&e.jsx("p",{className:"text-xs text-destructive",children:h.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"category",children:[n("participants.category")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(de,{id:"category",value:d.category,onChange:t=>{w({...d,category:t.target.value}),h.category&&E({...h,category:null})},className:h.category?"border-destructive":"",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:n("participants.categoryPlaceholder")}),D.length===0?e.jsx("option",{value:"",disabled:!0,children:n("categories.noCategories")}):D.map(t=>e.jsx("optgroup",{label:t.label,children:t.options.map(i=>e.jsx("option",{value:i.name,children:i.label},i.id))},t.label))]}),h.category&&e.jsx("p",{className:"text-xs text-destructive",children:h.category})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:x,children:n("common.cancel")}),e.jsx(k,{type:"submit",disabled:x||!d.name.trim()||!d.category,children:n(x?"common.saving":"common.save")})]})]})]})})}function _e({participant:a}){const{t:m}=L(),{deleteParticipant:s}=he(),[c,n]=j.useState(!1),[C,y]=j.useState(!1),[p,u]=j.useState(!1),x=async()=>{u(!0);try{await s(a.id),n(!1)}catch(g){console.error("Failed to delete participant:",g)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.category&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.category})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>n(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Tt,{open:C,onOpenChange:y,participant:a,projectId:a.projectId}),e.jsx(Ne,{open:c,onOpenChange:n,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:m("participants.deleteTitle")}),e.jsx(De,{children:m("participants.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:p,children:m("common.cancel")}),e.jsx(Ee,{variant:"destructive",onClick:x,disabled:p,children:m(p?"common.deleting":"common.delete")})]})]})})]})}function Ut({projectId:a,participants:m=[]}){const{t:s}=L(),{importParticipants:c,exportParticipants:n}=he(),{categories:C,loadCategories:y}=Q(),[p,u]=j.useState(!1),[x,g]=j.useState(!1),d=j.useRef(null),w=ee(),[h,E]=j.useState(new Set);j.useEffect(()=>{a&&y(a)},[a,y]);const{rootCategories:F,childrenByParent:D,participantsByCategory:o,unmatchedParticipants:r}=j.useMemo(()=>{const b=new Map;C.forEach(N=>{const z=N.parentCategoryId||null;b.has(z)||b.set(z,[]),b.get(z).push(N)}),b.forEach(N=>{N.sort((z,O)=>z.name.localeCompare(O.name))});const l=new Map;C.forEach(N=>{l.has(N.name)||l.set(N.name,N)});const f=new Map,S=[];return m.forEach(N=>{const z=l.get(N.category);if(!z){S.push(N);return}f.has(z.id)||f.set(z.id,[]),f.get(z.id).push(N)}),f.forEach(N=>{N.sort((z,O)=>z.name.localeCompare(O.name))}),{rootCategories:(b.get(null)||[]).slice().sort((N,z)=>N.name.localeCompare(z.name)),childrenByParent:b,participantsByCategory:f,unmatchedParticipants:S.sort((N,z)=>N.name.localeCompare(z.name))}},[C,m]),t=b=>{E(l=>{const f=new Set(l);return f.has(b)?f.delete(b):f.add(b),f})},i=b=>o.has(b)?!0:(D.get(b)||[]).some(f=>i(f.id)),v=b=>{const l=(D.get(b.id)||[]).filter(N=>i(N.id)),f=o.get(b.id)||[];if(l.length===0&&f.length===0)return null;const S=h.has(b.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>t(b.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[S?e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:b.name})]})}),!S&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[f.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(N=>e.jsx(_e,{participant:N},N.id))}),l.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:l.map(N=>v(N))})]})]},b.id)},I=async()=>{try{const b=await n(a),l=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),f=URL.createObjectURL(l),S=document.createElement("a");S.href=f,S.download=`participants-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(f)}catch(b){console.error("Failed to export participants:",b)}},P=async b=>{var f;const l=(f=b.target.files)==null?void 0:f[0];if(l){g(!0);try{const S=await l.text(),N=JSON.parse(S);await c(a,Array.isArray(N)?N:[N])}catch(S){console.error("Failed to import participants:",S)}finally{g(!1),d.current&&(d.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("participants.title")," (",m.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("participants.description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:d,type:"file",accept:".json",onChange:P,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var b;return(b=d.current)==null?void 0:b.click()},disabled:x,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:I,disabled:m.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>u(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(R,{className:"h-4 w-4"}),!w&&s("participants.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var b;return(b=d.current)==null?void 0:b.click()},disabled:x,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:I,disabled:m.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>u(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("participants.addNew")]})]})]})]}),m.length===0?e.jsx(V,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(et,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("participants.noParticipants")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("participants.noParticipantsDescription")}),e.jsxs(k,{onClick:()=>u(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("participants.addNew")]})]})})}):e.jsxs("div",{className:"space-y-6",children:[F.map(b=>v(b)),r.length>0&&e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3",children:e.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"Uncategorized"})}),e.jsx("div",{className:"p-4 pt-4 border-t border-border",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(b=>e.jsx(_e,{participant:b},b.id))})})]})]}),e.jsx(Ot,{open:p,onOpenChange:u,projectId:a})]})}function Rt({open:a,onOpenChange:m,projectId:s}){const{t:c}=L(),{categories:n,createCategory:C,loadCategories:y}=Q(),[p,u]=j.useState(!1),[x,g]=j.useState({name:"",parentCategoryId:null}),[d,w]=j.useState({});j.useEffect(()=>{a&&s&&y(s)},[a,s,y]),j.useEffect(()=>{a||(g({name:"",parentCategoryId:null}),w({}))},[a]);const h=()=>{const o={};if(x.name.trim()?/^[A-Za-z0-9]+$/.test(x.name)?x.name.length>16&&(o.name="Name must be 16 characters or fewer"):o.name="Name must contain only letters and numbers":o.name=c("validation.required"),x.parentCategoryId){let t=0,i=x.parentCategoryId;const v=new Set;for(;i;){if(v.has(i)){t=Number.POSITIVE_INFINITY;break}v.add(i);const I=n.find(P=>P.id===i);if(!I)break;t+=1,i=I.parentCategoryId||null}(!Number.isFinite(t)||t+1>5)&&(o.parentCategoryId="Category depth cannot exceed 5 levels")}if(x.name.trim()){const r=x.name.trim(),t=P=>{let b=P;const l=new Set;for(;b;){if(l.has(b))return null;l.add(b);const f=n.find(S=>S.id===b);if(!f)return null;if(!f.parentCategoryId)return f.id;b=f.parentCategoryId}return null},i=x.parentCategoryId?t(x.parentCategoryId):null;(i?!(P=>{const b=[P],l=new Set;for(;b.length>0;){const f=b.pop();if(!f||l.has(f))continue;l.add(f);const S=n.find(N=>N.id===f);if(S){if(S.name===r)return!0;n.filter(N=>N.parentCategoryId===S.id).forEach(N=>b.push(N.id))}}return!1})(i):!n.some(P=>!P.parentCategoryId&&P.name===r))||(o.name="Category name must be unique within its tree")}return w(o),Object.keys(o).length===0},E=async o=>{if(o.preventDefault(),!!h()){u(!0);try{await C({name:x.name,parentCategoryId:x.parentCategoryId||null,projectId:s}),g({name:"",parentCategoryId:null}),w({}),m(!1)}catch(r){console.error("Failed to create category:",r)}finally{u(!1)}}},F=o=>{const r=[];let t=n.find(i=>i.id===o);for(;t;)r.unshift(t.name),t=n.find(i=>i.id===t.parentCategoryId);return r.join(" > ")},D=(()=>{const o=new Map;return n.forEach(r=>{const t=F(r.id);if(!t)return;const[i]=t.split(" > ");o.has(i)||o.set(i,[]),o.get(i).push({id:r.id,label:t})}),Array.from(o.entries()).map(([r,t])=>({label:r,options:t.sort((i,v)=>i.label.localeCompare(v.label))})).sort((r,t)=>r.label.localeCompare(t.label))})();return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:c("categories.addNew")}),e.jsx(ne,{children:c("categories.createDescription")})]}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[c("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:x.name,onChange:o=>{g({...x,name:o.target.value}),d.name&&w({...d,name:null})},placeholder:c("categories.namePlaceholder"),className:d.name?"border-destructive":"",required:!0}),d.name&&e.jsx("p",{className:"text-xs text-destructive",children:d.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:c("categories.parentCategory")}),e.jsxs(de,{id:"parentCategory",value:x.parentCategoryId||"none",onChange:o=>{const r=o.target.value;g({...x,parentCategoryId:r==="none"?null:r}),d.parentCategoryId?w({...d,parentCategoryId:null}):d.name&&w({...d,name:null})},children:[e.jsx("option",{value:"none",children:c("categories.noParent")}),D.map(o=>e.jsx("optgroup",{label:o.label,children:o.options.map(r=>e.jsx("option",{value:r.id,children:r.label},r.id))},o.label))]}),d.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:d.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c("categories.parentCategoryHelp")})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:p,children:c("common.cancel")}),e.jsx(k,{type:"submit",disabled:p||!x.name.trim(),children:c(p?"common.creating":"common.create")})]})]})]})})}function qt({open:a,onOpenChange:m,category:s,projectId:c}){const{t:n}=L(),{categories:C,updateCategory:y,loadCategories:p}=Q(),[u,x]=j.useState(!1),[g,d]=j.useState({name:"",parentCategoryId:null}),[w,h]=j.useState({});j.useEffect(()=>{a&&c&&p(c),a&&s&&d({name:s.name||"",parentCategoryId:s.parentCategoryId||null})},[a,c,s,p]),j.useEffect(()=>{a||h({})},[a]);const E=()=>{const r={};g.name.trim()?/^[A-Za-z0-9]+$/.test(g.name)?g.name.length>16&&(r.name="Name must be 16 characters or fewer"):r.name="Name must contain only letters and numbers":r.name=n("validation.required");const t=5,i=new Map;C.forEach(P=>{const b=P.parentCategoryId||null;i.has(b)||i.set(b,[]),i.get(b).push(P.id)});const v=P=>{const b=new Set,l=f=>{if(b.has(f))return 0;b.add(f);const S=i.get(f)||[];if(S.length===0)return 1;let N=0;return S.forEach(z=>{N=Math.max(N,l(z))}),1+N};return l(s==null?void 0:s.id)},I=P=>{let b=0,l=P;const f=new Set;for(;l;){if(f.has(l))return Number.POSITIVE_INFINITY;f.add(l);const S=C.find(N=>N.id===l);if(!S)break;b+=1,l=S.parentCategoryId||null}return b};if(s){const P=g.parentCategoryId?I(g.parentCategoryId):0,b=v(s.id),l=P+b;(!Number.isFinite(P)||l>t)&&(r.parentCategoryId=`Category depth cannot exceed ${t} levels`)}if(s&&g.name.trim()){const P=g.name.trim(),b=N=>{let z=N;const O=new Set;for(;z;){if(O.has(z))return null;O.add(z);const T=C.find(K=>K.id===z);if(!T)return null;if(!T.parentCategoryId)return T.id;z=T.parentCategoryId}return null},l=g.parentCategoryId?b(g.parentCategoryId):s.id;(l?!(N=>{const z=[N],O=new Set;for(;z.length>0;){const T=z.pop();if(!T||O.has(T))continue;O.add(T);const K=C.find(J=>J.id===T);if(K){if(K.id!==s.id&&K.name===P)return!0;C.filter(J=>J.parentCategoryId===K.id).forEach(J=>z.push(J.id))}}return!1})(l):!C.some(N=>!N.parentCategoryId&&N.id!==s.id&&N.name===P))||(r.name="Category name must be unique within its tree")}return h(r),Object.keys(r).length===0},F=async r=>{if(r.preventDefault(),!!E()){x(!0);try{await y(s.id,{name:g.name,parentCategoryId:g.parentCategoryId||null}),m(!1)}catch(t){console.error("Failed to update category:",t)}finally{x(!1)}}},D=r=>{const t=[];let i=C.find(v=>v.id===r);for(;i;)t.unshift(i.name),i=C.find(v=>v.id===i.parentCategoryId);return t.join(" > ")},o=(()=>{const r=new Map;return C.filter(t=>t.id!==(s==null?void 0:s.id)).forEach(t=>{const i=D(t.id);if(!i)return;const[v]=i.split(" > ");r.has(v)||r.set(v,[]),r.get(v).push({id:t.id,label:i})}),Array.from(r.entries()).map(([t,i])=>({label:t,options:i.sort((v,I)=>v.label.localeCompare(I.label))})).sort((t,i)=>t.label.localeCompare(i.label))})();return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[425px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[n("common.edit")," ",n("categories.title").slice(0,-1)]}),e.jsx(ne,{children:n("categories.updateDescription")})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[n("categories.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:g.name,onChange:r=>{d({...g,name:r.target.value}),w.name&&h({...w,name:null})},placeholder:n("categories.namePlaceholder"),className:w.name?"border-destructive":"",required:!0}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"parentCategory",children:n("categories.parentCategory")}),e.jsxs(de,{id:"parentCategory",value:g.parentCategoryId||"none",onChange:r=>{const t=r.target.value;d({...g,parentCategoryId:t==="none"?null:t}),w.parentCategoryId?h({...w,parentCategoryId:null}):w.name&&h({...w,name:null})},children:[e.jsx("option",{value:"none",children:n("categories.noParent")}),o.map(r=>e.jsx("optgroup",{label:r.label,children:r.options.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))},r.label))]}),w.parentCategoryId&&e.jsx("p",{className:"text-xs text-destructive",children:w.parentCategoryId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("categories.parentCategoryHelp")})]})]}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:u,children:n("common.cancel")}),e.jsx(k,{type:"submit",disabled:u||!g.name.trim(),children:n(u?"common.saving":"common.save")})]})]})]})})}function $t({category:a}){const{t:m}=L(),{categories:s,deleteCategory:c}=Q(),[n,C]=j.useState(!1),[y,p]=j.useState(!1),[u,x]=j.useState(!1),g=async()=>{x(!0);try{await c(a.id),C(!1)}catch(h){console.error("Failed to delete category:",h)}finally{x(!1)}},w=(()=>{if(!a.parentCategoryId)return null;const h=s.find(E=>E.id===a.parentCategoryId);return h?h.name:null})();return e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center text-white",children:e.jsx(Ge,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),w&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:w})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>p(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>C(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(qt,{open:y,onOpenChange:p,category:a,projectId:a.projectId}),e.jsx(Ne,{open:n,onOpenChange:C,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:m("categories.deleteTitle")}),e.jsx(De,{children:m("categories.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:u,children:m("common.cancel")}),e.jsx(Ee,{variant:"destructive",onClick:g,disabled:u,children:m(u?"common.deleting":"common.delete")})]})]})})]})}function Vt({projectId:a,categories:m=[]}){const{t:s}=L(),{importCategories:c,exportCategories:n}=Q(),[C,y]=j.useState(!1),[p,u]=j.useState(!1),x=j.useRef(null),g=ee(),[d,w]=j.useState(new Set),h=new Map;m.forEach(t=>{const i=t.parentCategoryId||null;h.has(i)||h.set(i,[]),h.get(i).push(t)});const E=(h.get(null)||[]).slice().sort((t,i)=>t.name.localeCompare(i.name)),F=t=>{w(i=>{const v=new Set(i);return v.has(t)?v.delete(t):v.add(t),v})},D=t=>{const i=(h.get(t.id)||[]).slice().sort((I,P)=>I.name.localeCompare(P.name)),v=d.has(t.id);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:[e.jsx("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>F(t.id),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[v?e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm font-semibold truncate",children:t.name})]})}),!v&&e.jsxs("div",{className:"p-4 pt-4 space-y-5 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx($t,{category:t})}),i.length>0&&e.jsx("div",{className:"space-y-5 pl-4 -ml-4 border-l border-border/60",children:i.map(I=>D(I))})]})]},t.id)},o=async()=>{try{const t=await n(a),i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),v=URL.createObjectURL(i),I=document.createElement("a");I.href=v,I.download=`categories-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(v)}catch(t){console.error("Failed to export categories:",t)}},r=async t=>{var v;const i=(v=t.target.files)==null?void 0:v[0];if(i){u(!0);try{const I=await i.text(),P=JSON.parse(I);await c(a,Array.isArray(P)?P:[P])}catch(I){console.error("Failed to import categories:",I)}finally{u(!1),x.current&&(x.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("categories.title")," (",m.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("categories.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:x,type:"file",accept:".json",onChange:r,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var t;return(t=x.current)==null?void 0:t.click()},disabled:p,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:o,disabled:m.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(R,{className:"h-4 w-4"}),!g&&s("categories.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var t;return(t=x.current)==null?void 0:t.click()},disabled:p,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:o,disabled:m.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("categories.addNew")]})]})]})]}),m.length===0?e.jsx(V,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ge,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("categories.noCategories")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("categories.noCategoriesDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("categories.addNew")]})]})})}):e.jsx("div",{className:"space-y-6",children:E.map(t=>D(t))}),e.jsx(Rt,{open:C,onOpenChange:y,projectId:a})]})}function Bt({open:a,onOpenChange:m,projectId:s}){const{t:c}=L(),{createDecorator:n}=pe(),[C,y]=j.useState(!1),[p,u]=j.useState({name:"",type:"",properties:[]}),[x,g]=j.useState({}),d=()=>{u({...p,properties:[...p.properties,{name:"",type:"string",defaultValue:""}]})},w=(D,o,r)=>{const t=[...p.properties];t[D]={...t[D],[o]:r},u({...p,properties:t})},h=D=>{u({...p,properties:p.properties.filter((o,r)=>r!==D)})},E=()=>{const D={};return p.name.trim()?/\s/.test(p.name)&&(D.name=c("decorators.validation.noWhitespace")):D.name=c("validation.required"),g(D),Object.keys(D).length===0},F=async D=>{if(D.preventDefault(),!!E()){y(!0);try{await n({...p,projectId:s}),u({name:"",type:"",properties:[]}),g({}),m(!1)}catch(o){console.error("Failed to create decorator:",o)}finally{y(!1)}}};return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[600px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:c("decorators.addNew")}),e.jsx(ne,{children:c("decorators.createDescription")})]}),e.jsxs("form",{onSubmit:F,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[c("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:p.name,onChange:D=>{u({...p,name:D.target.value}),x.name&&g({...x,name:null})},placeholder:c("decorators.namePlaceholder"),className:x.name?"border-destructive":"",required:!0}),x.name&&e.jsx("p",{className:"text-xs text-destructive",children:x.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:c("decorators.type")}),e.jsx($,{id:"type",value:p.type,onChange:D=>u({...p,type:D.target.value}),placeholder:c("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:c("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:d,className:"gap-2",children:[e.jsx(R,{className:"h-3 w-3"}),c("decorators.properties.add")]})]}),p.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:c("decorators.properties.empty")}),p.properties.map((D,o)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:c("decorators.properties.name")}),e.jsx($,{value:D.name,onChange:r=>w(o,"name",r.target.value),placeholder:c("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:c("decorators.properties.type")}),e.jsx(de,{value:D.type,onChange:r=>w(o,"type",r.target.value),children:[{value:"string",label:c("decorators.types.string")},{value:"int",label:c("decorators.types.integer")},{value:"float",label:c("decorators.types.float")},{value:"bool",label:c("decorators.types.boolean")}].map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:c("decorators.properties.defaultValue")}),e.jsx($,{value:D.defaultValue,onChange:r=>w(o,"defaultValue",r.target.value),placeholder:D.type==="bool"?c("decorators.properties.placeholders.bool"):D.type==="int"?c("decorators.properties.placeholders.int"):D.type==="float"?c("decorators.properties.placeholders.float"):c("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>h(o),className:"h-9 w-9",children:e.jsx(Ae,{className:"h-4 w-4"})})]},o))]})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:C,children:c("common.cancel")}),e.jsx(k,{type:"submit",disabled:C||!p.name.trim(),children:c(C?"common.creating":"common.create")})]})]})]})})}function Ht({open:a,onOpenChange:m,decorator:s,projectId:c}){const{t:n}=L(),{updateDecorator:C}=pe(),[y,p]=j.useState(!1),[u,x]=j.useState({name:"",type:"",properties:[]}),[g,d]=j.useState({});j.useEffect(()=>{a&&s&&x({name:s.name||"",type:s.type||"",properties:Array.isArray(s.properties)?s.properties:[]})},[a,s]),j.useEffect(()=>{a||d({})},[a]);const w=()=>{x(o=>({...o,properties:[...o.properties,{name:"",type:"string",defaultValue:""}]}))},h=(o,r,t)=>{const i=[...u.properties];i[o]={...i[o],[r]:t},x({...u,properties:i})},E=o=>{x(r=>({...r,properties:r.properties.filter((t,i)=>i!==o)}))},F=()=>{const o={};return u.name.trim()?/\s/.test(u.name)&&(o.name=n("decorators.validation.noWhitespace")):o.name=n("validation.required"),d(o),Object.keys(o).length===0},D=async o=>{if(o.preventDefault(),!!F()){p(!0);try{await C(s.id,{name:u.name,type:u.type,properties:u.properties,projectId:c}),m(!1)}catch(r){console.error("Failed to update decorator:",r)}finally{p(!1)}}};return e.jsx(te,{open:a,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-[600px]",children:[e.jsxs(ae,{children:[e.jsxs(re,{children:[n("common.edit")," ",n("decorators.title").slice(0,-1)]}),e.jsx(ne,{children:n("decorators.updateDescription")})]}),e.jsxs("form",{onSubmit:D,children:[e.jsx("div",{className:"no-scrollbar -mx-4 max-h-[50vh] overflow-y-auto px-4 sm:-mx-6 sm:px-6",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"name",children:[n("decorators.name")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{id:"name",value:u.name,onChange:o=>{x({...u,name:o.target.value}),g.name&&d({...g,name:null})},placeholder:n("decorators.namePlaceholder"),className:g.name?"border-destructive":"",required:!0}),g.name&&e.jsx("p",{className:"text-xs text-destructive",children:g.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"type",children:n("decorators.type")}),e.jsx($,{id:"type",value:u.type,onChange:o=>x({...u,type:o.target.value}),placeholder:n("decorators.typePlaceholder")})]}),e.jsxs("div",{className:"grid gap-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:n("decorators.properties.title")}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:w,className:"gap-2",children:[e.jsx(R,{className:"h-3 w-3"}),n("decorators.properties.add")]})]}),u.properties.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:n("decorators.properties.empty")}),u.properties.map((o,r)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,1fr,auto] gap-2 items-end bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:n("decorators.properties.name")}),e.jsx($,{value:o.name,onChange:t=>h(r,"name",t.target.value),placeholder:n("decorators.properties.namePlaceholder"),size:"sm",required:!0})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:n("decorators.properties.type")}),e.jsx(de,{value:o.type,onChange:t=>h(r,"type",t.target.value),children:[{value:"string",label:n("decorators.types.string")},{value:"int",label:n("decorators.types.integer")},{value:"float",label:n("decorators.types.float")},{value:"bool",label:n("decorators.types.boolean")}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(M,{className:"text-xs",children:n("decorators.properties.defaultValue")}),e.jsx($,{value:o.defaultValue,onChange:t=>h(r,"defaultValue",t.target.value),placeholder:n("decorators.properties.placeholders.value"),size:"sm"})]}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>E(r),children:e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})})]},r))]})]})}),e.jsxs(ie,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:y,children:n("common.cancel")}),e.jsx(k,{type:"submit",disabled:y||!u.name.trim(),children:n(y?"common.saving":"common.save")})]})]})]})})}function Wt({decorator:a}){const{t:m}=L(),{deleteDecorator:s}=pe(),[c,n]=j.useState(!1),[C,y]=j.useState(!1),[p,u]=j.useState(!1),x=async()=>{u(!0);try{await s(a.id),n(!1)}catch(g){console.error("Failed to delete decorator:",g)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"group hover:shadow-md transition-all hover:border-primary/50",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white",children:e.jsx(Ye,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),a.type&&e.jsx(Le,{variant:"outline",className:"mt-1 text-xs",children:a.type})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>n(!0),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})}),e.jsx(Ht,{open:C,onOpenChange:y,decorator:a,projectId:a.projectId}),e.jsx(Ne,{open:c,onOpenChange:n,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:m("decorators.deleteTitle")}),e.jsx(De,{children:m("decorators.deleteDescription",{name:a.name})})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",disabled:p,children:m("common.cancel")}),e.jsx(Ee,{variant:"destructive",onClick:x,disabled:p,children:m(p?"common.deleting":"common.delete")})]})]})})]})}function Jt({projectId:a,decorators:m=[]}){const{t:s}=L(),{importDecorators:c,exportDecorators:n}=pe(),[C,y]=j.useState(!1),[p,u]=j.useState(!1),x=j.useRef(null),g=ee(),d=async()=>{try{const h=await n(a),E=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),F=URL.createObjectURL(E),D=document.createElement("a");D.href=F,D.download=`decorators-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(F)}catch(h){console.error("Failed to export decorators:",h)}},w=async h=>{var F;const E=(F=h.target.files)==null?void 0:F[0];if(E){u(!0);try{const D=await E.text(),o=JSON.parse(D);await c(a,Array.isArray(o)?o:[o])}catch(D){console.error("Failed to import decorators:",D)}finally{u(!1),x.current&&(x.current.value="")}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-top justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s("decorators.title")," (",m.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("decorators.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:x,type:"file",accept:".json",onChange:w,className:"hidden"}),e.jsxs("div",{className:"md:hidden flex gap-2 flex-1",children:[e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",className:"rounded-full",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{onClick:()=>{var h;return(h=x.current)==null?void 0:h.click()},disabled:p,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),s("common.import")]}),e.jsxs(H,{onClick:d,disabled:m.length===0,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs(k,{size:"icon",onClick:()=>y(!0),className:"gap-2 flex-1 rounded-full",children:[e.jsx(R,{className:"h-4 w-4"}),!g&&s("decorators.addNew")]})]}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var h;return(h=x.current)==null?void 0:h.click()},disabled:p,className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s("common.import")]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:d,disabled:m.length===0,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s("common.export")]}),e.jsxs(k,{size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("decorators.addNew")]})]})]})]}),m.length===0?e.jsx(V,{children:e.jsx(B,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ye,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("decorators.noDecorators")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s("decorators.noDecoratorsDescription")}),e.jsxs(k,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s("decorators.addNew")]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(h=>e.jsx(Wt,{decorator:h},h.id))}),e.jsx(Bt,{open:C,onOpenChange:y,projectId:a})]})}function es(){const{t:a}=L(),{theme:m,resolvedTheme:s,setTheme:c}=lt(),{projectId:n}=He.useParams(),C=He.useSearch(),y=ee(),{projects:p,loadProjects:u,deleteProject:x,exportProject:g,importProject:d}=ot(),{dialogues:w,loadDialogues:h}=Me(),{participants:E,loadParticipants:F}=he(),{categories:D,loadCategories:o}=Q(),{decorators:r,loadDecorators:t}=pe(),{status:i,checkRemoteDiff:v,startPull:I,lastSyncedAt:P}=Ze(),[b,l]=j.useState(!0),[f,S]=j.useState((C==null?void 0:C.section)||"overview"),[N,z]=j.useState(!1),[O,T]=j.useState(!1),[K,J]=j.useState(!1),Oe=j.useRef(new Set),Y=j.useRef(null),me=j.useCallback(async()=>{l(!0),await Promise.all([u(),h(),F(n),o(n),t(n)]),l(!1)},[u,h,F,o,t,n]);j.useEffect(()=>{me()},[me]),j.useEffect(()=>{P&&me()},[P,me]),j.useEffect(()=>{(async()=>{if(!n||i!=="connected"||Oe.current.has(n))return;Oe.current.add(n),await v(n)&&await I(n,{simulate:!0})})()},[n,i,v,I]);const ue=p.find(A=>A.id===n),Pe=w.filter(A=>A.projectId===n),ze=E.filter(A=>A.projectId===n),Te=D.filter(A=>A.projectId===n),Ue=r.filter(A=>A.projectId===n),le=async()=>{try{await g(n)}catch(A){console.error("Failed to export project:",A)}};j.useEffect(()=>{const A=U=>{const X=U==null?void 0:U.detail;!X||X.projectId!==n||le()},q=U=>{const X=U==null?void 0:U.detail;!X||X.projectId!==n||Y.current&&Y.current.click()};return window.addEventListener("command:project-export",A),window.addEventListener("command:project-import",q),()=>{window.removeEventListener("command:project-export",A),window.removeEventListener("command:project-import",q)}},[n,le]),j.useEffect(()=>{if(y)return;const A=q=>{const U=q.target;if(!(U.tagName==="INPUT"||U.tagName==="TEXTAREA"||U.isContentEditable)&&(q.ctrlKey||q.metaKey)){const $e=q.key.toLowerCase();if($e==="e"){q.preventDefault(),le();return}$e==="i"&&(q.preventDefault(),Y.current&&Y.current.click())}};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[le,y]);const Re=async A=>{var U;const q=(U=A.target.files)==null?void 0:U[0];if(q){z(!0);try{await d(q),await me()}catch(X){console.error("Failed to import project:",X)}finally{z(!1),Y.current&&(Y.current.value="")}}},tt=async()=>{await x(n),window.location.href="#/"},qe=()=>{J(!0)};return b?e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsx("p",{className:"text-muted-foreground",children:a("common.loading")})}):ue?e.jsxs("div",{className:`${y?"h-[100dvh]":"h-screen"} flex flex-col overflow-hidden`,children:[e.jsx(gt,{className:O?"z-40":void 0,left:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>T(!0),className:"lg:hidden rounded-full shrink-0",children:e.jsx(ht,{className:"h-5 w-5"})}),e.jsx(be,{to:"/",children:e.jsx(ct,{content:a("common.back"),side:"bottom",children:e.jsx(k,{variant:"ghost",size:"icon",className:"rounded-full shrink-0",children:e.jsx(jt,{className:"h-5 w-5"})})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-sm md:text-2xl font-bold tracking-tight truncate",children:ue.name}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:a("projects.projectDetails")})]})]}),right:e.jsxs("div",{className:"hidden md:flex items-center text-xs font-medium text-muted-foreground bg-muted px-3 py-1.5 rounded-full","data-header-mobile-hidden":!0,children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),a("dialogues.autoSaved")]}),menuItems:e.jsxs(e.Fragment,{children:[e.jsx(ft,{}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>c(s==="dark"?"light":"dark"),className:"justify-start",children:s==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),a("settings.lightMode")]}):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),a("settings.darkMode")]})})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>T(!1)}),e.jsx("input",{ref:Y,type:"file",accept:".mnteadlgproj",onChange:Re,className:"hidden"}),e.jsxs("div",{className:"flex-1 flex min-h-0 overflow-hidden",children:[e.jsx(zt,{activeSection:f,onSectionChange:A=>{S(A),T(!1)},project:ue,dialogueCount:Pe.length,participantCount:ze.length,isMobileOpen:O,onMobileClose:()=>T(!1)}),e.jsx("main",{className:"flex-1 bg-grid overflow-x-hidden overflow-y-auto overscroll-contain",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8 lg:p-12",children:[f==="overview"&&e.jsx(Ft,{project:ue,dialogues:Pe,participants:ze,categories:Te,decorators:Ue,onExport:le,onImport:Re,onDelete:qe,onSectionChange:S,fileInputRef:Y,isImporting:N}),f==="dialogues"&&e.jsx(Lt,{projectId:n,dialogues:Pe}),f==="participants"&&e.jsx(Ut,{projectId:n,participants:ze}),f==="categories"&&e.jsx(Vt,{projectId:n,categories:Te}),f==="decorators"&&e.jsx(Jt,{projectId:n,decorators:Ue}),f==="settings"&&e.jsx(dt,{project:ue,onExport:le,onDelete:qe})]})})]}),e.jsx(Ne,{open:K,onOpenChange:J,children:e.jsxs(ye,{variant:"destructive",size:"sm",children:[e.jsxs(we,{children:[e.jsx(Ce,{className:"bg-destructive/10 text-destructive dark:bg-destructive/20 dark:text-destructive",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx(ke,{children:a("projects.deleteProject")}),e.jsx(De,{children:a("projects.deleteConfirm")})]}),e.jsxs(Ie,{children:[e.jsx(Se,{variant:"outline",children:a("common.cancel")}),e.jsx(Ee,{variant:"destructive",onClick:()=>{J(!1),tt()},children:a("common.delete")})]})]})})]}):e.jsx("div",{className:`${y?"min-h-screen":"h-screen"} flex items-center justify-center`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a("projects.notFound")}),e.jsx("p",{className:"text-muted-foreground",children:a("projects.notFoundDescription")})]})})}export{es as component};
